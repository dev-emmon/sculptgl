!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.sculptgl=t():e.sculptgl=t()}("undefined"!=typeof self?self:this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=37)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(1),i={};i.SCALE=100,i.TAG_FLAG=1,i.SCULPT_FLAG=1,i.STATE_FLAG=1,i.TRI_INDEX=4294967295,i.cursors={},i.cursors.dropper="url(/components/em-sculptgl/app/resources/dropper.png) 5 25, auto",i.linearToSRGB1=function(e){return e<.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055},i.sRGBToLinear1=function(e){return e<.04045?e*(1/12.92):Math.pow((e+.055)*(1/1.055),2.4)},i.extend=function(e,t){for(var r=Object.keys(t),n=0,i=r.length;n<i;++n){var a=r[n];void 0===e[a]&&(e[a]=t[a])}return e},i.invert=function(e){for(var t=Object.keys(e),r={},n=0,i=t.length;n<i;++n)r[e[t[n]]]=t[n];return r},i.replaceElement=function(e,t,r){for(var n=0,i=e.length;n<i;++n)if(e[n]===t)return void(e[n]=r)},i.removeElement=function(e,t){for(var r=0,n=e.length;r<n;++r)if(e[r]===t)return e[r]=e[n-1],void e.pop()},i.appendArray=function(e,t){var r=e.length,n=t.length;e.length+=n;for(var i=0;i<n;++i)e[r+i]=t[i]},i.isPowerOfTwo=function(e){return 0!==e&&0==(e&e-1)},i.nextHighestPowerOfTwo=function(e){--e;for(var t=1;t<32;t<<=1)e|=e>>t;return e+1};var a=function(e,t){return e-t};i.tidy=function(e){e.sort(a);var t=e.length,r=0,n=0;for(r=1;r<t;++r)e[n]!==e[r]&&(e[++n]=e[r]);r>1&&(e.length=n+1)},i.intersectionArrays=function(e,t){for(var r=0,n=0,i=[],a=e.length,s=t.length;r<a&&n<s;)e[r]<t[n]?r++:e[r]>t[n]?n++:(i.push(e[r]),++r,++n);return i},i.littleEndian=function(){var e=new ArrayBuffer(2);return new DataView(e).setInt16(0,256,!0),256===new Int16Array(e)[0]}(),i.getBytes=function(e,t){return[e[t].charCodeAt(),e[t+1].charCodeAt(),e[t+2].charCodeAt(),e[t+3].charCodeAt()]},i.getUint32=function(e,t){var r=i.getBytes(e,t);return r[0]<<0|r[1]<<8|r[2]<<16|r[3]<<24},i.getFloat32=function(e,t){var r=i.getBytes(e,t),n=1-2*(r[3]>>7),a=(r[3]<<1&255|r[2]>>7)-127,s=(127&r[2])<<16|r[1]<<8|r[0];return 128===a?0!==s?NaN:n*(1/0):-127===a?n*s*Math.pow(2,-149):n*(1+s*Math.pow(2,-23))*Math.pow(2,a)},i.ab2str=function(e){for(var t="",r=new Uint8Array(e),n=0,i=r.length;n<i;n+=65535){var a=r.subarray(n,65535<i-n?65535+n:i);t+=String.fromCharCode.apply(null,a)}return t},i.getMemory=function(){var e=new ArrayBuffer(1e5);return function(t){return e.byteLength>=t?e:e=new ArrayBuffer(t)}}(),i.now=Date.now||function(){return(new Date).getTime()},i.throttle=function(e,t){var r,n=[],a=null,s=0,o=function(){s=i.now(),a=null,r=e.apply(e,n)};return function(){for(var u=i.now(),l=t-(u-s),c=n.length=arguments.length,h=0;h<c;++h)n[h]=arguments[h];return l<=0||l>t?(window.clearTimeout(a),a=null,s=u,r=e.apply(e,n)):a||(a=window.setTimeout(o,l)),r}},i.normalizeArrayVec3=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,r=0,n=e.length/3;r<n;++r){var i=3*r,a=e[i],s=e[i+1],o=e[i+2],u=a*a+s*s+o*o;0!==u?(u=1/Math.sqrt(u),t[i]=a*u,t[i+1]=s*u,t[i+2]=o*u):t[i]=1}return t},i.convertArrayVec3toSRGB=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,r=0,n=e.length;r<n;++r)t[r]=i.linearToSRGB1(e[r]);return t},i.convertArrayVec3toLinear=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,r=0,n=e.length;r<n;++r)t[r]=i.sRGBToLinear1(e[r]);return t},i.computeWorldVertices=function(e,t){var r=e.getNbVertices(),i=e.getVertices().subarray(0,3*r);t||(t=new Float32Array(3*r));for(var a=e.getMatrix(),s=n.vec3.create(),o=0;o<r;++o){var u=3*o;n.vec3.set(s,i[u],i[u+1],i[u+2]),n.vec3.transformMat4(s,s,a),t[u]=s[0],t[u+1]=s[1],t[u+2]=s[2]}return t};var s=i;t.default=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(8),i=r(40),a=r(41),s=r(22),o=r(42),u=r(43),l=r(44),c=r(23),h=r(24);r.d(t,"glMatrix",function(){return n}),r.d(t,"mat2",function(){return i}),r.d(t,"mat2d",function(){return a}),r.d(t,"mat3",function(){return s}),r.d(t,"mat4",function(){return o}),r.d(t,"quat",function(){return u}),r.d(t,"vec2",function(){return l}),r.d(t,"vec3",function(){return c}),r.d(t,"vec4",function(){return h})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(e){return e&&e.__esModule?e:{default:e}}(r(0)),i={};i.Action={NOTHING:0,MASK_EDIT:1,SCULPT_EDIT:2,CAMERA_ZOOM:3,CAMERA_ROTATE:4,CAMERA_PAN:5,CAMERA_PAN_ZOOM_ALT:6},i.Tools={BRUSH:0,INFLATE:1,TWIST:2,SMOOTH:3,FLATTEN:4,PINCH:5,CREASE:6,DRAG:7,PAINT:8,MOVE:9,MASKING:10,LOCALSCALE:11,TRANSFORM:12},i.Shader={PBR:0,FLAT:1,NORMAL:2,WIREFRAME:3,UV:4,MATCAP:5,SELECTION:6,BACKGROUND:7,MERGE:8,FXAA:9,CONTOUR:10},i.Projection={PERSPECTIVE:0,ORTHOGRAPHIC:1},i.CameraMode={ORBIT:0,SPHERICAL:1,PLANE:2},i.MultiState={NONE:0,SCULPT:1,CAMERA:2,PICKING:3};var a=Object.keys(i.Tools).length;i.KeyAction=n.default.extend({INTENSITY:a++,RADIUS:a++,NEGATIVE:a++,PICKER:a++,DELETE:a++,CAMERA_FRONT:a++,CAMERA_TOP:a++,CAMERA_LEFT:a++,CAMERA_RESET:a++,STRIFE_LEFT:a++,STRIFE_RIGHT:a++,STRIFE_UP:a++,STRIFE_DOWN:a++,WIREFRAME:a++,REMESH:a++},i.Tools);var s=i;t.default=s},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(5)),a=n(r(53)),s=n(r(54)),o=n(r(55)),u=(n(r(56)),n(r(57)),n(r(58)),n(r(59)),n(r(60)),n(r(61)),function e(t){var r=e.languages[e.select][t]||e.languages.english[t];return"string"==typeof r?r:"function"==typeof r?r.apply(this,Array.prototype.slice.call(arguments,1)):(console.error("No TR found for : "+t),t)});u.languages={"中文(简体)":s.default,"中文(繁體)":o.default,english:a.default},u.select="中文(简体)";var l=window.navigator.language||window.navigator.userLanguage;switch(l&&(l=l.substr(0,2)),"en"===l?u.select="english":"zh_s"===l?u.select="中文(简体)":"zh_t"===l&&(u.select="中文(繁體)"),(0,i.default)().language){case"english":u.select="english";break;case"chinese_s":u.select="中文(简体)";break;case"chinese_t":u.select="中文(繁體)";break;case"korean":u.select="한국어";break;case"japanese":u.select="日本語";break;case"russian":u.select="русский";break;case"turkish":u.select="turkish";break;case"swedish":u.select="svenska";break;case"french":u.select="français"}var c=u;t.default=c},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(1),a=n(r(5)),s=n(r(0)),o=n(r(13)),u=n(r(50)),l=n(r(51)),c={};c.vertexName="VertexName",c.fragmentName="FragmentName",c.activeAttributes={vertex:!0,normal:!0,material:!0,color:!0},c.showSymmetryLine=(0,a.default)().mirrorline,c.darkenUnselected=(0,a.default)().darkenunselected,c.uniformNames={},c.uniformNames.commonUniforms=["uMV","uMVP","uN","uEM","uEN","uFlat","uPlaneO","uPlaneN","uSym","uCurvature","uAlpha","uFov","uDarken"],c.strings={},c.strings.colorSpaceGLSL=u.default,c.strings.vertUniforms=["uniform mat4 uMV;","uniform mat4 uMVP;","uniform mat3 uN;","uniform mat4 uEM;","uniform mat3 uEN;","uniform float uAlpha;"].join("\n"),c.strings.fragColorUniforms=["uniform vec3 uPlaneN;","uniform vec3 uPlaneO;","uniform int uSym;","uniform int uDarken;","uniform float uCurvature;","uniform float uFov;","varying float vMasking;","uniform int uFlat;"].join("\n"),c.strings.fragColorFunction=[l.default,u.default,"#extension GL_OES_standard_derivatives : enable","vec3 getNormal() {","  #ifndef GL_OES_standard_derivatives","    return normalize(gl_FrontFacing ? vNormal : -vNormal);","  #else","    return uFlat == 0 ? normalize(gl_FrontFacing ? vNormal : -vNormal) : -normalize(cross(dFdy(vVertex), dFdx(vVertex)));","  #endif","}","vec4 encodeFragColor(const in vec3 frag, const in float alpha) {","  vec3 col = computeCurvature(vVertex, vNormal, frag, uCurvature, uFov);","  if(uDarken == 1) col *= 0.3;","  col *= (0.3 + 0.7 * vMasking);","  if(uSym == 1 && abs(dot(uPlaneN, vVertex - uPlaneO)) < 0.15)","      col = min(col * 1.5, 1.0);","  return alpha != 1.0 ? vec4(col * alpha, alpha) : encodeRGBM(col);","}"].join("\n");var h=function(e){var t="",r=e.match(/^\s*(#extension).*/gm);if(r)for(var n={},i=0,a=r.length;i<a;++i){var s=r[i].substr(r[i].indexOf("#extension"));e=e.replace(r[i],""),n[s]||(n[s]=!0,t+=s+"\n")}var o="";-1===e.indexOf("#version")&&(o+="#version 100\n");var u="";return/precision\s+(high|low|medium)p\s+float/.test(e)||(u+="#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n#else\n  precision mediump float;\n#endif\n"),e=o+t+u+e};c.getOrCreate=function(e){if(this.program)return this;var t="\n#define SHADER_NAME "+this.vertexName+"\n",r="\n#define SHADER_NAME "+this.fragmentName+"\n",n=e.createShader(e.VERTEX_SHADER);e.shaderSource(n,h(this.vertex+t)),e.compileShader(n);var i=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(i,h(this.fragment+r)),e.compileShader(i);var a=this.program=e.createProgram();e.attachShader(a,n),e.attachShader(a,i),e.linkProgram(a),e.useProgram(a);var s=e.getShaderInfoLog(n),o=e.getShaderInfoLog(i),u=e.getProgramInfoLog(a);return s&&console.warn(this.vertexName+" (vertex)\n"+s),o&&console.warn(this.fragmentName+" (fragment)\n"+o),u&&console.warn(this.fragmentName+" (program)\n"+u),this.initAttributes(e),this.initUniforms(e),this},c.initUniforms=function(e){for(var t=this.program,r=this.uniformNames,n=this.uniforms,i=0,a=r.length;i<a;++i){var s=r[i];n[s]=e.getUniformLocation(t,s)}},c.updateUniforms=function(){var e=[0,0,0];return function(t,r){var n=t.getGL(),a=c.darkenUnselected&&r.getIndexSelectMesh(t)<0,s=c.showSymmetryLine&&t.getID()===r.getMesh().getID()&&r.getSculptManager().getSymmetry(),o=this.uniforms;n.uniformMatrix4fv(o.uEM,!1,t.getEditMatrix()),n.uniformMatrix3fv(o.uEN,!1,t.getEN()),n.uniformMatrix4fv(o.uMV,!1,t.getMV()),n.uniformMatrix4fv(o.uMVP,!1,t.getMVP()),n.uniformMatrix3fv(o.uN,!1,t.getN()),n.uniform1i(o.uDarken,a?1:0),n.uniform1i(o.uFlat,t.getFlatShading()),n.uniform3fv(o.uPlaneO,i.vec3.transformMat4(e,t.getSymmetryOrigin(),t.getMV())),n.uniform3fv(o.uPlaneN,i.vec3.normalize(e,i.vec3.transformMat3(e,t.getSymmetryNormal(),t.getN()))),n.uniform1i(o.uSym,s?1:0),n.uniform1f(o.uAlpha,t.getOpacity()),n.uniform1f(o.uCurvature,t.getCurvature());var u=r.getCamera();n.uniform1f(o.uFov,u.isOrthographic()?25*-Math.abs(u._trans[2]):u.getFov())}}(),c.draw=function(e,t){e.getGL().useProgram(this.program),this.bindAttributes(e),this.updateUniforms(e,t),this.drawBuffer(e)},c.drawBuffer=function(e){var t=e.getGL();e.isUsingDrawArrays()?t.drawArrays(e.getMode(),0,e.getCount()):(e.getIndexBuffer().bind(),t.drawElements(e.getMode(),e.getCount(),t.UNSIGNED_INT,0)),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),this.unbindAttributes()},c.setTextureParameters=function(e,t){e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),s.default.isPowerOfTwo(t.width)&&s.default.isPowerOfTwo(t.height)?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.generateMipmap(e.TEXTURE_2D)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE))},c.onLoadTexture0=function(e,t,r){this.texture0=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture0),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),c.setTextureParameters(e,t),e.bindTexture(e.TEXTURE_2D,null),r&&r.render()},c.getDummyTexture=function(e){return this._dummyTex?this._dummyTex:(this._dummyTex=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this._dummyTex),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array(4)),e.bindTexture(e.TEXTURE_2D,null),this._dummyTex)},c.getOrCreateTexture0=function(e,t,r){if(void 0!==this.texture0)return this.texture0;this.texture0=null;var n=new Image;return n.src=t,n.onload=this.onLoadTexture0.bind(this,e,n,r),!1},c.initAttributes=function(e){var t=this.program,r=this.attributes;r.aVertex=new o.default(e,t,"aVertex",3,e.FLOAT),r.aNormal=new o.default(e,t,"aNormal",3,e.FLOAT),r.aColor=new o.default(e,t,"aColor",3,e.FLOAT),r.aMaterial=new o.default(e,t,"aMaterial",3,e.FLOAT)},c.bindAttributes=function(e){var t=this.attributes,r=this.activeAttributes;r.vertex&&t.aVertex.bindToBuffer(e.getVertexBuffer()),r.normal&&t.aNormal.bindToBuffer(e.getNormalBuffer()),r.color&&t.aColor.bindToBuffer(e.getColorBuffer()),r.material&&t.aMaterial.bindToBuffer(e.getMaterialBuffer())},c.unbindAttributes=function(){var e=this.attributes,t=this.activeAttributes;t.vertex&&e.aVertex.unbind(),t.normal&&e.aNormal.unbind(),t.color&&e.aColor.unbind(),t.material&&e.aMaterial.unbind()},c.getCopy=function(){for(var e=Object.keys(c),t={},r=0,n=e.length;r<n;++r)t[e[r]]=this[e[r]];return t.program=null,t};var f=c;t.default=f},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,i=function(e){return e&&e.__esModule?e:{default:e}}(r(2)),a=i.default.KeyAction,s=function(e,t){return void 0===e?t:"false"!==e&&"0"!==e},o=function(e,t,r,n){var i=parseFloat(e);return i||0===i?Math.max(t,Math.min(r,i)):n},u=function(e,t,r,n){var i=parseInt(e,10);return i||0===i?Math.max(t,Math.min(r,i)):n},l=function(e,t,r){if(t){var n=e[t.toUpperCase()];if(void 0!==n)return n}return r},c=function(){if(n)return n;n={};var e=function(){for(var e=window.location.search.substr(1).split("&"),t={},r=0,n=e.length;r<n;r++){var i=e[r].split("=",2);2===i.length&&(t[i[0].toLowerCase()]=i[1])}return t}();return n.language=e.language,n.scalecenter=s(e.scalecenter,!1),n.grid=s(e.grid,!0),n.outline=s(e.outline,!1),n.outlinecolor=function(e,t){if(!e)return t;var r=e.split(",");if(r.length<3)return t;var n=t.slice();return n[0]=parseInt(r[0]||0,10)/255,n[1]=parseInt(r[1]||0,10)/255,n[2]=parseInt(r[2]||0,10)/255,void 0!==r[3]&&(n[3]=parseFloat(r[3])),n}(e.outlinecolor,[.3,0,0,1]),n.mirrorline=s(e.mirrorline,!1),n.darkenunselected=s(e.darkenunselected,!1),n.projection=l(i.default.Projection,e.projection,i.default.Projection.PERSPECTIVE),n.cameramode=l(i.default.CameraMode,e.cameramode,i.default.Projection.ORBIT),n.pivot=s(e.pivot,!0),n.fov=o(e.fov,10,90,45),n.flatshading=s(e.flatshading,!1),n.wireframe=s(e.wireframe,!1),n.curvature=o(e.curvature,0,5,0),n.exposure=o(e.exposure,0,5,1),n.environment=u(e.environment,0,1/0,0),n.matcap=u(e.matcap,0,1/0,3),n.shader=l(i.default.Shader,e.shader,i.default.Shader.MATCAP),n.filmic=s(e.filmic,!1),n.modelurl=e.modelurl,n.shortcuts=function(e){var t={};if(t["0".charCodeAt(0)]=a.MOVE,t["1".charCodeAt(0)]=a.BRUSH,t["2".charCodeAt(0)]=a.INFLATE,t["3".charCodeAt(0)]=a.TWIST,t["4".charCodeAt(0)]=a.SMOOTH,t["5".charCodeAt(0)]=a.FLATTEN,t["6".charCodeAt(0)]=a.PINCH,t["7".charCodeAt(0)]=a.CREASE,t["8".charCodeAt(0)]=a.DRAG,t["9".charCodeAt(0)]=a.PAINT,t["E".charCodeAt(0)]=a.TRANSFORM,t["C".charCodeAt(0)]=a.INTENSITY,t["X".charCodeAt(0)]=a.RADIUS,t["N".charCodeAt(0)]=a.NEGATIVE,t["S".charCodeAt(0)]=a.PICKER,t[46]=a.DELETE,t["F".charCodeAt(0)]=a.CAMERA_FRONT,t["T".charCodeAt(0)]=a.CAMERA_TOP,t["L".charCodeAt(0)]=a.CAMERA_LEFT,t[32]=a.CAMERA_RESET,t[37]=a.STRIFE_LEFT,t[39]=a.STRIFE_RIGHT,t[38]=a.STRIFE_UP,t[40]=a.STRIFE_DOWN,t["W".charCodeAt(0)]=a.WIREFRAME,t["R".charCodeAt(0)]=a.REMESH,!e)return t;for(var r=e.split(","),n=0,i=r.length;n<i;n++){var s=r[n].split(":",2);if(2===s.length){var o=s[1].toUpperCase(),u=parseInt(o,10);o=u==u&&u>=10?u:o.charCodeAt(0);var l=a[s[0].toUpperCase()];void 0!==l&&(t[o]=l)}}return t}(e.shortcuts),n};c(),c.getShortKey=function(e){return e>=96&&e<=105&&(e-=48),c().shortcuts[e]};var h=c;t.default=h},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(2)),s=n(r(0)),o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=t,this._cbContinuous=this.updateContinuous.bind(this),this._lastMouseX=0,this._lastMouseY=0}return function(e,t,r){t&&i(e.prototype,t),r&&i(e,r)}(e,[{key:"setToolMesh",value:function(e){this._forceToolMesh=e}},{key:"getMesh",value:function(){return this._forceToolMesh||this._main.getMesh()}},{key:"start",value:function(e){var t=this._main,r=t.getPicking();if(!r.intersectionMouseMeshes())return!1;var n=t.setOrUnsetMesh(r.getMesh(),e);if(!n)return!1;r.initAlpha();var i=t.getSculptManager().getSymmetry()?t.getPickingSymmetry():null;return i&&(i.intersectionMouseMesh(n),i.initAlpha()),this.pushState(),this._lastMouseX=t._mouseX,this._lastMouseY=t._mouseY,this.startSculpt(),!0}},{key:"end",value:function(){this.getMesh()&&this.getMesh().balanceOctree()}},{key:"pushState",value:function(){this._main.getStateManager().pushStateGeometry(this.getMesh())}},{key:"startSculpt",value:function(){!0!==this._lockPosition&&this.sculptStroke()}},{key:"preUpdate",value:function(e){var t=this._main,r=t.getPicking(),n=t._action===a.default.Action.SCULPT_EDIT;if(!n||e){n?r.intersectionMouseMesh():r.intersectionMouseMeshes();var i=r.getMesh();i&&t.getSculptManager().getSymmetry()&&t.getPickingSymmetry().intersectionMouseMesh(i)}}},{key:"update",value:function(e){if(!0===this._lockPosition)return this.updateSculptLock(e);this.sculptStroke()}},{key:"updateSculptLock",value:function(e){var t=this._main;e||this._main.getStateManager().getCurrentState().undo();var r=t.getPicking(),n=this._radius,i=t.getSculptManager().getSymmetry()?t.getPickingSymmetry():null,a=t._mouseX-this._lastMouseX,s=t._mouseY-this._lastMouseY;this._radius=Math.sqrt(a*a+s*s);var o=a/this._radius,u=s/this._radius;this.makeStroke(this._lastMouseX+.001*o,this._lastMouseY+.001*u,r,i),this._radius=n,this.updateRender(),t.setCanvasCursor("default")}},{key:"sculptStroke",value:function(){var e=this._main,t=e.getPicking(),r=e.getSculptManager().getSymmetry()?e.getPickingSymmetry():null,n=e._mouseX-this._lastMouseX,i=e._mouseY-this._lastMouseY,a=Math.sqrt(n*n+i*i),s=.15*this._radius*e.getPixelRatio();if(!(a<=s)){var o=1/Math.floor(a/s);n*=o,i*=o;for(var u=this._lastMouseX+n,l=this._lastMouseY+i,c=o;c<=1&&this.makeStroke(u,l,t,r);c+=o)u+=n,l+=i;this.updateRender(),this._lastMouseX=e._mouseX,this._lastMouseY=e._mouseY}}},{key:"updateRender",value:function(){this.updateMeshBuffers(),this._main.render()}},{key:"makeStroke",value:function(e,t,r,n){var i=this.getMesh();r.intersectionMouseMesh(i,e,t);var a=r.getMesh();a&&(r.pickVerticesInSphere(r.getLocalRadius2()),r.computePickedNormal());var s=i.isDynamic&&!this._lockPosition;s&&a&&this.stroke(r,!1);var o;return n&&(n.intersectionMouseMesh(i,e,t),(o=n.getMesh())&&(n.setLocalRadius2(r.getLocalRadius2()),n.pickVerticesInSphere(n.getLocalRadius2()),n.computePickedNormal())),!s&&a&&this.stroke(r,!1),o&&this.stroke(n,!0),a||o}},{key:"updateMeshBuffers",value:function(){var e=this.getMesh();e.isDynamic?e.updateBuffers():e.updateGeometryBuffers()}},{key:"updateContinuous",value:function(){if(this._lockPosition)return this.update(!0);var e=this._main,t=e.getPicking(),r=e.getSculptManager().getSymmetry()?e.getPickingSymmetry():null;this.makeStroke(e._mouseX,e._mouseY,t,r),this.updateRender()}},{key:"getFrontVertices",value:function(e,t){for(var r=e.length,n=new Uint32Array(s.default.getMemory(4*r),0,r),i=0,a=this.getMesh().getNormals(),o=t[0],u=t[1],l=t[2],c=0;c<r;++c){var h=e[c],f=3*h;a[f]*o+a[f+1]*u+a[f+2]*l<=0&&(n[i++]=h)}return new Uint32Array(n.subarray(0,i))}},{key:"areaNormal",value:function(e){for(var t=this.getMesh(),r=t.getNormals(),n=t.getMaterials(),i=0,a=0,s=0,o=0,u=e.length;o<u;++o){var l=3*e[o],c=n[l+2];i+=r[l]*c,a+=r[l+1]*c,s+=r[l+2]*c}var h=Math.sqrt(i*i+a*a+s*s);if(0!==h)return h=1/h,[i*h,a*h,s*h]}},{key:"areaCenter",value:function(e){for(var t=this.getMesh(),r=t.getVertices(),n=t.getMaterials(),i=e.length,a=0,s=0,o=0,u=0,l=0;l<i;++l){var c=3*e[l],h=n[c+2];u+=h,a+=r[c]*h,s+=r[c+1]*h,o+=r[c+2]*h}return[a/u,s/u,o/u]}},{key:"updateProxy",value:function(e){var t=this.getMesh(),r=t.getVertices(),n=t.getVerticesProxy();if(r!==n)for(var i=t.getVerticesStateFlags(),a=s.default.STATE_FLAG,o=0,u=e.length;o<u;++o){var l=e[o];if(i[l]!==a){var c=3*l;n[c]=r[c],n[c+1]=r[c+1],n[c+2]=r[c+2]}}}},{key:"laplacianSmooth",value:function(e,t,r){for(var n=this.getMesh(),i=n.getVerticesRingVertStartCount(),a=n.getVerticesRingVert(),s=a instanceof Array?a:null,o=n.getVerticesOnEdge(),u=r||n.getVertices(),l=e.length,c=0;c<l;++c){var h,f,d=3*c,p=e[c];s?(h=0,f=(a=s[p]).length):f=(h=i[2*p])+i[2*p+1];var v=0,g=f-h;if(g<=2)v=3*p,t[d]=u[v],t[d+1]=u[v+1],t[d+2]=u[v+2];else{var m=0,_=0,y=0,b=0;if(1===o[p]){var M=0;for(b=h;b<f;++b)1===o[v=a[b]]&&(m+=u[v*=3],_+=u[v+1],y+=u[v+2],++M);if(M>=2){t[d]=m/M,t[d+1]=_/M,t[d+2]=y/M;continue}m=_=y=0}for(b=h;b<f;++b)m+=u[v=3*a[b]],_+=u[v+1],y+=u[v+2];t[d]=m/g,t[d+1]=_/g,t[d+2]=y/g}}}},{key:"dynamicTopology",value:function(e){var t=this.getMesh(),r=e.getPickedVertices();if(!t.isDynamic)return r;var n=t.getSubdivisionFactor(),i=t.getDecimationFactor();if(0===n&&0===i)return r;0===r.length&&(r=t.getVerticesFromFaces([e.getPickedFace()]),this._main.getStateManager().pushVertices(r));var a=t.getFacesFromVertices(r),o=e.getLocalRadius2(),u=e.getIntersectionPoint(),l=o*(1.1-n)*.2,c=l/4.2025*i;this._main.getStateManager().pushFaces(a),n&&(a=t.subdivide(a,u,o,l,this._main.getStateManager())),i&&(a=t.decimate(a,u,o,c,this._main.getStateManager()));for(var h=(r=t.getVerticesFromFaces(a)).length,f=s.default.SCULPT_FLAG,d=t.getVerticesSculptFlags(),p=new Uint32Array(s.default.getMemory(4*h),0,h),v=0,g=0;g<h;++g){var m=r[g];d[m]===f&&(p[v++]=m)}return p=new Uint32Array(p.subarray(0,v)),t.updateTopology(a,r),t.updateGeometry(a,r),p}},{key:"getUnmaskedVertices",value:function(){return this.filterMaskedVertices(0,1/0)}},{key:"getMaskedVertices",value:function(){return this.filterMaskedVertices(-1/0,1)}},{key:"filterMaskedVertices",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1/0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,r=this.getMesh(),n=r.getMaterials(),i=r.getNbVertices(),a=new Uint32Array(s.default.getMemory(4*i),0,i),o=0,u=0;u<i;++u){var l=n[3*u+2];l>e&&l<t&&(a[o++]=u)}return new Uint32Array(a.subarray(0,o))}},{key:"postRender",value:function(e){e.render(this._main)}},{key:"addSculptToScene",value:function(){}},{key:"getScreenRadius",value:function(){return(this._radius||1)*this._main.getPixelRatio()}}]),e}();t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={radiusFactor:.75,intensityFactor:0,pressure:.5};n.getPressureIntensity=function(){return 1+n.intensityFactor*(2*n.pressure-1)},n.getPressureRadius=function(){return 1+n.radiusFactor*(2*n.pressure-1)};var i=n;t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r.d(t,"ARRAY_TYPE",function(){return i}),t.setMatrixArrayType=function(e){i=e},t.toRadian=function(e){return e*s},t.equals=function(e,t){return Math.abs(e-t)<=n*Math.max(1,Math.abs(e),Math.abs(t))};const n=1e-6;t.EPSILON=n;let i="undefined"!=typeof Float32Array?Float32Array:Array;const a=Math.random;t.RANDOM=a;const s=Math.PI/180},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(11)),s=n(r(81)),o=n(r(19)),u=n(r(16)),l=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=function(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),r._id=a.default.ID++,e&&(r._renderData=new u.default(e,r)),r._meshData=(0,o.default)(),r._transformData=(0,s.default)(),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),t}();t.default=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(1),i={};i.normalizedMouse=function(e,t,r,n){return[2*e/r-1,1-2*t/n]},i.mouseOnUnitSphere=function(e){var t=e[0],r=e[1],i=1-t*t-r*r,a=[t,r,i>0?Math.sqrt(i):0];return n.vec3.normalize(a,a)},i.intersectionRayTriangleEdges=function(){var e=[0,0,0],t=[0,0,0],r=[0,0,0];return function(i,a,s,o,u,l){n.vec3.cross(e,a,o);var c=n.vec3.dot(s,e);if(c>-1e-15&&c<1e-15)return-1;var h=1/c;n.vec3.sub(t,i,u);var f=n.vec3.dot(t,e)*h;if(f<-1e-15||f>1+1e-15)return-1;n.vec3.cross(r,t,s);var d=n.vec3.dot(a,r)*h;if(d<-1e-15||f+d>1+1e-15)return-1;var p=n.vec3.dot(o,r)*h;return p<-1e-15?-1:(l&&n.vec3.scaleAndAdd(l,i,a,p),p)}}(),i.intersectionRayTriangle=function(){var e=[0,0,0],t=[0,0,0];return function(r,a,s,o,u,l){return n.vec3.sub(e,o,s),n.vec3.sub(t,u,s),i.intersectionRayTriangleEdges(r,a,e,t,s,l)}}(),i.distance2PointTriangleEdges=function(){var e=[0,0,0];return function(t,r,i,a,s,o,u,l){n.vec3.sub(e,a,t);var c,h=n.vec3.dot(e,r),f=n.vec3.dot(e,i),d=n.vec3.sqrLen(e),p=Math.abs(s*u-o*o),v=o*f-u*h,g=o*h-s*f,m=4;if(v+g<=p)if(v<0)g<0?(m=4,h<0?(g=0,-h>=s?(v=1,c=s+2*h+d):c=h*(v=-h/s)+d):(v=0,f>=0?(g=0,c=d):-f>=u?(g=1,c=u+2*f+d):c=f*(g=-f/u)+d)):(m=3,v=0,f>=0?(g=0,c=d):-f>=u?(g=1,c=u+2*f+d):c=f*(g=-f/u)+d);else if(g<0)m=5,g=0,h>=0?(v=0,c=d):-h>=s?(v=1,c=s+2*h+d):c=h*(v=-h/s)+d;else{m=0;var _=1/p;c=(v*=_)*(s*v+o*(g*=_)+2*h)+g*(o*v+u*g+2*f)+d}else{var y,b,M,T;v<0?(m=2,(b=u+f)>(y=o+h)?(M=b-y)>=(T=s-2*o+u)?(v=1,g=0,c=s+2*h+d):c=(v=M/T)*(s*v+o*(g=1-v)+2*h)+g*(o*v+u*g+2*f)+d:(v=0,b<=0?(g=1,c=u+2*f+d):f>=0?(g=0,c=d):c=f*(g=-f/u)+d)):g<0?(m=6,(b=s+h)>(y=o+f)?(M=b-y)>=(T=s-2*o+u)?(g=1,v=0,c=u+2*f+d):c=(v=1-(g=M/T))*(s*v+o*g+2*h)+g*(o*v+u*g+2*f)+d:(g=0,b<=0?(v=1,c=s+2*h+d):h>=0?(v=0,c=d):c=h*(v=-h/s)+d)):(m=1,(M=u+f-o-h)<=0?(v=0,g=1,c=u+2*f+d):M>=(T=s-2*o+u)?(v=1,g=0,c=s+2*h+d):c=(v=M/T)*(s*v+o*(g=1-v)+2*h)+g*(o*v+u*g+2*f)+d)}return c<0&&(c=0),l&&(l[0]=a[0]+v*r[0]+g*i[0],l[1]=a[1]+v*r[1]+g*i[1],l[2]=a[2]+v*r[2]+g*i[2],l[3]=m),c}}(),i.distance2PointTriangle=function(){var e=[0,0,0],t=[0,0,0];return function(r,a,s,o,u){n.vec3.sub(e,s,a),n.vec3.sub(t,o,a);var l=n.vec3.sqrLen(e),c=n.vec3.dot(e,t),h=n.vec3.sqrLen(t);return i.distance2PointTriangleEdges(r,e,t,a,l,c,h,u)}}(),i.pointInsideTriangle=function(){var e=[0,0,0],t=[0,0,0],r=[0,0,0],i=[0,0,0],a=[0,0,0];return function(s,o,u,l){n.vec3.sub(e,o,u),n.vec3.sub(t,o,l),n.vec3.sub(r,s,u),n.vec3.sub(i,s,l);var c=n.vec3.len(n.vec3.cross(a,e,t)),h=n.vec3.len(n.vec3.cross(a,e,r)),f=n.vec3.len(n.vec3.cross(a,t,i)),d=n.vec3.len(n.vec3.cross(a,r,i));return Math.abs(c-(h+f+d))<1e-20}}(),i.triangleInsideSphere=function(e,t,r,n,a){return i.distanceSqToSegment(e,r,n)<t||(i.distanceSqToSegment(e,n,a)<t||i.distanceSqToSegment(e,r,a)<t)},i.distanceSqToSegment=function(){var e=[0,0,0],t=[0,0,0];return function(r,i,a){n.vec3.sub(e,r,i),n.vec3.sub(t,a,i);var s=n.vec3.sqrLen(t),o=n.vec3.dot(e,t)/s;return o<0?n.vec3.sqrLen(e):o>1?n.vec3.sqrLen(n.vec3.sub(e,r,a)):(e[0]=r[0]-i[0]-o*t[0],e[1]=r[1]-i[1]-o*t[1],e[2]=r[2]-i[2]-o*t[2],n.vec3.sqrLen(e))}}(),i.signedAngle2d=function(e,t){var r=e[0],n=e[1],i=t[0],a=t[1];return Math.atan2(r*a-n*i,r*i+n*a)},i.pointPlaneDistance=function(){var e=[0,0,0];return function(t,r,i){return n.vec3.dot(n.vec3.sub(e,t,r),i)}}(),i.mirrorPoint=function(){var e=[0,0,0];return function(t,r,a){return n.vec3.sub(t,t,n.vec3.scale(e,a,2*i.pointPlaneDistance(t,r,a)))}}(),i.vertexOnLine=function(){var e=[0,0,0];return function(t,r,i){n.vec3.sub(e,i,r);var a=[0,0,0],s=n.vec3.dot(e,n.vec3.sub(a,t,r));return n.vec3.scaleAndAdd(a,r,e,s/n.vec3.sqrLen(e))}}(),i.intersectLinePlane=function(e,t,r,i,a){var s=n.vec3.dot(n.vec3.sub(a,e,r),i),o=n.vec3.dot(n.vec3.sub(a,t,r),i);if(s===o)return t;var u=-s/(o-s);return n.vec3.scaleAndAdd(a,e,n.vec3.sub(a,t,e),u)},i.getPerpendicularVector=function(e){var t=[0,0,0];return 0===e[0]?t[0]=1:0===e[1]?t[1]=1:0===e[2]?t[2]=1:(t[0]=e[2],t[1]=e[2],t[2]=-e[0]-e[1],n.vec3.normalize(t,t)),t};var a=i;t.default=a},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(1),s=n(r(2)),o=n(r(0)),u=n(r(80)),l=n(r(16)),c=n(r(12)),h=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=e.ID++,this._meshData=null,this._transformData=null,this._renderData=null}return function(e,t,r){t&&i(e.prototype,t),r&&i(e,r)}(e,[{key:"setID",value:function(e){this._id=e}},{key:"setVertices",value:function(e){this._meshData._verticesXYZ=e,this._meshData._nbVertices=e.length/3}},{key:"setFaces",value:function(e){this._meshData._facesABCD=e,this._meshData._nbFaces=e.length/4}},{key:"setTexCoords",value:function(e){this._meshData._texCoordsST=e,this._meshData._nbTexCoords=e.length/2}},{key:"setColors",value:function(e){this._meshData._colorsRGB=e}},{key:"setMaterials",value:function(e){this._meshData._materialsPBR=e}},{key:"setVerticesDuplicateStartCount",value:function(e){this._meshData._duplicateStartCount=e}},{key:"setFacesTexCoord",value:function(e){this._meshData._UVfacesABCD=e}},{key:"setMeshData",value:function(e){this._meshData=e}},{key:"setRenderData",value:function(e){this._renderData=e}},{key:"setTransformData",value:function(e){this._transformData=e}},{key:"setNbVertices",value:function(e){this._meshData._nbVertices=e}},{key:"setNbFaces",value:function(e){this._meshData._nbFaces=e}},{key:"getID",value:function(){return this._id}},{key:"getRenderData",value:function(){return this._renderData}},{key:"getMeshData",value:function(){return this._meshData}},{key:"getTransformData",value:function(){return this._transformData}},{key:"getNbVertices",value:function(){return this._meshData._nbVertices}},{key:"getNbFaces",value:function(){return this._meshData._nbFaces}},{key:"getNbQuads",value:function(){return this.getNbTriangles()-this.getNbFaces()}},{key:"getNbTriangles",value:function(){return this._meshData._trianglesABC.length/3}},{key:"getNbTexCoords",value:function(){return this._meshData._nbTexCoords}},{key:"hasUV",value:function(){return null!==this._meshData._texCoordsST}},{key:"getVertices",value:function(){return this._meshData._verticesXYZ}},{key:"getColors",value:function(){return this._meshData._colorsRGB}},{key:"getNormals",value:function(){return this._meshData._normalsXYZ}},{key:"getMaterials",value:function(){return this._meshData._materialsPBR}},{key:"getVerticesTagFlags",value:function(){return this._meshData._vertTagFlags}},{key:"getVerticesSculptFlags",value:function(){return this._meshData._vertSculptFlags}},{key:"getVerticesStateFlags",value:function(){return this._meshData._vertStateFlags}},{key:"getVerticesRingVertStartCount",value:function(){return this._meshData._vrvStartCount}},{key:"getVerticesRingVert",value:function(){return this._meshData._vertRingVert}},{key:"getVerticesRingFaceStartCount",value:function(){return this._meshData._vrfStartCount}},{key:"getVerticesRingFace",value:function(){return this._meshData._vertRingFace}},{key:"getVerticesOnEdge",value:function(){return this._meshData._vertOnEdge}},{key:"getVerticesProxy",value:function(){return this._meshData._vertProxy}},{key:"getFaces",value:function(){return this._meshData._facesABCD}},{key:"hasOnlyTriangles",value:function(){return this.getNbTriangles()===this.getNbFaces()}},{key:"hasOnlyQuads",value:function(){return this.getNbTriangles()===2*this.getNbFaces()}},{key:"getFaceNormals",value:function(){return this._meshData._faceNormalsXYZ}},{key:"getFaceBoxes",value:function(){return this._meshData._faceBoxes}},{key:"getFaceCenters",value:function(){return this._meshData._faceCentersXYZ}},{key:"getFacesTagFlags",value:function(){return this._meshData._facesTagFlags}},{key:"getFaceEdges",value:function(){return this._meshData._faceEdges}},{key:"getFacesToTriangles",value:function(){return this._meshData._facesToTriangles}},{key:"getTrianglesTexCoord",value:function(){return this._meshData._UVtrianglesABC}},{key:"getTriangles",value:function(){return this._meshData._trianglesABC}},{key:"getEdges",value:function(){return this._meshData._edges}},{key:"getNbEdges",value:function(){return this._meshData._edges.length}},{key:"getTexCoords",value:function(){return this._meshData._texCoordsST}},{key:"getVerticesDuplicateStartCount",value:function(){return this._meshData._duplicateStartCount}},{key:"getFacesTexCoord",value:function(){return this._meshData._UVfacesABCD}},{key:"getVerticesDrawArrays",value:function(){return this._meshData._DAverticesXYZ||this.updateDrawArrays(),this._meshData._DAverticesXYZ}},{key:"getNormalsDrawArrays",value:function(){return this._meshData._DAnormalsXYZ}},{key:"getColorsDrawArrays",value:function(){return this._meshData._DAcolorsRGB}},{key:"getMaterialsDrawArrays",value:function(){return this._meshData._DAmaterialsPBR}},{key:"getTexCoordsDrawArrays",value:function(){return this._meshData._DAtexCoordsST}},{key:"getOctree",value:function(){return this._meshData._octree}},{key:"getCenter",value:function(){return this._transformData._center}},{key:"getMV",value:function(){return this._transformData._lastComputedMV}},{key:"getMVP",value:function(){return this._transformData._lastComputedMVP}},{key:"getN",value:function(){return this._transformData._lastComputedN}},{key:"getEN",value:function(){return this._transformData._lastComputedEN}},{key:"getDepth",value:function(){return this._transformData._lastComputedDepth}},{key:"getMatrix",value:function(){return this._transformData._matrix}},{key:"getEditMatrix",value:function(){return this._transformData._editMatrix}},{key:"getScale2",value:function(){var e=this._transformData._matrix;return e[0]*e[0]+e[4]*e[4]+e[8]*e[8]}},{key:"getScale",value:function(){return Math.sqrt(this.getScale2())}},{key:"getSymmetryOrigin",value:function(){return this._transformData._center}},{key:"getSymmetryNormal",value:function(){return this._transformData._symmetryNormal}},{key:"getFacePosInLeaf",value:function(){return this._meshData._facePosInLeaf}},{key:"getFaceLeaf",value:function(){return this._meshData._faceLeaf}},{key:"getLeavesToUpdate",value:function(){return this._meshData._leavesToUpdate}},{key:"getLocalBound",value:function(){return this._meshData._octree._aabbLoose}},{key:"getRenderNbEdges",value:function(){return this.getNbEdges()}},{key:"init",value:function(){this.initColorsAndMaterials(),this.allocateArrays(),this.initTopology(),this.updateGeometry(),this._renderData&&this.updateDuplicateColorsAndMaterials(),this.updateCenter()}},{key:"initTopology",value:function(){this.initFaceRings(),this.optimize(),this.initEdges(),this.initVertexRings(),this.initRenderTriangles()}},{key:"updateGeometry",value:function(e,t){this.updateFacesAabbAndNormal(e),this.updateVerticesNormal(t),this.updateOctree(e),this._renderData&&(this.updateDuplicateGeometry(t),this.updateDrawArrays(e))}},{key:"allocateArrays",value:function(){var e=this.getNbVertices();if(this.hasUV()){var t=this._meshData._texCoordsST.length/2,r=new Float32Array(3*t);r.set(this._meshData._verticesXYZ),this._meshData._verticesXYZ=r,this._meshData._normalsXYZ=new Float32Array(3*t),r=new Float32Array(3*t),this._meshData._colorsRGB&&r.set(this._meshData._colorsRGB),this._meshData._colorsRGB=r,r=new Float32Array(3*t),this._meshData._materialsPBR&&r.set(this._meshData._materialsPBR),this._meshData._materialsPBR=r}else this._meshData._normalsXYZ=this._meshData._normalsXYZ||new Float32Array(3*e),this._meshData._colorsRGB=this._meshData._colorsRGB||new Float32Array(3*e),this._meshData._materialsPBR=this._meshData._materialsPBR||new Float32Array(3*e);this._meshData._vertOnEdge=new Uint8Array(e),this._meshData._vrvStartCount=new Uint32Array(2*e),this._meshData._vrfStartCount=new Uint32Array(2*e),this._meshData._vertTagFlags=new Int32Array(e),this._meshData._vertSculptFlags=new Int32Array(e),this._meshData._vertStateFlags=new Int32Array(e),this._meshData._vertProxy=new Float32Array(3*e);var n=this.getNbFaces();this._meshData._faceEdges=new Uint32Array(4*n),this._meshData._facesToTriangles=new Uint32Array(n),this._meshData._faceBoxes=new Float32Array(6*n),this._meshData._faceNormalsXYZ=new Float32Array(3*n),this._meshData._faceCentersXYZ=new Float32Array(3*n),this._meshData._facesTagFlags=new Int32Array(n),this._meshData._facePosInLeaf=new Uint32Array(n);var i=this._meshData._faceLeaf;i.length=n;for(var a=0;a<n;++a)i[a]=null}},{key:"initColorsAndMaterials",value:function(){var e=0,t=3*this.getNbVertices();if(!this._meshData._colorsRGB||this._meshData._colorsRGB.length!==t){var r=this._meshData._colorsRGB=new Float32Array(t);for(e=0;e<t;++e)r[e]=1}if(!this._meshData._materialsPBR||this._meshData._materialsPBR.length!==t){var n=this._meshData._materialsPBR=new Float32Array(t);for(e=0;e<t;++e){var i=3*e;n[i]=.18,n[i+1]=.08,n[i+2]=1}}}},{key:"initFaceRings",value:function(){var e=this.getFaces(),t=this.getNbVertices(),r=this.getNbFaces(),n=0,i=0,a=new Uint32Array(t);for(n=0;n<r;++n){a[e[i=4*n]]++,a[e[i+1]]++,a[e[i+2]]++;var s=e[i+3];s!==o.default.TRI_INDEX&&a[s]++}var u=this.getVerticesRingFaceStartCount(),l=0;for(n=0;n<t;++n){var c=a[n];u[2*n]=l,u[2*n+1]=c,l+=c}var h=new Uint32Array(o.default.getMemory(4*r*6),0,6*r);for(l=0,n=0;n<r;++n){var f=e[i=4*n],d=e[i+1],p=e[i+2],v=e[i+3];h[u[2*f]+--a[f]]=n,h[u[2*d]+--a[d]]=n,h[u[2*p]+--a[p]]=n,v!==o.default.TRI_INDEX&&(h[u[2*v]+--a[v]]=n,++l)}this._meshData._vertRingFace=new Uint32Array(h.subarray(0,3*r+l))}},{key:"updateVerticesNormal",value:function(e){for(var t=this.getVerticesRingFaceStartCount(),r=this.getVerticesRingFace(),n=r instanceof Array?r:null,i=this.getNormals(),a=this.getFaceNormals(),s=void 0===e,o=s?this.getNbVertices():e.length,u=0;u<o;++u){var l,c,h=s?u:e[u];n?(l=0,c=(r=n[h]).length):c=(l=t[2*h])+t[2*h+1];for(var f=0,d=0,p=0,v=l;v<c;++v){var g=3*r[v];f+=a[g],d+=a[g+1],p+=a[g+2]}var m=c-l;0!==m&&(m=1/m),i[h*=3]=f*m,i[h+1]=d*m,i[h+2]=p*m}}},{key:"initVertexRings",value:function(){for(var e=this.getVerticesRingVertStartCount(),t=this._meshData._vertRingVert=new Uint32Array(2*this.getNbEdges()),r=this.getVerticesRingFaceStartCount(),n=this.getVerticesRingFace(),i=this.getVerticesTagFlags(),a=this.getVerticesOnEdge(),s=this.getFaces(),u=0,l=0,c=this.getNbVertices();l<c;++l){for(var h=++o.default.TAG_FLAG,f=r[2*l],d=f+r[2*l+1],p=0,v=f;v<d;++v){var g=4*n[v],m=s[g],_=s[g+1],y=s[g+2],b=s[g+3];m===l?m=b!==o.default.TRI_INDEX?b:y:_===l||b===l?_=y:y===l&&b!==o.default.TRI_INDEX&&(m=b),i[m]!==h&&(t[u+p++]=m,i[m]=h),i[_]!==h&&(t[u+p++]=_,i[_]=h)}e[2*l]=u,e[2*l+1]=p,u+=p,d-f!==p&&(a[l]=1)}}},{key:"expandsVertices",value:function(e,t){var r=++o.default.TAG_FLAG,n=e.length,i=this.getVerticesRingVertStartCount(),a=this.getVerticesRingVert(),s=a instanceof Array?a:null,u=this.getVerticesTagFlags(),l=n,c=this.getNbVertices(),h=new Uint32Array(o.default.getMemory(4*c),0,c);h.set(e);var f=0;for(f=0;f<n;++f)u[h[f]]=r;for(var d=0;t;){for(--t,f=d;f<n;++f){var p,v,g=h[f];s?(p=0,v=(a=s[g]).length):v=(p=i[2*g])+i[2*g+1];for(var m=p;m<v;++m){var _=a[m];u[_]!==r&&(u[_]=r,h[l++]=_)}}d=n,n=l}return new Uint32Array(h.subarray(0,l))}},{key:"getVerticesFromFaces",value:function(e){for(var t=++o.default.TAG_FLAG,r=e.length,n=this.getVerticesTagFlags(),i=this.getFaces(),a=0,s=new Uint32Array(o.default.getMemory(4*e.length*4),0,4*e.length),u=0;u<r;++u){var l=4*e[u],c=i[l],h=i[l+1],f=i[l+2],d=i[l+3];n[c]!==t&&(n[c]=t,s[a++]=c),n[h]!==t&&(n[h]=t,s[a++]=h),n[f]!==t&&(n[f]=t,s[a++]=f),d!==o.default.TRI_INDEX&&n[d]!==t&&(n[d]=t,s[a++]=d)}return new Uint32Array(s.subarray(0,a))}},{key:"updateFacesAabbAndNormal",value:function(e){for(var t=this.getFaceNormals(),r=this.getFaceBoxes(),n=this.getFaceCenters(),i=this.getVertices(),a=this.getFaces(),s=void 0===e,u=s?this.getNbFaces():e.length,l=0;l<u;++l){var c=s?l:e[l],h=3*c,f=4*c,d=6*c,p=3*a[f],v=3*a[f+1],g=3*a[f+2],m=a[f+3],_=m!==o.default.TRI_INDEX;_&&(m*=3);var y=i[p],b=i[p+1],M=i[p+2],T=i[v],A=i[v+1],S=i[v+2],k=i[g],w=i[g+1],E=i[g+2],x=T-y,R=A-b,C=S-M,P=k-y,F=w-b,D=E-M,I=R*D-C*F,N=C*P-x*D,V=x*F-R*P,L=y<T?y<k?y:k:T<k?T:k,O=y>T?y>k?y:k:T>k?T:k,U=b<A?b<w?b:w:A<w?A:w,B=b>A?b>w?b:w:A>w?A:w,j=M<S?M<E?M:E:S<E?S:E,G=M>S?M>E?M:E:S>E?S:E;if(_){var X=i[m],z=i[m+1],W=i[m+2];X<L&&(L=X),X>O&&(O=X),z<U&&(U=z),z>B&&(B=z),W<j&&(j=W),W>G&&(G=W),I+=(R=w-z)*D-(C=E-W)*F,N+=C*P-(x=k-X)*D,V+=x*F-R*P}t[h]=I,t[h+1]=N,t[h+2]=V,r[d]=L,r[d+1]=U,r[d+2]=j,r[d+3]=O,r[d+4]=B,r[d+5]=G,n[h]=.5*(L+O),n[h+1]=.5*(U+B),n[h+2]=.5*(j+G)}}},{key:"expandsFaces",value:function(e,t){var r=++o.default.TAG_FLAG,n=e.length,i=this.getVerticesRingFaceStartCount(),a=this.getVerticesRingFace(),s=a instanceof Array?a:null,u=this.getFacesTagFlags(),l=this.getFaces(),c=n,h=new Uint32Array(o.default.getMemory(4*this.getNbFaces()),0,this.getNbFaces());h.set(e);var f=0;for(f=0;f<n;++f)u[h[f]]=r;for(var d=0;t;){for(--t,f=d;f<n;++f)for(var p=4*h[f],v=0;v<4;++v){var g=l[p+v];if(g!==o.default.TRI_INDEX){var m,_;s?(m=0,_=(a=s[g]).length):_=(m=i[2*g])+i[2*g+1];for(var y=m;y<_;++y){var b=a[y];u[b]!==r&&(u[b]=r,h[c++]=b)}}}d=n,n=c}return new Uint32Array(h.subarray(0,c))}},{key:"getFacesFromVertices",value:function(e){for(var t=++o.default.TAG_FLAG,r=e.length,n=this.getVerticesRingFaceStartCount(),i=this.getVerticesRingFace(),a=i instanceof Array?i:null,s=this.getFacesTagFlags(),u=0,l=new Uint32Array(o.default.getMemory(4*this.getNbFaces()),0,this.getNbFaces()),c=0;c<r;++c){var h,f,d=e[c];a?(h=0,f=(i=a[d]).length):f=(h=n[2*d])+n[2*d+1];for(var p=h;p<f;++p){var v=i[p];s[v]!==t&&(s[v]=t,l[u++]=v)}}return new Uint32Array(l.subarray(0,u))}},{key:"initRenderTriangles",value:function(){this.hasUV()&&(this._meshData._UVtrianglesABC=this.computeTrianglesFromFaces(this.getFacesTexCoord())),this._meshData._trianglesABC=this.computeTrianglesFromFaces(this.getFaces())}},{key:"computeTrianglesFromFaces",value:function(e){for(var t=this.getNbFaces(),r=this.getFacesToTriangles(),n=new Uint32Array(o.default.getMemory(4*t*6),0,6*t),i=0,a=0;a<t;++a){r[a]=i;var s=4*a,u=e[s],l=e[s+1],c=e[s+2],h=e[s+3],f=3*i;n[f]=u,n[f+1]=l,n[f+2]=c,++i,h!==o.default.TRI_INDEX&&(n[f=3*i]=u,n[f+1]=c,n[f+2]=h,++i)}return new Uint32Array(n.subarray(0,3*i))}},{key:"initEdges",value:function(){for(var e=this.getFaces(),t=this.getFaceEdges(),r=0,n=new Uint32Array(this.getNbVertices()),i=this.getVerticesRingFaceStartCount(),a=this.getVerticesRingFace(),s=0,u=this.getNbVertices();s<u;++s)for(var l=i[2*s],c=l+i[2*s+1],h=r,f=l;f<c;++f){var d=4*a[f],p=e[d],v=e[d+1],g=e[d+2],m=e[d+3],_=0,y=0;m===o.default.TRI_INDEX?(s>p&&(_=n[p],y=d+(s===v?0:2),_<=h?(t[y]=r,n[p]=++r):t[y]=_-1),s>v&&(_=n[v],y=d+(s===p?0:1),_<=h?(t[y]=r,n[v]=++r):t[y]=_-1),s>g&&(_=n[g],y=d+(s===p?2:1),_<=h?(t[y]=r,n[g]=++r):t[y]=_-1),t[d+3]=o.default.TRI_INDEX):(s>p&&s!==g&&(_=n[p],y=d+(s===v?0:3),_<=h?(t[y]=r,n[p]=++r):t[y]=_-1),s>v&&s!==m&&(_=n[v],y=d+(s===p?0:1),_<=h?(t[y]=r,n[v]=++r):t[y]=_-1),s>g&&s!==p&&(_=n[g],y=d+(s===v?1:2),_<=h?(t[y]=r,n[g]=++r):t[y]=_-1),s>m&&s!==v&&(_=n[m],y=d+(s===p?3:2),_<=h?(t[y]=r,n[m]=++r):t[y]=_-1))}for(var b=this._meshData._edges=new Uint8ClampedArray(r),M=0,T=this.getNbFaces();M<T;++M){var A=4*M;b[t[A]]++,b[t[A+1]]++,b[t[A+2]]++;var S=t[A+3];S!==o.default.TRI_INDEX&&b[S]++}}},{key:"getWireframe",value:function(){var e,t=this.getNbEdges(),r=this.isUsingDrawArrays();if(r){if(this._meshData._drawArraysWireframe&&this._meshData._drawArraysWireframe.length===2*t)return this._meshData._drawArraysWireframe;e=this._meshData._drawArraysWireframe=new Uint32Array(2*t)}else{if(this._meshData._drawElementsWireframe&&this._meshData._drawElementsWireframe.length===2*t)return this._meshData._drawElementsWireframe;e=this._meshData._drawElementsWireframe=new Uint32Array(2*t)}for(var n=this.getFaces(),i=this.getFaceEdges(),a=this.getNbFaces(),s=this.getFacesToTriangles(),u=0,l=new Uint8Array(t),c=0;c<a;++c){var h,f,d,p=4*c,v=n[p+3],g=v!==o.default.TRI_INDEX;if(r){var m=3*s[c];h=m,f=m+1,d=m+2,g&&(v=m+5)}else h=n[p],f=n[p+1],d=n[p+2];var _=i[p],y=i[p+1],b=i[p+2],M=i[p+3];0===l[_]&&(l[_]=1,e[2*u]=h,e[2*u+1]=f,u++),0===l[y]&&(l[y]=1,e[2*u]=f,e[2*u+1]=d,u++),0===l[b]&&(l[b]=1,e[2*u]=d,e[2*u+1]=g?v:h,u++),g&&0===l[M]&&(l[M]=1,e[2*u]=v,e[2*u+1]=h,u++)}return r?this._meshData._drawArraysWireframe:this._meshData._drawElementsWireframe}},{key:"updateDuplicateGeometry",value:function(e){if(this.isUsingTexCoords()&&this.hasUV())for(var t=this.getVertices(),r=this.getColors(),n=this.getMaterials(),i=this.getNormals(),a=this.getVerticesDuplicateStartCount(),s=void 0===e,o=s?this.getNbVertices():e.length,u=0;u<o;++u){var l=s?u:e[u],c=a[2*l];if(0!==c)for(var h=c+a[2*l+1],f=3*l,d=t[f],p=t[f+1],v=t[f+2],g=i[f],m=i[f+1],_=i[f+2],y=r[f],b=r[f+1],M=r[f+2],T=n[f],A=n[f+1],S=n[f+2],k=c;k<h;++k){var w=3*k;t[w]=d,t[w+1]=p,t[w+2]=v,i[w]=g,i[w+1]=m,i[w+2]=_,r[w]=y,r[w+1]=b,r[w+2]=M,n[w]=T,n[w+1]=A,n[w+2]=S}}}},{key:"updateDuplicateColorsAndMaterials",value:function(e){if(this.isUsingTexCoords()&&this.hasUV())for(var t=this.getColors(),r=this.getMaterials(),n=this.getVerticesDuplicateStartCount(),i=void 0===e,a=i?this.getNbVertices():e.length,s=0;s<a;++s){var o=i?s:e[s],u=n[2*o];if(0!==u)for(var l=u+n[2*o+1],c=3*o,h=t[c],f=t[c+1],d=t[c+2],p=r[c],v=r[c+1],g=r[c+2],m=u;m<l;++m){var _=3*m;t[_]=h,t[_+1]=f,t[_+2]=d,r[_]=p,r[_+1]=v,r[_+2]=g}}}},{key:"initTexCoordsDataFromOBJData",value:function(e,t){var r=this.getFaces(),n=this.getNbVertices(),i=0,a=0,s=0,u=0,l=new Int32Array(n),c=new Float32Array(o.default.getMemory(4*n*2),0,2*n),h=[],f=0,d=0,p=r.length;for(i=0;i<p;++i)if((s=r[i])!==o.default.TRI_INDEX){var v=t[i];if((u=l[s])!==v+1)if(0!==u)if(u>0)l[s]=--f,h.push([v]),++d;else{var g=h[-u-1],m=g.length;for(a=0;a<m&&g[a]!==v;++a);a===m&&(++d,g.push(v))}else l[s]=v+1,c[2*s]=e[2*v],c[2*s+1]=e[2*v+1]}var _=new Float32Array(2*(n+d));_.set(c);var y=this._meshData._duplicateStartCount=new Uint32Array(2*n);for(f=0,i=0;i<n;++i)if(!((u=l[i])>=0)){var b=h[-u-1],M=b.length,T=n+f;for(y[2*i]=T,y[2*i+1]=M,f+=M,a=0;a<M;++a){var A=2*b[a],S=2*(T+a);_[S]=e[A],_[S+1]=e[A+1]}}var k=new Uint32Array(r);for(p=r.length,i=0;i<p;++i)if((s=k[i])!==o.default.TRI_INDEX&&!((u=l[s])>0)){var w=t[i],E=h[-u-1],x=E.length;for(a=0;a<x;++a)if(w===E[a]){k[i]=y[2*s]+a;break}}this.setTexCoords(_),this.setFacesTexCoord(k)}},{key:"setAlreadyDrawArrays",value:function(){this._meshData._DAverticesXYZ=this.getVertices(),this._meshData._DAnormalsXYZ=this.getNormals(),this._meshData._DAcolorsRGB=this.getColors(),this._meshData._DAmaterialsPBR=this.getMaterials()}},{key:"updateDrawArrays",value:function(e){if(this.isUsingDrawArrays()){var t=this.getVertices(),r=this.getNormals(),n=this.getColors(),i=this.getMaterials(),a=this.getFaces(),s=this.getNbTriangles(),u=this.hasOnlyTriangles()?null:this.getFacesToTriangles(),l=void 0===e,c=this._meshData._DAverticesXYZ,h=this._meshData._DAnormalsXYZ,f=this._meshData._DAcolorsRGB,d=this._meshData._DAmaterialsPBR;(!c||c.length<9*s)&&(c=this._meshData._DAverticesXYZ=new Float32Array(9*s),h=this._meshData._DAnormalsXYZ=new Float32Array(9*s),f=this._meshData._DAcolorsRGB=new Float32Array(9*s),d=this._meshData._DAmaterialsPBR=new Float32Array(9*s));for(var p=l?this.getNbFaces():e.length,v=0;v<p;++v){var g=l?v:e[v],m=9*(u?u[g]:g),_=3*a[g*=4],y=3*a[g+1],b=3*a[g+2];c[m]=t[_],c[m+1]=t[_+1],c[m+2]=t[_+2],c[m+3]=t[y],c[m+4]=t[y+1],c[m+5]=t[y+2],c[m+6]=t[b],c[m+7]=t[b+1],c[m+8]=t[b+2],f[m]=n[_],f[m+1]=n[_+1],f[m+2]=n[_+2],f[m+3]=n[y],f[m+4]=n[y+1],f[m+5]=n[y+2],f[m+6]=n[b],f[m+7]=n[b+1],f[m+8]=n[b+2],d[m]=i[_],d[m+1]=i[_+1],d[m+2]=i[_+2],d[m+3]=i[y],d[m+4]=i[y+1],d[m+5]=i[y+2],d[m+6]=i[b],d[m+7]=i[b+1],d[m+8]=i[b+2],h[m]=r[_],h[m+1]=r[_+1],h[m+2]=r[_+2],h[m+3]=r[y],h[m+4]=r[y+1],h[m+5]=r[y+2],h[m+6]=r[b],h[m+7]=r[b+1],h[m+8]=r[b+2];var M=a[g+3];M!==o.default.TRI_INDEX&&(M*=3,c[m+=9]=t[_],c[m+1]=t[_+1],c[m+2]=t[_+2],c[m+3]=t[b],c[m+4]=t[b+1],c[m+5]=t[b+2],c[m+6]=t[M],c[m+7]=t[M+1],c[m+8]=t[M+2],f[m]=n[_],f[m+1]=n[_+1],f[m+2]=n[_+2],f[m+3]=n[b],f[m+4]=n[b+1],f[m+5]=n[b+2],f[m+6]=n[M],f[m+7]=n[M+1],f[m+8]=n[M+2],d[m]=i[_],d[m+1]=i[_+1],d[m+2]=i[_+2],d[m+3]=i[b],d[m+4]=i[b+1],d[m+5]=i[b+2],d[m+6]=i[M],d[m+7]=i[M+1],d[m+8]=i[M+2],h[m]=r[_],h[m+1]=r[_+1],h[m+2]=r[_+2],h[m+3]=r[b],h[m+4]=r[b+1],h[m+5]=r[b+2],h[m+6]=r[M],h[m+7]=r[M+1],h[m+8]=r[M+2])}this.isUsingTexCoords()&&this.updateDrawArraysTexCoord(e)}}},{key:"updateDrawArraysTexCoord",value:function(e){var t=this.getNbTriangles(),r=this.getFacesToTriangles(),n=void 0===e,i=this._meshData._DAtexCoordsST;i&&i.length===6*t||(i=this._meshData._DAtexCoordsST=new Float32Array(6*t));for(var a=this.getTexCoords(),s=this.getFacesTexCoord(),u=n?this.getNbFaces():e.length,l=0;l<u;++l){var c=n?l:e[l],h=6*r[c],f=2*s[c*=4],d=2*s[c+1],p=2*s[c+2];i[h]=a[f],i[h+1]=a[f+1],i[h+2]=a[d],i[h+3]=a[d+1],i[h+4]=a[p],i[h+5]=a[p+1];var v=s[c+3];v!==o.default.TRI_INDEX&&(v*=3,i[h+=6]=a[f],i[h+1]=a[f+1],i[h+2]=a[p],i[h+3]=a[p+1],i[h+4]=a[v],i[h+5]=a[v+1])}}},{key:"updateCenter",value:function(){var e=this.getLocalBound();a.vec3.set(this._transformData._center,.5*(e[0]+e[3]),.5*(e[1]+e[4]),.5*(e[2]+e[5]))}},{key:"updateMatrices",value:function(e){a.mat3.normalFromMat4(this._transformData._lastComputedEN,this._transformData._editMatrix),a.mat4.mul(this._transformData._lastComputedMV,e.getView(),this._transformData._matrix),a.mat3.normalFromMat4(this._transformData._lastComputedN,this._transformData._lastComputedMV),a.mat4.mul(this._transformData._lastComputedMVP,e.getProjection(),this._transformData._lastComputedMV);var t=this._transformData._center,r=this._transformData._lastComputedMVP;this._transformData._lastComputedDepth=r[2]*t[0]+r[6]*t[1]+r[10]*t[2]+r[14]}},{key:"normalizeSize",value:function(){var e=this.getLocalBound(),t=a.vec3.dist([e[0],e[1],e[2]],[e[3],e[4],e[5]]),r=o.default.SCALE/t;a.mat4.scale(this._transformData._matrix,this._transformData._matrix,[r,r,r])}},{key:"computeWorldBound",value:function(){var e=this._meshData._worldBound,t=this.getLocalBound(),r=this.getMatrix();e[0]=e[3]=r[12],e[1]=e[4]=r[13],e[2]=e[5]=r[14];for(var n=0;n<3;++n)for(var i=4*n,a=t[n],s=t[n+3],o=0;o<3;++o){var u=r[i+o],l=u*s,c=u*a;l<c?(e[o]+=l,e[o+3]+=c):(e[o]+=c,e[o+3]+=l)}return e}},{key:"intersectRay",value:function(e,t,r){var n=this.getNbFaces(),i=new Uint32Array(o.default.getMemory(4*n),0,n);return this._meshData._octree.collectIntersectRay(e,t,i,r?this._meshData._leavesToUpdate:void 0)}},{key:"intersectSphere",value:function(e,t,r){var n=this.getNbFaces(),i=new Uint32Array(o.default.getMemory(4*n),0,n);return this._meshData._octree.collectIntersectSphere(e,t,i,r?this._meshData._leavesToUpdate:void 0)}},{key:"updateOctree",value:function(e){e?this.updateOctreeAdd(this.updateOctreeRemove(e)):this.computeOctree()}},{key:"computeAabb",value:function(){for(var e=this.getNbVertices(),t=this.getVertices(),r=1/0,n=1/0,i=1/0,a=-1/0,s=-1/0,o=-1/0,u=0;u<e;++u){var l=3*u,c=t[l],h=t[l+1],f=t[l+2];c<r&&(r=c),c>a&&(a=c),h<n&&(n=h),h>s&&(s=h),f<i&&(i=f),f>o&&(o=f)}return[r,n,i,a,s,o]}},{key:"computeOctree",value:function(){var e=this.computeAabb(),t=e[0],r=e[1],n=e[2],i=e[3],a=e[4],s=e[5],o=i-t,l=a-r,c=s-n,h=.2*Math.sqrt(o*o+l*l+c*c);i-t<1e-16&&(t-=h,i+=h),a-r<1e-16&&(r-=h,a+=h),s-n<1e-16&&(n-=h,s+=h);var f=.3*o,d=.3*l,p=.3*c,v=t-f,g=i+f,m=r-d,_=a+d,y=n-p,b=s+p,M=this._meshData._octree=new u.default;M.resetNbFaces(this.getNbFaces()),M.setAabbLoose(t,r,n,i,a,s),M.setAabbSplit(v,m,y,g,_,b),M.build(this)}},{key:"updateOctreeRemove",value:function(e){for(var t=this.getFaceCenters(),r=this.getFaceBoxes(),n=this._meshData._facePosInLeaf,i=this._meshData._faceLeaf,a=e.length,s=0,u=new Uint32Array(o.default.getMemory(4*a),0,a),l=0;l<a;++l){var c=e[l],h=6*c,f=3*c,d=i[c],p=d._aabbSplit,v=t[f],g=t[f+1],m=t[f+2];if(v<=p[0]||g<=p[1]||m<=p[2]||v>p[3]||g>p[4]||m>p[5]){u[s++]=e[l];var _=d._iFaces;if(_.length>0){var y=_[_.length-1],b=n[c];_[b]=y,n[y]=b,_.pop()}}else d.expandsAabbLoose(r[h],r[h+1],r[h+2],r[h+3],r[h+4],r[h+5])}return new Uint32Array(u.subarray(0,s))}},{key:"updateOctreeAdd",value:function(e){for(var t=this.getFaceCenters(),r=this.getFaceBoxes(),n=this._meshData._facePosInLeaf,i=this._meshData._faceLeaf,a=e.length,s=this._meshData._octree,o=s._aabbSplit,u=o[0],l=o[1],c=o[2],h=o[3],f=o[4],d=o[5],p=0;p<a;++p){var v=e[p],g=6*v,m=r[g],_=r[g+1],y=r[g+2],b=r[g+3],M=r[g+4],T=r[g+5];if(m>h||b<u||_>f||M<l||y>d||T<c){this.computeOctree(),this._meshData._leavesToUpdate.length=0;break}var A=3*v,S=s.addFace(v,m,_,y,b,M,T,t[A],t[A+1],t[A+2]);if(S)n[v]=S._iFaces.length-1,i[v]=S;else{var k=i[v]._iFaces;n[v]=k.length,k.push(e[p])}}}},{key:"balanceOctree",value:function(){++u.default.FLAG;for(var e=this._meshData._leavesToUpdate,t=e.length,r=0;r<t;++r){var n=e[r];n._flag!==u.default.FLAG&&(0===n._iFaces.length?n.pruneIfPossible():n._iFaces.length>u.default.MAX_FACES&&n._depth<u.default.MAX_DEPTH&&n.build(this),n._flag=u.default.FLAG)}e.length=0}},{key:"setFlatColor",value:function(e){this.getFlatColor().set(e)}},{key:"setAlbedo",value:function(e){this.getAlbedo().set(e)}},{key:"setMode",value:function(e){this._renderData._mode=e}},{key:"setRoughness",value:function(e){this._renderData._roughness=e}},{key:"setMetallic",value:function(e){this._renderData._metallic=e}},{key:"setOpacity",value:function(e){this._renderData._alpha=e}},{key:"setTexture0",value:function(e){this._renderData._texture0=e}},{key:"setMatcap",value:function(e){this._renderData._matcap=e}},{key:"setCurvature",value:function(e){this._renderData._curvature=e}},{key:"setFlatShading",value:function(e){this._renderData._flatShading=e}},{key:"setShowWireframe",value:function(e){this._renderData._showWireframe=!l.default.ONLY_DRAW_ARRAYS&&e,this.updateWireframeBuffer()}},{key:"setUseDrawArrays",value:function(e){this._renderData._useDrawArrays=e}},{key:"getGL",value:function(){return this._renderData._gl}},{key:"getCount",value:function(){var e=this.getGL();return this.getMode()===e.TRIANGLES?3*this.getNbTriangles():this.getMode()===e.LINES?this.getNbVertices():0}},{key:"getVertexBuffer",value:function(){return this._renderData._vertexBuffer}},{key:"getNormalBuffer",value:function(){return this._renderData._normalBuffer}},{key:"getColorBuffer",value:function(){return this._renderData._colorBuffer}},{key:"getMaterialBuffer",value:function(){return this._renderData._materialBuffer}},{key:"getTexCoordBuffer",value:function(){return this._renderData._texCoordBuffer}},{key:"getIndexBuffer",value:function(){return this._renderData._indexBuffer}},{key:"getWireframeBuffer",value:function(){return this._renderData._wireframeBuffer}},{key:"getRoughness",value:function(){return this._renderData._roughness}},{key:"getMetallic",value:function(){return this._renderData._metallic}},{key:"getOpacity",value:function(){return this._renderData._alpha}},{key:"getFlatColor",value:function(){return this._renderData._flatColor}},{key:"getMode",value:function(){return this._renderData._mode}},{key:"getAlbedo",value:function(){return this._renderData._albedo}},{key:"getTexture0",value:function(){return this._renderData._texture0}},{key:"getMatcap",value:function(){return this._renderData._matcap}},{key:"getCurvature",value:function(){return this._renderData._curvature}},{key:"getFlatShading",value:function(){return this._renderData._flatShading}},{key:"getShowWireframe",value:function(){return this._renderData._showWireframe}},{key:"isUsingDrawArrays",value:function(){return this._renderData._useDrawArrays||l.default.ONLY_DRAW_ARRAYS}},{key:"isUsingTexCoords",value:function(){return this._renderData._shaderType===s.default.Shader.UV}},{key:"isTransparent",value:function(){return this._renderData._alpha<.99}},{key:"getShaderType",value:function(){return this._renderData._shaderType}},{key:"setShaderType",value:function(e){var t=this.hasUV();if(e===s.default.Shader.UV&&!t){if(this._renderData._shaderType!==s.default.Shader.UV)return;e=s.default.Shader.MATCAP}this._renderData._shaderType=e,t&&(this.updateDuplicateGeometry(),this.updateDrawArrays()),this.updateBuffers()}},{key:"initRender",value:function(){this.setShaderType(this._renderData._shaderType),this.setShowWireframe(this.getShowWireframe())}},{key:"render",value:function(e){c.default[this.getShaderType()].getOrCreate(this.getGL()).draw(this,e)}},{key:"renderWireframe",value:function(e){c.default[s.default.Shader.WIREFRAME].getOrCreate(this.getGL()).draw(this,e)}},{key:"renderFlatColor",value:function(e){c.default[s.default.Shader.FLAT].getOrCreate(this.getGL()).draw(this,e)}},{key:"getRenderNbVertices",value:function(){return this.isUsingDrawArrays()?this.getCount():this.isUsingTexCoords()?this.getNbTexCoords():this.getNbVertices()}},{key:"updateVertexBuffer",value:function(){var e=this.isUsingDrawArrays()?this.getVerticesDrawArrays():this.getVertices();this.getVertexBuffer().update(e,3*this.getRenderNbVertices())}},{key:"updateNormalBuffer",value:function(){var e=this.isUsingDrawArrays()?this.getNormalsDrawArrays():this.getNormals();this.getNormalBuffer().update(e,3*this.getRenderNbVertices())}},{key:"updateColorBuffer",value:function(){var e=this.isUsingDrawArrays()?this.getColorsDrawArrays():this.getColors();this.getColorBuffer().update(e,3*this.getRenderNbVertices())}},{key:"updateMaterialBuffer",value:function(){var e=this.isUsingDrawArrays()?this.getMaterialsDrawArrays():this.getMaterials();this.getMaterialBuffer().update(e,3*this.getRenderNbVertices())}},{key:"updateTexCoordBuffer",value:function(){if(this.isUsingTexCoords()){var e=this.isUsingDrawArrays()?this.getTexCoordsDrawArrays():this.getTexCoords();this.getTexCoordBuffer().update(e,2*this.getRenderNbVertices())}}},{key:"updateIndexBuffer",value:function(){if(!this.isUsingDrawArrays()){var e=this.isUsingTexCoords()?this.getTrianglesTexCoord():this.getTriangles();this.getIndexBuffer().update(e,3*this.getNbTriangles())}}},{key:"updateWireframeBuffer",value:function(){this.getShowWireframe()&&this.getWireframeBuffer().update(this.getWireframe(),2*this.getNbEdges())}},{key:"updateGeometryBuffers",value:function(){this.updateVertexBuffer(),this.updateNormalBuffer()}},{key:"updateBuffers",value:function(){this.updateGeometryBuffers(),this.updateColorBuffer(),this.updateMaterialBuffer(),this.updateTexCoordBuffer(),this.updateIndexBuffer(),this.updateWireframeBuffer()}},{key:"release",value:function(){this.getTexture0()&&this.getGL().deleteTexture(this.getTexture0()),this.getVertexBuffer().release(),this.getNormalBuffer().release(),this.getColorBuffer().release(),this.getMaterialBuffer().release(),this.getIndexBuffer().release(),this.getWireframeBuffer().release()}},{key:"copyRenderConfig",value:function(e){this.setFlatShading(e.getFlatShading()),this.setShowWireframe(e.getShowWireframe()),this.setShaderType(e.getShaderType()),this.setMatcap(e.getMatcap()),this.setTexture0(e.getTexture0()),this.setCurvature(e.getCurvature()),this.setOpacity(e.getOpacity())}},{key:"optimize",value:function(){0!==this.getNbFaces()&&e.OPTIMIZE&&(this.optimizePostTransform(),this.optimizePreTransform(),this.initFaceRings())}},{key:"computeCacheScore",value:function(){var e=this.getFaces(),t=this.getNbFaces(),r=[];r.length=32;for(var n=0,i=0,a=0;a<t;++a)for(var s=3*a,u=e[s+3]!==o.default.TRI_INDEX?4:3,l=0;l<u;++l){var c=e[s+l];for(i=0;i<32;++i){if(void 0===r[i]){r[i]=c,n++;break}if(r[i]===c)break}32===i&&(n++,r.shift(),r.push(c))}return{ACMR:n/t,ACTVR:n/this.getNbVertices()}}},{key:"optimizePostTransform",value:function(){var e=0,t=this.hasUV(),r=this.getFaces(),n=t?this.getFacesTexCoord():r,i=this.getNbFaces(),a=this.getNbVertices(),s=t?this.getNbTexCoords():a,u=this.getVerticesDuplicateStartCount(),l=new Uint32Array(s-a);if(t)for(e=0;e<s;++e)for(var c=u[2*e],h=c+u[2*e+1],f=c;f<h;++f)l[f-a]=e;var d=this.getVerticesRingFaceStartCount(),p=this.getVerticesRingFace(),v=new Int32Array(s);for(e=0;e<a;++e)v[e]=d[2*e+1];for(e=a;e<s;++e)v[e]=d[2*l[e-a]+1];for(var g=new Uint32Array(s),m=33,_=0,y=new Uint32Array(o.default.getMemory(4*i*4),0,4*i),b=0,M=new Uint8Array(i),T=new Uint32Array(4*i),A=t?new Uint32Array(4*i):T,S=0,k=0;k>=0;){var w=[],E=k>=a?l[k-a]:k,x=d[2*E],R=x+d[2*E+1];for(e=x;e<R;++e){var C=p[e];if(!M[C]){M[C]=1;var P=4*C,F=y[b++]=T[S++]=n[P],D=y[b++]=T[S++]=n[P+1],I=y[b++]=T[S++]=n[P+2],N=T[S++]=n[P+3],V=N!==o.default.TRI_INDEX;t&&(A[S-4]=r[P],A[S-3]=r[P+1],A[S-2]=r[P+2],A[S-1]=r[P+3]),w.push(F,D,I),--v[F],--v[D],--v[I],m-g[F]>32&&(g[F]=m++),m-g[D]>32&&(g[D]=m++),m-g[I]>32&&(g[I]=m++),V&&(y[b++]=N,w.push(N),--v[N],m-g[N]>32&&(g[N]=m++))}}k=-1;var L=-1,O=w.length;for(e=0;e<O;++e){var U=w[e],B=v[U];if(!(B<=0)){var j=0,G=m-g[U];G+2*B<=32&&(j=G),j>L&&(L=j,k=U)}}if(-1===k){for(;b>0;){var X=y[--b];if(v[X]>0){k=X;break}}if(-1===k)for(;_<s;)if(v[_++]>0){k=_-1;break}}}n.set(T.subarray(0,4*i)),t&&r.set(A.subarray(0,4*i))}},{key:"optimizePreTransform",value:function(){var e=this.getVertices(),t=this.getColors(),r=this.getMaterials(),n=this.getNbVertices(),i=this.getFaces(),a=4*this.getNbFaces(),s=new Float32Array(3*n),u=new Float32Array(3*n),l=new Float32Array(3*n),c=new Uint32Array(n),h=0,f=0;for(f=0;f<a;++f){var d=i[f];if(d!==o.default.TRI_INDEX){var p=c[d]-1;if(-1===p){var v=3*h,g=3*d;s[v]=e[g],s[v+1]=e[g+1],s[v+2]=e[g+2],u[v]=t[g],u[v+1]=t[g+1],u[v+2]=t[g+2],l[v]=r[g],l[v+1]=r[g+1],l[v+2]=r[g+2],p=h++,c[d]=p+1}i[f]=p}}var m=n-h;if(m>0&&this.setNbVertices(h),this.hasUV()){var _=this.getFacesTexCoord();for(f=0;f<a;++f){var y=_[f];y<n?_[f]=c[y]-1:y!==o.default.TRI_INDEX&&(_[f]-=m)}var b=this.getNbTexCoords(),M=this.getNbTexCoords()-m,T=this.getTexCoords(),A=new Float32Array(2*M),S=new Uint32Array(2*h),k=this.getVerticesDuplicateStartCount();for(f=0;f<n;++f){var w=2*f,E=k[w],x=2*(c[f]-1);x<0||(E>0&&(S[x]=E-m,S[x+1]=k[w+1]),A[x]=T[w],A[x+1]=T[w+1])}for(f=n;f<b;++f){var R=2*f,C=2*(f-m);A[C]=T[R],A[C+1]=T[R+1]}this.setVerticesDuplicateStartCount(S),this.setTexCoords(A)}e.set(s),t.set(u),r.set(l)}}],[{key:"sortFunction",value:function(e,t){var r=e.isTransparent(),n=t.isTransparent();return r&&!n?1:!r&&n?-1:(t.getDepth()-e.getDepth())*(r&&n?1:-1)}}]),e}();h.OPTIMIZE=!0,h.ID=0;var f=h;t.default=f},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(2)),a=n(r(49)),s=n(r(25)),o=n(r(62)),u=n(r(63)),l=n(r(64)),c=n(r(65)),h=n(r(66)),f=n(r(67)),d=n(r(68)),p=n(r(69)),v=n(r(26)),g=[];g[i.default.Shader.PBR]=a.default,g[i.default.Shader.MATCAP]=s.default,g[i.default.Shader.NORMAL]=o.default,g[i.default.Shader.UV]=u.default,g[i.default.Shader.WIREFRAME]=l.default,g[i.default.Shader.FLAT]=c.default,g[i.default.Shader.SELECTION]=h.default,g[i.default.Shader.BACKGROUND]=f.default,g[i.default.Shader.MERGE]=d.default,g[i.default.Shader.FXAA]=p.default,g[i.default.Shader.CONTOUR]=v.default;var m=g;t.default=m},function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=function(){function e(t,r,n,i,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._gl=t,this._location=t.getAttribLocation(r,n),this._size=i,this._type=a}return function(e,t,r){t&&n(e.prototype,t),r&&n(e,r)}(e,[{key:"unbind",value:function(){this._gl.disableVertexAttribArray(this._location)}},{key:"bindToBuffer",value:function(e){var t=this._gl;e.bind(),t.enableVertexAttribArray(this._location),t.vertexAttribPointer(this._location,this._size,this._type,!1,0,0)}}]),e}();t.default=i},function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._gl=t,this._buffer=t.createBuffer(),this._type=r,this._hint=n,this._size=0}return function(e,t,r){t&&n(e.prototype,t),r&&n(e,r)}(e,[{key:"bind",value:function(){this._buffer||(this._buffer=this._gl.createBuffer()),this._gl.bindBuffer(this._type,this._buffer)}},{key:"release",value:function(){this._gl.deleteBuffer(this._buffer),this._buffer=null,this._size=0}},{key:"update",value:function(e,t){this.bind(),void 0!==t&&t!==e.length&&(e=e.subarray(0,t)),e.length>this._size?(this._gl.bufferData(this._type,e,this._hint),this._size=e.length):this._gl.bufferSubData(this._type,0,e)}}]),e}();t.default=i},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(1),a=n(r(85)),s=n(r(86)),o=n(r(10)),u=n(r(9)),l=n(r(0)),c=n(r(2)),h={};h.RESOLUTION=150,h.BLOCK=!1;var f=function(e,t){for(var r=t.min,n=t.step,i=t.dims,a=1/n,s=r[0],u=r[1],l=r[2],c=i[0],h=c*i[1],f=t.distanceField,d=t.crossedEdges,p=t.colorField,v=t.materialField,g=e.getTriangles(),m=e.getVertices(),_=e.getColors(),y=e.getMaterials(),b=e.getNbTriangles(),M=[0,0,0],T=[0,0,0],A=[0,0,0],S=[0,0,0],k=[0,0,0],w=[0,0,0],E=[0,0,0,0],x=[[1,0,0],[0,1,0],[0,0,1]],R=0;R<b;++R)for(var C=3*R,P=3*g[C],F=3*g[C+1],D=3*g[C+2],I=M[0]=m[P],N=M[1]=m[P+1],V=M[2]=m[P+2],L=T[0]=m[F],O=T[1]=m[F+1],U=T[2]=m[F+2],B=A[0]=m[D],j=A[1]=m[D+1],G=A[2]=m[D+2],X=(_[P]+_[F]+_[D])*(1/3),z=(_[P+1]+_[F+1]+_[D+1])*(1/3),W=(_[P+2]+_[F+2]+_[D+2])*(1/3),Y=(y[P]+y[F]+y[D])*(1/3),H=(y[P+1]+y[F+1]+y[D+1])*(1/3),q=(y[P+2]+y[F+2]+y[D+2])*(1/3),K=I<L?I<B?I:B:L<B?L:B,Z=I>L?I>B?I:B:L>B?L:B,Q=N<O?N<j?N:j:O<j?O:j,J=N>O?N>j?N:j:O>j?O:j,$=V<U?V<G?V:G:U<G?U:G,ee=V>U?V>G?V:G:U>G?U:G,te=S[0]=L-I,re=S[1]=O-N,ne=S[2]=U-V,ie=k[0]=B-I,ae=k[1]=j-N,se=k[2]=G-V,oe=te*te+re*re+ne*ne,ue=te*ie+re*ae+ne*se,le=ie*ie+ae*ae+se*se,ce=Math.floor((K-s)*a),he=Math.floor((Q-u)*a),fe=Math.floor(($-l)*a),de=Math.ceil((Z-s)*a),pe=Math.ceil((J-u)*a),ve=Math.ceil((ee-l)*a),ge=fe;ge<=ve;++ge)for(var me=he;me<=pe;++me)for(var _e=ce;_e<=de;++_e){var ye=s+_e*n,be=u+me*n,Me=l+ge*n,Te=_e+me*c+ge*h;w[0]=ye,w[1]=be,w[2]=Me;var Ae=o.default.distance2PointTriangleEdges(w,S,k,M,oe,ue,le,E);if((Ae=Math.sqrt(Ae))<f[Te]){f[Te]=Ae;var Se=3*Te;p[Se]=X,p[Se+1]=z,p[Se+2]=W,v[Se]=Y,v[Se+1]=H,v[Se+2]=q}if(!(Ae>n))for(var ke=0;ke<3;++ke){var we=E[ke]-w[ke];if(!(we<0||we>n)){var Ee=3*Te+ke;if(1!==d[Ee]){var xe=o.default.intersectionRayTriangleEdges(w,x[ke],S,k,M);xe<0||xe>n||(d[Ee]=1)}}}}},d=function(e,t,r,n,i){var a=new u.default(e.getGL());return a.setID(e.getID()),a.setFaces(t),a.setVertices(r),n&&a.setColors(n),i&&a.setMaterials(i),a.setRenderData(e.getRenderData()),a.init(),a.initRender(),a};h.remesh=function(e,t){console.time("remesh total"),console.time("1. prepareMeshes");var r=function(e){for(var t=[1/0,1/0,1/0,-1/0,-1/0,-1/0],r=[0,0,0],n=0,s=e.length;n<s;++n){var o=e[n];o.isUsingTexCoords()&&o.setShaderType(c.default.Shader.MATCAP);for(var u=o.getMatrix(),l=(o=e[n]=a.default.createClosedMesh(o)).getVertices(),h=0,f=o.getNbVertices();h<f;++h){var d=3*h;r[0]=l[d],r[1]=l[d+1],r[2]=l[d+2],i.vec3.transformMat4(r,r,u);var p=l[d]=r[0],v=l[d+1]=r[1],g=l[d+2]=r[2];p<t[0]&&(t[0]=p),v<t[1]&&(t[1]=v),g<t[2]&&(t[2]=g),p>t[3]&&(t[3]=p),v>t[4]&&(t[4]=v),g>t[5]&&(t[5]=g)}}return t}(e=e.slice());console.timeEnd("1. prepareMeshes"),console.time("2. voxelization");for(var n=function(e){for(var t=Math.max(e[3]-e[0],e[4]-e[1],e[5]-e[2])/h.RESOLUTION,r=1.51*t,n=1.51*t,i=[e[0]-r,e[1]-r,e[2]-r],a=[e[3]+n,e[4]+n,e[5]+n],s=Math.ceil((a[0]-i[0])/t),o=Math.ceil((a[1]-i[1])/t),u=Math.ceil((a[2]-i[2])/t),c=s*o*u,f=l.default.getMemory(31*c),d=new Float32Array(f,0,c),p=new Float32Array(f,4*c,3*c),v=new Float32Array(f,16*c,3*c),g=new Uint8Array(f,28*c,3*c),m=0;m<c;++m)d[m]=1/0;for(var _=0,y=3*c;_<y;++_)g[_]=0;for(var b=0,M=3*c;b<M;++b)p[b]=v[b]=-1;var T={};return T.dims=[s,o,u],T.step=t,T.min=i,T.max=a,T.crossedEdges=g,T.distanceField=d,T.colorField=p,T.materialField=v,T}(r),o=0,u=e.length;o<u;++o)f(e[o],n);console.timeEnd("2. voxelization"),console.time("3. flood"),function(e){var t=e.step,r=e.dims,n=r[0],i=n*r[1],a=e.crossedEdges,s=e.distanceField,o=s.length,u=new Uint8Array(o),l=new Int32Array(o);l[0]=0;for(var c=1,h=[-1,1,-n,n,-i,i],f=[0,0,1,1,2,2],d=h.length,p=0,v=0;c>0;){var g=l[--c];if(s[g]<t)for(p=0;p<d;++p){var m=h[p];(v=g+m)>=o||v<0||1!==u[v]&&s[v]!==1/0&&0===a[3*(m>=0?g:v)+f[p]]&&(u[v]=1,l[c++]=v)}else for(p=0;p<d;++p)(v=g+h[p])>=o||v<0||1!==u[v]&&(u[v]=1,l[c++]=v)}for(var _=0;_<o;++_)0===s[_]&&console.log("hit"),0===u[_]&&(s[_]=-s[_])}(n),console.timeEnd("3. flood"),console.time("4. surfaceNet"),s.default.BLOCK=h.BLOCK;var p=s.default.computeSurface(n);console.timeEnd("4. surfaceNet"),console.time("5. createMesh");var v=d(t,p.faces,p.vertices,p.colors,p.materials);return console.timeEnd("5. createMesh"),function(e,t){var r=[t[0],t[1],t[2]],n=[t[3],t[4],t[5]],a=i.vec3.dist(r,n),s=i.vec3.add([],r,n);i.vec3.scale(s,s,.5);var o=e.getLocalBound(),u=[o[0],o[1],o[2]],l=[o[3],o[4],o[5]],c=i.vec3.dist(u,l),h=i.vec3.add([],u,l);i.vec3.scale(h,h,.5);var f=a/c,d=i.vec3.scale([],s,1/f);i.vec3.sub(d,d,h);var p=e.getMatrix();i.mat4.identity(p),i.mat4.scale(p,p,[f,f,f]),i.mat4.translate(p,p,d)}(v,r),console.timeEnd("remesh total"),console.log("\n"),v},h.mergeArrays=function(e,t){var r,n,a=0,s=0,o=0,u=0,c=e.length,h=0;for(r=0;r<c;++r)a+=e[r].getNbVertices(),s+=e[r].getNbFaces(),o+=e[r].getNbQuads(),u+=e[r].getNbTriangles();t.nbVertices=a,t.nbFaces=s,t.nbQuads=o,t.nbTriangles=u;var f=t.vertices=void 0!==t.vertices?new Float32Array(3*a):null,d=t.colors=void 0!==t.colors?new Float32Array(3*a):null,p=t.materials=void 0!==t.materials?new Float32Array(3*a):null,v=t.faces=void 0!==t.faces?new Uint32Array(4*s):null,g=t.triangles=void 0!==t.triangles?new Uint32Array(3*u):null,m=[0,0,0],_=0,y=0,b=0,M=0;for(r=0;r<c;++r){var T=e[r],A=T.getVertices(),S=T.getColors(),k=T.getMaterials(),w=T.getFaces(),E=T.getTriangles(),x=T.getNbVertices(),R=T.getNbFaces(),C=T.getNbTriangles(),P=T.getMatrix();for(n=0;n<x;++n)h=3*n,m[0]=A[h],m[1]=A[h+1],m[2]=A[h+2],i.vec3.transformMat4(m,m,P),f[_+h]=m[0],f[_+h+1]=m[1],f[_+h+2]=m[2],d&&(d[_+h]=S[h],d[_+h+1]=S[h+1],d[_+h+2]=S[h+2]),p&&(p[_+h]=k[h],p[_+h+1]=k[h+1],p[_+h+2]=k[h+2]);if(_+=3*x,v)for(n=0;n<R;++n)v[y+(h=4*n)]=w[h]+M,v[y+h+1]=w[h+1]+M,v[y+h+2]=w[h+2]+M,v[y+h+3]=w[h+3]===l.default.TRI_INDEX?l.default.TRI_INDEX:w[h+3]+M;if(g)for(n=0;n<C;++n)g[b+(h=3*n)]=E[h]+M,g[b+h+1]=E[h+1]+M,g[b+h+2]=E[h+2]+M;M+=x,y+=4*R,b+=3*C}return t},h.mergeMeshes=function(e,t){var r={vertices:null,colors:null,materials:null,faces:null};return h.mergeArrays(e,r),d(t,r.faces,r.vertices,r.colors,r.materials)};var p=h;t.default=p},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(5)),a=n(r(14)),s=n(r(25)),o=function(e){var t=(0,i.default)();return{_gl:e,_shaderType:t.shader,_flatShading:t.flatshading,_showWireframe:t.wireframe,_matcap:Math.min(t.matcap,s.default.matcaps.length-1),_curvature:Math.min(t.curvature,5),_texture0:null,_useDrawArrays:!1,_vertexBuffer:new a.default(e,e.ARRAY_BUFFER,e.DYNAMIC_DRAW),_normalBuffer:new a.default(e,e.ARRAY_BUFFER,e.DYNAMIC_DRAW),_colorBuffer:new a.default(e,e.ARRAY_BUFFER,e.DYNAMIC_DRAW),_materialBuffer:new a.default(e,e.ARRAY_BUFFER,e.DYNAMIC_DRAW),_texCoordBuffer:new a.default(e,e.ARRAY_BUFFER,e.STATIC_DRAW),_indexBuffer:new a.default(e,e.ELEMENT_ARRAY_BUFFER,e.STATIC_DRAW),_wireframeBuffer:new a.default(e,e.ELEMENT_ARRAY_BUFFER,e.STATIC_DRAW),_albedo:new Float32Array([-1,-1,-1]),_roughness:-.18,_metallic:-.78,_alpha:1,_flatColor:new Float32Array([1,0,0]),_mode:e.TRIANGLES}};o.ONLY_DRAW_ARRAYS=!1;var u=o;t.default=u},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(2)),a=n(r(72)),s=n(r(73)),o=n(r(74)),u=n(r(18)),l=n(r(27)),c=n(r(75)),h=n(r(76)),f=n(r(77)),d=n(r(28)),p=n(r(78)),v=n(r(79)),g=n(r(82)),m=n(r(83)),_=[];_[i.default.Tools.BRUSH]=a.default,_[i.default.Tools.INFLATE]=s.default,_[i.default.Tools.TWIST]=o.default,_[i.default.Tools.SMOOTH]=u.default,_[i.default.Tools.FLATTEN]=l.default,_[i.default.Tools.PINCH]=c.default,_[i.default.Tools.CREASE]=h.default,_[i.default.Tools.DRAG]=f.default,_[i.default.Tools.PAINT]=d.default,_[i.default.Tools.MOVE]=p.default,_[i.default.Tools.MASKING]=v.default,_[i.default.Tools.LOCALSCALE]=g.default,_[i.default.Tools.TRANSFORM]=m.default,_[i.default.Tools.BRUSH].uiName="sculptBrush",_[i.default.Tools.INFLATE].uiName="sculptInflate",_[i.default.Tools.TWIST].uiName="sculptTwist",_[i.default.Tools.SMOOTH].uiName="sculptSmooth",_[i.default.Tools.FLATTEN].uiName="sculptFlatten",_[i.default.Tools.PINCH].uiName="sculptPinch",_[i.default.Tools.CREASE].uiName="sculptCrease",_[i.default.Tools.DRAG].uiName="sculptDrag",_[i.default.Tools.PAINT].uiName="sculptPaint",_[i.default.Tools.MOVE].uiName="sculptMove",_[i.default.Tools.MASKING].uiName="sculptMasking",_[i.default.Tools.LOCALSCALE].uiName="sculptLocalScale",_[i.default.Tools.TRANSFORM].uiName="sculptTransform";var y=_;t.default=y},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=n(r(0)),o=n(r(7)),u=n(r(6)),l=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=function(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r._radius=50,r._intensity=.75,r._culling=!1,r._tangent=!1,r._idAlpha=0,r._lockPosition=!1,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.default),function(e,t,r){t&&a(e.prototype,t),r&&a(e,r)}(t,[{key:"stroke",value:function(e){var t=e.getPickedVertices(),r=this._intensity*o.default.getPressureIntensity();this._main.getStateManager().pushVertices(t),this._culling&&(t=this.getFrontVertices(t,e.getEyeDirection())),e.updateAlpha(this._lockPosition),e.setIdAlpha(this._idAlpha),this._tangent?this.smoothTangent(t,r,e):this.smooth(t,r,e);var n=this.getMesh();n.updateGeometry(n.getFacesFromVertices(t),t)}},{key:"smooth",value:function(e,t,r){var n=this.getMesh(),i=n.getVertices(),a=n.getMaterials(),o=e.length,u=new Float32Array(s.default.getMemory(4*o*3),0,3*o);this.laplacianSmooth(e,u);for(var l=0;l<o;++l){var c=3*e[l],h=i[c],f=i[c+1],d=i[c+2],p=3*l,v=t*a[c+2];r&&(v*=r.getAlpha(h,f,d));var g=1-v;i[c]=h*g+u[p]*v,i[c+1]=f*g+u[p+1]*v,i[c+2]=d*g+u[p+2]*v}}},{key:"smoothTangent",value:function(e,t,r){var n=this.getMesh(),i=n.getVertices(),a=n.getMaterials(),o=n.getNormals(),u=e.length,l=new Float32Array(s.default.getMemory(4*u*3),0,3*u);this.laplacianSmooth(e,l);for(var c=0;c<u;++c){var h=3*e[c],f=i[h],d=i[h+1],p=i[h+2],v=o[h],g=o[h+1],m=o[h+2],_=v*v+g*g+m*m;if(0!==_){v*=_=1/Math.sqrt(_),g*=_,m*=_;var y=3*c,b=l[y],M=l[y+1],T=l[y+2],A=v*(b-f)+g*(M-d)+m*(T-p),S=t*a[h+2];r&&(S*=r.getAlpha(f,d,p)),i[h]=f+(b-v*A-f)*S,i[h+1]=d+(M-g*A-d)*S,i[h+2]=p+(T-m*A-p)*S}}}},{key:"smoothAlongNormals",value:function(e,t,r){var n=this.getMesh(),i=n.getVertices(),a=n.getMaterials(),o=n.getNormals(),u=e.length,l=new Float32Array(s.default.getMemory(4*u*3),0,3*u);this.laplacianSmooth(e,l);for(var c=0;c<u;++c){var h=3*e[c],f=i[h],d=i[h+1],p=i[h+2],v=o[h],g=o[h+1],m=o[h+2],_=3*c,y=1/(v*v+g*g+m*m),b=v*(l[_]-f)+g*(l[_+1]-d)+m*(l[_+2]-p);b*=y*t*a[h+2],r&&(b*=r.getAlpha(f,d,p)),i[h]=f+v*b,i[h+1]=d+g*b,i[h+2]=p+m*b}}}]),t}();t.default=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(){return{_nbVertices:0,_nbFaces:0,_nbTexCoords:0,_verticesXYZ:null,_normalsXYZ:null,_colorsRGB:null,_materialsPBR:null,_vertOnEdge:null,_vertRingFace:null,_vrfStartCount:null,_vrvStartCount:null,_vertRingVert:null,_vertTagFlags:null,_vertSculptFlags:null,_vertStateFlags:null,_vertProxy:null,_facesABCD:null,_faceEdges:null,_faceNormalsXYZ:null,_facesToTriangles:null,_trianglesABC:null,_facesTagFlags:null,_edges:null,_drawArraysWireframe:null,_drawElementsWireframe:null,_texCoordsST:null,_duplicateStartCount:null,_UVfacesABCD:null,_UVtrianglesABC:null,_DAverticesXYZ:null,_DAnormalsXYZ:null,_DAcolorsRGB:null,_DAmaterialsPBR:null,_DAtexCoordsST:null,_octree:null,_faceBoxes:null,_faceCentersXYZ:null,_facePosInLeaf:null,_faceLeaf:[],_leavesToUpdate:[],_worldBound:[1/0,1/0,1/0,-1/0,-1/0,-1/0]}};t.default=n},function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=function(e){return e&&e.__esModule?e:{default:e}}(r(0)),a={};a.LINEAR=!1;var s=function(){function e(t,r,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._vArOut=r,this._cArOut=n,this._mArOut=i,this._vAr=t.getVertices(),this._cAr=t.getColors(),this._mAr=t.getMaterials(),this._eAr=t.getEdges(),this._nbVertices=t.getNbVertices(),this._tagEdges=new Int32Array(t.getNbEdges())}return function(e,t,r){t&&n(e.prototype,t),r&&n(e,r)}(e,[{key:"computeTriangleEdgeVertex",value:function(e,t,r,n){var i=this._vAr,s=this._cAr,o=this._mAr,u=this._eAr,l=this._vArOut,c=this._cArOut,h=this._mArOut,f=this._tagEdges,d=3*e,p=3*t,v=3*r,g=f[n]-1,m=-1===g?this._nbVertices++:g,_=3*m,y=u[n];if(1===y||y>=3||a.LINEAR){if(-1!==g)return m;f[n]=m+1,l[_]=.5*(i[d]+i[p]),l[_+1]=.5*(i[d+1]+i[p+1]),l[_+2]=.5*(i[d+2]+i[p+2]),c[_]=.5*(s[d]+s[p]),c[_+1]=.5*(s[d+1]+s[p+1]),c[_+2]=.5*(s[d+2]+s[p+2]),h[_]=.5*(o[d]+o[p]),h[_+1]=.5*(o[d+1]+o[p+1]),h[_+2]=.5*(o[d+2]+o[p+2])}else-1===g?(f[n]=m+1,l[_]=.125*i[v]+.375*(i[d]+i[p]),l[_+1]=.125*i[v+1]+.375*(i[d+1]+i[p+1]),l[_+2]=.125*i[v+2]+.375*(i[d+2]+i[p+2]),c[_]=.125*s[v]+.375*(s[d]+s[p]),c[_+1]=.125*s[v+1]+.375*(s[d+1]+s[p+1]),c[_+2]=.125*s[v+2]+.375*(s[d+2]+s[p+2]),h[_]=.125*o[v]+.375*(o[d]+o[p]),h[_+1]=.125*o[v+1]+.375*(o[d+1]+o[p+1]),h[_+2]=.125*o[v+2]+.375*(o[d+2]+o[p+2])):(l[_]+=.125*i[v],l[_+1]+=.125*i[v+1],l[_+2]+=.125*i[v+2],c[_]+=.125*s[v],c[_+1]+=.125*s[v+1],c[_+2]+=.125*s[v+2],h[_]+=.125*o[v],h[_+1]+=.125*o[v+1],h[_+2]+=.125*o[v+2]);return m}},{key:"computeQuadEdgeVertex",value:function(e,t,r,n,i){var s=this._vAr,o=this._cAr,u=this._mAr,l=this._eAr,c=this._vArOut,h=this._cArOut,f=this._mArOut,d=this._tagEdges,p=3*e,v=3*t,g=3*r,m=3*n,_=d[i]-1,y=-1===_?this._nbVertices++:_,b=3*y,M=l[i];if(1===M||M>=3||a.LINEAR){if(-1!==_)return y;d[i]=y+1,c[b]=.5*(s[p]+s[v]),c[b+1]=.5*(s[p+1]+s[v+1]),c[b+2]=.5*(s[p+2]+s[v+2]),h[b]=.5*(o[p]+o[v]),h[b+1]=.5*(o[p+1]+o[v+1]),h[b+2]=.5*(o[p+2]+o[v+2]),f[b]=.5*(u[p]+u[v]),f[b+1]=.5*(u[p+1]+u[v+1]),f[b+2]=.5*(u[p+2]+u[v+2])}else-1===_?(d[i]=y+1,c[b]=.0625*(s[g]+s[m])+.375*(s[p]+s[v]),c[b+1]=.0625*(s[g+1]+s[m+1])+.375*(s[p+1]+s[v+1]),c[b+2]=.0625*(s[g+2]+s[m+2])+.375*(s[p+2]+s[v+2]),h[b]=.0625*(o[g]+o[m])+.375*(o[p]+o[v]),h[b+1]=.0625*(o[g+1]+o[m+1])+.375*(o[p+1]+o[v+1]),h[b+2]=.0625*(o[g+2]+o[m+2])+.375*(o[p+2]+o[v+2]),f[b]=.0625*(u[g]+u[m])+.375*(u[p]+u[v]),f[b+1]=.0625*(u[g+1]+u[m+1])+.375*(u[p+1]+u[v+1]),f[b+2]=.0625*(u[g+2]+u[m+2])+.375*(u[p+2]+u[v+2])):(c[b]+=.0625*(s[g]+s[m]),c[b+1]+=.0625*(s[g+1]+s[m+1]),c[b+2]+=.0625*(s[g+2]+s[m+2]),h[b]+=.0625*(o[g]+o[m]),h[b+1]+=.0625*(o[g+1]+o[m+1]),h[b+2]+=.0625*(o[g+2]+o[m+2]),f[b]+=.0625*(u[g]+u[m]),f[b+1]+=.0625*(u[g+1]+u[m+1]),f[b+2]+=.0625*(u[g+2]+u[m+2]));return y}},{key:"computeFaceVertex",value:function(e,t,r,n){var i=3*e,a=3*t,s=3*r,o=3*n,u=this._vAr,l=this._cAr,c=this._mAr,h=this._vArOut,f=this._cArOut,d=this._mArOut,p=this._nbVertices++,v=3*p;return h[v]=.25*(u[i]+u[a]+u[s]+u[o]),h[v+1]=.25*(u[i+1]+u[a+1]+u[s+1]+u[o+1]),h[v+2]=.25*(u[i+2]+u[a+2]+u[s+2]+u[o+2]),f[v]=.25*(l[i]+l[a]+l[s]+l[o]),f[v+1]=.25*(l[i+1]+l[a+1]+l[s+1]+l[o+1]),f[v+2]=.25*(l[i+2]+l[a+2]+l[s+2]+l[o+2]),d[v]=.25*(c[i]+c[a]+c[s]+c[o]),d[v+1]=.25*(c[i+1]+c[a+1]+c[s+1]+c[o+1]),d[v+2]=.25*(c[i+2]+c[a+2]+c[s+2]+c[o+2]),p}}]),e}(),o=function(e,t,r,n){var s=e.getNbVertices();r.set(e.getColors().subarray(0,3*s)),n.set(e.getMaterials().subarray(0,3*s));for(var o=e.getVertices(),u=e.getFaces(),l=e.getEdges(),c=e.getFaceEdges(),h=e.getVerticesOnEdge(),f=e.getVerticesRingVertStartCount(),d=e.getVerticesRingVert(),p=e.getVerticesRingFaceStartCount(),v=e.getVerticesRingFace(),g=e.hasOnlyTriangles(),m=0;m<s;++m){var _=3*m,y=0,b=0,M=0,T=0,A=0,S=0,k=0;if(h[m]||a.LINEAR){var w=p[2*m],E=w+p[2*m+1];for(S=w;S<E;++S){var x=4*v[S],R=u[x],C=u[x+1],P=u[x+2],F=u[x+3],D=F===i.default.TRI_INDEX;k=i.default.TRI_INDEX,R===m?1===l[c[x]]?k=C:1===l[c[D?x+2:x+3]]&&(k=D?P:F):C===m?1===l[c[x]]?k=R:1===l[c[x+1]]&&(k=P):P===m?1===l[c[x+1]]?k=C:1===l[c[x+2]]&&(k=D?R:F):F===m&&(1===l[c[x+2]]?k=P:1===l[c[x+3]]&&(k=R)),k!==i.default.TRI_INDEX&&(y+=o[k*=3],b+=o[k+1],M+=o[k+2],T++)}T<2?(t[_]=o[_],t[_+1]=o[_+1],t[_+2]=o[_+2]):(T=.25/T,A=.75,t[_]=o[_]*A+y*T,t[_+1]=o[_+1]*A+b*T,t[_+2]=o[_+2]*A+M*T)}else{var I=f[2*m],N=f[2*m+1],V=I+N;for(S=I;S<V;++S)y+=o[k=3*d[S]],b+=o[k+1],M+=o[k+2];if(g)6===N?(T=.0625,A=.625):3===N?(T=.1875,A=.4375):(T=.375/N,A=.625),t[_]=o[_]*A+y*T,t[_+1]=o[_+1]*A+b*T,t[_+2]=o[_+2]*A+M*T;else{var L=0,O=0,U=0,B=0,j=p[2*m],G=j+p[2*m+1],X=0;for(S=j;S<G;++S){var z=u[(k=4*v[S])+3];if(z!==i.default.TRI_INDEX){X++;var W=u[k],Y=u[k+1],H=u[k+2],q=0;L+=o[q=W===m?3*H:Y===m?3*z:H===m?3*W:3*Y],O+=o[q+1],U+=o[q+2]}}X!==G-j?0!==X?(T=.5*(A=1/(1+.5*N+.25*X)),B=.25*A,t[_]=o[_]*A+y*T+L*B,t[_+1]=o[_+1]*A+b*T+O*B,t[_+2]=o[_+2]*A+M*T+U*B):(6===N?(T=.0625,A=.625):3===N?(T=.1875,A=.4375):(T=.375/N,A=.625),t[_]=o[_]*A+y*T,t[_+1]=o[_+1]*A+b*T,t[_+2]=o[_+2]*A+M*T):(4===N?(A=.5625,T=.09375,B=.015625):A=1-((T=1.5/(N*N))+(B=.25/(N*N)))*N,t[_]=o[_]*A+y*T+L*B,t[_+1]=o[_+1]*A+b*T+O*B,t[_+2]=o[_+2]*A+M*T+U*B)}}}},u=function(e,t,r,n,a){for(var o=e.getFaces(),u=e.getFaceEdges(),l=new s(e,t,r,n),c=0,h=e.getNbFaces();c<h;++c){var f,d,p,v,g,m=4*c,_=o[m],y=o[m+1],b=o[m+2],M=o[m+3],T=M!==i.default.TRI_INDEX;T?(f=l.computeQuadEdgeVertex(_,y,b,M,u[m]),d=l.computeQuadEdgeVertex(y,b,M,_,u[m+1]),p=l.computeQuadEdgeVertex(b,M,_,y,u[m+2]),v=l.computeQuadEdgeVertex(M,_,y,b,u[m+3]),g=l.computeFaceVertex(_,y,b,M)):(f=l.computeTriangleEdgeVertex(_,y,b,u[m]),d=l.computeTriangleEdgeVertex(y,b,_,u[m+1]),p=l.computeTriangleEdgeVertex(b,_,y,u[m+2])),a&&(m*=4,T?(a[m+1]=a[m+4]=f,a[m+6]=a[m+9]=d,a[m+11]=a[m+14]=p,a[m+3]=a[m+12]=v,a[m+2]=a[m+7]=a[m+8]=a[m+13]=g,a[m]=_,a[m+5]=y,a[m+10]=b,a[m+15]=M):(a[m]=a[m+5]=a[m+8]=f,a[m+1]=a[m+10]=a[m+12]=d,a[m+2]=a[m+6]=a[m+14]=p,a[m+3]=a[m+7]=a[m+11]=a[m+15]=i.default.TRI_INDEX,a[m+4]=_,a[m+9]=y,a[m+13]=b))}return l._tagEdges},l=function(e,t,r){var n=t.getNbVertices(),a=new Uint32Array(2*n);a.set(e.getVerticesDuplicateStartCount());var s=e.getFaces(),o=e.getFacesTexCoord(),u=3*t.getNbFaces(),l=e.getTexCoords(),c=new Float32Array(i.default.getMemory(4*u*2),0,2*u),h=0,f=e.getNbVertices(),d=n-f;for(h=0;h<f;++h){var p=a[2*h];p>0&&(a[2*h]=p+d)}c.set(l),c.set(l.subarray(2*f),2*(f+d));var v=d+e.getNbTexCoords(),g=e.getFaceEdges(),m=new Uint32Array(r.length),_=new Uint32Array(r.length);for(f=s.length,h=0;h<f;++h){var y=g[h];if(y!==i.default.TRI_INDEX){var b=(h+1)%4==0?h-3:h+1,M=o[h],T=o[b];T===i.default.TRI_INDEX&&(T=o[h-2]);var A=r[y]-1,S=_[y],k=M>T?M:T,w=M<T?M:T;0!==S?S===k&&m[y]===w||(c[2*v]=.5*(l[2*M]+l[2*T]),c[2*v+1]=.5*(l[2*M+1]+l[2*T+1]),a[2*A]=v++,a[2*A+1]=1):(c[2*A]=.5*(l[2*M]+l[2*T]),c[2*A+1]=.5*(l[2*M+1]+l[2*T+1]),m[y]=w,_[y]=k)}}var E=new Float32Array(2*v);E.set(c.subarray(0,2*v)),t.setTexCoords(E),t.setVerticesDuplicateStartCount(a),function(e,t,r){for(var n=e.getFacesTexCoord(),a=t.getFaces(),s=new Uint32Array(a.length),o=e.getFaceEdges(),u=e.getNbVertices(),l=t.getNbVertices()-u,c=t.getVerticesDuplicateStartCount(),h=t.getTexCoords(),f=0,d=e.getNbFaces();f<d;++f){var p=4*f,v=n[p],g=n[p+1],m=n[p+2],_=n[p+3];v>=u&&(v+=l),g>=u&&(g+=l),m>=u&&(m+=l),_!==i.default.TRI_INDEX&&_>=u&&(_+=l);var y=o[p],b=r[y]-1;b<0?b=c[2*(-b-1)]:c[2*b]>0&&(r[y]=-b);var M=r[y=o[p+1]]-1;M<0?M=c[2*(-M-1)]:c[2*M]>0&&(r[y]=-M);var T=r[y=o[p+2]]-1;if(T<0?T=c[2*(-T-1)]:c[2*T]>0&&(r[y]=-T),p*=4,_!==i.default.TRI_INDEX){var A=r[y=o[4*f+3]]-1;A<0?A=c[2*(-A-1)]:c[2*A]>0&&(r[y]=-A),s[p+1]=s[p+4]=b,s[p+6]=s[p+9]=M,s[p+11]=s[p+14]=T,s[p+3]=s[p+12]=A,s[p+2]=s[p+7]=s[p+8]=s[p+13]=a[p+2],s[p]=v,s[p+5]=g,s[p+10]=m,s[p+15]=_;var S=2*a[p+2];h[S]=.25*(h[2*v]+h[2*g]+h[2*m]+h[2*_]),h[S+1]=.25*(h[2*v+1]+h[2*g+1]+h[2*m+1]+h[2*_+1])}else s[p]=s[p+5]=s[p+8]=b,s[p+1]=s[p+10]=s[p+12]=M,s[p+2]=s[p+6]=s[p+14]=T,s[p+3]=s[p+7]=s[p+11]=s[p+15]=i.default.TRI_INDEX,s[p+4]=v,s[p+9]=g,s[p+13]=m}t.setFacesTexCoord(s)}(e,t,r)};a.fullSubdivision=function(e,t){var r=e.getNbVertices()+e.getNbEdges()+e.getNbQuads();t.setVertices(new Float32Array(3*r)),t.setColors(new Float32Array(3*r)),t.setMaterials(new Float32Array(3*r)),t.setFaces(new Uint32Array(4*e.getNbFaces()*4)),o(e,t.getVertices(),t.getColors(),t.getMaterials());var n=u(e,t.getVertices(),t.getColors(),t.getMaterials(),t.getFaces());e.hasUV()&&l(e,t,n),t.allocateArrays()},a.partialSubdivision=function(e,t,r,n){o(e,t,r,n),u(e,t,r,n)};var c=a;t.default=c},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t,r){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,t);if(void 0===n){var i=Object.getPrototypeOf(e);return null===i?void 0:a(i,t,r)}if("value"in n)return n.value;var s=n.get;if(void 0!==s)return s.call(r)}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,r){return t&&s(e.prototype,t),r&&s(e,r),e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var u=n(r(109)),l=n(r(11)),c=n(r(14)),h=n(r(20)),f=n(r(110)),d=function(e){function t(e){var r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))).setID(e.getID()),r.setRenderData(e.getRenderData()),r.setTransformData(e.getTransformData()),r._meshes=[new u.default(e,!0)],r.setSelection(0);var n=e.getGL();return r._indexBuffer=new c.default(n,n.ELEMENT_ARRAY_BUFFER,n.STATIC_DRAW),r._wireframeBuffer=new c.default(n,n.ELEMENT_ARRAY_BUFFER,n.STATIC_DRAW),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,l.default),o(t,null,[{key:"NONE",get:function(){return 0}},{key:"SCULPT",get:function(){return 1}},{key:"CAMERA",get:function(){return 2}},{key:"PICKING",get:function(){return 3}}]),o(t,[{key:"getCurrentMesh",value:function(){return this._meshes[this._sel]}},{key:"setSelection",value:function(e){this._sel=e,this.setMeshData(this.getCurrentMesh().getMeshData())}},{key:"addLevel",value:function(){if(this._meshes.length-1!==this._sel)return this.getCurrentMesh();var e=this.getCurrentMesh().getNbFaces(),t="addLevel : "+e+" -> "+4*e;console.time(t);var r=this.getCurrentMesh(),n=new u.default(r);return r.setVerticesMapping(void 0),h.default.fullSubdivision(r,n),n.initTopology(),this.pushMesh(n),this.initRender(),console.timeEnd(t),n}},{key:"computeReverse",value:function(){if(0!==this._sel)return this.getCurrentMesh();var e=this.getCurrentMesh(),t=new u.default(e);return f.default.computeReverse(e,t)?(t.initTopology(),this.unshiftMesh(t),this.initRender(),t):void 0}},{key:"lowerLevel",value:function(){return 0===this._sel?this._meshes[0]:(this._meshes[this._sel-1].lowerAnalysis(this.getCurrentMesh()),this.setSelection(this._sel-1),this.updateResolution(),this.getCurrentMesh())}},{key:"higherLevel",value:function(){return this._sel===this._meshes.length-1?this.getCurrentMesh():(this._meshes[this._sel+1].higherSynthesis(this.getCurrentMesh()),this.setSelection(this._sel+1),this.updateResolution(),this.getCurrentMesh())}},{key:"updateResolution",value:function(){this.updateGeometry(),this.updateDuplicateColorsAndMaterials(),this.updateBuffers();var e=this._meshes[this.getLowIndexRender()];this._indexBuffer.update(e.getTriangles()),this._wireframeBuffer.update(e.getWireframe())}},{key:"selectResolution",value:function(e){for(;this._sel>e;)this.lowerLevel();for(;this._sel<e;)this.higherLevel()}},{key:"findIndexFromMesh",value:function(e){for(var t=this._meshes,r=0,n=t.length;r<n;++r)if(e===t[r])return r}},{key:"selectMesh",value:function(e){var t=this.findIndexFromMesh(e);this.selectResolution(t)}},{key:"pushMesh",value:function(e){this._meshes.push(e),this.setSelection(this._meshes.length-1),this.updateResolution()}},{key:"unshiftMesh",value:function(e){this._meshes.unshift(e),this.setSelection(1),this.lowerLevel()}},{key:"popMesh",value:function(){this._meshes.pop(),this.setSelection(this._meshes.length-1),this.updateResolution()}},{key:"shiftMesh",value:function(){this._meshes.shift(),this.setSelection(0),this.updateResolution()}},{key:"deleteLower",value:function(){this._meshes.splice(0,this._sel),this.setSelection(0)}},{key:"deleteHigher",value:function(){this._meshes.splice(this._sel+1)}},{key:"getLowIndexRender",value:function(){for(var e=this._sel;e>=0;){var t=this._meshes[e];if(!0===t.getEvenMapping())return e===this._sel?e:e+1;if(t.getNbTriangles()<5e5)return e;--e}return 0}},{key:"_renderLow",value:function(e){var r=this.getRenderData(),n=this._sel,i=this.getIndexBuffer();this.setSelection(this.getLowIndexRender()),r._indexBuffer=this._indexBuffer,a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"render",this).call(this,e),r._indexBuffer=i,this.setSelection(n)}},{key:"_renderWireframeLow",value:function(e){var r=this.getRenderData(),n=this._sel,i=this.getWireframeBuffer();this.setSelection(this.getLowIndexRender()),r._wireframeBuffer=this._wireframeBuffer,a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"renderWireframe",this).call(this,e),r._wireframeBuffer=i,this.setSelection(n)}},{key:"_canUseLowRender",value:function(e){return!this.isUsingTexCoords()&&!this.isUsingDrawArrays()&&(t.RENDER_HINT!==t.PICKING&&t.RENDER_HINT!==t.NONE&&((e.getMesh()!==this||t.RENDER_HINT===t.CAMERA)&&this.getLowIndexRender()!==this._sel))}},{key:"render",value:function(e){return this._canUseLowRender(e)?this._renderLow(e):a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"render",this).call(this,e)}},{key:"renderWireframe",value:function(e){return this._canUseLowRender(e)?this._renderWireframeLow(e):a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"renderWireframe",this).call(this,e)}}]),t}();d.RENDER_HINT=0;var p=d;t.default=p},function(e,t,r){"use strict";function n(e,t,r){let n=t[0],i=t[1],a=t[2],s=t[3],o=t[4],u=t[5],l=t[6],c=t[7],h=t[8],f=r[0],d=r[1],p=r[2],v=r[3],g=r[4],m=r[5],_=r[6],y=r[7],b=r[8];return e[0]=f*n+d*s+p*l,e[1]=f*i+d*o+p*c,e[2]=f*a+d*u+p*h,e[3]=v*n+g*s+m*l,e[4]=v*i+g*o+m*c,e[5]=v*a+g*u+m*h,e[6]=_*n+y*s+b*l,e[7]=_*i+y*o+b*c,e[8]=_*a+y*u+b*h,e}function i(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e}Object.defineProperty(t,"__esModule",{value:!0}),t.create=function(){let e=new a.ARRAY_TYPE(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},t.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},t.clone=function(e){let t=new a.ARRAY_TYPE(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},t.fromValues=function(e,t,r,n,i,s,o,u,l){let c=new a.ARRAY_TYPE(9);return c[0]=e,c[1]=t,c[2]=r,c[3]=n,c[4]=i,c[5]=s,c[6]=o,c[7]=u,c[8]=l,c},t.set=function(e,t,r,n,i,a,s,o,u,l){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=a,e[5]=s,e[6]=o,e[7]=u,e[8]=l,e},t.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},t.transpose=function(e,t){if(e===t){let r=t[1],n=t[2],i=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=n,e[7]=i}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},t.invert=function(e,t){let r=t[0],n=t[1],i=t[2],a=t[3],s=t[4],o=t[5],u=t[6],l=t[7],c=t[8],h=c*s-o*l,f=-c*a+o*u,d=l*a-s*u,p=r*h+n*f+i*d;return p?(p=1/p,e[0]=h*p,e[1]=(-c*n+i*l)*p,e[2]=(o*n-i*s)*p,e[3]=f*p,e[4]=(c*r-i*u)*p,e[5]=(-o*r+i*a)*p,e[6]=d*p,e[7]=(-l*r+n*u)*p,e[8]=(s*r-n*a)*p,e):null},t.adjoint=function(e,t){let r=t[0],n=t[1],i=t[2],a=t[3],s=t[4],o=t[5],u=t[6],l=t[7],c=t[8];return e[0]=s*c-o*l,e[1]=i*l-n*c,e[2]=n*o-i*s,e[3]=o*u-a*c,e[4]=r*c-i*u,e[5]=i*a-r*o,e[6]=a*l-s*u,e[7]=n*u-r*l,e[8]=r*s-n*a,e},t.determinant=function(e){let t=e[0],r=e[1],n=e[2],i=e[3],a=e[4],s=e[5],o=e[6],u=e[7],l=e[8];return t*(l*a-s*u)+r*(-l*i+s*o)+n*(u*i-a*o)},t.multiply=n,t.translate=function(e,t,r){let n=t[0],i=t[1],a=t[2],s=t[3],o=t[4],u=t[5],l=t[6],c=t[7],h=t[8],f=r[0],d=r[1];return e[0]=n,e[1]=i,e[2]=a,e[3]=s,e[4]=o,e[5]=u,e[6]=f*n+d*s+l,e[7]=f*i+d*o+c,e[8]=f*a+d*u+h,e},t.rotate=function(e,t,r){let n=t[0],i=t[1],a=t[2],s=t[3],o=t[4],u=t[5],l=t[6],c=t[7],h=t[8],f=Math.sin(r),d=Math.cos(r);return e[0]=d*n+f*s,e[1]=d*i+f*o,e[2]=d*a+f*u,e[3]=d*s-f*n,e[4]=d*o-f*i,e[5]=d*u-f*a,e[6]=l,e[7]=c,e[8]=h,e},t.scale=function(e,t,r){let n=r[0],i=r[1];return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=i*t[3],e[4]=i*t[4],e[5]=i*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},t.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},t.fromRotation=function(e,t){let r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=-r,e[4]=n,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},t.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},t.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},t.fromQuat=function(e,t){let r=t[0],n=t[1],i=t[2],a=t[3],s=r+r,o=n+n,u=i+i,l=r*s,c=n*s,h=n*o,f=i*s,d=i*o,p=i*u,v=a*s,g=a*o,m=a*u;return e[0]=1-h-p,e[3]=c-m,e[6]=f+g,e[1]=c+m,e[4]=1-l-p,e[7]=d-v,e[2]=f-g,e[5]=d+v,e[8]=1-l-h,e},t.normalFromMat4=function(e,t){let r=t[0],n=t[1],i=t[2],a=t[3],s=t[4],o=t[5],u=t[6],l=t[7],c=t[8],h=t[9],f=t[10],d=t[11],p=t[12],v=t[13],g=t[14],m=t[15],_=r*o-n*s,y=r*u-i*s,b=r*l-a*s,M=n*u-i*o,T=n*l-a*o,A=i*l-a*u,S=c*v-h*p,k=c*g-f*p,w=c*m-d*p,E=h*g-f*v,x=h*m-d*v,R=f*m-d*g,C=_*R-y*x+b*E+M*w-T*k+A*S;return C?(C=1/C,e[0]=(o*R-u*x+l*E)*C,e[1]=(u*w-s*R-l*k)*C,e[2]=(s*x-o*w+l*S)*C,e[3]=(i*x-n*R-a*E)*C,e[4]=(r*R-i*w+a*k)*C,e[5]=(n*w-r*x-a*S)*C,e[6]=(v*A-g*T+m*M)*C,e[7]=(g*b-p*A-m*y)*C,e[8]=(p*T-v*b+m*_)*C,e):null},t.projection=function(e,t,r){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/r,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},t.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},t.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2))},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e},t.subtract=i,t.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e},t.multiplyScalarAndAdd=function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},t.equals=function(e,t){let r=e[0],n=e[1],i=e[2],s=e[3],o=e[4],u=e[5],l=e[6],c=e[7],h=e[8],f=t[0],d=t[1],p=t[2],v=t[3],g=t[4],m=t[5],_=t[6],y=t[7],b=t[8];return Math.abs(r-f)<=a.EPSILON*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(n-d)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(i-p)<=a.EPSILON*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(s-v)<=a.EPSILON*Math.max(1,Math.abs(s),Math.abs(v))&&Math.abs(o-g)<=a.EPSILON*Math.max(1,Math.abs(o),Math.abs(g))&&Math.abs(u-m)<=a.EPSILON*Math.max(1,Math.abs(u),Math.abs(m))&&Math.abs(l-_)<=a.EPSILON*Math.max(1,Math.abs(l),Math.abs(_))&&Math.abs(c-y)<=a.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(h-b)<=a.EPSILON*Math.max(1,Math.abs(h),Math.abs(b))};var a=r(8);const s=n;t.mul=s;const o=i;t.sub=o},function(e,t,r){"use strict";function n(){let e=new p.ARRAY_TYPE(3);return e[0]=0,e[1]=0,e[2]=0,e}function i(e){let t=e[0],r=e[1],n=e[2];return Math.sqrt(t*t+r*r+n*n)}function a(e,t,r){let n=new p.ARRAY_TYPE(3);return n[0]=e,n[1]=t,n[2]=r,n}function s(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function o(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function u(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function l(e,t){let r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2];return Math.sqrt(r*r+n*n+i*i)}function c(e,t){let r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2];return r*r+n*n+i*i}function h(e){let t=e[0],r=e[1],n=e[2];return t*t+r*r+n*n}function f(e,t){let r=t[0],n=t[1],i=t[2],a=r*r+n*n+i*i;return a>0&&(a=1/Math.sqrt(a),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a),e}function d(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}Object.defineProperty(t,"__esModule",{value:!0}),t.create=n,t.clone=function(e){var t=new p.ARRAY_TYPE(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},t.length=i,t.fromValues=a,t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},t.set=function(e,t,r,n){return e[0]=t,e[1]=r,e[2]=n,e},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e},t.subtract=s,t.multiply=o,t.divide=u,t.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},t.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},t.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e},t.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e},t.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},t.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e},t.scaleAndAdd=function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e},t.distance=l,t.squaredDistance=c,t.squaredLength=h,t.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},t.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},t.normalize=f,t.dot=d,t.cross=function(e,t,r){let n=t[0],i=t[1],a=t[2],s=r[0],o=r[1],u=r[2];return e[0]=i*u-a*o,e[1]=a*s-n*u,e[2]=n*o-i*s,e},t.lerp=function(e,t,r,n){let i=t[0],a=t[1],s=t[2];return e[0]=i+n*(r[0]-i),e[1]=a+n*(r[1]-a),e[2]=s+n*(r[2]-s),e},t.hermite=function(e,t,r,n,i,a){let s=a*a,o=s*(2*a-3)+1,u=s*(a-2)+a,l=s*(a-1),c=s*(3-2*a);return e[0]=t[0]*o+r[0]*u+n[0]*l+i[0]*c,e[1]=t[1]*o+r[1]*u+n[1]*l+i[1]*c,e[2]=t[2]*o+r[2]*u+n[2]*l+i[2]*c,e},t.bezier=function(e,t,r,n,i,a){let s=1-a,o=s*s,u=a*a,l=o*s,c=3*a*o,h=3*u*s,f=u*a;return e[0]=t[0]*l+r[0]*c+n[0]*h+i[0]*f,e[1]=t[1]*l+r[1]*c+n[1]*h+i[1]*f,e[2]=t[2]*l+r[2]*c+n[2]*h+i[2]*f,e},t.random=function(e,t){t=t||1;let r=2*p.RANDOM()*Math.PI,n=2*p.RANDOM()-1,i=Math.sqrt(1-n*n)*t;return e[0]=Math.cos(r)*i,e[1]=Math.sin(r)*i,e[2]=n*t,e},t.transformMat4=function(e,t,r){let n=t[0],i=t[1],a=t[2],s=r[3]*n+r[7]*i+r[11]*a+r[15];return s=s||1,e[0]=(r[0]*n+r[4]*i+r[8]*a+r[12])/s,e[1]=(r[1]*n+r[5]*i+r[9]*a+r[13])/s,e[2]=(r[2]*n+r[6]*i+r[10]*a+r[14])/s,e},t.transformMat3=function(e,t,r){let n=t[0],i=t[1],a=t[2];return e[0]=n*r[0]+i*r[3]+a*r[6],e[1]=n*r[1]+i*r[4]+a*r[7],e[2]=n*r[2]+i*r[5]+a*r[8],e},t.transformQuat=function(e,t,r){let n=t[0],i=t[1],a=t[2],s=r[0],o=r[1],u=r[2],l=r[3],c=l*n+o*a-u*i,h=l*i+u*n-s*a,f=l*a+s*i-o*n,d=-s*n-o*i-u*a;return e[0]=c*l+d*-s+h*-u-f*-o,e[1]=h*l+d*-o+f*-s-c*-u,e[2]=f*l+d*-u+c*-o-h*-s,e},t.rotateX=function(e,t,r,n){let i=[],a=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],a[0]=i[0],a[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),a[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e},t.rotateY=function(e,t,r,n){let i=[],a=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],a[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),a[1]=i[1],a[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e},t.rotateZ=function(e,t,r,n){let i=[],a=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],a[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),a[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),a[2]=i[2],e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e},t.angle=function(e,t){let r=a(e[0],e[1],e[2]),n=a(t[0],t[1],t[2]);f(r,r),f(n,n);let i=d(r,n);return i>1?0:i<-1?Math.PI:Math.acos(i)},t.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},t.equals=function(e,t){let r=e[0],n=e[1],i=e[2],a=t[0],s=t[1],o=t[2];return Math.abs(r-a)<=p.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-s)<=p.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-o)<=p.EPSILON*Math.max(1,Math.abs(i),Math.abs(o))};var p=r(8);const v=s;t.sub=v;const g=o;t.mul=g;const m=u;t.div=m;const _=l;t.dist=_;const y=c;t.sqrDist=y;const b=i;t.len=b;const M=h;t.sqrLen=M;const T=function(){let e=n();return function(t,r,n,i,a,s){let o,u;for(r||(r=3),n||(n=0),u=i?Math.min(i*r+n,t.length):t.length,o=n;o<u;o+=r)e[0]=t[o],e[1]=t[o+1],e[2]=t[o+2],a(e,e,s),t[o]=e[0],t[o+1]=e[1],t[o+2]=e[2];return t}}();t.forEach=T},function(e,t,r){"use strict";function n(){let e=new d.ARRAY_TYPE(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function i(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function a(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function s(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function o(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function u(e,t){let r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2],a=t[3]-e[3];return Math.sqrt(r*r+n*n+i*i+a*a)}function l(e,t){let r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2],a=t[3]-e[3];return r*r+n*n+i*i+a*a}function c(e){let t=e[0],r=e[1],n=e[2],i=e[3];return Math.sqrt(t*t+r*r+n*n+i*i)}function h(e){let t=e[0],r=e[1],n=e[2],i=e[3];return t*t+r*r+n*n+i*i}function f(e,t){let r=t[0],n=t[1],i=t[2],a=t[3],s=r*r+n*n+i*i+a*a;return s>0&&(s=1/Math.sqrt(s),e[0]=r*s,e[1]=n*s,e[2]=i*s,e[3]=a*s),e}Object.defineProperty(t,"__esModule",{value:!0}),t.create=n,t.clone=function(e){let t=new d.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},t.fromValues=function(e,t,r,n){let i=new d.ARRAY_TYPE(4);return i[0]=e,i[1]=t,i[2]=r,i[3]=n,i},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},t.set=function(e,t,r,n,i){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},t.subtract=i,t.multiply=a,t.divide=s,t.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},t.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},t.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e},t.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e},t.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},t.scale=o,t.scaleAndAdd=function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e},t.distance=u,t.squaredDistance=l,t.length=c,t.squaredLength=h,t.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},t.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},t.normalize=f,t.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},t.lerp=function(e,t,r,n){let i=t[0],a=t[1],s=t[2],o=t[3];return e[0]=i+n*(r[0]-i),e[1]=a+n*(r[1]-a),e[2]=s+n*(r[2]-s),e[3]=o+n*(r[3]-o),e},t.random=function(e,t){return t=t||1,e[0]=d.RANDOM(),e[1]=d.RANDOM(),e[2]=d.RANDOM(),e[3]=d.RANDOM(),f(e,e),o(e,e,t),e},t.transformMat4=function(e,t,r){let n=t[0],i=t[1],a=t[2],s=t[3];return e[0]=r[0]*n+r[4]*i+r[8]*a+r[12]*s,e[1]=r[1]*n+r[5]*i+r[9]*a+r[13]*s,e[2]=r[2]*n+r[6]*i+r[10]*a+r[14]*s,e[3]=r[3]*n+r[7]*i+r[11]*a+r[15]*s,e},t.transformQuat=function(e,t,r){let n=t[0],i=t[1],a=t[2],s=r[0],o=r[1],u=r[2],l=r[3],c=l*n+o*a-u*i,h=l*i+u*n-s*a,f=l*a+s*i-o*n,d=-s*n-o*i-u*a;return e[0]=c*l+d*-s+h*-u-f*-o,e[1]=h*l+d*-o+f*-s-c*-u,e[2]=f*l+d*-u+c*-o-h*-s,e[3]=t[3],e},t.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},t.equals=function(e,t){let r=e[0],n=e[1],i=e[2],a=e[3],s=t[0],o=t[1],u=t[2],l=t[3];return Math.abs(r-s)<=d.EPSILON*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-o)<=d.EPSILON*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(i-u)<=d.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(a-l)<=d.EPSILON*Math.max(1,Math.abs(a),Math.abs(l))};var d=r(8);const p=i;t.sub=p;const v=a;t.mul=v;const g=s;t.div=g;const m=u;t.dist=m;const _=l;t.sqrDist=_;const y=c;t.len=y;const b=h;t.sqrLen=b;const M=function(){let e=n();return function(t,r,n,i,a,s){let o,u;for(r||(r=4),n||(n=0),u=i?Math.min(i*r+n,t.length):t.length,o=n;o<u;o+=r)e[0]=t[o],e[1]=t[o+1],e[2]=t[o+2],e[3]=t[o+3],a(e,e,s),t[o]=e[0],t[o+1]=e[1],t[o+2]=e[2],t[o+3]=e[3];return t}}();t.forEach=M},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(3)),a=n(r(4)),s=a.default.getCopy();s.vertexName=s.fragmentName="Matcap",s.textures={},s.createTexture=function(e,t,r){var n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),s.setTextureParameters(e,t),e.bindTexture(e.TEXTURE_2D,null),s.textures[r]=n};var o="/components/em-sculptgl/app/resources/matcaps/";s.matcaps=[{path:o+"matcapFV.jpg",name:"matcap FV"},{path:o+"redClay.jpg",name:"Red clay"},{path:o+"skinHazardousarts.jpg",name:"Skin hazardousarts"},{path:o+"skinHazardousarts2.jpg",name:"Skin Hazardousarts2"},{path:o+"pearl.jpg",name:(0,i.default)("matcapPearl")},{path:o+"clay.jpg",name:(0,i.default)("matcapClay")},{path:o+"skin.jpg",name:(0,i.default)("matcapSkin")},{path:o+"green.jpg",name:(0,i.default)("matcapGreen")},{path:o+"white.jpg",name:(0,i.default)("matcapWhite")}],s.uniforms={},s.attributes={},s.uniformNames=["uTexture0","uAlbedo"],Array.prototype.push.apply(s.uniformNames,a.default.uniformNames.commonUniforms),s.vertex=["attribute vec3 aVertex;","attribute vec3 aNormal;","attribute vec3 aColor;","attribute vec3 aMaterial;",a.default.strings.vertUniforms,"varying vec3 vVertex;","varying vec3 vNormal;","varying vec3 vColor;","varying float vMasking;","varying vec3 vVertexPres;","uniform vec3 uAlbedo;","void main() {","  vColor = uAlbedo.x >= 0.0 ? uAlbedo : aColor;","  vMasking = aMaterial.z;","  vNormal = mix(aNormal, uEN * aNormal, vMasking);","  vNormal = normalize(uN * vNormal);","  vec4 vertex4 = vec4(aVertex, 1.0);","  vertex4 = mix(vertex4, uEM * vertex4, vMasking);","  vVertex = vec3(uMV * vertex4);","  vVertexPres = vVertex / max(1.0, abs(uMV[3][2]));","  gl_Position = uMVP * vertex4;","}"].join("\n"),s.fragment=["uniform sampler2D uTexture0;","varying vec3 vVertex;","varying vec3 vVertexPres;","varying vec3 vNormal;","varying vec3 vColor;","uniform float uAlpha;",a.default.strings.fragColorUniforms,a.default.strings.fragColorFunction,"void main() {","  vec3 normal = getNormal();","  vec3 nm_z = normalize(vVertexPres);","  vec3 nm_x = vec3(-nm_z.z, 0.0, nm_z.x);","  vec3 nm_y = cross(nm_x, nm_z);","  vec2 texCoord = 0.5 + 0.5 * vec2(dot(normal, nm_x), dot(normal, nm_y));","  vec3 color = sRGBToLinear(texture2D(uTexture0, texCoord).rgb) * sRGBToLinear(vColor);","  gl_FragColor = encodeFragColor(color, uAlpha);","}"].join("\n"),s.updateUniforms=function(e,t){var r=e.getGL(),n=this.uniforms;r.activeTexture(r.TEXTURE0),e.setTexture0(s.textures[e.getMatcap()]),r.bindTexture(r.TEXTURE_2D,e.getTexture0()||this.getDummyTexture(r)),r.uniform1i(n.uTexture0,0),r.uniform3fv(n.uAlbedo,e.getAlbedo()),a.default.updateUniforms.call(this,e,t)};var u=s;t.default=u},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(5)),a=n(r(4)),s=n(r(13)),o=n(r(71)),u=a.default.getCopy();u.vertexName=u.fragmentName="SobelContour",u.color=(0,i.default)().outlinecolor,u.uniforms={},u.attributes={},u.uniformNames=["uTexture0","uColor","uInvSize"],u.vertex=["attribute vec2 aVertex;","varying vec2 vTexCoord;","void main() {","  vTexCoord = aVertex * 0.5 + 0.5;","  gl_Position = vec4(aVertex, 0.0, 1.0);","}"].join("\n"),u.fragment=["#extension GL_OES_standard_derivatives : enable","uniform sampler2D uTexture0;","uniform vec4 uColor;","varying vec2 vTexCoord;","uniform vec2 uInvSize;",o.default,a.default.strings.colorSpaceGLSL,"void main() {","  float mag = outlineDistance(vTexCoord, uTexture0, uInvSize);","  if (mag < 1.5) discard;","  gl_FragColor = vec4(sRGBToLinear(uColor.rgb) * uColor.a, uColor.a);","}"].join("\n"),u.draw=function(e){var t=e.getGL();t.useProgram(this.program),u.attributes.aVertex.bindToBuffer(e.getVertexBuffer()),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,e.getTexture()),t.uniform1i(this.uniforms.uTexture0,0),t.uniform4fv(this.uniforms.uColor,u.color),t.uniform2fv(this.uniforms.uInvSize,e.getInverseSize()),t.drawArrays(t.TRIANGLES,0,3)},u.initAttributes=function(e){u.attributes.aVertex=new s.default(e,u.program,"aVertex",2,e.FLOAT)};var l=u;t.default=l},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=n(r(7)),o=n(r(6)),u=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=function(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r._radius=50,r._intensity=.75,r._negative=!0,r._culling=!1,r._idAlpha=0,r._lockPosition=!1,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),function(e,t,r){t&&a(e.prototype,t),r&&a(e,r)}(t,[{key:"stroke",value:function(e){var t=e.getPickedVertices(),r=this._intensity*s.default.getPressureIntensity();this._main.getStateManager().pushVertices(t),t=this.dynamicTopology(e);var n=this.getFrontVertices(t,e.getEyeDirection());this._culling&&(t=n);var i=this.areaNormal(n);if(i){var a=this.areaCenter(n);e.updateAlpha(this._lockPosition),e.setIdAlpha(this._idAlpha),this.flatten(t,i,a,e.getIntersectionPoint(),e.getLocalRadius2(),r,e);var o=this.getMesh();o.updateGeometry(o.getFacesFromVertices(t),t)}}},{key:"flatten",value:function(e,t,r,n,i,a,s){for(var o=this.getMesh(),u=o.getVertices(),l=o.getMaterials(),c=Math.sqrt(i),h=!1===this._accumulate&&!1===this._lockPosition?o.getVerticesProxy():u,f=n[0],d=n[1],p=n[2],v=r[0],g=r[1],m=r[2],_=t[0],y=t[1],b=t[2],M=this._negative?-1:1,T=0,A=e.length;T<A;++T){var S=3*e[T],k=u[S],w=u[S+1],E=u[S+2],x=(k-v)*_+(w-g)*y+(E-m)*b;if(!(x*M>0)){var R=h[S]-f,C=h[S+1]-d,P=h[S+2]-p,F=Math.sqrt(R*R+C*C+P*P)/c;if(!(F>=1)){var D=F*F;D=3*D*D-4*D*F+1,D*=x*a*l[S+2]*s.getAlpha(k,w,E),u[S]-=_*D,u[S+1]-=y*D,u[S+2]-=b*D}}}}}]),t}();t.default=u},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t,r){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,t);if(void 0===n){var i=Object.getPrototypeOf(e);return null===i?void 0:s(i,t,r)}if("value"in n)return n.value;var a=n.get;if(void 0!==a)return a.call(r)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=r(1),u=n(r(7)),l=n(r(6)),c=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=function(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r._radius=50,r._hardness=.75,r._intensity=.75,r._culling=!1,r._color=o.vec3.fromValues(1,.766,.336),r._material=o.vec3.fromValues(.3,.95,0),r._pickColor=!1,r._pickCallback=null,r._idAlpha=0,r._lockPosition=!1,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,l.default),function(e,t,r){t&&a(e.prototype,t),r&&a(e,r)}(t,[{key:"end",value:function(){this._pickColor=!1,s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"end",this).call(this)}},{key:"pushState",value:function(e){this._pickColor&&!e||this._main.getStateManager().pushStateColorAndMaterial(this.getMesh())}},{key:"startSculpt",value:function(){if(this._pickColor)return this.pickColor(this._main.getPicking());s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"startSculpt",this).call(this)}},{key:"update",value:function(e){if(!0===this._pickColor)return this.updatePickColor();s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"update",this).call(this,e)}},{key:"updateContinuous",value:function(){if(!0===this._pickColor)return this.updatePickColor();s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateContinuous",this).call(this)}},{key:"updateMeshBuffers",value:function(){var e=this.getMesh();e.isDynamic?e.updateBuffers():(e.updateColorBuffer(),e.updateMaterialBuffer())}},{key:"updatePickColor",value:function(){var e=this._main.getPicking();e.intersectionMouseMesh()&&this.pickColor(e)}},{key:"setPickCallback",value:function(e){this._pickCallback=e}},{key:"pickColor",value:function(e){var t=this.getMesh(),r=this._color;e.polyLerp(t.getMaterials(),r);var n=r[0],i=r[1];e.polyLerp(t.getColors(),r),this._pickCallback(r,n,i)}},{key:"stroke",value:function(e){var t=e.getPickedVertices(),r=this._intensity*u.default.getPressureIntensity();this._main.getStateManager().pushVertices(t),t=this.dynamicTopology(e),this._culling&&(t=this.getFrontVertices(t,e.getEyeDirection())),e.updateAlpha(this._lockPosition),e.setIdAlpha(this._idAlpha),this.paint(t,e.getIntersectionPoint(),e.getLocalRadius2(),r,this._hardness,e);var n=this.getMesh();n.updateDuplicateColorsAndMaterials(t),n.isUsingDrawArrays()&&n.updateDrawArrays(n.getFacesFromVertices(t))}},{key:"paint",value:function(e,t,r,n,i,a){for(var s=this.getMesh(),o=s.getVertices(),u=s.getColors(),l=s.getMaterials(),c=this._color,h=this._material[0],f=this._material[1],d=Math.sqrt(r),p=c[0],v=c[1],g=c[2],m=t[0],_=t[1],y=t[2],b=2*(1-i),M=0,T=e.length;M<T;++M){var A=3*e[M],S=o[A],k=o[A+1],w=o[A+2],E=S-m,x=k-_,R=w-y,C=Math.sqrt(E*E+x*x+R*R)/d;C>1&&(C=1);var P=Math.pow(1-C,b),F=1-(P*=n*l[A+2]*a.getAlpha(S,k,w));u[A]=u[A]*F+p*P,u[A+1]=u[A+1]*F+v*P,u[A+2]=u[A+2]*F+g*P,l[A]=l[A]*F+h*P,l[A+1]=l[A+1]*F+f*P}}},{key:"paintAll",value:function(){var e=this.getMesh(),t=this.getUnmaskedVertices();if(0!==t.length){this.pushState(!0),this._main.getStateManager().pushVertices(t);for(var r=e.getColors(),n=e.getMaterials(),i=this._color,a=this._material[0],s=this._material[1],o=i[0],u=i[1],l=i[2],c=0,h=t.length;c<h;++c){var f=3*t[c],d=n[f+2],p=1-d;r[f]=r[f]*p+o*d,r[f+1]=r[f+1]*p+u*d,r[f+2]=r[f+2]*p+l*d,n[f]=n[f]*p+a*d,n[f+1]=n[f+1]*p+s*d}e.updateDuplicateColorsAndMaterials(),e.updateDrawArrays(),this.updateRender()}}}]),t}();t.default=c},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(0)),a=n(r(9)),s=n(r(15)),o={},u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:64,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:64,s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],u=s&&0===e,l=o&&0===t,c=.5*r,h=(a+1)*n,f=a*n;s&&(h+=1,f+=n),o&&(h+=1,f+=n),(u||l)&&(h-=n,f-=n);var d=new Float32Array(3*h),p=new Uint32Array(4*f),v=0,g=0,m=0,_=0,y=u?1:0,b=l?a-1:a;for(m=y;m<=b;m++){var M=m/a,T=M*(t-e)+e;for(_=0;_<n;_++){var A=2*Math.PI*_/n;d[g=3*v++]=T*Math.sin(A),d[g+1]=-M*r+c,d[g+2]=T*Math.cos(A)}}for(v=0,_=0;_<n;_++){var S=_===n-1?0:_+1;for(m=y;m<b;m++)p[g=4*v++]=n*m+_,p[g+1]=n*(m+1)+_,p[g+2]=n*(m+1)+S,p[g+3]=n*m+S}var k;if(s)for(d[3*(k=(o?d.length-6:d.length-3)/3)+1]=c,_=0;_<n;_++)p[g=4*v++]=_,p[g+1]=_===n-1?0:_+1,p[g+2]=k,p[g+3]=i.default.TRI_INDEX;if(o){d[3*(k=(d.length-3)/3)+1]=-c,u&&--m;var w=n*m;for(_=0;_<n;_++)p[g=4*v++]=_===n-1?w:w+_+1,p[g+1]=w+_,p[g+2]=k,p[g+3]=i.default.TRI_INDEX}return{vertices:d,faces:p}},l=function(e,t){var r=new a.default(e);return r.setVertices(t.vertices),t.faces&&r.setFaces(t.faces),t.uv&&t.facesUV&&r.initTexCoordsDataFromOBJData(t.uv,t.facesUV),r.init(),e&&r.initRender(),r},c=Array.prototype.slice;o.createGrid=function(e){var t=l(e,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-.5,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-.5,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:1,l=arguments.length>9&&void 0!==arguments[9]?arguments[9]:20,c=arguments.length>10&&void 0!==arguments[10]?arguments[10]:l;l+=2,c+=2;var h=new Float32Array(2*(l+c)*3),f=0,d=0,p=n/(l-1),v=i/(l-1),g=a/(l-1),m=e+n+s,_=t+i+o,y=r+a+u;for(f=0;f<l;++f)h[d=6*f]=e+p*f,h[d+1]=t+v*f,h[d+2]=r+g*f,h[d+3]=m-p*(l-f-1),h[d+4]=_-v*(l-f-1),h[d+5]=y-g*(l-f-1);for(p=s/(c-1),v=o/(c-1),g=u/(c-1),f=0;f<c;++f)h[d=6*(l+f)]=e+p*f,h[d+1]=t+v*f,h[d+2]=r+g*f,h[d+3]=m-p*(c-f-1),h[d+4]=_-v*(c-f-1),h[d+5]=y-g*(c-f-1);return{vertices:h}}.apply(this,c.call(arguments,1)));return e&&(t.setMode(e.LINES),t.setUseDrawArrays(!0),t.setAlreadyDrawArrays()),t},o.createCube=function(e){return l(e,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=new Float32Array(24);t[1]=t[2]=t[4]=t[6]=t[7]=t[9]=t[10]=t[11]=t[14]=t[18]=t[21]=t[23]=.5*-e,t[0]=t[3]=t[5]=t[8]=t[12]=t[13]=t[15]=t[16]=t[17]=t[19]=t[20]=t[22]=.5*e;var r=new Float32Array(28);r[0]=r[6]=r[8]=r[10]=r[11]=r[13]=r[16]=r[23]=r[25]=.5,r[1]=r[3]=1,r[2]=r[4]=r[9]=r[12]=r[14]=r[15]=r[18]=.25,r[5]=r[7]=r[21]=r[24]=r[26]=r[27]=.75,r[17]=r[19]=r[20]=r[22]=0;var n=new Uint32Array(24),i=new Uint32Array(24);return n[0]=n[8]=n[21]=i[0]=0,n[1]=n[11]=n[12]=i[1]=1,n[2]=n[15]=n[16]=i[2]=i[15]=i[16]=2,n[3]=n[19]=n[22]=i[3]=i[19]=i[22]=3,n[4]=n[9]=n[20]=i[4]=i[9]=4,n[7]=n[10]=n[13]=i[5]=i[18]=i[23]=5,n[6]=n[14]=n[17]=i[6]=i[14]=i[17]=6,n[5]=n[18]=n[23]=i[7]=i[10]=7,i[8]=8,i[11]=9,i[12]=10,i[13]=11,i[20]=12,i[21]=13,{vertices:t,uv:r,faces:n,facesUV:i}}.apply(this,c.call(arguments,1)))},o.createCylinder=function(e){return l(e,u.apply(this,c.call(arguments,1)))},o.createTorus=function(e){return l(e,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2*Math.PI,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:32,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:128,s=2*Math.PI-r<.01,o=n*a,u=o;s||(o+=2,u+=n);var l=s?a:a-1,c=new Float32Array(3*o),h=new Uint32Array(4*u),f=0,d=0,p=0,v=0;for(p=0;p<a;++p)for(v=0;v<n;++v){var g=p/l*r,m=v/n*Math.PI*2;c[d=3*f++]=(e+t*Math.cos(m))*Math.cos(g),c[d+1]=t*Math.sin(m),c[d+2]=(e+t*Math.cos(m))*Math.sin(g)}for(f=0,p=0;p<l;++p){var _=p===a-1?0:p+1;for(v=0;v<n;++v){h[d=4*f++]=n*p+v;var y=v===n-1?0:v+1;h[d+1]=n*p+y,h[d+2]=n*_+y,h[d+3]=n*_+v}}if(!s){var b=(c.length-6)/3;for(c[3*b]=e,v=0;v<n;v++)h[d=4*f++]=b,h[d+1]=v===n-1?0:v+1,h[d+2]=v,h[d+3]=i.default.TRI_INDEX;c[3*++b]=e*Math.cos(r),c[3*b+2]=e*Math.sin(r);var M=n*p;for(v=0;v<n;v++)h[d=4*f++]=b,h[d+1]=M+v,h[d+2]=v===n-1?M:M+v+1,h[d+3]=i.default.TRI_INDEX}return{vertices:c,faces:h}}.apply(this,c.call(arguments,1)))},o.createPlane=function(e){return l(e,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-.5,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-.5,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:1,l=new Float32Array(4);l[0]=0,l[1]=1,l[2]=2,l[3]=3;var c=new Float32Array(12);return c[0]=e,c[1]=t,c[2]=r,c[3]=e+n,c[4]=t+i,c[5]=r+a,c[6]=e+n+s,c[7]=t+i+o,c[8]=r+a+u,c[9]=e+s,c[10]=t+o,c[11]=r+u,{faces:l,vertices:c}}.apply(this,c.call(arguments,1)))},o.createArrow=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.2,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:4,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,c=l(null,u(t,t,r,a,o)),h=l(null,u(0,t*n,r*i,a,o));h.getMatrix()[13]=.5*r;var f={vertices:null,faces:null};return s.default.mergeArrays([c,h],f),l(e,f)},o.createLine2D=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=l(e,{vertices:new Float32Array([t,r,0,n,i,0])});return e&&(a.setMode(e.LINES),a.setUseDrawArrays(!0),a.setAlreadyDrawArrays()),a};var h=o;t.default=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(e){return e&&e.__esModule?e:{default:e}}(r(4)),i={};i.VERSION=3,i.exportSGL=function(e,t){var r,a=e.length,s=4*(9+31*a),o=0;for(o=0;o<a;++o)s+=4*(r=e[o]).getNbVertices()*3,r.getColors()&&(s+=4*r.getNbVertices()*3),r.getMaterials()&&(s+=4*r.getNbVertices()*3),s+=4*r.getNbFaces()*4,r.hasUV()&&(s+=4*r.getNbTexCoords()*2,s+=4*r.getNbFaces()*4);var u=new ArrayBuffer(s),l=new Float32Array(u),c=new Uint32Array(u),h=0;c[h++]=i.VERSION,c[h++]=t._showGrid,c[h++]=n.default.showSymmetryLine,c[h++]=t._showContour;var f=t.getCamera();for(c[h++]=f.getProjectionType(),c[h++]=f.getMode(),l[h++]=f.getFov(),c[h++]=f.getUsePivot(),c[h++]=a,o=0;o<a;++o){r=e[o],c[h++]=r.getShaderType(),c[h++]=r.getMatcap(),c[h++]=r.getShowWireframe(),c[h++]=r.getFlatShading(),l[h++]=r.getOpacity(),l.set(r.getCenter(),h),h+=3,l.set(r.getMatrix(),h),h+=16,l[h++]=r.getScale();var d=r.getNbVertices();c[h++]=d,l.set(r.getVertices().subarray(0,3*d),h),h+=3*d;var p=r.getColors()?d:0;c[h++]=p,p>0&&l.set(r.getColors().subarray(0,3*d),h),h+=3*p;var v=r.getMaterials()?d:0;c[h++]=v,v>0&&l.set(r.getMaterials().subarray(0,3*d),h),h+=3*v;var g=r.getNbFaces();c[h++]=g,c.set(r.getFaces().subarray(0,4*g),h),h+=4*g;var m=r.hasUV(),_=r.getNbTexCoords();c[h++]=m?_:0,m&&(l.set(r.getTexCoords().subarray(0,2*_),h),h+=2*_),c[h++]=m?g:0,m&&(c.set(r.getFacesTexCoord().subarray(0,4*g),h),h+=4*g)}var y=new DataView(u,0,4*h);return new Blob([y])};var a=i;t.default=a},function(e,t){!function(e){"use strict";function t(){this.crc=-1}function r(){}function n(e,t){var r,n;return r=new ArrayBuffer(e),n=new Uint8Array(r),t&&n.set(t,0),{buffer:r,array:n,view:new DataView(r)}}function i(){}function a(e){var t,r=this;r.size=0,r.init=function(n,i){var a=new Blob([e],{type:V});(t=new o(a)).init(function(){r.size=t.size,n()},i)},r.readUint8Array=function(e,r,n,i){t.readUint8Array(e,r,n,i)}}function s(t){var r,i=this;i.size=0,i.init=function(e){for(var n=t.length;"="==t.charAt(n-1);)n--;r=t.indexOf(",")+1,i.size=Math.floor(.75*(n-r)),e()},i.readUint8Array=function(i,a,s){var o,u=n(a),l=4*Math.floor(i/3),c=4*Math.ceil((i+a)/3),h=e.atob(t.substring(l+r,c+r)),f=i-3*Math.floor(l/4);for(o=f;o<f+a;o++)u.array[o-f]=h.charCodeAt(o);s(u.array)}}function o(e){var t=this;t.size=0,t.init=function(r){t.size=e.size,r()},t.readUint8Array=function(t,r,n,i){var a=new FileReader;a.onload=function(e){n(new Uint8Array(e.target.result))},a.onerror=i;try{a.readAsArrayBuffer(function(e,t,r){if(t<0||r<0||t+r>e.size)throw new RangeError("offset:"+t+", length:"+r+", size:"+e.size);return e.slice?e.slice(t,t+r):e.webkitSlice?e.webkitSlice(t,t+r):e.mozSlice?e.mozSlice(t,t+r):e.msSlice?e.msSlice(t,t+r):void 0}(e,t,r))}catch(e){i(e)}}}function u(){}function l(e){var t;this.init=function(e){t=new Blob([],{type:V}),e()},this.writeUint8Array=function(e,r){t=new Blob([t,k?e:e.buffer],{type:V}),r()},this.getData=function(r,n){var i=new FileReader;i.onload=function(e){r(e.target.result)},i.onerror=n,i.readAsText(t,e)}}function c(t){var r="",n="";this.init=function(e){r+="data:"+(t||"")+";base64,",e()},this.writeUint8Array=function(t,i){var a,s=n.length,o=n;for(n="",a=0;a<3*Math.floor((s+t.length)/3)-s;a++)o+=String.fromCharCode(t[a]);for(;a<t.length;a++)n+=String.fromCharCode(t[a]);o.length>2?r+=e.btoa(o):n=o,i()},this.getData=function(t){t(r+e.btoa(n))}}function h(e){var t;this.init=function(r){t=new Blob([],{type:e}),r()},this.writeUint8Array=function(r,n){t=new Blob([t,k?r:r.buffer],{type:e}),n()},this.getData=function(e){e(t)}}function f(e,t,r,n,i,a,s,o,u,l){function c(){e.removeEventListener("message",h,!1),o(p,v)}function h(t){var r=t.data,i=r.data,o=r.error;if(o)return o.toString=function(){return"Error: "+this.message},void u(o);if(r.sn===m)switch("number"==typeof r.codecTime&&(e.codecTime+=r.codecTime),"number"==typeof r.crcTime&&(e.crcTime+=r.crcTime),r.type){case"append":i?(p+=i.length,n.writeUint8Array(i,function(){f()},l)):f();break;case"flush":v=r.crc,i?(p+=i.length,n.writeUint8Array(i,function(){c()},l)):c();break;case"progress":s&&s(d+r.loaded,a);break;case"importScripts":case"newTask":case"echo":break;default:console.warn("zip.js:launchWorkerProcess: unknown message: ",r)}}function f(){(d=g*N)<a?r.readUint8Array(i+d,Math.min(N,a-d),function(r){s&&s(d,a);var n=0===d?t:{sn:m};n.type="append",n.data=r,e.postMessage(n,[r.buffer]),g++},u):e.postMessage({sn:m,type:"flush"})}var d,p,v,g=0,m=t.sn;p=0,e.addEventListener("message",h,!1),f()}function d(e,r,n,i,a,s,o,u,l,c){function h(){var t;if((f=d*N)<a)r.readUint8Array(i+f,Math.min(N,a-f),function(t){var r;try{r=e.append(t,function(e){o&&o(f+e,a)})}catch(e){return void l(e)}r?(p+=r.length,n.writeUint8Array(r,function(){d++,setTimeout(h,1)},c),g&&m.append(r)):(d++,setTimeout(h,1)),v&&m.append(t),o&&o(f,a)},l);else{try{t=e.flush()}catch(e){return void l(e)}t?(g&&m.append(t),p+=t.length,n.writeUint8Array(t,function(){u(p,m.get())},c)):u(p,m.get())}}var f,d=0,p=0,v="input"===s,g="output"===s,m=new t;h()}function p(t,n,i,a,s,o,u,l,c,h,p){if(e.zip.useWebWorkers&&u){f(t,{sn:n,codecClass:"NOOP",crcType:"input"},i,a,s,o,c,l,h,p)}else d(new r,i,a,s,o,"input",c,l,h,p)}function v(e){var t,r,n="",i=["Ç","ü","é","â","ä","à","å","ç","ê","ë","è","ï","î","ì","Ä","Å","É","æ","Æ","ô","ö","ò","û","ù","ÿ","Ö","Ü","ø","£","Ø","×","ƒ","á","í","ó","ú","ñ","Ñ","ª","º","¿","®","¬","½","¼","¡","«","»","_","_","_","¦","¦","Á","Â","À","©","¦","¦","+","+","¢","¥","+","+","-","-","+","-","+","ã","Ã","+","+","-","-","¦","-","+","¤","ð","Ð","Ê","Ë","È","i","Í","Î","Ï","+","+","_","_","¦","Ì","_","Ó","ß","Ô","Ò","õ","Õ","µ","þ","Þ","Ú","Û","Ù","ý","Ý","¯","´","­","±","_","¾","¶","§","÷","¸","°","¨","·","¹","³","²","_"," "];for(t=0;t<e.length;t++)n+=(r=255&e.charCodeAt(t))>127?i[r-128]:String.fromCharCode(r);return n}function g(e){return decodeURIComponent(escape(e))}function m(e){var t,r="";for(t=0;t<e.length;t++)r+=String.fromCharCode(e[t]);return r}function _(e,t,r,n,i){e.version=t.view.getUint16(r,!0),e.bitFlag=t.view.getUint16(r+2,!0),e.compressionMethod=t.view.getUint16(r+4,!0),e.lastModDateRaw=t.view.getUint32(r+6,!0),e.lastModDate=function(e){var t=(4294901760&e)>>16,r=65535&e;try{return new Date(1980+((65024&t)>>9),((480&t)>>5)-1,31&t,(63488&r)>>11,(2016&r)>>5,2*(31&r),0)}catch(e){}}(e.lastModDateRaw),1!=(1&e.bitFlag)?((n||8!=(8&e.bitFlag))&&(e.crc32=t.view.getUint32(r+10,!0),e.compressedSize=t.view.getUint32(r+14,!0),e.uncompressedSize=t.view.getUint32(r+18,!0)),4294967295!==e.compressedSize&&4294967295!==e.uncompressedSize?(e.filenameLength=t.view.getUint16(r+22,!0),e.extraFieldLength=t.view.getUint16(r+24,!0)):i(R)):i(x)}function y(t,r,i){function a(){}var s=0;a.prototype.getData=function(r,a,o,u){function l(e,t){u&&!function(e){var t=n(4);return t.view.setUint32(0,e),v.crc32==t.view.getUint32(0)}(t)?i(E):r.getData(function(e){a(e)})}function c(e){i(e||D)}function h(e){i(e||F)}var v=this;t.readUint8Array(v.offset,30,function(a){var g,m=n(a.length,a);1347093252==m.view.getUint32(0)?(_(v,m,4,!1,i),g=v.offset+30+v.filenameLength+v.extraFieldLength,r.init(function(){0===v.compressionMethod?p(v._worker,s++,t,r,g,v.compressedSize,u,l,o,c,h):function(t,r,n,i,a,s,o,u,l,c,h){var p=o?"output":"none";e.zip.useWebWorkers?f(t,{sn:r,codecClass:"Inflater",crcType:p},n,i,a,s,l,u,c,h):d(new e.zip.Inflater,n,i,a,s,p,l,u,c,h)}(v._worker,s++,t,r,g,v.compressedSize,u,l,o,c,h)},h)):i(w)},c)};var o={getEntries:function(e){var r=this._worker;!function(e){function r(r,a){t.readUint8Array(t.size-r,r,function(t){for(var r=t.length-n;r>=0;r--)if(80===t[r]&&75===t[r+1]&&5===t[r+2]&&6===t[r+3])return void e(new DataView(t.buffer,r,n));a()},function(){i(C)})}var n=22;if(t.size<n)i(w);else{var a=n+65536;r(n,function(){r(Math.min(a,t.size),function(){i(w)})})}}(function(s){var o,u;o=s.getUint32(16,!0),u=s.getUint16(8,!0),o<0||o>=t.size?i(w):t.readUint8Array(o,t.size-o,function(t){var s,o,l,c,h=0,f=[],d=n(t.length,t);for(s=0;s<u;s++){if(o=new a,o._worker=r,1347092738!=d.view.getUint32(h))return void i(w);_(o,d,h+6,!0,i),o.commentLength=d.view.getUint16(h+32,!0),o.directory=16==(16&d.view.getUint8(h+38)),o.offset=d.view.getUint32(h+42,!0),l=m(d.array.subarray(h+46,h+46+o.filenameLength)),o.filename=2048==(2048&o.bitFlag)?g(l):v(l),o.directory||"/"!=o.filename.charAt(o.filename.length-1)||(o.directory=!0),c=m(d.array.subarray(h+46+o.filenameLength+o.extraFieldLength,h+46+o.filenameLength+o.extraFieldLength+o.commentLength)),o.comment=2048==(2048&o.bitFlag)?g(c):v(c),f.push(o),h+=46+o.filenameLength+o.extraFieldLength+o.commentLength}e(f)},function(){i(C)})})},close:function(e){this._worker&&(this._worker.terminate(),this._worker=null),e&&e()},_worker:null};e.zip.useWebWorkers?A("inflater",function(e){o._worker=e,r(o)},function(e){i(e)}):r(o)}function b(e){return unescape(encodeURIComponent(e))}function M(e){var t,r=[];for(t=0;t<e.length;t++)r.push(e.charCodeAt(t));return r}function T(t,r,i,a){function s(e){i(e||P)}function o(e){i(e||D)}var u={},l=[],c=0,h=0,v={add:function(r,v,g,m,_){function y(e,r){var i=n(16);c+=e||0,i.view.setUint32(0,1347094280),void 0!==r&&(A.view.setUint32(10,r,!0),i.view.setUint32(4,r,!0)),v&&(i.view.setUint32(8,e,!0),A.view.setUint32(14,e,!0),i.view.setUint32(12,v.size,!0),A.view.setUint32(18,v.size,!0)),t.writeUint8Array(i.array,function(){c+=16,g()},s)}function T(){_=_||{},r=r.trim(),_.directory&&"/"!=r.charAt(r.length-1)&&(r+="/"),u.hasOwnProperty(r)?i(I):(S=M(b(r)),l.push(r),function(e){var i;k=_.lastModDate||new Date,A=n(26),u[r]={headerArray:A.array,directory:_.directory,filename:S,offset:c,comment:M(b(_.comment||""))},A.view.setUint32(0,335546376),_.version&&A.view.setUint8(0,_.version),a||0===_.level||_.directory||A.view.setUint16(4,2048),A.view.setUint16(6,(k.getHours()<<6|k.getMinutes())<<5|k.getSeconds()/2,!0),A.view.setUint16(8,(k.getFullYear()-1980<<4|k.getMonth()+1)<<5|k.getDate(),!0),A.view.setUint16(22,S.length,!0),(i=n(30+S.length)).view.setUint32(0,1347093252),i.array.set(A.array,4),i.array.set(S,30),c+=i.array.length,t.writeUint8Array(i.array,e,s)}(function(){v?a||0===_.level?p(w,h++,v,t,0,v.size,!0,y,m,o,s):function(t,r,n,i,a,s,o,u,l){e.zip.useWebWorkers?f(t,{sn:r,options:{level:a},codecClass:"Deflater",crcType:"input"},n,i,0,n.size,o,s,u,l):d(new e.zip.Deflater,n,i,0,n.size,"input",o,s,u,l)}(w,h++,v,t,_.level,y,m,o,s):y()}))}var A,S,k,w=this._worker;v?v.init(T,o):T()},close:function(e){this._worker&&(this._worker.terminate(),this._worker=null);var r,i,a,o=0,h=0;for(i=0;i<l.length;i++)o+=46+(a=u[l[i]]).filename.length+a.comment.length;for(r=n(o+22),i=0;i<l.length;i++)a=u[l[i]],r.view.setUint32(h,1347092738),r.view.setUint16(h+4,5120),r.array.set(a.headerArray,h+6),r.view.setUint16(h+32,a.comment.length,!0),a.directory&&r.view.setUint8(h+38,16),r.view.setUint32(h+42,a.offset,!0),r.array.set(a.filename,h+46),r.array.set(a.comment,h+46+a.filename.length),h+=46+a.filename.length+a.comment.length;r.view.setUint32(h,1347093766),r.view.setUint16(h+8,l.length,!0),r.view.setUint16(h+10,l.length,!0),r.view.setUint32(h+12,o,!0),r.view.setUint32(h+16,c,!0),t.writeUint8Array(r.array,function(){t.getData(e)},s)},_worker:null};e.zip.useWebWorkers?A("deflater",function(e){v._worker=e,r(v)},function(e){i(e)}):r(v)}function A(t,r,n){function i(e){var t=e.data;if(t.error)return o.terminate(),void n(t.error);"importScripts"===t.type&&(o.removeEventListener("message",i),o.removeEventListener("error",a),r(o))}function a(e){o.terminate(),n(e)}if(null===e.zip.workerScripts||null===e.zip.workerScriptsPath){var s;if(e.zip.workerScripts){if(s=e.zip.workerScripts[t],!Array.isArray(s))return void n(new Error("zip.workerScripts."+t+" is not an array!"));s=function(e){var t=document.createElement("a");return e.map(function(e){return t.href=e,t.href})}(s)}else(s=L[t].slice(0))[0]=(e.zip.workerScriptsPath||"")+s[0];var o=new Worker(s[0]);o.codecTime=o.crcTime=0,o.postMessage({type:"importScripts",scripts:s.slice(1)}),o.addEventListener("message",i),o.addEventListener("error",a)}else n(new Error("Either zip.workerScripts or zip.workerScriptsPath may be set, not both."))}function S(e){console.error(e)}var k,w="File format is not recognized.",E="CRC failed.",x="File contains encrypted entry.",R="File is using Zip64 (4gb+ file size).",C="Error while reading zip file.",P="Error while writing zip file.",F="Error while writing file data.",D="Error while reading file data.",I="File already exists.",N=524288,V="text/plain";try{k=0===new Blob([new DataView(new ArrayBuffer(0))]).size}catch(e){}t.prototype.append=function(e){for(var t=0|this.crc,r=this.table,n=0,i=0|e.length;n<i;n++)t=t>>>8^r[255&(t^e[n])];this.crc=t},t.prototype.get=function(){return~this.crc},t.prototype.table=function(){var e,t,r,n=[];for(e=0;e<256;e++){for(r=e,t=0;t<8;t++)1&r?r=r>>>1^3988292384:r>>>=1;n[e]=r}return n}(),r.prototype.append=function(e,t){return e},r.prototype.flush=function(){},(a.prototype=new i).constructor=a,(s.prototype=new i).constructor=s,(o.prototype=new i).constructor=o,u.prototype.getData=function(e){e(this.data)},(l.prototype=new u).constructor=l,(c.prototype=new u).constructor=c,(h.prototype=new u).constructor=h;var L={deflater:["z-worker.js","deflate.js"],inflater:["z-worker.js","inflate.js"]};e.zip={Reader:i,Writer:u,BlobReader:o,Data64URIReader:s,TextReader:a,BlobWriter:h,Data64URIWriter:c,TextWriter:l,createReader:function(e,t,r){r=r||S,e.init(function(){y(e,t,r)},r)},createWriter:function(e,t,r,n){r=r||S,n=!!n,e.init(function(){T(e,t,r,n)},r)},useWebWorkers:!0,workerScriptsPath:null,workerScripts:null}}(this)},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(0)),a=n(r(15)),s={},o=function(e){return a.default.mergeArrays(e,{vertices:null,colors:null,faces:null})};s.exportAsciiPLY=function(e){var t=o(e),r=t.nbVertices,n=t.nbFaces,a=t.vertices,s=t.colors,u=t.faces,l=0,c=0,h="ply\nformat ascii 1.0\ncomment created by SculptGL\n";for(h+="element vertex "+r+"\n",h+="property float x\nproperty float y\nproperty float z\n",h+="property uchar red\nproperty uchar green\nproperty uchar blue\n",h+="element face "+n+"\n",h+="property list uchar uint vertex_indices\nend_header\n",l=0;l<r;++l)h+=a[c=3*l]+" "+a[c+1]+" "+a[c+2]+" "+(255*s[c]|0)+" "+(255*s[c+1]|0)+" "+(255*s[c+2]|0)+"\n";for(l=0;l<n;++l){var f=u[(c=4*l)+3],d=f!==i.default.TRI_INDEX;h+=(d?"4 ":"3 ")+u[c]+" "+u[c+1]+" "+u[c+2]+(d?" "+f+"\n":"\n")}return new Blob([h])},s.exportBinaryPLY=function(e,t){var r=o(e),n=r.nbVertices,a=r.nbFaces,s=r.nbQuads,u=r.nbTriangles,l=r.vertices,c=r.colors,h=r.faces,f=0,d=0,p=0;if(t)for(f=0;f<n;++f){var v=l[(p=3*f)+1];l[p+1]=-l[p+2],l[p+2]=v}var g="ply\nformat binary_"+(i.default.littleEndian?"little":"big")+"_endian 1.0\ncomment created by SculptGL\n";g+="element vertex "+n+"\n",g+="property float x\nproperty float y\nproperty float z\n",g+="property uchar red\nproperty uchar green\nproperty uchar blue\n",g+="element face "+a+"\n",g+="property list uchar uint vertex_indices\nend_header\n";var m=4*l.length+c.length,_=4*(4*s+3*u)+a,y=g.length+m+2*_,b=new Uint8Array(y),M=new DataView(b.buffer);d=g.length;var T=0;for(T=0;T<d;++T)b[T]=g.charCodeAt(T);for(f=0;f<n;++f)d=3*f,M.setFloat32(T,l[d],!0),T+=4,M.setFloat32(T,l[d+1],!0),T+=4,M.setFloat32(T,l[d+2],!0),T+=4,M.setUint8(T,Math.round(255*c[d])),T+=1,M.setUint8(T,Math.round(255*c[d+1])),T+=1,M.setUint8(T,Math.round(255*c[d+2])),T+=1;for(f=0;f<a;++f){var A=h[(d=4*f)+3]!==i.default.TRI_INDEX;M.setUint8(T,A?4:3),T+=1,M.setUint32(T,h[d],!0),T+=4,M.setUint32(T,h[d+1],!0),T+=4,M.setUint32(T,h[d+2],!0),T+=4,A&&(M.setUint32(T,h[d+3],!0),T+=4)}return new Blob([b])};var u=s;t.default=u},function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=function(){function e(t,r,n,i){switch(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=t,this._multimesh=r,this._mesh=r.getCurrentMesh(),this._type=n,n){case e.DELETE_LOWER:this._deletedMeshes=r._meshes.slice(0,r._sel);break;case e.DELETE_HIGHER:this._deletedMeshes=r._meshes.slice(r._sel+1),i||(this._vMappingState=this._mesh.getVerticesMapping());break;case e.SUBDIVISION:case e.REVERSION:i||(this._vArState=new Float32Array(this._mesh.getVertices()),this._cArState=new Float32Array(this._mesh.getColors()),this._mArState=new Float32Array(this._mesh.getMaterials()))}}return i(e,null,[{key:"SUBDIVISION",get:function(){return 0}},{key:"REVERSION",get:function(){return 1}},{key:"SELECTION",get:function(){return 2}},{key:"DELETE_LOWER",get:function(){return 3}},{key:"DELETE_HIGHER",get:function(){return 4}}]),i(e,[{key:"isNoop",value:function(){return!1}},{key:"undo",value:function(){var t=this._multimesh;switch(this._type){case e.SELECTION:t.selectMesh(this._mesh);break;case e.DELETE_LOWER:Array.prototype.unshift.apply(t._meshes,this._deletedMeshes);break;case e.DELETE_HIGHER:Array.prototype.push.apply(t._meshes,this._deletedMeshes),this._mesh.setVerticesMapping(this._vMappingState);break;case e.SUBDIVISION:case e.REVERSION:var r=this._mesh.getNbVertices();this._mesh.setVertices(new Float32Array(this._vArState)),this._mesh.setColors(new Float32Array(this._cArState)),this._mesh.setMaterials(new Float32Array(this._mArState)),this._mesh.setNbVertices(r),this._type===e.SUBDIVISION?t.popMesh():t.shiftMesh()}t.setSelection(t.findIndexFromMesh(this._mesh)),this._main.setMesh(t)}},{key:"redo",value:function(){var t=this._multimesh;switch(this._type){case e.SELECTION:t.selectMesh(this._mesh);break;case e.DELETE_LOWER:t.deleteLower();break;case e.DELETE_HIGHER:t.deleteHigher();break;case e.SUBDIVISION:t.pushMesh(this._mesh);break;case e.REVERSION:t.unshiftMesh(this._mesh)}t.setSelection(t.findIndexFromMesh(this._mesh)),this._main.setMesh(t)}},{key:"createRedo",value:function(){return new e(this._main,this._multimesh,this._type,!0)}}]),e}();t.default=a},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=r(1),o=n(r(10)),u=n(r(7)),l=n(r(0)),c=n(r(3)),h=[0,0,0],f=[0,0,0],d=[0,0,0],p=s.mat4.create(),v=[0,0,0],g=[0,0,0],m=[0,0,0],_=[0,0,0],y=[0,0,0],b=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._mesh=null,this._main=t,this._pickedFace=-1,this._pickedVertices=[],this._interPoint=[0,0,0],this._rLocal2=0,this._rWorld2=0,this._eyeDir=[0,0,0],this._xSym=!!r,this._pickedNormal=[0,0,0],this._alphaOrigin=[0,0,0],this._alphaSide=0,this._alphaLookAt=s.mat4.create(),this._alpha=null}return a(e,null,[{key:"addAlpha",value:function(t,r,n,i){var a={};a._name=i,a._texture=t,a._ratioX=Math.max(1,r/n),a._ratioY=Math.max(1,n/r),a._ratioMax=Math.max(a._ratioX,a._ratioY),a._width=r,a._height=n;for(var s=1;e.ALPHAS[a._name];)a._name=i+s++;return e.ALPHAS[a._name]=a,e.ALPHAS_NAMES[a._name]=a._name,a}}]),a(e,[{key:"setIdAlpha",value:function(t){this._alpha=e.ALPHAS[t]}},{key:"getAlpha",value:function(e,t,r){var n=this._alpha;if(!n||!n._texture)return 1;var i=this._alphaLookAt,a=this._alphaSide,s=n._ratioY*(i[0]*e+i[4]*t+i[8]*r+i[12])/(this._xSym?-a:a);if(Math.abs(s)>1)return 0;var o=n._ratioX*(i[1]*e+i[5]*t+i[9]*r+i[13])/a;if(Math.abs(o)>1)return 0;var u=n._width;return s=(.5-.5*s)*u,o=(.5-.5*o)*n._height,n._texture[(0|s)+u*(0|o)]/255}},{key:"updateAlpha",value:function(e){var t=m,r=_,n=Math.sqrt(this._rLocal2);if(this._alphaSide=n*Math.SQRT1_2,s.vec3.sub(t,this._interPoint,this._alphaOrigin),0!==s.vec3.len(t)){s.vec3.normalize(t,t);var i=this._pickedNormal;s.vec3.scaleAndAdd(t,t,i,-s.vec3.dot(t,i)),s.vec3.normalize(t,t),e||s.vec3.copy(this._alphaOrigin,this._interPoint),s.vec3.scaleAndAdd(r,this._alphaOrigin,i,n),s.mat4.lookAt(this._alphaLookAt,this._alphaOrigin,r,t)}}},{key:"initAlpha",value:function(){this.computePickedNormal(),this.updateAlpha()}},{key:"getMesh",value:function(){return this._mesh}},{key:"setLocalRadius2",value:function(e){this._rLocal2=e}},{key:"getLocalRadius2",value:function(){return this._rLocal2}},{key:"getLocalRadius",value:function(){return Math.sqrt(this._rLocal2)}},{key:"getWorldRadius2",value:function(){return this._rWorld2}},{key:"getWorldRadius",value:function(){return Math.sqrt(this._rWorld2)}},{key:"setIntersectionPoint",value:function(e){this._interPoint=e}},{key:"getEyeDirection",value:function(){return this._eyeDir}},{key:"getIntersectionPoint",value:function(){return this._interPoint}},{key:"getPickedVertices",value:function(){return this._pickedVertices}},{key:"getPickedFace",value:function(){return this._pickedFace}},{key:"getPickedNormal",value:function(){return this._pickedNormal}},{key:"intersectionMouseMeshes",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._main.getMeshes(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._main._mouseX,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._main._mouseY,n=this.unproject(t,r,0),i=this.unproject(t,r,.1),a=1/0,o=null,u=-1,l=0,c=e.length;l<c;++l){var h=e[l];if(s.mat4.invert(p,h.getMatrix()),s.vec3.transformMat4(f,n,p),s.vec3.transformMat4(d,i,p),this.intersectionRayMesh(h,f,d)){var v=this.getIntersectionPoint(),m=s.vec3.dist(f,v)*h.getScale();m<a&&(a=m,o=h,s.vec3.copy(g,v),u=this.getPickedFace())}}return this._mesh=o,s.vec3.copy(this._interPoint,g),this._pickedFace=u,-1!==u&&this.updateLocalAndWorldRadius2(),!!o}},{key:"intersectionMouseMesh",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._main.getMesh(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._main._mouseX,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._main._mouseY,n=this.unproject(t,r,0),i=this.unproject(t,r,.1),a=s.mat4.create();return s.mat4.invert(a,e.getMatrix()),s.vec3.transformMat4(n,n,a),s.vec3.transformMat4(i,i,a),this.intersectionRayMesh(e,n,i)}},{key:"intersectionRayMesh",value:function(e,t,r){if(this._mesh=null,this._pickedFace=-1,s.vec3.copy(h,t),s.vec3.copy(d,r),this._xSym){var n=e.getSymmetryOrigin(),i=e.getSymmetryNormal();o.default.mirrorPoint(h,n,i),o.default.mirrorPoint(d,n,i)}var a=e.getVertices(),u=e.getFaces(),c=this.getEyeDirection();s.vec3.sub(c,d,h),s.vec3.normalize(c,c);for(var f=e.intersectRay(h,c),p=1/0,g=f.length,b=0;b<g;++b){var M=4*f[b],T=3*u[M],A=3*u[M+1],S=3*u[M+2];m[0]=a[T],m[1]=a[T+1],m[2]=a[T+2],_[0]=a[A],_[1]=a[A+1],_[2]=a[A+2],y[0]=a[S],y[1]=a[S+1],y[2]=a[S+2];var k=o.default.intersectionRayTriangle(h,c,m,_,y,v);k<0&&(A=u[M+3])!==l.default.TRI_INDEX&&(A*=3,_[0]=a[A],_[1]=a[A+1],_[2]=a[A+2],k=o.default.intersectionRayTriangle(h,c,m,y,_,v)),k>=0&&k<p&&(p=k,s.vec3.copy(this._interPoint,v),this._pickedFace=f[b])}return-1!==this._pickedFace?(this._mesh=e,this.updateLocalAndWorldRadius2(),!0):(this._rLocal2=0,!1)}},{key:"pickVerticesInSphere",value:function(e){for(var t=this._mesh,r=t.getVertices(),n=t.getVerticesSculptFlags(),i=this.getIntersectionPoint(),a=t.intersectSphere(i,e,!0),s=t.getVerticesFromFaces(a),o=s.length,u=++l.default.SCULPT_FLAG,c=new Uint32Array(l.default.getMemory(4*o),0,o),h=0,f=i[0],d=i[1],p=i[2],v=0;v<o;++v){var g=s[v],m=3*g,_=f-r[m],y=d-r[m+1],b=p-r[m+2];_*_+y*y+b*b<e&&(n[g]=u,c[h++]=g)}return this._pickedVertices=new Uint32Array(c.subarray(0,h)),this._pickedVertices}},{key:"_isInsideSphere",value:function(e,t,r){if(e===l.default.TRI_INDEX)return!1;var n=3*e;return s.vec3.sqrDist(t,this._mesh.getVertices().subarray(n,n+3))<=r}},{key:"pickVerticesInSphereTopological",value:function(e){var t=this._mesh,r=t.getNbVertices(),n=t.getVertices(),i=t.getFaces(),a=t.getVerticesRingVertStartCount(),s=t.getVerticesRingVert(),o=s instanceof Array?s:null,u=t.getVerticesSculptFlags(),c=t.getVerticesTagFlags(),h=++l.default.SCULPT_FLAG,f=++l.default.TAG_FLAG,d=this.getIntersectionPoint(),p=d[0],v=d[1],g=d[2],m=new Uint32Array(l.default.getMemory(4*r),0,r),_=4*this.getPickedFace(),y=1;this._isInsideSphere(i[_],d,e)?m[0]=i[_]:this._isInsideSphere(i[_+1],d,e)?m[0]=i[_+1]:this._isInsideSphere(i[_+2],d,e)?m[0]=i[_+2]:this._isInsideSphere(i[_+3],d,e)?m[0]=i[_+3]:y=0,1===y&&(u[m[0]]=h,c[m[0]]=f);for(var b=0;b<y;++b){var M,T,A=m[b];o?(M=0,T=(s=o[A]).length):T=(M=a[2*A])+a[2*A+1];for(var S=M;S<T;++S){var k=s[S];if(c[k]!==f){c[k]=f;var w=3*k,E=p-n[w],x=v-n[w+1],R=g-n[w+2];E*E+x*x+R*R>e||(u[k]=h,m[y++]=k)}}}return this._pickedVertices=new Uint32Array(m.subarray(0,y)),this._pickedVertices}},{key:"computeWorldRadius2",value:function(e){s.vec3.transformMat4(v,this.getIntersectionPoint(),this._mesh.getMatrix());var t=this._main.getSculptManager().getCurrentTool().getScreenRadius();e||(t*=u.default.getPressureRadius());var r=this.project(v);return s.vec3.sqrDist(v,this.unproject(r[0]+t,r[1],r[2]))}},{key:"updateLocalAndWorldRadius2",value:function(){this._mesh&&(this._rWorld2=this.computeWorldRadius2(),this._rLocal2=this._rWorld2/this._mesh.getScale2())}},{key:"unproject",value:function(e,t,r){return this._main.getCamera().unproject(e,t,r)}},{key:"project",value:function(e){return this._main.getCamera().project(e)}},{key:"computePickedNormal",value:function(){if(this._mesh&&!(this._pickedFace<0))return this.polyLerp(this._mesh.getNormals(),this._pickedNormal),s.vec3.normalize(this._pickedNormal,this._pickedNormal)}},{key:"polyLerp",value:function(e,t){var r=this._mesh.getVertices(),n=this._mesh.getFaces(),i=4*this._pickedFace,a=3*n[i],o=3*n[i+1],u=3*n[i+2],c=n[i+3],h=c!==l.default.TRI_INDEX;h&&(c*=3);var f=1/s.vec3.dist(this._interPoint,r.subarray(a,a+3)),d=1/s.vec3.dist(this._interPoint,r.subarray(o,o+3)),p=1/s.vec3.dist(this._interPoint,r.subarray(u,u+3)),v=h?1/s.vec3.dist(this._interPoint,r.subarray(c,c+3)):0,g=1/(f+d+p+v);return s.vec3.set(t,0,0,0),s.vec3.scaleAndAdd(t,t,e.subarray(a,a+3),f*g),s.vec3.scaleAndAdd(t,t,e.subarray(o,o+3),d*g),s.vec3.scaleAndAdd(t,t,e.subarray(u,u+3),p*g),h&&s.vec3.scaleAndAdd(t,t,e.subarray(c,c+3),v*g),t}}]),e}();b.INIT_ALPHAS_NAMES=[(0,c.default)("alphaSquare"),(0,c.default)("alphaSkin")],b.INIT_ALPHAS_PATHS=["square.jpg","skin.jpg"];var M=(0,c.default)("alphaNone");b.ALPHAS_NAMES={},b.ALPHAS_NAMES[M]=M,b.ALPHAS={},b.ALPHAS[M]=null;var T=b;t.default=T},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(0)),s=n(r(119)),o=n(r(120)),u=n(r(121)),l=n(r(122)),c=n(r(33)),h=n(r(123)),f=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=t,this._undos=[],this._redos=[],this._curUndoIndex=-1}return function(e,t,r){t&&i(e.prototype,t),r&&i(e,r)}(e,[{key:"pushStateCustom",value:function(e,t,r){var n=new h.default(e,t);n.squash=r,this.pushState(n)}},{key:"pushStateAddRemove",value:function(e,t,r){var n=new s.default(this._main,e,t);n.squash=r,this.pushState(n)}},{key:"pushStateRemove",value:function(e){this.pushState(new s.default(this._main,[],e))}},{key:"pushStateAdd",value:function(e){this.pushState(new s.default(this._main,e,[]))}},{key:"pushStateColorAndMaterial",value:function(e){e.isDynamic?this.pushState(new l.default(this._main,e)):this.pushState(new o.default(this._main,e))}},{key:"pushStateGeometry",value:function(e){e.isDynamic?this.pushState(new l.default(this._main,e)):this.pushState(new u.default(this._main,e))}},{key:"pushStateMultiresolution",value:function(e,t){this.pushState(new c.default(this._main,e,t))}},{key:"setNewMaxStack",value:function(t){e.STACK_LENGTH=t;for(var r=this._undos,n=this._redos;this._curUndoIndex>=t;)r.shift(),--this._curUndoIndex;for(;r.length>t;)r.pop(),n.shift()}},{key:"pushState",value:function(t){++a.default.STATE_FLAG;var r=this._undos;-1===this._curUndoIndex?r.length=0:r.length>=e.STACK_LENGTH&&(r.shift(),--this._curUndoIndex),this._redos.length=0,++this._curUndoIndex,r.length>0&&(r.length=this._curUndoIndex),r.push(t)}},{key:"getCurrentState",value:function(){return this._undos[this._curUndoIndex]}},{key:"pushVertices",value:function(e){e&&e.length>0&&this.getCurrentState().pushVertices(e)}},{key:"pushFaces",value:function(e){e&&e.length>0&&this.getCurrentState().pushFaces(e)}},{key:"undo",value:function(){if(this._undos.length&&!(this._curUndoIndex<0)){var e=this.getCurrentState(),t=e.createRedo();t.squash=e.squash,this._redos.push(t),e.undo(),this._curUndoIndex--,!0===e.squash&&this.undo()}}},{key:"redo",value:function(){if(this._redos.length){var e=this._redos[this._redos.length-1];e.redo(),this._curUndoIndex++,this._redos.pop(),!0===e.squash&&this.redo()}}},{key:"reset",value:function(){this._undos.length=0,this._redos.length=0,this._curUndoIndex=-1}},{key:"cleanNoop",value:function(){for(;this._curUndoIndex>=0&&this.getCurrentState().isNoop();)this._undos.length--,this._curUndoIndex--,this._redos.length=0}}]),e}();f.STACK_LENGTH=15;var d=f;t.default=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={};n._gl=null,n._checkRTT={},n._webGLExtensions={},n.HALF_FLOAT=n.HALF_FLOAT_OES=36193,n.checkRTTSupport=function(e,t){var r=n._gl;if(void 0===r)return!1;var i=e+","+t;if(void 0!==n._checkRTT[i])return n._checkRTT[i];var a=r.createTexture();r.bindTexture(r.TEXTURE_2D,a),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,2,2,0,r.RGBA,e,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,t);var s=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,s),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,a,0);var o=n._checkRTT[i]=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.deleteTexture(a),r.deleteFramebuffer(s),r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),o},n.hasRTTLinearHalfFloat=function(){return n._webGLExtensions.OES_texture_half_float_linear&&n.checkRTTSupport(n.HALF_FLOAT,n._gl.LINEAR)},n.hasRTTLinearFloat=function(){return n._webGLExtensions.OES_texture_float_linear&&n.checkRTTSupport(n._gl.FLOAT,n._gl.LINEAR)},n.hasRTTHalfFloat=function(){return n._webGLExtensions.OES_texture_half_float&&n.checkRTTSupport(n.HALF_FLOAT,n._gl.NEAREST)},n.hasRTTFloat=function(){return n._webGLExtensions.OES_texture_float&&n.checkRTTSupport(n._gl.FLOAT,n._gl.NEAREST)},n.getWebGLExtension=function(e){return n._webGLExtensions[e]},n.getWebGLExtensions=function(){return n._webGLExtensions},n.initWebGLExtensions=function(e){n._gl=e;for(var t=e.getSupportedExtensions(),r=n._webGLExtensions,i=0,a=t.length;i<a;++i){var s=t[i];r[s]=e.getExtension(s)}};var i=n;t.default=i},function(e,t,r){"use strict";var n=function(e){return e&&e.__esModule?e:{default:e}}(r(38));window.SculptGL=n.default},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,r(39);var s=r(1),o=r(45),u=n(r(7)),l=n(r(2)),c=n(r(0)),h=n(r(46)),f=n(r(21)),d=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e=function(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),e._mouseX=0,e._mouseY=0,e._lastMouseX=0,e._lastMouseY=0,e._lastScale=0,e._action=l.default.Action.NOTHING,e._lastNbPointers=0,e._isWheelingIn=!1,e._maskX=0,e._maskY=0,e._hammer=new o.Manager(e._canvas),e._eventProxy={},e.initHammer(),e.addEvents(),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,h.default),function(e,t,r){t&&a(e.prototype,t),r&&a(e,r)}(t,[{key:"addEvents",value:function(){var e=this._canvas,t=this.onMouseWheel.bind(this),r=this.onPointer.bind(this);e.addEventListener("pointerdown",r,!1),e.addEventListener("pointermove",r,!1),e.addEventListener("mousedown",this.onMouseDown.bind(this),!1),e.addEventListener("mouseup",this.onMouseUp.bind(this),!1),e.addEventListener("mouseout",this.onMouseOut.bind(this),!1),e.addEventListener("mouseover",this.onMouseOver.bind(this),!1),e.addEventListener("mousemove",c.default.throttle(this.onMouseMove.bind(this),16.66),!1),e.addEventListener("mousewheel",t,!1),e.addEventListener("DOMMouseScroll",t,!1),window.addEventListener("keydown",this.onKeyDown.bind(this),!1),window.addEventListener("keyup",this.onKeyUp.bind(this),!1);var n=this.loadFiles.bind(this),i=this.stopAndPrevent.bind(this);e.addEventListener("webglcontextlost",this.onContextLost.bind(this),!1),e.addEventListener("webglcontextrestored",this.onContextRestored.bind(this),!1),window.addEventListener("dragenter",i,!1),window.addEventListener("dragover",i,!1),window.addEventListener("drop",n,!1),document.getElementById("fileopen").addEventListener("change",n,!1)}},{key:"onPointer",value:function(e){u.default.pressure=e.pressure}},{key:"initHammer",value:function(){this._hammer.options.enable=!0,this._initHammerRecognizers(),this._initHammerEvents()}},{key:"_initHammerRecognizers",value:function(){var e=this._hammer;e.add(new o.Tap({event:"doubletap",pointers:1,taps:2,time:250,interval:450,threshold:5,posThreshold:50})),e.add(new o.Tap({event:"doubletap2fingers",pointers:2,taps:2,time:250,interval:450,threshold:5,posThreshold:50})),e.add(new o.Pan({event:"pan",pointers:0,threshold:0})),e.add(new o.Pinch({event:"pinch",pointers:2,threshold:.1})),e.get("pinch").recognizeWith(e.get("pan"))}},{key:"_initHammerEvents",value:function(){var e=this._hammer;e.on("panstart",this.onPanStart.bind(this)),e.on("panmove",this.onPanMove.bind(this)),e.on("panend pancancel",this.onPanEnd.bind(this)),e.on("doubletap",this.onDoubleTap.bind(this)),e.on("doubletap2fingers",this.onDoubleTap2Fingers.bind(this)),e.on("pinchstart",this.onPinchStart.bind(this)),e.on("pinchin pinchout",this.onPinchInOut.bind(this))}},{key:"stopAndPrevent",value:function(e){e.stopPropagation(),e.preventDefault()}},{key:"onContextLost",value:function(){window.alert("Oops... WebGL context lost.")}},{key:"onContextRestored",value:function(){window.alert("Wow... Context is restored.")}},{key:"onKeyDown",value:function(e){this._gui.callFunc("onKeyDown",e)}},{key:"onKeyUp",value:function(e){this._gui.callFunc("onKeyUp",e)}},{key:"onPanStart",value:function(e){if("mouse"!==e.pointerType){this._focusGui=!1;var t=this._eventProxy;t.pageX=e.center.x,t.pageY=e.center.y,this._lastNbPointers=t.which=Math.min(2,e.pointers.length),this.onDeviceDown(t)}}},{key:"onPanMove",value:function(e){if("mouse"!==e.pointerType){var t=this._eventProxy;t.pageX=e.center.x,t.pageY=e.center.y;var r=Math.min(2,e.pointers.length);r!==this._lastNbPointers&&(this.onDeviceUp(),t.which=r,this.onDeviceDown(t),this._lastNbPointers=r),this.onDeviceMove(t)}}},{key:"onPanEnd",value:function(e){"mouse"!==e.pointerType&&this.onDeviceUp()}},{key:"onDoubleTap",value:function(e){if(!this._focusGui){var t=this._eventProxy;t.pageX=e.center.x,t.pageY=e.center.y,this.setMousePosition(t);var r=this._picking,n=r.intersectionMouseMeshes(),i=this._camera,a=[0,0,0];if(!n)return this.resetCameraMeshes();s.vec3.transformMat4(a,r.getIntersectionPoint(),r.getMesh().getMatrix());var o=i._trans[2];i.isOrthographic()||(o=Math.min(o,s.vec3.dist(a,i.computePosition()))),i.setAndFocusOnPivot(a,o),this.render()}}},{key:"onDoubleTap2Fingers",value:function(){this._focusGui||this.resetCameraMeshes()}},{key:"onPinchStart",value:function(e){this._focusGui=!1,this._lastScale=e.scale}},{key:"onPinchInOut",value:function(e){var t=25*(e.scale-this._lastScale);this._lastScale=e.scale,this.onDeviceWheel(t)}},{key:"resetCameraMeshes",value:function(e){if(e||(e=this._meshes),e.length>0){var t=[0,0,0],r=this.computeBoundingBoxMeshes(e),n=.4*s.vec3.dist([r[0],r[1],r[2]],[r[3],r[4],r[5]]);n*=this._camera.computeFrustumFit(),s.vec3.set(t,.5*(r[0]+r[3]),.5*(r[1]+r[4]),.5*(r[2]+r[5])),this._camera.setAndFocusOnPivot(t,n)}else this._camera.resetView();this.render()}},{key:"getFileType",value:function(e){var t=e.toLowerCase();return t.endsWith(".obj")?"obj":t.endsWith(".sgl")?"sgl":t.endsWith(".stl")?"stl":t.endsWith(".ply")?"ply":void 0}},{key:"loadFiles",value:function(e){e.stopPropagation(),e.preventDefault();for(var t=e.dataTransfer?e.dataTransfer.files:e.target.files,r=0,n=t.length;r<n;++r){var i=t[r],a=this.getFileType(i.name);this.readFile(i,a)}}},{key:"readFile",value:function(e,t){var r=t||this.getFileType(e.name);if(r){var n=new FileReader,i=this;n.onload=function(e){i.loadScene(e.target.result,r),document.getElementById("fileopen").value=""},"obj"===r?n.readAsText(e):n.readAsArrayBuffer(e)}}},{key:"onMouseDown",value:function(e){e.stopPropagation(),e.preventDefault(),this._gui.callFunc("onMouseDown",e),this.onDeviceDown(e)}},{key:"onMouseMove",value:function(e){e.stopPropagation(),e.preventDefault(),this._gui.callFunc("onMouseMove",e),this.onDeviceMove(e)}},{key:"onMouseOver",value:function(e){this._focusGui=!1,this._gui.callFunc("onMouseOver",e)}},{key:"onMouseOut",value:function(e){this._focusGui=!0,this._gui.callFunc("onMouseOut",e),this.onMouseUp(e)}},{key:"onMouseUp",value:function(e){e.preventDefault(),this._gui.callFunc("onMouseUp",e),this.onDeviceUp()}},{key:"onMouseWheel",value:function(e){e.stopPropagation(),e.preventDefault(),this._gui.callFunc("onMouseWheel",e);var t=void 0===e.wheelDelta?-e.detail:e.wheelDelta;this.onDeviceWheel(t>0?1:-1)}},{key:"onDeviceUp",value:function(){this.setCanvasCursor("default"),f.default.RENDER_HINT=f.default.NONE,this._sculptManager.end(),this._action===l.default.Action.MASK_EDIT&&this._mesh&&(this._lastMouseX===this._maskX&&this._lastMouseY===this._maskY?this.getSculptManager().getTool(l.default.Tools.MASKING).invert():this.getSculptManager().getTool(l.default.Tools.MASKING).clear()),this._action=l.default.Action.NOTHING,this.render(),this._stateManager.cleanNoop()}},{key:"onDeviceWheel",value:function(e){e>0&&!this._isWheelingIn&&(this._isWheelingIn=!0,this._camera.start(this._mouseX,this._mouseY)),this._camera.zoom(.02*e),f.default.RENDER_HINT=f.default.CAMERA,this.render(),this._timerEndWheel&&window.clearTimeout(this._timerEndWheel),this._timerEndWheel=window.setTimeout(this._endWheel.bind(this),300)}},{key:"_endWheel",value:function(){f.default.RENDER_HINT=f.default.NONE,this._isWheelingIn=!1,this.render()}},{key:"setMousePosition",value:function(e){this._mouseX=this._pixelRatio*(e.pageX-this._canvasOffsetLeft),this._mouseY=this._pixelRatio*(e.pageY-this._canvasOffsetTop)}},{key:"onDeviceDown",value:function(e){if(!this._focusGui){this.setMousePosition(e);var t=this._mouseX,r=this._mouseY,n=e.which,i=!1;1===n&&(i=this._sculptManager.start(e.shiftKey)),1===n&&i&&this.setCanvasCursor("none"),3===n&&e.ctrlKey?this._action=l.default.Action.CAMERA_ZOOM:2===n?this._action=l.default.Action.CAMERA_PAN:!i&&e.ctrlKey?(this._maskX=t,this._maskY=r,this._action=l.default.Action.MASK_EDIT):i&&3!==n||!e.altKey?this._action=3===n||1===n&&!i?l.default.Action.CAMERA_ROTATE:l.default.Action.SCULPT_EDIT:this._action=l.default.Action.CAMERA_PAN_ZOOM_ALT,this._action!==l.default.Action.CAMERA_ROTATE&&this._action!==l.default.Action.CAMERA_ZOOM||this._camera.start(t,r),this._lastMouseX=t,this._lastMouseY=r}}},{key:"onDeviceMove",value:function(e){if(!this._focusGui){this.setMousePosition(e);var t=this._mouseX,r=this._mouseY,n=this._action;n===l.default.Action.CAMERA_ZOOM||n===l.default.Action.CAMERA_PAN_ZOOM_ALT&&!e.altKey?(f.default.RENDER_HINT=f.default.CAMERA,this._camera.zoom((t-this._lastMouseX+r-this._lastMouseY)/1e3),this.render()):n===l.default.Action.CAMERA_PAN_ZOOM_ALT||n===l.default.Action.CAMERA_PAN?(f.default.RENDER_HINT=f.default.CAMERA,this._camera.translate((t-this._lastMouseX)/1e3,(r-this._lastMouseY)/1e3),this.render()):n===l.default.Action.CAMERA_ROTATE?(f.default.RENDER_HINT=f.default.CAMERA,e.shiftKey||this._camera.rotate(t,r),this.render()):(f.default.RENDER_HINT=f.default.PICKING,this._sculptManager.preUpdate(),n===l.default.Action.SCULPT_EDIT&&(f.default.RENDER_HINT=f.default.SCULPT,this._sculptManager.update(this),this.getMesh().isDynamic&&this._gui.updateMeshInfo())),this._lastMouseX=t,this._lastMouseY=r,this.renderSelectOverRtt()}}}]),t}();t.default=d},function(e,t){if(window.Map||(window.Map=function(){this.map={}},window.Map.prototype={set:function(e,t){this.map[e]=t},get:function(e){return this.map[e]}}),!Float32Array.prototype.slice){var r=function(e,t){return new this.constructor(this.subarray(e,t))};Int8Array.prototype.slice=r,Uint8Array.prototype.slice=r,Uint8ClampedArray.prototype.slice=r,Int16Array.prototype.slice=r,Uint16Array.prototype.slice=r,Int32Array.prototype.slice=r,Uint32Array.prototype.slice=r,Float32Array.prototype.slice=r,Float64Array.prototype.slice=r}String.prototype.endsWith||(String.prototype.endsWith=function(e){return this.slice(-e.length)===e}),String.prototype.startsWith||(String.prototype.startsWith=function(e){return this.slice(0,e.length)===e});for(var n=["moz","webkit"],i=0;i<n.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[n[i]+"RequestAnimationFrame"];window.requestAnimationFrame||window.alert("browser is too old. Probably no webgl there anyway")},function(e,t,r){"use strict";function n(e,t,r){let n=t[0],i=t[1],a=t[2],s=t[3],o=r[0],u=r[1],l=r[2],c=r[3];return e[0]=n*o+a*u,e[1]=i*o+s*u,e[2]=n*l+a*c,e[3]=i*l+s*c,e}function i(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}Object.defineProperty(t,"__esModule",{value:!0}),t.create=function(){let e=new a.ARRAY_TYPE(4);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},t.clone=function(e){let t=new a.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},t.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},t.fromValues=function(e,t,r,n){let i=new a.ARRAY_TYPE(4);return i[0]=e,i[1]=t,i[2]=r,i[3]=n,i},t.set=function(e,t,r,n,i){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e},t.transpose=function(e,t){if(e===t){let r=t[1];e[1]=t[2],e[2]=r}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},t.invert=function(e,t){let r=t[0],n=t[1],i=t[2],a=t[3],s=r*a-i*n;return s?(s=1/s,e[0]=a*s,e[1]=-n*s,e[2]=-i*s,e[3]=r*s,e):null},t.adjoint=function(e,t){let r=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=r,e},t.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},t.multiply=n,t.rotate=function(e,t,r){let n=t[0],i=t[1],a=t[2],s=t[3],o=Math.sin(r),u=Math.cos(r);return e[0]=n*u+a*o,e[1]=i*u+s*o,e[2]=n*-o+a*u,e[3]=i*-o+s*u,e},t.scale=function(e,t,r){let n=t[0],i=t[1],a=t[2],s=t[3],o=r[0],u=r[1];return e[0]=n*o,e[1]=i*o,e[2]=a*u,e[3]=s*u,e},t.fromRotation=function(e,t){let r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=-r,e[3]=n,e},t.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},t.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},t.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2))},t.LDU=function(e,t,r,n){return e[2]=n[2]/n[0],r[0]=n[0],r[1]=n[1],r[3]=n[3]-e[2]*r[1],[e,t,r]},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},t.subtract=i,t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},t.equals=function(e,t){let r=e[0],n=e[1],i=e[2],s=e[3],o=t[0],u=t[1],l=t[2],c=t[3];return Math.abs(r-o)<=a.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-u)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(i-l)<=a.EPSILON*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(s-c)<=a.EPSILON*Math.max(1,Math.abs(s),Math.abs(c))},t.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},t.multiplyScalarAndAdd=function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e};var a=r(8);const s=n;t.mul=s;const o=i;t.sub=o},function(e,t,r){"use strict";function n(e,t,r){let n=t[0],i=t[1],a=t[2],s=t[3],o=t[4],u=t[5],l=r[0],c=r[1],h=r[2],f=r[3],d=r[4],p=r[5];return e[0]=n*l+a*c,e[1]=i*l+s*c,e[2]=n*h+a*f,e[3]=i*h+s*f,e[4]=n*d+a*p+o,e[5]=i*d+s*p+u,e}function i(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e}Object.defineProperty(t,"__esModule",{value:!0}),t.create=function(){let e=new a.ARRAY_TYPE(6);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},t.clone=function(e){let t=new a.ARRAY_TYPE(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},t.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},t.fromValues=function(e,t,r,n,i,s){let o=new a.ARRAY_TYPE(6);return o[0]=e,o[1]=t,o[2]=r,o[3]=n,o[4]=i,o[5]=s,o},t.set=function(e,t,r,n,i,a,s){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=a,e[5]=s,e},t.invert=function(e,t){let r=t[0],n=t[1],i=t[2],a=t[3],s=t[4],o=t[5],u=r*a-n*i;return u?(u=1/u,e[0]=a*u,e[1]=-n*u,e[2]=-i*u,e[3]=r*u,e[4]=(i*o-a*s)*u,e[5]=(n*s-r*o)*u,e):null},t.determinant=function(e){return e[0]*e[3]-e[1]*e[2]},t.multiply=n,t.rotate=function(e,t,r){let n=t[0],i=t[1],a=t[2],s=t[3],o=t[4],u=t[5],l=Math.sin(r),c=Math.cos(r);return e[0]=n*c+a*l,e[1]=i*c+s*l,e[2]=n*-l+a*c,e[3]=i*-l+s*c,e[4]=o,e[5]=u,e},t.scale=function(e,t,r){let n=t[0],i=t[1],a=t[2],s=t[3],o=t[4],u=t[5],l=r[0],c=r[1];return e[0]=n*l,e[1]=i*l,e[2]=a*c,e[3]=s*c,e[4]=o,e[5]=u,e},t.translate=function(e,t,r){let n=t[0],i=t[1],a=t[2],s=t[3],o=t[4],u=t[5],l=r[0],c=r[1];return e[0]=n,e[1]=i,e[2]=a,e[3]=s,e[4]=n*l+a*c+o,e[5]=i*l+s*c+u,e},t.fromRotation=function(e,t){let r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=-r,e[3]=n,e[4]=0,e[5]=0,e},t.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e},t.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},t.str=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},t.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+1)},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e},t.subtract=i,t.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e},t.multiplyScalarAndAdd=function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},t.equals=function(e,t){let r=e[0],n=e[1],i=e[2],s=e[3],o=e[4],u=e[5],l=t[0],c=t[1],h=t[2],f=t[3],d=t[4],p=t[5];return Math.abs(r-l)<=a.EPSILON*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(n-c)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(i-h)<=a.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(s-f)<=a.EPSILON*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(o-d)<=a.EPSILON*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(u-p)<=a.EPSILON*Math.max(1,Math.abs(u),Math.abs(p))};var a=r(8);const s=n;t.mul=s;const o=i;t.sub=o},function(e,t,r){"use strict";function n(e,t,r){let n=t[0],i=t[1],a=t[2],s=t[3],o=t[4],u=t[5],l=t[6],c=t[7],h=t[8],f=t[9],d=t[10],p=t[11],v=t[12],g=t[13],m=t[14],_=t[15],y=r[0],b=r[1],M=r[2],T=r[3];return e[0]=y*n+b*o+M*h+T*v,e[1]=y*i+b*u+M*f+T*g,e[2]=y*a+b*l+M*d+T*m,e[3]=y*s+b*c+M*p+T*_,y=r[4],b=r[5],M=r[6],T=r[7],e[4]=y*n+b*o+M*h+T*v,e[5]=y*i+b*u+M*f+T*g,e[6]=y*a+b*l+M*d+T*m,e[7]=y*s+b*c+M*p+T*_,y=r[8],b=r[9],M=r[10],T=r[11],e[8]=y*n+b*o+M*h+T*v,e[9]=y*i+b*u+M*f+T*g,e[10]=y*a+b*l+M*d+T*m,e[11]=y*s+b*c+M*p+T*_,y=r[12],b=r[13],M=r[14],T=r[15],e[12]=y*n+b*o+M*h+T*v,e[13]=y*i+b*u+M*f+T*g,e[14]=y*a+b*l+M*d+T*m,e[15]=y*s+b*c+M*p+T*_,e}function i(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}Object.defineProperty(t,"__esModule",{value:!0}),t.create=function(){let e=new a.ARRAY_TYPE(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.clone=function(e){let t=new a.ARRAY_TYPE(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.fromValues=function(e,t,r,n,i,s,o,u,l,c,h,f,d,p,v,g){let m=new a.ARRAY_TYPE(16);return m[0]=e,m[1]=t,m[2]=r,m[3]=n,m[4]=i,m[5]=s,m[6]=o,m[7]=u,m[8]=l,m[9]=c,m[10]=h,m[11]=f,m[12]=d,m[13]=p,m[14]=v,m[15]=g,m},t.set=function(e,t,r,n,i,a,s,o,u,l,c,h,f,d,p,v,g){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=a,e[5]=s,e[6]=o,e[7]=u,e[8]=l,e[9]=c,e[10]=h,e[11]=f,e[12]=d,e[13]=p,e[14]=v,e[15]=g,e},t.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.transpose=function(e,t){if(e===t){let r=t[1],n=t[2],i=t[3],a=t[6],s=t[7],o=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=a,e[11]=t[14],e[12]=i,e[13]=s,e[14]=o}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},t.invert=function(e,t){let r=t[0],n=t[1],i=t[2],a=t[3],s=t[4],o=t[5],u=t[6],l=t[7],c=t[8],h=t[9],f=t[10],d=t[11],p=t[12],v=t[13],g=t[14],m=t[15],_=r*o-n*s,y=r*u-i*s,b=r*l-a*s,M=n*u-i*o,T=n*l-a*o,A=i*l-a*u,S=c*v-h*p,k=c*g-f*p,w=c*m-d*p,E=h*g-f*v,x=h*m-d*v,R=f*m-d*g,C=_*R-y*x+b*E+M*w-T*k+A*S;return C?(C=1/C,e[0]=(o*R-u*x+l*E)*C,e[1]=(i*x-n*R-a*E)*C,e[2]=(v*A-g*T+m*M)*C,e[3]=(f*T-h*A-d*M)*C,e[4]=(u*w-s*R-l*k)*C,e[5]=(r*R-i*w+a*k)*C,e[6]=(g*b-p*A-m*y)*C,e[7]=(c*A-f*b+d*y)*C,e[8]=(s*x-o*w+l*S)*C,e[9]=(n*w-r*x-a*S)*C,e[10]=(p*T-v*b+m*_)*C,e[11]=(h*b-c*T-d*_)*C,e[12]=(o*k-s*E-u*S)*C,e[13]=(r*E-n*k+i*S)*C,e[14]=(v*y-p*M-g*_)*C,e[15]=(c*M-h*y+f*_)*C,e):null},t.adjoint=function(e,t){let r=t[0],n=t[1],i=t[2],a=t[3],s=t[4],o=t[5],u=t[6],l=t[7],c=t[8],h=t[9],f=t[10],d=t[11],p=t[12],v=t[13],g=t[14],m=t[15];return e[0]=o*(f*m-d*g)-h*(u*m-l*g)+v*(u*d-l*f),e[1]=-(n*(f*m-d*g)-h*(i*m-a*g)+v*(i*d-a*f)),e[2]=n*(u*m-l*g)-o*(i*m-a*g)+v*(i*l-a*u),e[3]=-(n*(u*d-l*f)-o*(i*d-a*f)+h*(i*l-a*u)),e[4]=-(s*(f*m-d*g)-c*(u*m-l*g)+p*(u*d-l*f)),e[5]=r*(f*m-d*g)-c*(i*m-a*g)+p*(i*d-a*f),e[6]=-(r*(u*m-l*g)-s*(i*m-a*g)+p*(i*l-a*u)),e[7]=r*(u*d-l*f)-s*(i*d-a*f)+c*(i*l-a*u),e[8]=s*(h*m-d*v)-c*(o*m-l*v)+p*(o*d-l*h),e[9]=-(r*(h*m-d*v)-c*(n*m-a*v)+p*(n*d-a*h)),e[10]=r*(o*m-l*v)-s*(n*m-a*v)+p*(n*l-a*o),e[11]=-(r*(o*d-l*h)-s*(n*d-a*h)+c*(n*l-a*o)),e[12]=-(s*(h*g-f*v)-c*(o*g-u*v)+p*(o*f-u*h)),e[13]=r*(h*g-f*v)-c*(n*g-i*v)+p*(n*f-i*h),e[14]=-(r*(o*g-u*v)-s*(n*g-i*v)+p*(n*u-i*o)),e[15]=r*(o*f-u*h)-s*(n*f-i*h)+c*(n*u-i*o),e},t.determinant=function(e){let t=e[0],r=e[1],n=e[2],i=e[3],a=e[4],s=e[5],o=e[6],u=e[7],l=e[8],c=e[9],h=e[10],f=e[11],d=e[12],p=e[13],v=e[14],g=e[15];return(t*s-r*a)*(h*g-f*v)-(t*o-n*a)*(c*g-f*p)+(t*u-i*a)*(c*v-h*p)+(r*o-n*s)*(l*g-f*d)-(r*u-i*s)*(l*v-h*d)+(n*u-i*o)*(l*p-c*d)},t.multiply=n,t.translate=function(e,t,r){let n,i,a,s,o,u,l,c,h,f,d,p,v=r[0],g=r[1],m=r[2];return t===e?(e[12]=t[0]*v+t[4]*g+t[8]*m+t[12],e[13]=t[1]*v+t[5]*g+t[9]*m+t[13],e[14]=t[2]*v+t[6]*g+t[10]*m+t[14],e[15]=t[3]*v+t[7]*g+t[11]*m+t[15]):(n=t[0],i=t[1],a=t[2],s=t[3],o=t[4],u=t[5],l=t[6],c=t[7],h=t[8],f=t[9],d=t[10],p=t[11],e[0]=n,e[1]=i,e[2]=a,e[3]=s,e[4]=o,e[5]=u,e[6]=l,e[7]=c,e[8]=h,e[9]=f,e[10]=d,e[11]=p,e[12]=n*v+o*g+h*m+t[12],e[13]=i*v+u*g+f*m+t[13],e[14]=a*v+l*g+d*m+t[14],e[15]=s*v+c*g+p*m+t[15]),e},t.scale=function(e,t,r){let n=r[0],i=r[1],a=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.rotate=function(e,t,r,n){let i,s,o,u,l,c,h,f,d,p,v,g,m,_,y,b,M,T,A,S,k,w,E,x,R=n[0],C=n[1],P=n[2],F=Math.sqrt(R*R+C*C+P*P);return Math.abs(F)<a.EPSILON?null:(F=1/F,R*=F,C*=F,P*=F,i=Math.sin(r),s=Math.cos(r),o=1-s,u=t[0],l=t[1],c=t[2],h=t[3],f=t[4],d=t[5],p=t[6],v=t[7],g=t[8],m=t[9],_=t[10],y=t[11],b=R*R*o+s,M=C*R*o+P*i,T=P*R*o-C*i,A=R*C*o-P*i,S=C*C*o+s,k=P*C*o+R*i,w=R*P*o+C*i,E=C*P*o-R*i,x=P*P*o+s,e[0]=u*b+f*M+g*T,e[1]=l*b+d*M+m*T,e[2]=c*b+p*M+_*T,e[3]=h*b+v*M+y*T,e[4]=u*A+f*S+g*k,e[5]=l*A+d*S+m*k,e[6]=c*A+p*S+_*k,e[7]=h*A+v*S+y*k,e[8]=u*w+f*E+g*x,e[9]=l*w+d*E+m*x,e[10]=c*w+p*E+_*x,e[11]=h*w+v*E+y*x,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},t.rotateX=function(e,t,r){let n=Math.sin(r),i=Math.cos(r),a=t[4],s=t[5],o=t[6],u=t[7],l=t[8],c=t[9],h=t[10],f=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*i+l*n,e[5]=s*i+c*n,e[6]=o*i+h*n,e[7]=u*i+f*n,e[8]=l*i-a*n,e[9]=c*i-s*n,e[10]=h*i-o*n,e[11]=f*i-u*n,e},t.rotateY=function(e,t,r){let n=Math.sin(r),i=Math.cos(r),a=t[0],s=t[1],o=t[2],u=t[3],l=t[8],c=t[9],h=t[10],f=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*i-l*n,e[1]=s*i-c*n,e[2]=o*i-h*n,e[3]=u*i-f*n,e[8]=a*n+l*i,e[9]=s*n+c*i,e[10]=o*n+h*i,e[11]=u*n+f*i,e},t.rotateZ=function(e,t,r){let n=Math.sin(r),i=Math.cos(r),a=t[0],s=t[1],o=t[2],u=t[3],l=t[4],c=t[5],h=t[6],f=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*i+l*n,e[1]=s*i+c*n,e[2]=o*i+h*n,e[3]=u*i+f*n,e[4]=l*i-a*n,e[5]=c*i-s*n,e[6]=h*i-o*n,e[7]=f*i-u*n,e},t.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},t.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.fromRotation=function(e,t,r){let n,i,s,o=r[0],u=r[1],l=r[2],c=Math.sqrt(o*o+u*u+l*l);return Math.abs(c)<a.EPSILON?null:(c=1/c,o*=c,u*=c,l*=c,n=Math.sin(t),i=Math.cos(t),s=1-i,e[0]=o*o*s+i,e[1]=u*o*s+l*n,e[2]=l*o*s-u*n,e[3]=0,e[4]=o*u*s-l*n,e[5]=u*u*s+i,e[6]=l*u*s+o*n,e[7]=0,e[8]=o*l*s+u*n,e[9]=u*l*s-o*n,e[10]=l*l*s+i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},t.fromXRotation=function(e,t){let r=Math.sin(t),n=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.fromYRotation=function(e,t){let r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.fromZRotation=function(e,t){let r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.fromRotationTranslation=function(e,t,r){let n=t[0],i=t[1],a=t[2],s=t[3],o=n+n,u=i+i,l=a+a,c=n*o,h=n*u,f=n*l,d=i*u,p=i*l,v=a*l,g=s*o,m=s*u,_=s*l;return e[0]=1-(d+v),e[1]=h+_,e[2]=f-m,e[3]=0,e[4]=h-_,e[5]=1-(c+v),e[6]=p+g,e[7]=0,e[8]=f+m,e[9]=p-g,e[10]=1-(c+d),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e},t.getTranslation=function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},t.getScaling=function(e,t){let r=t[0],n=t[1],i=t[2],a=t[4],s=t[5],o=t[6],u=t[8],l=t[9],c=t[10];return e[0]=Math.sqrt(r*r+n*n+i*i),e[1]=Math.sqrt(a*a+s*s+o*o),e[2]=Math.sqrt(u*u+l*l+c*c),e},t.getRotation=function(e,t){let r=t[0]+t[5]+t[10],n=0;return r>0?(n=2*Math.sqrt(r+1),e[3]=.25*n,e[0]=(t[6]-t[9])/n,e[1]=(t[8]-t[2])/n,e[2]=(t[1]-t[4])/n):t[0]>t[5]&t[0]>t[10]?(n=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/n,e[0]=.25*n,e[1]=(t[1]+t[4])/n,e[2]=(t[8]+t[2])/n):t[5]>t[10]?(n=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/n,e[0]=(t[1]+t[4])/n,e[1]=.25*n,e[2]=(t[6]+t[9])/n):(n=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/n,e[0]=(t[8]+t[2])/n,e[1]=(t[6]+t[9])/n,e[2]=.25*n),e},t.fromRotationTranslationScale=function(e,t,r,n){let i=t[0],a=t[1],s=t[2],o=t[3],u=i+i,l=a+a,c=s+s,h=i*u,f=i*l,d=i*c,p=a*l,v=a*c,g=s*c,m=o*u,_=o*l,y=o*c,b=n[0],M=n[1],T=n[2];return e[0]=(1-(p+g))*b,e[1]=(f+y)*b,e[2]=(d-_)*b,e[3]=0,e[4]=(f-y)*M,e[5]=(1-(h+g))*M,e[6]=(v+m)*M,e[7]=0,e[8]=(d+_)*T,e[9]=(v-m)*T,e[10]=(1-(h+p))*T,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e},t.fromRotationTranslationScaleOrigin=function(e,t,r,n,i){let a=t[0],s=t[1],o=t[2],u=t[3],l=a+a,c=s+s,h=o+o,f=a*l,d=a*c,p=a*h,v=s*c,g=s*h,m=o*h,_=u*l,y=u*c,b=u*h,M=n[0],T=n[1],A=n[2],S=i[0],k=i[1],w=i[2];return e[0]=(1-(v+m))*M,e[1]=(d+b)*M,e[2]=(p-y)*M,e[3]=0,e[4]=(d-b)*T,e[5]=(1-(f+m))*T,e[6]=(g+_)*T,e[7]=0,e[8]=(p+y)*A,e[9]=(g-_)*A,e[10]=(1-(f+v))*A,e[11]=0,e[12]=r[0]+S-(e[0]*S+e[4]*k+e[8]*w),e[13]=r[1]+k-(e[1]*S+e[5]*k+e[9]*w),e[14]=r[2]+w-(e[2]*S+e[6]*k+e[10]*w),e[15]=1,e},t.fromQuat=function(e,t){let r=t[0],n=t[1],i=t[2],a=t[3],s=r+r,o=n+n,u=i+i,l=r*s,c=n*s,h=n*o,f=i*s,d=i*o,p=i*u,v=a*s,g=a*o,m=a*u;return e[0]=1-h-p,e[1]=c+m,e[2]=f-g,e[3]=0,e[4]=c-m,e[5]=1-l-p,e[6]=d+v,e[7]=0,e[8]=f+g,e[9]=d-v,e[10]=1-l-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.frustum=function(e,t,r,n,i,a,s){let o=1/(r-t),u=1/(i-n),l=1/(a-s);return e[0]=2*a*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*a*u,e[6]=0,e[7]=0,e[8]=(r+t)*o,e[9]=(i+n)*u,e[10]=(s+a)*l,e[11]=-1,e[12]=0,e[13]=0,e[14]=s*a*2*l,e[15]=0,e},t.perspective=function(e,t,r,n,i){let a=1/Math.tan(t/2),s=1/(n-i);return e[0]=a/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(i+n)*s,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*i*n*s,e[15]=0,e},t.perspectiveFromFieldOfView=function(e,t,r,n){let i=Math.tan(t.upDegrees*Math.PI/180),a=Math.tan(t.downDegrees*Math.PI/180),s=Math.tan(t.leftDegrees*Math.PI/180),o=Math.tan(t.rightDegrees*Math.PI/180),u=2/(s+o),l=2/(i+a);return e[0]=u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=l,e[6]=0,e[7]=0,e[8]=-(s-o)*u*.5,e[9]=(i-a)*l*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e},t.ortho=function(e,t,r,n,i,a,s){let o=1/(t-r),u=1/(n-i),l=1/(a-s);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*l,e[11]=0,e[12]=(t+r)*o,e[13]=(i+n)*u,e[14]=(s+a)*l,e[15]=1,e},t.lookAt=function(e,t,r,n){let i,s,o,u,l,c,h,f,d,p,v=t[0],g=t[1],m=t[2],_=n[0],y=n[1],b=n[2],M=r[0],T=r[1],A=r[2];return Math.abs(v-M)<a.EPSILON&&Math.abs(g-T)<a.EPSILON&&Math.abs(m-A)<a.EPSILON?mat4.identity(e):(h=v-M,f=g-T,d=m-A,p=1/Math.sqrt(h*h+f*f+d*d),h*=p,f*=p,d*=p,i=y*d-b*f,s=b*h-_*d,o=_*f-y*h,(p=Math.sqrt(i*i+s*s+o*o))?(i*=p=1/p,s*=p,o*=p):(i=0,s=0,o=0),u=f*o-d*s,l=d*i-h*o,c=h*s-f*i,(p=Math.sqrt(u*u+l*l+c*c))?(u*=p=1/p,l*=p,c*=p):(u=0,l=0,c=0),e[0]=i,e[1]=u,e[2]=h,e[3]=0,e[4]=s,e[5]=l,e[6]=f,e[7]=0,e[8]=o,e[9]=c,e[10]=d,e[11]=0,e[12]=-(i*v+s*g+o*m),e[13]=-(u*v+l*g+c*m),e[14]=-(h*v+f*g+d*m),e[15]=1,e)},t.targetTo=function(e,t,r,n){let i=t[0],a=t[1],s=t[2],o=n[0],u=n[1],l=n[2],c=i-r[0],h=a-r[1],f=s-r[2],d=c*c+h*h+f*f;d>0&&(c*=d=1/Math.sqrt(d),h*=d,f*=d);let p=u*f-l*h,v=l*c-o*f,g=o*h-u*c;return e[0]=p,e[1]=v,e[2]=g,e[3]=0,e[4]=h*g-f*v,e[5]=f*p-c*g,e[6]=c*v-h*p,e[7]=0,e[8]=c,e[9]=h,e[10]=f,e[11]=0,e[12]=i,e[13]=a,e[14]=s,e[15]=1,e},t.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},t.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2)+Math.pow(e[9],2)+Math.pow(e[10],2)+Math.pow(e[11],2)+Math.pow(e[12],2)+Math.pow(e[13],2)+Math.pow(e[14],2)+Math.pow(e[15],2))},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e},t.subtract=i,t.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e},t.multiplyScalarAndAdd=function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e[9]=t[9]+r[9]*n,e[10]=t[10]+r[10]*n,e[11]=t[11]+r[11]*n,e[12]=t[12]+r[12]*n,e[13]=t[13]+r[13]*n,e[14]=t[14]+r[14]*n,e[15]=t[15]+r[15]*n,e},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},t.equals=function(e,t){let r=e[0],n=e[1],i=e[2],s=e[3],o=e[4],u=e[5],l=e[6],c=e[7],h=e[8],f=e[9],d=e[10],p=e[11],v=e[12],g=e[13],m=e[14],_=e[15],y=t[0],b=t[1],M=t[2],T=t[3],A=t[4],S=t[5],k=t[6],w=t[7],E=t[8],x=t[9],R=t[10],C=t[11],P=t[12],F=t[13],D=t[14],I=t[15];return Math.abs(r-y)<=a.EPSILON*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(n-b)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(b))&&Math.abs(i-M)<=a.EPSILON*Math.max(1,Math.abs(i),Math.abs(M))&&Math.abs(s-T)<=a.EPSILON*Math.max(1,Math.abs(s),Math.abs(T))&&Math.abs(o-A)<=a.EPSILON*Math.max(1,Math.abs(o),Math.abs(A))&&Math.abs(u-S)<=a.EPSILON*Math.max(1,Math.abs(u),Math.abs(S))&&Math.abs(l-k)<=a.EPSILON*Math.max(1,Math.abs(l),Math.abs(k))&&Math.abs(c-w)<=a.EPSILON*Math.max(1,Math.abs(c),Math.abs(w))&&Math.abs(h-E)<=a.EPSILON*Math.max(1,Math.abs(h),Math.abs(E))&&Math.abs(f-x)<=a.EPSILON*Math.max(1,Math.abs(f),Math.abs(x))&&Math.abs(d-R)<=a.EPSILON*Math.max(1,Math.abs(d),Math.abs(R))&&Math.abs(p-C)<=a.EPSILON*Math.max(1,Math.abs(p),Math.abs(C))&&Math.abs(v-P)<=a.EPSILON*Math.max(1,Math.abs(v),Math.abs(P))&&Math.abs(g-F)<=a.EPSILON*Math.max(1,Math.abs(g),Math.abs(F))&&Math.abs(m-D)<=a.EPSILON*Math.max(1,Math.abs(m),Math.abs(D))&&Math.abs(_-I)<=a.EPSILON*Math.max(1,Math.abs(_),Math.abs(I))};var a=r(8);const s=n;t.mul=s;const o=i;t.sub=o},function(e,t,r){"use strict";function n(){let e=new u.ARRAY_TYPE(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function i(e,t,r){r*=.5;let n=Math.sin(r);return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=Math.cos(r),e}function a(e,t,r){let n=t[0],i=t[1],a=t[2],s=t[3],o=r[0],u=r[1],l=r[2],c=r[3];return e[0]=n*c+s*o+i*l-a*u,e[1]=i*c+s*u+a*o-n*l,e[2]=a*c+s*l+n*u-i*o,e[3]=s*c-n*o-i*u-a*l,e}function s(e,t,r,n){let i,a,s,o,u,l=t[0],c=t[1],h=t[2],f=t[3],d=r[0],p=r[1],v=r[2],g=r[3];return(a=l*d+c*p+h*v+f*g)<0&&(a=-a,d=-d,p=-p,v=-v,g=-g),1-a>1e-6?(i=Math.acos(a),s=Math.sin(i),o=Math.sin((1-n)*i)/s,u=Math.sin(n*i)/s):(o=1-n,u=n),e[0]=o*l+u*d,e[1]=o*c+u*p,e[2]=o*h+u*v,e[3]=o*f+u*g,e}function o(e,t){let r,n=t[0]+t[4]+t[8];if(n>0)r=Math.sqrt(n+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{let n=0;t[4]>t[0]&&(n=1),t[8]>t[3*n+n]&&(n=2);let i=(n+1)%3,a=(n+2)%3;r=Math.sqrt(t[3*n+n]-t[3*i+i]-t[3*a+a]+1),e[n]=.5*r,r=.5/r,e[3]=(t[3*i+a]-t[3*a+i])*r,e[i]=(t[3*i+n]+t[3*n+i])*r,e[a]=(t[3*a+n]+t[3*n+a])*r}return e}Object.defineProperty(t,"__esModule",{value:!0}),t.create=n,t.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},t.setAxisAngle=i,t.getAxisAngle=function(e,t){let r=2*Math.acos(t[3]),n=Math.sin(r/2);return 0!=n?(e[0]=t[0]/n,e[1]=t[1]/n,e[2]=t[2]/n):(e[0]=1,e[1]=0,e[2]=0),r},t.multiply=a,t.rotateX=function(e,t,r){r*=.5;let n=t[0],i=t[1],a=t[2],s=t[3],o=Math.sin(r),u=Math.cos(r);return e[0]=n*u+s*o,e[1]=i*u+a*o,e[2]=a*u-i*o,e[3]=s*u-n*o,e},t.rotateY=function(e,t,r){r*=.5;let n=t[0],i=t[1],a=t[2],s=t[3],o=Math.sin(r),u=Math.cos(r);return e[0]=n*u-a*o,e[1]=i*u+s*o,e[2]=a*u+n*o,e[3]=s*u-i*o,e},t.rotateZ=function(e,t,r){r*=.5;let n=t[0],i=t[1],a=t[2],s=t[3],o=Math.sin(r),u=Math.cos(r);return e[0]=n*u+i*o,e[1]=i*u-n*o,e[2]=a*u+s*o,e[3]=s*u-a*o,e},t.calculateW=function(e,t){let r=t[0],n=t[1],i=t[2];return e[0]=r,e[1]=n,e[2]=i,e[3]=Math.sqrt(Math.abs(1-r*r-n*n-i*i)),e},t.slerp=s,t.invert=function(e,t){let r=t[0],n=t[1],i=t[2],a=t[3],s=r*r+n*n+i*i+a*a,o=s?1/s:0;return e[0]=-r*o,e[1]=-n*o,e[2]=-i*o,e[3]=a*o,e},t.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},t.fromMat3=o,t.fromEuler=function(e,t,r,n){let i=.5*Math.PI/180;t*=i,r*=i,n*=i;let a=Math.sin(t),s=Math.cos(t),o=Math.sin(r),u=Math.cos(r),l=Math.sin(n),c=Math.cos(n);return e[0]=a*u*c-s*o*l,e[1]=s*o*c+a*u*l,e[2]=s*u*l-a*o*c,e[3]=s*u*c+a*o*l,e},t.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"};var u=r(8),l=r(22),c=r(23),h=r(24);const f=h.clone;t.clone=f;const d=h.fromValues;t.fromValues=d;const p=h.copy;t.copy=p;const v=h.set;t.set=v;const g=h.add;t.add=g;const m=a;t.mul=m;const _=h.scale;t.scale=_;const y=h.dot;t.dot=y;const b=h.lerp;t.lerp=b;const M=h.length;t.length=M;const T=M;t.len=T;const A=h.squaredLength;t.squaredLength=A;const S=A;t.sqrLen=S;const k=h.normalize;t.normalize=k;const w=h.exactEquals;t.exactEquals=w;const E=h.equals;t.equals=E;const x=function(){let e=c.create(),t=c.fromValues(1,0,0),r=c.fromValues(0,1,0);return function(n,a,s){let o=c.dot(a,s);return o<-.999999?(c.cross(e,t,a),c.len(e)<1e-6&&c.cross(e,r,a),c.normalize(e,e),i(n,e,Math.PI),n):o>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(c.cross(e,a,s),n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=1+o,k(n,n))}}();t.rotationTo=x;const R=function(){let e=n(),t=n();return function(r,n,i,a,o,u){return s(e,n,o,u),s(t,i,a,u),s(r,e,t,2*u*(1-u)),r}}();t.sqlerp=R;const C=function(){let e=l.create();return function(t,r,n,i){return e[0]=n[0],e[3]=n[1],e[6]=n[2],e[1]=i[0],e[4]=i[1],e[7]=i[2],e[2]=-r[0],e[5]=-r[1],e[8]=-r[2],k(t,o(t,e))}}();t.setAxes=C},function(e,t,r){"use strict";function n(){let e=new h.ARRAY_TYPE(2);return e[0]=0,e[1]=0,e}function i(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function a(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function s(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function o(e,t){var r=t[0]-e[0],n=t[1]-e[1];return Math.sqrt(r*r+n*n)}function u(e,t){var r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n}function l(e){var t=e[0],r=e[1];return Math.sqrt(t*t+r*r)}function c(e){var t=e[0],r=e[1];return t*t+r*r}Object.defineProperty(t,"__esModule",{value:!0}),t.create=n,t.clone=function(e){let t=new h.ARRAY_TYPE(2);return t[0]=e[0],t[1]=e[1],t},t.fromValues=function(e,t){let r=new h.ARRAY_TYPE(2);return r[0]=e,r[1]=t,r},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},t.set=function(e,t,r){return e[0]=t,e[1]=r,e},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e},t.subtract=i,t.multiply=a,t.divide=s,t.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},t.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},t.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e},t.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e},t.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},t.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e},t.scaleAndAdd=function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e},t.distance=o,t.squaredDistance=u,t.length=l,t.squaredLength=c,t.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},t.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},t.normalize=function(e,t){var r=t[0],n=t[1],i=r*r+n*n;return i>0&&(i=1/Math.sqrt(i),e[0]=t[0]*i,e[1]=t[1]*i),e},t.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},t.cross=function(e,t,r){var n=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=n,e},t.lerp=function(e,t,r,n){var i=t[0],a=t[1];return e[0]=i+n*(r[0]-i),e[1]=a+n*(r[1]-a),e},t.random=function(e,t){t=t||1;var r=2*h.RANDOM()*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e},t.transformMat2=function(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[2]*i,e[1]=r[1]*n+r[3]*i,e},t.transformMat2d=function(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[2]*i+r[4],e[1]=r[1]*n+r[3]*i+r[5],e},t.transformMat3=function(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[3]*i+r[6],e[1]=r[1]*n+r[4]*i+r[7],e},t.transformMat4=function(e,t,r){let n=t[0],i=t[1];return e[0]=r[0]*n+r[4]*i+r[12],e[1]=r[1]*n+r[5]*i+r[13],e},t.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]},t.equals=function(e,t){let r=e[0],n=e[1],i=t[0],a=t[1];return Math.abs(r-i)<=h.EPSILON*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(n-a)<=h.EPSILON*Math.max(1,Math.abs(n),Math.abs(a))};var h=r(8);const f=l;t.len=f;const d=i;t.sub=d;const p=a;t.mul=p;const v=s;t.div=v;const g=o;t.dist=g;const m=u;t.sqrDist=m;const _=c;t.sqrLen=_;const y=function(){let e=n();return function(t,r,n,i,a,s){let o,u;for(r||(r=2),n||(n=0),u=i?Math.min(i*r+n,t.length):t.length,o=n;o<u;o+=r)e[0]=t[o],e[1]=t[o+1],a(e,e,s),t[o]=e[0],t[o+1]=e[1];return t}}();t.forEach=y},function(e,t,r){var n;!function(i,a,s,o){"use strict";function u(e,t,r){return setTimeout(d(e,r),t)}function l(e,t,r){return!!Array.isArray(e)&&(c(e,r[t],r),!0)}function c(e,t,r){var n;if(e)if(e.forEach)e.forEach(t,r);else if(e.length!==o)for(n=0;n<e.length;)t.call(r,e[n],n,e),n++;else for(n in e)e.hasOwnProperty(n)&&t.call(r,e[n],n,e)}function h(e,t,r){var n="DEPRECATED METHOD: "+t+"\n"+r+" AT \n";return function(){var t=new Error("get-stack-trace"),r=t&&t.stack?t.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",a=i.console&&(i.console.warn||i.console.log);return a&&a.call(i.console,n,r),e.apply(this,arguments)}}function f(e,t,r){var n,i=t.prototype;(n=e.prototype=Object.create(i)).constructor=e,n._super=i,r&&te(n,r)}function d(e,t){return function(){return e.apply(t,arguments)}}function p(e,t){return typeof e==ie?e.apply(t?t[0]||o:o,t):e}function v(e,t){return e===o?t:e}function g(e,t,r){c(b(t),function(t){e.addEventListener(t,r,!1)})}function m(e,t,r){c(b(t),function(t){e.removeEventListener(t,r,!1)})}function _(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function y(e,t){return e.indexOf(t)>-1}function b(e){return e.trim().split(/\s+/g)}function M(e,t,r){if(e.indexOf&&!r)return e.indexOf(t);for(var n=0;n<e.length;){if(r&&e[n][r]==t||!r&&e[n]===t)return n;n++}return-1}function T(e){return Array.prototype.slice.call(e,0)}function A(e,t,r){for(var n=[],i=[],a=0;a<e.length;){var s=t?e[a][t]:e[a];M(i,s)<0&&n.push(e[a]),i[a]=s,a++}return r&&(n=t?n.sort(function(e,r){return e[t]>r[t]}):n.sort()),n}function S(e,t){for(var r,n,i=t[0].toUpperCase()+t.slice(1),a=0;a<re.length;){if(r=re[a],(n=r?r+i:t)in e)return n;a++}return o}function k(e){var t=e.ownerDocument||e;return t.defaultView||t.parentWindow||i}function w(e,t){var r=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){p(e.options.enable,[e])&&r.handler(t)},this.init()}function E(e,t,r){var n=r.pointers.length,i=r.changedPointers.length,a=t&ve&&n-i==0,s=t&(me|_e)&&n-i==0;r.isFirst=!!a,r.isFinal=!!s,a&&(e.session={}),r.eventType=t,function(e,t){var r=e.session,n=t.pointers,i=n.length;r.firstInput||(r.firstInput=x(t));i>1&&!r.firstMultiple?r.firstMultiple=x(t):1===i&&(r.firstMultiple=!1);var a=r.firstInput,s=r.firstMultiple,u=s?s.center:a.center,l=t.center=R(n);t.timeStamp=oe(),t.deltaTime=t.timeStamp-a.timeStamp,t.angle=D(u,l),t.distance=F(u,l),function(e,t){var r=t.center,n=e.offsetDelta||{},i=e.prevDelta||{},a=e.prevInput||{};t.eventType!==ve&&a.eventType!==me||(i=e.prevDelta={x:a.deltaX||0,y:a.deltaY||0},n=e.offsetDelta={x:r.x,y:r.y});t.deltaX=i.x+(r.x-n.x),t.deltaY=i.y+(r.y-n.y)}(r,t),t.offsetDirection=P(t.deltaX,t.deltaY);var c=C(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=c.x,t.overallVelocityY=c.y,t.overallVelocity=se(c.x)>se(c.y)?c.x:c.y,t.scale=s?function(e,t){return F(t[0],t[1],xe)/F(e[0],e[1],xe)}(s.pointers,n):1,t.rotation=s?function(e,t){return D(t[1],t[0],xe)+D(e[1],e[0],xe)}(s.pointers,n):0,t.maxPointers=r.prevInput?t.pointers.length>r.prevInput.maxPointers?t.pointers.length:r.prevInput.maxPointers:t.pointers.length,function(e,t){var r,n,i,a,s=e.lastInterval||t,u=t.timeStamp-s.timeStamp;if(t.eventType!=_e&&(u>pe||s.velocity===o)){var l=t.deltaX-s.deltaX,c=t.deltaY-s.deltaY,h=C(u,l,c);n=h.x,i=h.y,r=se(h.x)>se(h.y)?h.x:h.y,a=P(l,c),e.lastInterval=t}else r=s.velocity,n=s.velocityX,i=s.velocityY,a=s.direction;t.velocity=r,t.velocityX=n,t.velocityY=i,t.direction=a}(r,t);var h=e.element;_(t.srcEvent.target,h)&&(h=t.srcEvent.target);t.target=h}(e,r),e.emit("hammer.input",r),e.recognize(r),e.session.prevInput=r}function x(e){for(var t=[],r=0;r<e.pointers.length;)t[r]={clientX:ae(e.pointers[r].clientX),clientY:ae(e.pointers[r].clientY)},r++;return{timeStamp:oe(),pointers:t,center:R(t),deltaX:e.deltaX,deltaY:e.deltaY}}function R(e){var t=e.length;if(1===t)return{x:ae(e[0].clientX),y:ae(e[0].clientY)};for(var r=0,n=0,i=0;i<t;)r+=e[i].clientX,n+=e[i].clientY,i++;return{x:ae(r/t),y:ae(n/t)}}function C(e,t,r){return{x:t/e||0,y:r/e||0}}function P(e,t){return e===t?ye:se(e)>=se(t)?e<0?be:Me:t<0?Te:Ae}function F(e,t,r){r||(r=Ee);var n=t[r[0]]-e[r[0]],i=t[r[1]]-e[r[1]];return Math.sqrt(n*n+i*i)}function D(e,t,r){r||(r=Ee);var n=t[r[0]]-e[r[0]],i=t[r[1]]-e[r[1]];return 180*Math.atan2(i,n)/Math.PI}function I(){this.evEl=Ce,this.evWin=Pe,this.pressed=!1,w.apply(this,arguments)}function N(){this.evEl=Ie,this.evWin=Ne,w.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function V(){this.evTarget=Le,this.evWin=Oe,this.started=!1,w.apply(this,arguments)}function L(){this.evTarget=Be,this.targetIds={},w.apply(this,arguments)}function O(){w.apply(this,arguments);var e=d(this.handler,this);this.touch=new L(this.manager,e),this.mouse=new I(this.manager,e),this.primaryTouch=null,this.lastTouches=[]}function U(e){var t=e.changedPointers[0];if(t.identifier===this.primaryTouch){var r={x:t.clientX,y:t.clientY};this.lastTouches.push(r);var n=this.lastTouches,i=function(){var e=n.indexOf(r);e>-1&&n.splice(e,1)};setTimeout(i,je)}}function B(e,t){this.manager=e,this.set(t)}function j(e){this.options=te({},this.defaults,e||{}),this.id=ce++,this.manager=null,this.options.enable=v(this.options.enable,!0),this.state=Qe,this.simultaneous={},this.requireFail=[]}function G(e){return e&rt?"cancel":e&et?"end":e&$e?"move":e&Je?"start":""}function X(e){return e==Ae?"down":e==Te?"up":e==be?"left":e==Me?"right":""}function z(e,t){var r=t.manager;return r?r.get(e):e}function W(){j.apply(this,arguments)}function Y(){W.apply(this,arguments),this.pX=null,this.pY=null}function H(){W.apply(this,arguments)}function q(){j.apply(this,arguments),this._timer=null,this._input=null}function K(){W.apply(this,arguments)}function Z(){W.apply(this,arguments)}function Q(){j.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function J(e,t){return t=t||{},t.recognizers=v(t.recognizers,J.defaults.preset),new $(e,t)}function $(e,t){this.options=te({},J.defaults,t||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=function(e){var t=e.options.inputClass;return new(t||(fe?N:de?L:he?O:I))(e,E)}(this),this.touchAction=new B(this,this.options.touchAction),ee(this,!0),c(this.options.recognizers,function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])},this)}function ee(e,t){var r=e.element;if(r.style){var n;c(e.options.cssProps,function(i,a){n=S(r.style,a),t?(e.oldCssProps[n]=r.style[n],r.style[n]=i):r.style[n]=e.oldCssProps[n]||""}),t||(e.oldCssProps={})}}var te,re=["","webkit","Moz","MS","ms","o"],ne=a.createElement("div"),ie="function",ae=Math.round,se=Math.abs,oe=Date.now;te="function"!=typeof Object.assign?function(e){if(e===o||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),r=1;r<arguments.length;r++){var n=arguments[r];if(n!==o&&null!==n)for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])}return t}:Object.assign;var ue=h(function(e,t,r){for(var n=Object.keys(t),i=0;i<n.length;)(!r||r&&e[n[i]]===o)&&(e[n[i]]=t[n[i]]),i++;return e},"extend","Use `assign`."),le=h(function(e,t){return ue(e,t,!0)},"merge","Use `assign`."),ce=1,he="ontouchstart"in i,fe=S(i,"PointerEvent")!==o,de=he&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),pe=25,ve=1,ge=2,me=4,_e=8,ye=1,be=2,Me=4,Te=8,Ae=16,Se=be|Me,ke=Te|Ae,we=Se|ke,Ee=["x","y"],xe=["clientX","clientY"];w.prototype={handler:function(){},init:function(){this.evEl&&g(this.element,this.evEl,this.domHandler),this.evTarget&&g(this.target,this.evTarget,this.domHandler),this.evWin&&g(k(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&m(this.element,this.evEl,this.domHandler),this.evTarget&&m(this.target,this.evTarget,this.domHandler),this.evWin&&m(k(this.element),this.evWin,this.domHandler)}};var Re={mousedown:ve,mousemove:ge,mouseup:me},Ce="mousedown",Pe="mousemove mouseup";f(I,w,{handler:function(e){var t=Re[e.type];t&ve&&0===e.button&&(this.pressed=!0),t&ge&&1!==e.which&&(t=me),this.pressed&&(t&me&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:"mouse",srcEvent:e}))}});var Fe={pointerdown:ve,pointermove:ge,pointerup:me,pointercancel:_e,pointerout:_e},De={2:"touch",3:"pen",4:"mouse",5:"kinect"},Ie="pointerdown",Ne="pointermove pointerup pointercancel";i.MSPointerEvent&&!i.PointerEvent&&(Ie="MSPointerDown",Ne="MSPointerMove MSPointerUp MSPointerCancel"),f(N,w,{handler:function(e){var t=this.store,r=!1,n=e.type.toLowerCase().replace("ms",""),i=Fe[n],a=De[e.pointerType]||e.pointerType,s="touch"==a,o=M(t,e.pointerId,"pointerId");i&ve&&(0===e.button||s)?o<0&&(t.push(e),o=t.length-1):i&(me|_e)&&(r=!0),o<0||(t[o]=e,this.callback(this.manager,i,{pointers:t,changedPointers:[e],pointerType:a,srcEvent:e}),r&&t.splice(o,1))}});var Ve={touchstart:ve,touchmove:ge,touchend:me,touchcancel:_e},Le="touchstart",Oe="touchstart touchmove touchend touchcancel";f(V,w,{handler:function(e){var t=Ve[e.type];if(t===ve&&(this.started=!0),this.started){var r=function(e,t){var r=T(e.touches),n=T(e.changedTouches);return t&(me|_e)&&(r=A(r.concat(n),"identifier",!0)),[r,n]}.call(this,e,t);t&(me|_e)&&r[0].length-r[1].length==0&&(this.started=!1),this.callback(this.manager,t,{pointers:r[0],changedPointers:r[1],pointerType:"touch",srcEvent:e})}}});var Ue={touchstart:ve,touchmove:ge,touchend:me,touchcancel:_e},Be="touchstart touchmove touchend touchcancel";f(L,w,{handler:function(e){var t=Ue[e.type],r=function(e,t){var r=T(e.touches),n=this.targetIds;if(t&(ve|ge)&&1===r.length)return n[r[0].identifier]=!0,[r,r];var i,a,s=T(e.changedTouches),o=[],u=this.target;if(a=r.filter(function(e){return _(e.target,u)}),t===ve)for(i=0;i<a.length;)n[a[i].identifier]=!0,i++;for(i=0;i<s.length;)n[s[i].identifier]&&o.push(s[i]),t&(me|_e)&&delete n[s[i].identifier],i++;return o.length?[A(a.concat(o),"identifier",!0),o]:void 0}.call(this,e,t);r&&this.callback(this.manager,t,{pointers:r[0],changedPointers:r[1],pointerType:"touch",srcEvent:e})}});var je=2500,Ge=25;f(O,w,{handler:function(e,t,r){var n="touch"==r.pointerType,i="mouse"==r.pointerType;if(!(i&&r.sourceCapabilities&&r.sourceCapabilities.firesTouchEvents)){if(n)(function(e,t){e&ve?(this.primaryTouch=t.changedPointers[0].identifier,U.call(this,t)):e&(me|_e)&&U.call(this,t)}).call(this,t,r);else if(i&&function(e){for(var t=e.srcEvent.clientX,r=e.srcEvent.clientY,n=0;n<this.lastTouches.length;n++){var i=this.lastTouches[n],a=Math.abs(t-i.x),s=Math.abs(r-i.y);if(a<=Ge&&s<=Ge)return!0}return!1}.call(this,r))return;this.callback(e,t,r)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Xe=S(ne.style,"touchAction"),ze=Xe!==o,We="auto",Ye="manipulation",He="none",qe="pan-x",Ke="pan-y",Ze=function(){if(!ze)return!1;var e={},t=i.CSS&&i.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(r){e[r]=!t||i.CSS.supports("touch-action",r)}),e}();B.prototype={set:function(e){"compute"==e&&(e=this.compute()),ze&&this.manager.element.style&&Ze[e]&&(this.manager.element.style[Xe]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return c(this.manager.recognizers,function(t){p(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))}),function(e){if(y(e,He))return He;var t=y(e,qe),r=y(e,Ke);return t&&r?He:t||r?t?qe:Ke:y(e,Ye)?Ye:We}(e.join(" "))},preventDefaults:function(e){var t=e.srcEvent,r=e.offsetDirection;if(this.manager.session.prevented)t.preventDefault();else{var n=this.actions,i=y(n,He)&&!Ze[He],a=y(n,Ke)&&!Ze[Ke],s=y(n,qe)&&!Ze[qe];if(i){var o=1===e.pointers.length,u=e.distance<2,l=e.deltaTime<250;if(o&&u&&l)return}if(!s||!a)return i||a&&r&Se||s&&r&ke?this.preventSrc(t):void 0}},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};var Qe=1,Je=2,$e=4,et=8,tt=et,rt=16;j.prototype={defaults:{},set:function(e){return te(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(l(e,"recognizeWith",this))return this;var t=this.simultaneous;return e=z(e,this),t[e.id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return l(e,"dropRecognizeWith",this)?this:(e=z(e,this),delete this.simultaneous[e.id],this)},requireFailure:function(e){if(l(e,"requireFailure",this))return this;var t=this.requireFail;return e=z(e,this),-1===M(t,e)&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(l(e,"dropRequireFailure",this))return this;e=z(e,this);var t=M(this.requireFail,e);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){function t(t){r.manager.emit(t,e)}var r=this,n=this.state;n<et&&t(r.options.event+G(n)),t(r.options.event),e.additionalEvent&&t(e.additionalEvent),n>=et&&t(r.options.event+G(n))},tryEmit:function(e){if(this.canEmit())return this.emit(e);this.state=32},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(this.requireFail[e].state&(32|Qe)))return!1;e++}return!0},recognize:function(e){var t=te({},e);if(!p(this.options.enable,[this,t]))return this.reset(),void(this.state=32);this.state&(tt|rt|32)&&(this.state=Qe),this.state=this.process(t),this.state&(Je|$e|et|rt)&&this.tryEmit(t)},process:function(e){},getTouchAction:function(){},reset:function(){}},f(W,j,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(e){var t=this.state,r=e.eventType,n=t&(Je|$e),i=this.attrTest(e);return n&&(r&_e||!i)?t|rt:n||i?r&me?t|et:t&Je?t|$e:Je:32}}),f(Y,W,{defaults:{event:"pan",threshold:10,pointers:1,direction:we},getTouchAction:function(){var e=this.options.direction,t=[];return e&Se&&t.push(Ke),e&ke&&t.push(qe),t},directionTest:function(e){var t=this.options,r=!0,n=e.distance,i=e.direction,a=e.deltaX,s=e.deltaY;return i&t.direction||(t.direction&Se?(i=0===a?ye:a<0?be:Me,r=a!=this.pX,n=Math.abs(e.deltaX)):(i=0===s?ye:s<0?Te:Ae,r=s!=this.pY,n=Math.abs(e.deltaY))),e.direction=i,r&&n>t.threshold&&i&t.direction},attrTest:function(e){return W.prototype.attrTest.call(this,e)&&(this.state&Je||!(this.state&Je)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=X(e.direction);t&&(e.additionalEvent=this.options.event+t),this._super.emit.call(this,e)}}),f(H,W,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[He]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||this.state&Je)},emit:function(e){if(1!==e.scale){var t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}this._super.emit.call(this,e)}}),f(q,j,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[We]},process:function(e){var t=this.options,r=e.pointers.length===t.pointers,n=e.distance<t.threshold,i=e.deltaTime>t.time;if(this._input=e,!n||!r||e.eventType&(me|_e)&&!i)this.reset();else if(e.eventType&ve)this.reset(),this._timer=u(function(){this.state=tt,this.tryEmit()},t.time,this);else if(e.eventType&me)return tt;return 32},reset:function(){clearTimeout(this._timer)},emit:function(e){this.state===tt&&(e&&e.eventType&me?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=oe(),this.manager.emit(this.options.event,this._input)))}}),f(K,W,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[He]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||this.state&Je)}}),f(Z,W,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Se|ke,pointers:1},getTouchAction:function(){return Y.prototype.getTouchAction.call(this)},attrTest:function(e){var t,r=this.options.direction;return r&(Se|ke)?t=e.overallVelocity:r&Se?t=e.overallVelocityX:r&ke&&(t=e.overallVelocityY),this._super.attrTest.call(this,e)&&r&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&se(t)>this.options.velocity&&e.eventType&me},emit:function(e){var t=X(e.offsetDirection);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),f(Q,j,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Ye]},process:function(e){var t=this.options,r=e.pointers.length===t.pointers,n=e.distance<t.threshold,i=e.deltaTime<t.time;if(this.reset(),e.eventType&ve&&0===this.count)return this.failTimeout();if(n&&i&&r){if(e.eventType!=me)return this.failTimeout();var a=!this.pTime||e.timeStamp-this.pTime<t.interval,s=!this.pCenter||F(this.pCenter,e.center)<t.posThreshold;this.pTime=e.timeStamp,this.pCenter=e.center,s&&a?this.count+=1:this.count=1,this._input=e;if(0===this.count%t.taps)return this.hasRequireFailures()?(this._timer=u(function(){this.state=tt,this.tryEmit()},t.interval,this),Je):tt}return 32},failTimeout:function(){return this._timer=u(function(){this.state=32},this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==tt&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),J.VERSION="2.0.7",J.defaults={domEvents:!1,touchAction:"compute",enable:!0,inputTarget:null,inputClass:null,preset:[[K,{enable:!1}],[H,{enable:!1},["rotate"]],[Z,{direction:Se}],[Y,{direction:Se},["swipe"]],[Q],[Q,{event:"doubletap",taps:2},["tap"]],[q]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};$.prototype={set:function(e){return te(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?2:1},recognize:function(e){var t=this.session;if(!t.stopped){this.touchAction.preventDefaults(e);var r,n=this.recognizers,i=t.curRecognizer;(!i||i&&i.state&tt)&&(i=t.curRecognizer=null);for(var a=0;a<n.length;)r=n[a],2===t.stopped||i&&r!=i&&!r.canRecognizeWith(i)?r.reset():r.recognize(e),!i&&r.state&(Je|$e|et)&&(i=t.curRecognizer=r),a++}},get:function(e){if(e instanceof j)return e;for(var t=this.recognizers,r=0;r<t.length;r++)if(t[r].options.event==e)return t[r];return null},add:function(e){if(l(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(l(e,"remove",this))return this;if(e=this.get(e)){var t=this.recognizers,r=M(t,e);-1!==r&&(t.splice(r,1),this.touchAction.update())}return this},on:function(e,t){if(e!==o&&t!==o){var r=this.handlers;return c(b(e),function(e){r[e]=r[e]||[],r[e].push(t)}),this}},off:function(e,t){if(e!==o){var r=this.handlers;return c(b(e),function(e){t?r[e]&&r[e].splice(M(r[e],t),1):delete r[e]}),this}},emit:function(e,t){this.options.domEvents&&function(e,t){var r=a.createEvent("Event");r.initEvent(e,!0,!0),r.gesture=t,t.target.dispatchEvent(r)}(e,t);var r=this.handlers[e]&&this.handlers[e].slice();if(r&&r.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var n=0;n<r.length;)r[n](t),n++}},destroy:function(){this.element&&ee(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},te(J,{INPUT_START:ve,INPUT_MOVE:ge,INPUT_END:me,INPUT_CANCEL:_e,STATE_POSSIBLE:Qe,STATE_BEGAN:Je,STATE_CHANGED:$e,STATE_ENDED:et,STATE_RECOGNIZED:tt,STATE_CANCELLED:rt,STATE_FAILED:32,DIRECTION_NONE:ye,DIRECTION_LEFT:be,DIRECTION_RIGHT:Me,DIRECTION_UP:Te,DIRECTION_DOWN:Ae,DIRECTION_HORIZONTAL:Se,DIRECTION_VERTICAL:ke,DIRECTION_ALL:we,Manager:$,Input:w,TouchAction:B,TouchInput:L,MouseInput:I,PointerEventInput:N,TouchMouseInput:O,SingleTouchInput:V,Recognizer:j,AttrRecognizer:W,Tap:Q,Pan:Y,Swipe:Z,Pinch:H,Rotate:K,Press:q,on:g,off:m,each:c,merge:le,extend:ue,assign:te,inherit:f,bindFn:d,prefixed:S});(void 0!==i?i:"undefined"!=typeof self?self:{}).Hammer=J,(n=function(){return J}.call(t,r,t,e))===o||(e.exports=n)}(window,document)},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(1),s=n(r(5)),o=n(r(2)),u=n(r(0)),l=n(r(47)),c=n(r(20)),h=n(r(87)),f=n(r(92)),d=n(r(125)),p=n(r(34)),v=n(r(126)),g=n(r(11)),m=n(r(21)),_=n(r(29)),y=n(r(35)),b=n(r(16)),M=n(r(127)),T=n(r(12)),A=n(r(36)),S=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._gl=null,this._pixelRatio=1,this._viewport=document.getElementById("viewport"),this._canvas=document.getElementById("canvas"),this._canvasWidth=0,this._canvasHeight=0,this._canvasOffsetLeft=0,this._canvasOffsetTop=0,this._stateManager=new y.default(this),this._sculptManager=null,this._camera=new d.default(this),this._picking=new p.default(this),this._pickingSym=new p.default(this,!0),this._meshPreview=null,this._torusLength=.5,this._torusWidth=.1,this._torusRadius=2*Math.PI,this._torusRadial=32,this._torusTubular=128;var t=(0,s.default)();this._showContour=t.outline,this._showGrid=t.grid,this._grid=null,this._background=null,this._meshes=[],this._selectMeshes=[],this._mesh=null,this._rttContour=null,this._rttMerge=null,this._rttOpaque=null,this._rttTransparent=null,this._focusGui=!1,this._gui=new f.default(this),this._preventRender=!1,this._drawFullScene=!1,this._autoMatrix=t.scalecenter,this._vertexSRGB=!0}return function(e,t,r){t&&i(e.prototype,t),r&&i(e,r)}(e,[{key:"start",value:function(){if(this.initWebGL(),this._gl){this._sculptManager=new l.default(this),this._background=new v.default(this._gl,this),this._rttContour=new M.default(this._gl,o.default.Shader.CONTOUR,null),this._rttMerge=new M.default(this._gl,o.default.Shader.MERGE,null),this._rttOpaque=new M.default(this._gl,o.default.Shader.FXAA),this._rttTransparent=new M.default(this._gl,null,this._rttOpaque.getDepth(),!0),this._grid=_.default.createGrid(this._gl),this.initGrid(),this.loadTextures(),this._gui.initGui(),this.onCanvasResize();var e=(0,s.default)().modelurl;e?this.addModelURL(e):this.addSphere()}}},{key:"addModelURL",value:function(e){var t=this.getFileType(e);if(t){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="obj"===t?"text":"arraybuffer",r.onload=function(){200===r.status&&this.loadScene(r.response,t)}.bind(this),r.send(null)}}},{key:"getBackground",value:function(){return this._background}},{key:"getViewport",value:function(){return this._viewport}},{key:"getCanvas",value:function(){return this._canvas}},{key:"getPixelRatio",value:function(){return this._pixelRatio}},{key:"getCanvasWidth",value:function(){return this._canvasWidth}},{key:"getCanvasHeight",value:function(){return this._canvasHeight}},{key:"getCamera",value:function(){return this._camera}},{key:"getGui",value:function(){return this._gui}},{key:"getMeshes",value:function(){return this._meshes}},{key:"getMesh",value:function(){return this._mesh}},{key:"getSelectedMeshes",value:function(){return this._selectMeshes}},{key:"getPicking",value:function(){return this._picking}},{key:"getPickingSymmetry",value:function(){return this._pickingSym}},{key:"getSculptManager",value:function(){return this._sculptManager}},{key:"getStateManager",value:function(){return this._stateManager}},{key:"setMesh",value:function(e){return this.setOrUnsetMesh(e)}},{key:"setCanvasCursor",value:function(e){this._canvas.style.cursor=e}},{key:"initGrid",value:function(){var e=this._grid;e.normalizeSize();var t=e.getMatrix();a.mat4.translate(t,t,[0,-.45,0]);a.mat4.scale(t,t,[2.5,2.5,2.5]),this._grid.setShaderType(o.default.Shader.FLAT),e.setFlatColor([.04,.04,.04])}},{key:"setOrUnsetMesh",value:function(e,t){if(e)if(t){var r=this.getIndexSelectMesh(e);r>=0?this._selectMeshes.length>1&&(this._selectMeshes.splice(r,1),e=this._selectMeshes[0]):this._selectMeshes.push(e)}else this._selectMeshes.length=0,this._selectMeshes.push(e);else this._selectMeshes.length=0;return this._mesh=e,this.getGui().updateMesh(),this.render(),e}},{key:"renderSelectOverRtt",value:function(){this._requestRender()&&(this._drawFullScene=!1)}},{key:"_requestRender",value:function(){return!0!==this._preventRender&&(window.requestAnimationFrame(this.applyRender.bind(this)),this._preventRender=!0,!0)}},{key:"render",value:function(){this._drawFullScene=!0,this._requestRender()}},{key:"applyRender",value:function(){this._preventRender=!1,this.updateMatricesAndSort();var e=this._gl;e&&(this._drawFullScene&&this._drawScene(),e.disable(e.DEPTH_TEST),e.bindFramebuffer(e.FRAMEBUFFER,this._rttMerge.getFramebuffer()),this._rttMerge.render(this),e.bindFramebuffer(e.FRAMEBUFFER,null),this._rttOpaque.render(this),e.enable(e.DEPTH_TEST),this._sculptManager.postRender())}},{key:"_drawScene",value:function(){var e=this._gl,t=0,r=this._meshes,n=r.length;e.disable(e.DEPTH_TEST);var i=this._selectMeshes.length>0&&this._showContour&&T.default[o.default.Shader.CONTOUR].color[3]>0;if(i){e.bindFramebuffer(e.FRAMEBUFFER,this._rttContour.getFramebuffer()),e.clear(e.COLOR_BUFFER_BIT);for(var a=0,s=this._selectMeshes,u=s.length;a<u;++a)s[a].renderFlatColor(this)}for(e.enable(e.DEPTH_TEST),e.bindFramebuffer(e.FRAMEBUFFER,this._rttOpaque.getFramebuffer()),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),this._showGrid&&this._grid.render(this),t=0;t<n&&!r[t].isTransparent();++t)r[t].render(this);var l=t;for(this._meshPreview&&this._meshPreview.render(this),this._background.render(),e.bindFramebuffer(e.FRAMEBUFFER,this._rttTransparent.getFramebuffer()),e.clear(e.COLOR_BUFFER_BIT),e.enable(e.BLEND),e.depthFunc(e.LESS),t=0;t<n;++t)r[t].getShowWireframe()&&r[t].renderWireframe(this);for(e.depthFunc(e.LEQUAL),e.depthMask(!1),e.enable(e.CULL_FACE),t=l;t<n;++t)e.cullFace(e.FRONT),r[t].render(this),e.cullFace(e.BACK),r[t].render(this);e.disable(e.CULL_FACE),i&&this._rttContour.render(this),e.depthMask(!0),e.disable(e.BLEND)}},{key:"updateMatricesAndSort",value:function(){var e=this._meshes,t=this._camera;e.length>0&&t.optimizeNearFar(this.computeBoundingBoxScene());for(var r=0,n=e.length;r<n;++r)e[r].updateMatrices(t);e.sort(g.default.sortFunction),this._meshPreview&&this._meshPreview.updateMatrices(t),this._grid&&this._grid.updateMatrices(t)}},{key:"initWebGL",value:function(){var e={antialias:!1,stencil:!0},t=document.getElementById("canvas"),r=this._gl=t.getContext("webgl",e)||t.getContext("experimental-webgl",e);r?(A.default.initWebGLExtensions(r),A.default.getWebGLExtension("OES_element_index_uint")||(b.default.ONLY_DRAW_ARRAYS=!0),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!0),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,r.NONE),r.disable(r.CULL_FACE),r.frontFace(r.CCW),r.cullFace(r.BACK),r.disable(r.BLEND),r.blendFunc(r.ONE,r.ONE_MINUS_SRC_ALPHA),r.disable(r.DEPTH_TEST),r.depthFunc(r.LEQUAL),r.depthMask(!0),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT)):window.alert("Could not initialise WebGL. No WebGL, no SculptGL. Sorry.")}},{key:"loadTextures",value:function(){for(var e=this,t=this._gl,r=T.default[o.default.Shader.MATCAP],n=function(n,i){var a=new Image;a.src=n,a.onload=function(){r.createTexture(t,a,i),e.render()}},i=0,a=r.matcaps,s=a.length;i<s;++i)n(a[i].path,i);this.initAlphaTextures()}},{key:"initAlphaTextures",value:function(){for(var e=p.default.INIT_ALPHAS_PATHS,t=p.default.INIT_ALPHAS_NAMES,r=0,n=e.length;r<n;++r){var i=new Image;i.src="/components/em-sculptgl/app/resources/alpha/"+e[r],i.onload=this.onLoadAlphaImage.bind(this,i,t[r])}}},{key:"onCanvasResize",value:function(){var e=this._viewport,t=e.clientWidth*this._pixelRatio,r=e.clientHeight*this._pixelRatio;this._canvasOffsetLeft=e.offsetLeft,this._canvasOffsetTop=e.offsetTop,this._canvasWidth=t,this._canvasHeight=r,this._canvas.width=t,this._canvas.height=r,this._gl.viewport(0,0,t,r),this._camera.onResize(t,r),this._background.onResize(t,r),this._rttContour.onResize(t,r),this._rttMerge.onResize(t,r),this._rttOpaque.onResize(t,r),this._rttTransparent.onResize(t,r),this.render()}},{key:"computeBoundingBoxMeshes",value:function(e){for(var t=[1/0,1/0,1/0,-1/0,-1/0,-1/0],r=0,n=e.length;r<n;++r){var i=e[r].computeWorldBound();i[0]<t[0]&&(t[0]=i[0]),i[1]<t[1]&&(t[1]=i[1]),i[2]<t[2]&&(t[2]=i[2]),i[3]>t[3]&&(t[3]=i[3]),i[4]>t[4]&&(t[4]=i[4]),i[5]>t[5]&&(t[5]=i[5])}return t}},{key:"computeBoundingBoxScene",value:function(){var e=this._meshes.slice();return e.push(this._grid),this._sculptManager.addSculptToScene(e),this.computeBoundingBoxMeshes(e)}},{key:"normalizeAndCenterMeshes",value:function(e){var t=this.computeBoundingBoxMeshes(e),r=u.default.SCALE/a.vec3.dist([t[0],t[1],t[2]],[t[3],t[4],t[5]]),n=a.mat4.create();a.mat4.scale(n,n,[r,r,r]),a.mat4.translate(n,n,[.5*-(t[0]+t[3]),.5*-(t[1]+t[4]),.5*-(t[2]+t[5])]);for(var i=0,s=e.length;i<s;++i){var o=e[i].getMatrix();a.mat4.mul(o,n,o)}}},{key:"addSphere",value:function(){var e=new m.default(_.default.createCube(this._gl));return e.normalizeSize(),this.subdivideClamp(e),this.addNewMesh(e)}},{key:"addCube",value:function(){var e=new m.default(_.default.createCube(this._gl));return e.normalizeSize(),a.mat4.scale(e.getMatrix(),e.getMatrix(),[.7,.7,.7]),this.subdivideClamp(e,!0),this.addNewMesh(e)}},{key:"addCylinder",value:function(){var e=new m.default(_.default.createCylinder(this._gl));return e.normalizeSize(),a.mat4.scale(e.getMatrix(),e.getMatrix(),[.7,.7,.7]),this.subdivideClamp(e),this.addNewMesh(e)}},{key:"addTorus",value:function(e){var t=new m.default(_.default.createTorus(this._gl,this._torusLength,this._torusWidth,this._torusRadius,this._torusRadial,this._torusTubular));if(e){t.setShowWireframe(!0);var r=.3*u.default.SCALE;return a.mat4.scale(t.getMatrix(),t.getMatrix(),[r,r,r]),void(this._meshPreview=t)}t.normalizeSize(),this.subdivideClamp(t),this.addNewMesh(t)}},{key:"subdivideClamp",value:function(e,t){for(c.default.LINEAR=!!t;e.getNbFaces()<5e4;)e.addLevel();e._meshes.splice(0,Math.min(e._meshes.length-4,4)),e._sel=e._meshes.length-1,c.default.LINEAR=!1}},{key:"addNewMesh",value:function(e){return this._meshes.push(e),this._stateManager.pushStateAdd(e),this.setMesh(e),e}},{key:"loadScene",value:function(e,t){var r;"obj"===t?r=h.default.importOBJ(e,this._gl):"sgl"===t?r=h.default.importSGL(e,this._gl,this):"stl"===t?r=h.default.importSTL(e,this._gl):"ply"===t&&(r=h.default.importPLY(e,this._gl));var n=r.length;if(0!==n){for(var i=this._meshes,a=0;a<n;++a){var s=r[a]=new m.default(r[a]);!this._vertexSRGB&&s.getColors()&&u.default.convertArrayVec3toSRGB(s.getColors()),s.init(),s.initRender(),i.push(s)}return this._autoMatrix&&this.normalizeAndCenterMeshes(r),this._stateManager.pushStateAdd(r),this.setMesh(i[i.length-1]),this.resetCameraMeshes(r),r}}},{key:"clearScene",value:function(){this.getStateManager().reset(),this.getMeshes().length=0,this.getCamera().resetView(),this.setMesh(null),this._action=o.default.Action.NOTHING}},{key:"deleteCurrentSelection",value:function(){this._mesh&&(this.removeMeshes(this._selectMeshes),this._stateManager.pushStateRemove(this._selectMeshes.slice()),this._selectMeshes.length=0,this.setMesh(null))}},{key:"removeMeshes",value:function(e){for(var t=this._meshes,r=0;r<e.length;++r)t.splice(this.getIndexMesh(e[r]),1)}},{key:"getIndexMesh",value:function(e,t){for(var r=t?this._selectMeshes:this._meshes,n=e.getID(),i=0,a=r.length;i<a;++i){var s=r[i];if(s===e||s.getID()===n)return i}return-1}},{key:"getIndexSelectMesh",value:function(e){return this.getIndexMesh(e,!0)}},{key:"replaceMesh",value:function(e,t){var r=this.getIndexMesh(e);r>=0&&(this._meshes[r]=t),this._mesh===e&&this.setMesh(t)}},{key:"onLoadAlphaImage",value:function(e,t,r){var n=document.createElement("canvas");n.width=e.width,n.height=e.height;var i=n.getContext("2d");i.drawImage(e,0,0);for(var a=i.getImageData(0,0,e.width,e.height).data,s=a.subarray(0,a.length/4),o=0,u=0,l=s.length;o<l;++o,u+=4)s[o]=Math.round((a[u]+a[u+1]+a[u+2])/3);var c={};c[t=p.default.addAlpha(s,e.width,e.height,t)._name]=t,this.getGui().addAlphaOptions(c),r&&r._ctrlAlpha&&r._ctrlAlpha.setValue(t)}}]),e}();t.default=S},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(48)),s=n(r(17)),o=n(r(2)),u=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=t,this._toolIndex=o.default.Tools.BRUSH,this._tools=[],this._symmetry=!0,this._continuous=!1,this._sculptTimer=-1,this._selection=new a.default(t._gl),this.init()}return function(e,t,r){t&&i(e.prototype,t),r&&i(e,r)}(e,[{key:"setToolIndex",value:function(e){this._toolIndex=e}},{key:"getToolIndex",value:function(){return this._toolIndex}},{key:"getCurrentTool",value:function(){return this._tools[this._toolIndex]}},{key:"getSymmetry",value:function(){return this._symmetry}},{key:"getTool",value:function(e){return this._tools[e]}},{key:"getSelection",value:function(){return this._selection}},{key:"init",value:function(){for(var e=this._main,t=this._tools,r=0,n=s.default.length;r<n;++r)s.default[r]&&(t[r]=new s.default[r](e))}},{key:"canBeContinuous",value:function(){switch(this._toolIndex){case o.default.Tools.TWIST:case o.default.Tools.MOVE:case o.default.Tools.DRAG:case o.default.Tools.LOCALSCALE:case o.default.Tools.TRANSFORM:return!1;default:return!0}}},{key:"isUsingContinuous",value:function(){return this._continuous&&this.canBeContinuous()}},{key:"start",value:function(e){var t=this.getCurrentTool(),r=t.start(e);return this._main.getPicking().getMesh()&&this.isUsingContinuous()&&(this._sculptTimer=window.setInterval(t._cbContinuous,16.6)),r}},{key:"end",value:function(){this.getCurrentTool().end(),-1!==this._sculptTimer&&(clearInterval(this._sculptTimer),this._sculptTimer=-1)}},{key:"preUpdate",value:function(){this.getCurrentTool().preUpdate(this.canBeContinuous())}},{key:"update",value:function(){this.isUsingContinuous()||this.getCurrentTool().update()}},{key:"postRender",value:function(){this.getCurrentTool().postRender(this._selection)}},{key:"addSculptToScene",value:function(e){return this.getCurrentTool().addSculptToScene(e)}}]),e}();t.default=u},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(1),s=n(r(14)),o=n(r(12)),u=n(r(2)),l=a.mat4.create(),c=a.mat4.create(),h=[0,0,0],f=[0,0,0],d=[0,0,1],p=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._gl=t,this._circleBuffer=new s.default(t,t.ARRAY_BUFFER,t.STATIC_DRAW),this._dotBuffer=new s.default(t,t.ARRAY_BUFFER,t.STATIC_DRAW),this._cacheDotMVP=a.mat4.create(),this._cacheDotSymMVP=a.mat4.create(),this._cacheCircleMVP=a.mat4.create(),this._color=new Float32Array([.8,0,0]),this._offsetX=0,this._isEditMode=!1,this.init()}return function(e,t,r){t&&i(e.prototype,t),r&&i(e,r)}(e,[{key:"getGL",value:function(){return this._gl}},{key:"getCircleBuffer",value:function(){return this._circleBuffer}},{key:"getDotBuffer",value:function(){return this._dotBuffer}},{key:"getCircleMVP",value:function(){return this._cacheCircleMVP}},{key:"getDotMVP",value:function(){return this._cacheDotMVP}},{key:"getDotSymmetryMVP",value:function(){return this._cacheDotSymMVP}},{key:"getColor",value:function(){return this._color}},{key:"setIsEditMode",value:function(e){this._isEditMode=e}},{key:"getIsEditMode",value:function(){return this._isEditMode}},{key:"setOffsetX",value:function(e){this._offsetX=e}},{key:"getOffsetX",value:function(){return this._offsetX}},{key:"init",value:function(){this.getCircleBuffer().update(this._getCircleVertices(1)),this.getDotBuffer().update(this._getDotVertices(.05,10))}},{key:"release",value:function(){this.getCircleBuffer().release(),this.getDotBuffer().release()}},{key:"_getCircleVertices",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=2*Math.PI,i=r?1:0,a=r?t+2:t,s=new Float32Array(3*a),o=i;o<a;++o){var u=3*o,l=n*o/t;s[u]=Math.cos(l)*e,s[u+1]=Math.sin(l)*e}return s}},{key:"_getDotVertices",value:function(e,t){return this._getCircleVertices(e,t,!0)}},{key:"_updateMatricesBackground",value:function(e,t){var r=t.getSculptManager().getCurrentTool().getScreenRadius(),n=.5*e._width,i=.5*e._height;a.mat4.ortho(l,-n,n,-i,i,-10,10),a.mat4.identity(c),a.mat4.translate(c,c,a.vec3.set(h,-n+t._mouseX+this._offsetX,i-t._mouseY,0)),a.mat4.scale(this._cacheCircleMVP,c,a.vec3.set(h,r,r,r)),a.mat4.mul(this._cacheCircleMVP,l,this._cacheCircleMVP),a.mat4.scale(this._cacheDotMVP,c,a.vec3.set(h,50,50,50)),a.mat4.mul(this._cacheDotMVP,l,this._cacheDotMVP),a.mat4.scale(this._cacheDotSymMVP,this._cacheDotSymMVP,[0,0,0])}},{key:"_updateMatricesMesh",value:function(e,t){var r=t.getPicking(),n=t.getPickingSymmetry(),i=Math.sqrt(r.computeWorldRadius2(!0)),s=t.getSculptManager().getCurrentTool().getScreenRadius(),o=r.getMesh(),u=i/s*50;r.polyLerp(o.getNormals(),f),a.vec3.transformMat3(f,f,a.mat3.normalFromMat4(c,o.getMatrix())),a.vec3.normalize(f,f);var p=Math.acos(a.vec3.dot(d,f));a.vec3.cross(f,d,f),a.mat4.identity(c),a.mat4.translate(c,c,a.vec3.transformMat4(h,r.getIntersectionPoint(),o.getMatrix())),a.mat4.rotate(c,c,p,f),a.mat4.mul(l,e.getProjection(),e.getView()),a.mat4.scale(this._cacheCircleMVP,c,a.vec3.set(h,i,i,i)),a.mat4.mul(this._cacheCircleMVP,l,this._cacheCircleMVP),a.mat4.scale(this._cacheDotMVP,c,a.vec3.set(h,u,u,u)),a.mat4.mul(this._cacheDotMVP,l,this._cacheDotMVP),a.vec3.transformMat4(h,n.getIntersectionPoint(),o.getMatrix()),a.mat4.identity(c),a.mat4.translate(c,c,h),a.mat4.rotate(c,c,p,f),a.mat4.scale(c,c,a.vec3.set(h,u,u,u)),a.mat4.mul(this._cacheDotSymMVP,l,c)}},{key:"render",value:function(e){var t=e.getPicking().getMesh()&&!this._isEditMode;t?this._updateMatricesMesh(e.getCamera(),e):this._updateMatricesBackground(e.getCamera(),e);var r=e._action===u.default.Action.NOTHING;a.vec3.set(this._color,.8,r&&t?0:.4,0),o.default[u.default.Shader.SELECTION].getOrCreate(this._gl).draw(this,r,e.getSculptManager().getSymmetry()),this._isEditMode=!1}}]),e}();t.default=p},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(1),a=n(r(5)),s=n(r(4)),o=n(r(52)),u=n(r(3)),l=s.default.getCopy();l.vertexName=l.fragmentName="ShadingPBR",l.textures={};var c="/components/em-sculptgl/app/resources/environments/";l.environments=[{path:c+"footPrint.bin",sph:[.96097,.856821,1.11124,-.313999,-.358144,-.625599,.0870941,.1109,.171528,-.100569,-.0498991,-.0302566,.02047,.0151743,.0182682,-.00652953,-.0188746,-.0525354,.00192821,-.0279455,-.110808,-.0180287,-.0227345,-.0422744,.0139192,-.0187345,-.0812033],name:(0,u.default)("envFootPrint")},{path:c+"glazedPatio.bin",sph:[.475424,.460106,.407626,-.0626622,-.0978501,-.148369,-.029662,-.022522,-.0109794,-.0893952,-.116715,-.139033,.0450059,.0514445,.0619667,.00471057,.00393219,.00522881,-.0508041,-.0540791,-.0530655,-.0278953,-.0258599,-.0191718,-.0137735,-.0186312,-.0286948],name:(0,u.default)("envGlazedPatio")},{path:c+"nicolausChurch.bin",sph:[1.67609,1.52776,1.05807,-.261794,-.293249,-.225056,.0371792,.0263728,-.0174064,.142577,.121132,.0724402,.00827981,.00263222,.00184229,.0208164,.0128967,.0139606,.0795516,.0909961,.0897778,.058084,.0541786,.0401144,-.0664757,-.0587091,-.0386655],name:(0,u.default)("envNicolausChurch")},{path:c+"terrace.bin",sph:[.688602,.636799,.515733,-.192892,-.219448,-.242244,.126328,.124547,.0928089,.308754,.307826,.214901,-.0713295,-.0740211,-.0583892,-.0283229,-.0290954,-.0224256,-.030012,-.0302393,-.0280645,.0766113,.0653549,.0388244,.104034,.0751443,.0221583],name:(0,u.default)("envTerrace")},{path:c+"bryantPark.bin",sph:[.583073,.794556,.966801,-.218899,-.334516,-.690954,-.0581536,-.0912214,-.13112,.0180201,.0683966,.157536,-.0427475,-.073612,-.112892,.0490024,.06527,.0841072,-.0243839,-.0429701,-.0792229,-.0441213,-.0562622,-.0728875,-.0267015,-.0586719,-.11978],name:(0,u.default)("envBryantPark")}];var h=(0,a.default)();l.idEnv=Math.min(h.environment,l.environments.length-1),l.exposure=Math.min(h.exposure,5),l.uniforms={},l.attributes={},l.uniformNames=["uIblTransform","uTexture0","uAlbedo","uRoughness","uMetallic","uExposure","uSPH"],Array.prototype.push.apply(l.uniformNames,s.default.uniformNames.commonUniforms),l.vertex=["attribute vec3 aVertex;","attribute vec3 aNormal;","attribute vec3 aColor;","attribute vec3 aMaterial;",s.default.strings.vertUniforms,"uniform float uRoughness;","uniform float uMetallic;","uniform vec3 uAlbedo;","varying vec3 vVertex;","varying vec3 vNormal;","varying vec3 vAlbedo;","varying float vRoughness;","varying float vMetallic;","varying float vMasking;","void main() {","  vAlbedo = uAlbedo.x >= 0.0 ? uAlbedo : aColor;","  vRoughness = uRoughness >= 0.0 ? uRoughness : aMaterial.x;","  vMetallic = uMetallic >= 0.0 ? uMetallic : aMaterial.y;","  vMasking = aMaterial.z;","  vNormal = mix(aNormal, uEN * aNormal, vMasking);","  vNormal = normalize(uN * vNormal);","  vec4 vertex4 = vec4(aVertex, 1.0);","  vertex4 = mix(vertex4, uEM * vertex4, vMasking);","  vVertex = vec3(uMV * vertex4);","  gl_Position = uMVP * vertex4;","}"].join("\n"),l.fragment=["varying vec3 vVertex;","varying vec3 vNormal;","varying vec3 vAlbedo;","varying float vRoughness;","varying float vMetallic;","uniform float uAlpha;","uniform vec3 uSPH[9];",s.default.strings.fragColorUniforms,s.default.strings.fragColorFunction,o.default,"","void main(void) {","  vec3 normal = getNormal();","  float roughness = max( 0.0001, vRoughness );","  vec3 linColor = sRGBToLinear(vAlbedo);","  vec3 albedo = linColor * (1.0 - vMetallic);","  vec3 specular = mix( vec3(0.04), linColor, vMetallic);","","  vec3 color = uExposure * computeIBL_UE4( normal, -normalize(vVertex), albedo, roughness, specular );","  gl_FragColor = encodeFragColor(color, uAlpha);","}"].join("\n"),l.onLoadEnvironment=function(e,t,r,n){(200===e.status||e.response&&e.response.byteLength)&&(n.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,n.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1024,1024,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(e.response)),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindTexture(t.TEXTURE_2D,null),r&&r.render())},l.getOrCreateEnvironment=function(e,t,r){if(void 0!==r.texture)return r.texture;r.texture=null;var n=new XMLHttpRequest;return n.open("GET",r.path,!0),n.responseType="arraybuffer",n.onload=l.onLoadEnvironment.bind(this,n,e,t,r),n.send(null),null},l.getOrCreateSPH=function(e){if(e.sphCoef)return e.sphCoef;for(var t=1/(2*Math.sqrt(Math.PI)),r=-.5*Math.sqrt(3/Math.PI),n=-r,i=r,a=.5*Math.sqrt(15/Math.PI),s=-a,o=.25*Math.sqrt(5/Math.PI),u=s,l=.25*Math.sqrt(15/Math.PI),c=[t,t,t,r,r,r,n,n,n,i,i,i,a,a,a,s,s,s,o,o,o,u,u,u,l,l,l],h=e.sphCoef=new Float32Array(27),f=e.sph,d=0;d<27;++d)h[d]=f[d]*c[d];return h};var f=i.mat3.create();l.updateUniforms=function(e,t){var r=e.getGL(),n=this.uniforms;i.mat3.fromMat4(f,t.getCamera().getView()),r.uniformMatrix3fv(n.uIblTransform,!1,i.mat3.transpose(f,f)),r.uniform3fv(n.uAlbedo,e.getAlbedo()),r.uniform1f(n.uRoughness,e.getRoughness()),r.uniform1f(n.uMetallic,e.getMetallic()),r.uniform1f(n.uExposure,l.exposure);var a=l.environments[l.idEnv];r.uniform3fv(n.uSPH,l.getOrCreateSPH(a)),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,l.getOrCreateEnvironment(r,t,a)||this.getDummyTexture(r)),r.uniform1i(n.uTexture0,0),s.default.updateUniforms.call(this,e,t)};var d=l;t.default=d},function(e,t){e.exports="// reference\r\n// https://www.khronos.org/registry/gles/extensions/EXT/EXT_sRGB.txt\r\n\r\n#define LIN_SRGB(x) x < 0.0031308 ? x * 12.92 : 1.055 * pow(x, 1.0/2.4) - 0.055\r\nfloat linearTosRGB(const in float c) {\r\n    return LIN_SRGB(c);\r\n}\r\nvec3 linearTosRGB(const in vec3 c) {\r\n    return vec3(LIN_SRGB(c.r), LIN_SRGB(c.g), LIN_SRGB(c.b));\r\n}\r\nvec4 linearTosRGB(const in vec4 c) {\r\n    return vec4(LIN_SRGB(c.r), LIN_SRGB(c.g), LIN_SRGB(c.b), c.a);\r\n}\r\n\r\n#define SRGB_LIN(x) x < 0.04045 ? x * (1.0 / 12.92) : pow((x + 0.055) * (1.0 / 1.055), 2.4)\r\nfloat sRGBToLinear(const in float c) {\r\n    return SRGB_LIN(c);\r\n}\r\nvec3 sRGBToLinear(const in vec3 c) {\r\n    return vec3(SRGB_LIN(c.r), SRGB_LIN(c.g), SRGB_LIN(c.b));\r\n}\r\nvec4 sRGBToLinear(const in vec4 c) {\r\n    return vec4(SRGB_LIN(c.r), SRGB_LIN(c.g), SRGB_LIN(c.b), c.a);\r\n}\r\n\r\n#define RANGE 5.0\r\n// http://graphicrants.blogspot.fr/2009/04/rgbm-color-encoding.html\r\nvec4 encodeRGBM(const in vec3 col) {\r\n    vec4 rgbm;\r\n    vec3 color = col / RANGE;\r\n    rgbm.a = clamp( max( max( color.r, color.g ), max( color.b, 1e-6 ) ), 0.0, 1.0 );\r\n    rgbm.a = ceil( rgbm.a * 255.0 ) / 255.0;\r\n    rgbm.rgb = color / rgbm.a;\r\n    return rgbm;\r\n}\r\n\r\nvec3 decodeRGBM(const in vec4 col) {\r\n  return RANGE * col.rgb * col.a;\r\n}\r\n"},function(e,t){e.exports="// http://madebyevan.com/shaders/curvature/\r\n#extension GL_OES_standard_derivatives : enable\r\nvec3 computeCurvature( const in vec3 vertex, const in vec3 normal, const in vec3 color, const in float str, const in float fov) {\r\n  if(str < 1e-3)\r\n    return color;\r\n#ifndef GL_OES_standard_derivatives\r\n    return color * pow(length(normal), str * 100.0);\r\n#else\r\n  vec3 n = normalize(normal);\r\n  // Compute curvature\r\n  vec3 dx = dFdx(n);\r\n  vec3 dy = dFdy(n);\r\n  vec3 xneg = n - dx;\r\n  vec3 xpos = n + dx;\r\n  vec3 yneg = n - dy;\r\n  vec3 ypos = n + dy;\r\n  // fov < 0.0 means ortho\r\n  float depth = fov > 0.0 ? length(vertex) * fov : -fov;\r\n  float cur = (cross(xneg, xpos).y - cross(yneg, ypos).x) * str * 80.0 / depth;\r\n  return mix(mix(color, color * 0.3, clamp(-cur * 15.0, 0.0, 1.0)), color * 2.0, clamp(cur * 25.0, 0.0, 1.0));\r\n#endif\r\n}\r\n"},function(e,t){e.exports="#define PI 3.1415926535897932384626433832795\r\n#define PI_2 (2.0*3.1415926535897932384626433832795)\r\n#define INV_PI 1.0/PI\r\n#define INV_LOG2 1.4426950408889634073599246810019\r\n\r\nuniform sampler2D uTexture0;\r\nuniform float uExposure;\r\nuniform mat3 uIblTransform;\r\n\r\nvec2 environmentSize = vec2(1024, 512);\r\nvec2 environmentLodRange = vec2(10, 5);\r\n\r\nconst mat3 LUVInverse = mat3( 6.0013, -2.700, -1.7995, -1.332, 3.1029, -5.7720, 0.3007, -1.088, 5.6268 );\r\nvec3 LUVToRGB( const in vec4 vLogLuv ) {\r\n  float Le = vLogLuv.z * 255.0 + vLogLuv.w;\r\n  vec3 Xp_Y_XYZp;\r\n  Xp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\r\n  Xp_Y_XYZp.z = Xp_Y_XYZp.y / vLogLuv.y;\r\n  Xp_Y_XYZp.x = vLogLuv.x * Xp_Y_XYZp.z;\r\n  return max(LUVInverse * Xp_Y_XYZp, 0.0);\r\n}\r\n\r\nvec2 computeUVForMipmap( const in float level, const in vec2 uv, const in float size, const in float maxLOD ) {\r\n  float widthForLevel = exp2( maxLOD - level);\r\n  vec2 uvSpaceLocal =  vec2(1.0) + uv * vec2(widthForLevel - 2.0, widthForLevel * 0.5 - 2.0);\r\n  uvSpaceLocal.y += size - widthForLevel;\r\n  return uvSpaceLocal / size;\r\n}\r\n\r\nvec2 normalToPanoramaUVY( const in vec3 dir ) {\r\n  float n = length(dir.xz);\r\n  vec2 pos = vec2( (n>0.0000001) ? max(-1.0,dir.x / n) : 0.0, dir.y);\r\n  if ( pos.x > 0.0 ) pos.x = min( 0.999999, pos.x );\r\n  pos = acos(pos)*INV_PI;\r\n  pos.x = (dir.z > 0.0) ? pos.x*0.5 : 1.0-(pos.x*0.5);\r\n  pos.x = mod(pos.x-0.25+1.0, 1.0 );\r\n  pos.y = 1.0-pos.y;\r\n  return pos;\r\n}\r\n\r\nvec3 texturePanoramaLod(const in sampler2D texture, const in vec2 size , const in vec3 direction, const in float lodInput, const in float maxLOD ) {\r\n  float lod = min( maxLOD, lodInput );\r\n  vec2 uvBase = normalToPanoramaUVY( direction );\r\n  vec3 texel0 = LUVToRGB(texture2D( texture, computeUVForMipmap(floor(lod), uvBase, size.x, maxLOD )));\r\n  vec3 texel1 = LUVToRGB(texture2D( texture, computeUVForMipmap(ceil(lod), uvBase, size.x, maxLOD )));\r\n  return mix(texel0, texel1, fract( lod ) );\r\n}\r\n\r\nvec3 integrateBRDFApprox(const in vec3 specular, float roughness, float NoV) {\r\n  const vec4 c0 = vec4(-1, -0.0275, -0.572, 0.022);\r\n  const vec4 c1 = vec4(1, 0.0425, 1.04, -0.04);\r\n  vec4 r = roughness * c0 + c1;\r\n  float a004 = min(r.x * r.x, exp2(-9.28 * NoV)) * r.x + r.y;\r\n  vec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;\r\n  return specular * AB.x + AB.y;\r\n}\r\n\r\nvec3 getSpecularDominantDir( const in vec3 N, const in vec3 R, const in float realRoughness ) {\r\n    float smoothness = 1.0 - realRoughness;\r\n    return mix( N, R, smoothness * ( sqrt( smoothness ) + realRoughness ) );\r\n}\r\n\r\nvec3 approximateSpecularIBL( const in vec3 specularColor, float rLinear, const in vec3 N, const in vec3 V ) {\r\n  float NoV = clamp( dot( N, V ), 0.0, 1.0 );\r\n  vec3 R = normalize( (2.0 * NoV ) * N - V);\r\n  R = getSpecularDominantDir(N, R, rLinear);\r\n  vec3 prefilteredColor = texturePanoramaLod( uTexture0, environmentSize, uIblTransform * R, rLinear * environmentLodRange[1], environmentLodRange[0] );\r\n  return prefilteredColor * integrateBRDFApprox(specularColor, rLinear, NoV);\r\n}\r\n\r\n// expect shCoefs uniform\r\n// https://github.com/cedricpinson/envtools/blob/master/Cubemap.cpp#L523\r\nvec3 sphericalHarmonics( const in vec3 N ) {\r\n  float x = N.x;\r\n  float y = N.y;\r\n  float z = N.z;\r\n  vec3 result = uSPH[0] + uSPH[1] * y + uSPH[2] * z + uSPH[3] * x + uSPH[4] * y * x + uSPH[5] * y * z + uSPH[6] * (3.0 * z * z - 1.0) + uSPH[7] * (z * x) + uSPH[8] * (x*x - y*y);\r\n  return max(result, vec3(0.0));\r\n}\r\n\r\nvec3 computeIBL_UE4( const in vec3 N, const in vec3 V, const in vec3 albedo, const in float roughness, const in vec3 specular) {\r\n  vec3 color = vec3(0.0);\r\n  if ( albedo != color )\r\n    color += albedo * sphericalHarmonics( uIblTransform * N );\r\n  color += approximateSpecularIBL(specular, roughness, N, V);\r\n  return color;\r\n}\r\n"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={backgroundTitle:"Background",backgroundReset:"Reset",backgroundImport:"Import (jpg, png...)",backgroundFill:"Fill",cameraTitle:"Camera",cameraReset:"View",cameraCenter:"Reset (bar)",cameraFront:"Front (F)",cameraLeft:"Left (L)",cameraTop:"Top (T)",cameraMode:"Mode",cameraOrbit:"Orbit (Turntable)",cameraSpherical:"Spherical (Trackball)",cameraPlane:"Plane (Trackball)",cameraProjection:"Projection",cameraPerspective:"Perspective",cameraOrthographic:"Orthographic",cameraFov:"Fov",cameraPivot:"Picking pivot",fileTitle:"Files (import/export)",fileImportTitle:"Import",fileAdd:"Add (obj, sgl, ply, stl)",fileAutoMatrix:"Scale and center",fileVertexSRGB:"sRGB vertex color",fileExportSceneTitle:"Export Scene",fileExportAll:"Export all",fileExportSGL:"Save .sgl (SculptGL)",fileExportOBJ:"Save .obj",fileExportPLY:"Save .ply",fileExportSTL:"Save .stl",sceneTitle:"Scene",sceneReset:"Clear scene",sceneAddSphere:"Add sphere",sceneAddCube:"Add cube",sceneAddCylinder:"Add cylinder",sceneAddTorus:"Add torus",sceneSelection:"Selection",sceneMerge:"Merge selection",meshTitle:"Mesh",meshNbVertices:"Vertex : ",meshNbFaces:"Faces : ",topologyTitle:"Topology",multiresTitle:"Multiresolution",multiresSubdivide:"Subdivide",multiresReverse:"Reverse",multiresResolution:"Resolution",multiresNoLower:"There is no lower resolution level.",multiresNoHigher:"There is no higher resolution level.",multiresDelHigher:"Delete higher",multiresDelLower:"Delete lower",multiresSelectLowest:"Select the lowest resolution before reversing.",multiresSelectHighest:"Select the highest resolution before subdividing.",multiresWarnBigMesh:function(e){return"The next subdivision level will reach "+e+' faces.\nIf you know what you are doing, click again on "subdivide".'},multiresNotReversible:"Sorry it is not possile to reverse this mesh.\nThe mesh is not a product of a (loop-catmull) subdivision surface on a manifold mesh.",remeshTitle:"Voxel Remeshing",remeshRemesh:"Remesh",remeshResolution:"Resolution",remeshBlock:"Block",dynamicTitle:"Dynamic Topology",dynamicActivated:"Activated (no quads)",dynamicSubdivision:"Subdivision",dynamicDecimation:"Decimation",dynamicLinear:"Linear subdivision",sculptTitle:"Sculpting & Painting",sculptBrush:"Brush",sculptInflate:"Inflate",sculptTwist:"Twist",sculptSmooth:"Smooth (-Shift)",sculptFlatten:"Flatten",sculptPinch:"Pinch",sculptCrease:"Crease",sculptDrag:"Drag",sculptPaint:"Paint",sculptMasking:"Masking (-Ctrl)",sculptMove:"Move",sculptLocalScale:"Local scale",sculptTransform:"Transform (E)",sculptCommon:"Common",sculptTool:"Tool",sculptSymmetry:"Symmetry",sculptContinuous:"Continuous",sculptRadius:"Radius (-X)",sculptIntensity:"Intensity (-C)",sculptHardness:"Hardness",sculptCulling:"Thin surface (front vertex only)",sculptAlphaTitle:"Alpha",sculptLockPositon:"Lock position",sculptAlphaTex:"Texture",sculptImportAlpha:"Import alpha tex (jpg, png...)",sculptNegative:"Negative (N or -Alt)",sculptColor:"Albedo",sculptRoughness:"Roughness",sculptMetallic:"Metallic",sculptClay:"Clay",sculptAccumulate:"Accumulate (no limit per stroke)",sculptColorGlobal:"Global",sculptPickColor:"Material / Color picker (-S)",sculptTangentialSmoothing:"Relax only",sculptTopologicalCheck:"Topological check",sculptMoveAlongNormal:"Move along normal (N or -Alt)",sculptMaskingClear:"Clear (-Ctrl + Drag)",sculptMaskingInvert:"Invert (-Ctrl + Click)",sculptMaskingBlur:"Blur",sculptMaskingSharpen:"Sharpen",sculptPBRTitle:"PBR materials",sculptPaintAll:"Paint all",sculptExtractTitle:"Extract",sculptExtractThickness:"Thickness",sculptExtractAction:"Extract !",stateTitle:"History",stateUndo:"Undo",stateRedo:"Redo",stateMaxStack:"Max Stack",pressureTitle:"Tablet pressure",pressureRadius:"Pressure radius",pressureIntensity:"Pressure intensity",renderingTitle:"Rendering",renderingGrid:"Show grid",renderingSymmetryLine:"Show mirror line",renderingMatcap:"Matcap",renderingCurvature:"Curvature",renderingPBR:"PBR",renderingTransparency:"Transparency",renderingNormal:"Normal shader",renderingUV:"UV shader",renderingShader:"Shader",renderingMaterial:"Material",renderingImportUV:"Import (jpg, png...)",renderingImportMatcap:"Import (jpg, png...)",renderingExtra:"Extra",renderingFlat:"Flat shading",renderingWireframe:"Wireframe (W)",renderingExposure:"Exposure",renderingEnvironment:"Environment",renderingIsolate:"Isolate/Show (I)",renderingFilmic:"Filmic tonemapping",contour:"Contour",contourShow:"Show contour",contourColor:"Color",darkenUnselected:"Darken unselected",resolution:"Resolution",matcapPearl:"Pearl",matcapClay:"Clay",matcapSkin:"Skin",matcapGreen:"Green",matcapWhite:"White",sketchfabTitle:"Go to Sketchfab !",sketchfabUpload:"Upload",sketchfabUploadMessage:'Please enter your sketchfab API Key.\nYou can also leave "guest" to upload anonymously.\n(a new window will pop up when the uploading and processing is finished)',sketchfabUploadError:function(e){return"Sketchfab upload error :\n"+e},sketchfabUploadSuccess:"Upload success !\nHere is your link :",sketchfabAbort:"Abort the last upload ?",sketchfabUploadProcessing:"Processing...\nYour model will be available at :",about:"About & Help",alphaNone:"None",alphaSquare:"Square",alphaSkin:"Skin",envFootPrint:"Foot Print",envGlazedPatio:"Glazed Patio",envNicolausChurch:"St Nicolaus church",envTerrace:"Terrace",envBryantPark:"BryantPark",language:"Language",extraUI:"Extra UI",overall:"Overall",advanced:"Advanced",widget:"Widget",back:"Tack",text:"Text",border:"Border"};t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={backgroundTitle:"背景",backgroundReset:"重设",backgroundImport:"插入 (jpg, png...)",backgroundFill:"填充",cameraTitle:"镜头",cameraReset:"镜头重设",cameraCenter:"原点(空白键)",cameraFront:"前视角 (F)",cameraLeft:"左视角 (L)",cameraTop:"俯视角 (T)",cameraMode:"模式",cameraOrbit:"轨道 (转盘)",cameraSpherical:"球面 (轨迹球)",cameraPlane:"平面 (轨迹球)",cameraProjection:"投影",cameraPerspective:"透视角",cameraOrthographic:"等视角",cameraFov:"视野范围",cameraPivot:"选择轴心",fileTitle:"文件 (导入/导出)",fileImportTitle:"导入",fileAdd:"添加(obj, sgl, ply, stl)",fileAutoMatrix:"缩放并置中",fileVertexSRGB:"sRGB 顶点色彩",fileExportSceneTitle:"导出场景",fileExportAll:"导出出口",fileExportSGL:"储存为.sgl (SculptGL)",fileExportOBJ:"储存为.obj",fileExportPLY:"储存为.ply",fileExportSTL:"储存为.stl",sceneTitle:"场景",sceneReset:"重置场景",sceneAddSphere:"加入球体",sceneAddCube:"加入立方体",sceneAddCylinder:"加入圆柱体",sceneAddTorus:"加入圆环",sceneSelection:"选取项目",sceneMerge:"合并选取项目",meshTitle:"网面",meshNbVertices:"顶点 : ",meshNbFaces:"面 : ",topologyTitle:"网面结构(拓扑)",multiresTitle:"多重解析度",multiresSubdivide:"细分",multiresReverse:"反转",multiresResolution:"解析度",multiresNoLower:"没有更低等级的解析度。",multiresNoHigher:"没有更高等级的解析度。",multiresDelHigher:"删除较高等级",multiresDelLower:"删除较低等级",multiresSelectLowest:"反转前请先选择最低的解析度。",multiresSelectHighest:"细分前请先选择最高的解析度。",multiresWarnBigMesh:function(e){return"下一个细分等级会达到 "+e+" 个面。\n若你清楚你自己正在做什么，再点击「细分」一次。"},multiresNotReversible:"抱歉，无法反转此网面。\n此网面不是由流形网面经过细分曲面 (loop-catmull) 而来。",remeshTitle:"立体像素网面重构",remeshRemesh:"网面重构",remeshResolution:"解析度",remeshBlock:"块状重构",dynamicTitle:"动态网面结构",dynamicActivated:"启用 (无四边形)",dynamicSubdivision:"细分",dynamicDecimation:"削减面数",dynamicLinear:"线性细分",sculptTitle:"雕刻和涂绘",sculptBrush:"笔刷",sculptInflate:"膨胀",sculptTwist:"扭转",sculptSmooth:"平滑 (-Shift)",sculptFlatten:"抹平",sculptPinch:"捏塑",sculptCrease:"皱褶",sculptDrag:"拖拉",sculptPaint:"涂绘",sculptMasking:"遮罩 (-Ctrl)",sculptMove:"移动",sculptLocalScale:"局部缩放",sculptTransform:"变形 (E)",sculptCommon:"通用",sculptTool:"工具",sculptSymmetry:"对称",sculptContinuous:"连续",sculptRadius:"半径 (-X)",sculptIntensity:"强度 (-C)",sculptHardness:"硬度",sculptCulling:"薄曲面 (仅影响前面顶点)",sculptAlphaTitle:"透明色版 (Alpha)",sculptLockPositon:"锁定位置",sculptAlphaTex:"纹理",sculptImportAlpha:"导入 alpha 纹理 (jpg, png...)",sculptNegative:"反向 (N 或 -Alt)",sculptColor:"反照率",sculptRoughness:"粗糙度",sculptMetallic:"金属性",sculptClay:"黏土",sculptAccumulate:"累积 (每道笔划无限制)",sculptColorGlobal:"总体",sculptPickColor:"选择材质或颜色 (-S)",sculptTangentialSmoothing:"仅放松",sculptTopologicalCheck:"网面结构检查",sculptMoveAlongNormal:"沿法线方向移动 (N 或 -Alt)",sculptMaskingClear:"清除 (-Ctrl + 拖动)",sculptMaskingInvert:"反转 (-Ctrl + 点击)",sculptMaskingBlur:"模糊",sculptMaskingSharpen:"锐利化",sculptPBRTitle:"PBR 材质",sculptPaintAll:"涂绘全部",sculptExtractTitle:"提取",sculptExtractThickness:"厚度",sculptExtractAction:"提取 !",stateTitle:"记录",stateUndo:"撤销",stateRedo:"取消撤销",stateMaxStack:"最大推叠",pressureTitle:"感压绘图板",pressureRadius:"半径感压",pressureIntensity:"强度感压",renderingTitle:"图形绘算",renderingGrid:"显示格线",renderingSymmetryLine:"显示镜像线",renderingMatcap:"材质捕捉 (Matcap)",renderingCurvature:"曲率",renderingPBR:"物理式绘算(PBR)",renderingTransparency:"透明",renderingNormal:"法线著色器",renderingUV:"UV 著色器",renderingShader:"著色器",renderingMaterial:"材质",renderingImportUV:"导入 (jpg, png...)",renderingImportMatcap:"导入 (jpg, png...)",renderingExtra:"额外",renderingFlat:"平整面",renderingWireframe:"线框 (W)",renderingExposure:"曝光",renderingEnvironment:"环境",renderingIsolate:"隔离/显示 (I)",renderingFilmic:"电影色调对应",contour:"轮廓",contourShow:"显示轮廓",contourColor:"颜色",darkenUnselected:"未选取部分变暗",resolution:"解析度",matcapPearl:"珍珠",matcapClay:"黏土",matcapSkin:"肤色",matcapGreen:"绿色",matcapWhite:"白色",sketchfabTitle:"前往 Sketchfab !",sketchfabUpload:"上传",sketchfabUploadMessage:'请输入你的 sketchfab API 密钥.\n你也可以不填写留下 "guest" 进行匿名上传。\n(当上传中和完成时会跳出新窗口)',sketchfabUploadError:function(e){return"Sketchfab 上传错误 :\n"+e},sketchfabUploadSuccess:"上传成功 !\n这是你的连结 :",sketchfabAbort:"中止最后上传的项目 ?",sketchfabUploadProcessing:"处理中...\n你的模型将会存放在：",about:"关于和说明",alphaNone:"无",alphaSquare:"方块",alphaSkin:"皮肤",envFootPrint:"足迹",envGlazedPatio:"庭院",envNicolausChurch:"圣尼古拉斯教堂",envTerrace:"阳台",envBryantPark:"布莱恩特公园",language:"语言",extraUI:"主题",overall:"整体",advanced:"高级设置",widget:"控件",back:"背景",text:"文字",border:"边框"};t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={backgroundTitle:"背景",backgroundReset:"重設",backgroundImport:"匯入 (jpg, png...)",backgroundFill:"填充",cameraTitle:"鏡頭",cameraReset:"檢視",cameraCenter:"重設 (空白鍵)",cameraFront:"前視角 (F)",cameraLeft:"左視角 (L)",cameraTop:"俯視角 (T)",cameraMode:"模式",cameraOrbit:"軌道 (轉盤)",cameraSpherical:"球面 (軌跡球)",cameraPlane:"平面 (軌跡球)",cameraProjection:"投影",cameraPerspective:"透視角",cameraOrthographic:"等視角",cameraFov:"視野範圍",cameraPivot:"選擇軸心",fileTitle:"檔案 (匯入/匯出)",fileImportTitle:"匯入",fileAdd:"加入 (obj, sgl, ply, stl)",fileAutoMatrix:"縮放並置中",fileVertexSRGB:"sRGB 頂點色彩",fileExportSceneTitle:"匯出場景",fileExportAll:"匯出出口",fileExportSGL:"儲存 .sgl (SculptGL)",fileExportOBJ:"儲存 .obj",fileExportPLY:"儲存 .ply",fileExportSTL:"儲存 .stl",sceneTitle:"場景",sceneReset:"清除場景",sceneAddSphere:"加入球體",sceneAddCube:"加入立方體",sceneAddCylinder:"加入圓柱",sceneAddTorus:"加入圓環",sceneSelection:"選取項目",sceneMerge:"合併選取項目",meshTitle:"網面",meshNbVertices:"頂點 : ",meshNbFaces:"面 : ",topologyTitle:"網面結構(拓撲)",multiresTitle:"多重解析度",multiresSubdivide:"細分",multiresReverse:"反轉",multiresResolution:"解析度",multiresNoLower:"沒有更低等級的解析度。",multiresNoHigher:"沒有更高等級的解析度。",multiresDelHigher:"刪除較高等級",multiresDelLower:"刪除較低等級",multiresSelectLowest:"反轉前請先選擇最低的解析度。",multiresSelectHighest:"細分前請先選擇最高的解析度。",multiresWarnBigMesh:function(e){return"下一個細分等級會達到 "+e+" 個面。\n若你清楚你自己正在做什麼，再點擊「細分」一次。"},multiresNotReversible:"抱歉，無法反轉此網面。\n此網面不是由流形網面經過細分曲面 (loop-catmull) 而來。",remeshTitle:"立體像素網面重構",remeshRemesh:"網面重構",remeshResolution:"解析度",remeshBlock:"塊狀重構",dynamicTitle:"動態網面結構",dynamicActivated:"啟用 (無四邊形)",dynamicSubdivision:"細分",dynamicDecimation:"削減面數",dynamicLinear:"線性細分",sculptTitle:"雕刻和塗繪",sculptBrush:"筆刷",sculptInflate:"膨脹",sculptTwist:"扭轉",sculptSmooth:"平滑 (-Shift)",sculptFlatten:"抹平",sculptPinch:"捏塑",sculptCrease:"皺褶",sculptDrag:"拖拉",sculptPaint:"塗繪",sculptMasking:"遮罩 (-Ctrl)",sculptMove:"移動",sculptLocalScale:"局部縮放",sculptTransform:"變形 (E)",sculptCommon:"通用",sculptTool:"工具",sculptSymmetry:"對稱",sculptContinuous:"連續",sculptRadius:"半徑 (-X)",sculptIntensity:"強度 (-C)",sculptHardness:"硬度",sculptCulling:"薄曲面 (僅影響前面頂點)",sculptAlphaTitle:"透明色版 (Alpha)",sculptLockPositon:"鎖定位置",sculptAlphaTex:"紋理",sculptImportAlpha:"匯入 alpha 紋理 (jpg, png...)",sculptNegative:"反向 (N 或 -Alt)",sculptColor:"反照率",sculptRoughness:"粗糙度",sculptMetallic:"金屬性",sculptClay:"黏土",sculptAccumulate:"累積 (每道筆劃無限制)",sculptColorGlobal:"總體",sculptPickColor:"選擇材質或顏色 (-S)",sculptTangentialSmoothing:"僅放鬆",sculptTopologicalCheck:"網面結構檢查",sculptMoveAlongNormal:"沿法線方向移動 (N 或 -Alt)",sculptMaskingClear:"清除 (-Ctrl + 拖動)",sculptMaskingInvert:"反轉 (-Ctrl + 點擊)",sculptMaskingBlur:"模糊",sculptMaskingSharpen:"銳利化",sculptPBRTitle:"PBR 材質",sculptPaintAll:"塗繪全部",sculptExtractTitle:"提取",sculptExtractThickness:"厚度",sculptExtractAction:"提取 !",stateTitle:"記錄",stateUndo:"復原",stateRedo:"取消復原",stateMaxStack:"最大推疊",pressureTitle:"感壓繪圖板",pressureRadius:"半徑感壓",pressureIntensity:"強度感壓",renderingTitle:"圖形繪算",renderingGrid:"顯示格線",renderingSymmetryLine:"顯示鏡像線",renderingMatcap:"材質捕捉 (Matcap)",renderingCurvature:"曲率",renderingPBR:"物理式繪算(PBR)",renderingTransparency:"透明",renderingNormal:"法線著色器",renderingUV:"UV 著色器",renderingShader:"著色器",renderingMaterial:"材質",renderingImportUV:"匯入 (jpg, png...)",renderingImportMatcap:"匯入 (jpg, png...)",renderingExtra:"額外",renderingFlat:"平整面",renderingWireframe:"線框 (W)",renderingExposure:"曝光",renderingEnvironment:"環境",renderingIsolate:"隔離/顯示 (I)",renderingFilmic:"電影色調對應",contour:"輪廓",contourShow:"顯示輪廓",contourColor:"顏色",darkenUnselected:"未選取部分變暗",resolution:"解析度",matcapPearl:"珍珠",matcapClay:"黏土",matcapSkin:"膚色",matcapGreen:"綠色",matcapWhite:"白色",sketchfabTitle:"前往 Sketchfab !",sketchfabUpload:"上傳",sketchfabUploadMessage:'請輸入你的 sketchfab API 密鑰.\n你也可以不填寫留下 "guest" 進行匿名上傳。\n(當上傳中和完成時會跳出新視窗)',sketchfabUploadError:function(e){return"Sketchfab 上傳錯誤 :\n"+e},sketchfabUploadSuccess:"上傳成功 !\n這是你的連結 :",sketchfabAbort:"中止最後上傳的項目 ?",sketchfabUploadProcessing:"處理中...\n你的模型將會存放在：",about:"關於和說明",alphaNone:"無",alphaSquare:"方塊",alphaSkin:"皮膚",envFootPrint:"足跡",envGlazedPatio:"庭院",envNicolausChurch:"聖尼古拉斯教堂",envTerrace:"陽台",envBryantPark:"布萊恩特公園",language:"語言",extraUI:"主題",overall:"整體",advanced:"高級設置",widget:"控件",back:"背景",text:"文字",border:"邊框"};t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={backgroundTitle:"バックグラウンド",backgroundReset:"リセット",backgroundImport:"インポート  (jpg, png...)",backgroundFill:null,cameraTitle:"カメラ",cameraReset:"View",cameraCenter:null,cameraFront:null,cameraLeft:null,cameraTop:null,cameraMode:"モード",cameraOrbit:null,cameraSpherical:"球体 (Trackball)",cameraPlane:"平面 (Trackball)",cameraProjection:"タイプ",cameraPerspective:"透視投影",cameraOrthographic:"平行投影",cameraFov:"視野",cameraPivot:"ピボット選択",fileTitle:"ファイル (インポート/エクスポート)",fileImportTitle:null,fileAdd:"Add (obj, sgl, ply, stl)",fileAutoMatrix:null,fileVertexSRGB:null,fileExportSceneTitle:null,fileExportAll:null,fileExportSGL:null,fileExportOBJ:null,fileExportPLY:null,fileExportSTL:null,sceneTitle:null,sceneReset:null,sceneAddSphere:null,sceneAddCube:null,sceneAddCylinder:null,sceneAddTorus:null,sceneSelection:null,sceneMerge:null,meshTitle:"メッシュ",meshNbVertices:null,meshNbFaces:null,topologyTitle:null,multiresTitle:null,multiresSubdivide:null,multiresReverse:null,multiresResolution:null,multiresNoLower:null,multiresNoHigher:null,multiresDelHigher:null,multiresDelLower:null,multiresSelectLowest:null,multiresSelectHighest:null,multiresWarnBigMesh:null,multiresNotReversible:null,remeshTitle:null,remeshRemesh:null,remeshResolution:null,remeshBlock:null,dynamicTitle:null,dynamicActivated:null,dynamicSubdivision:null,dynamicDecimation:null,dynamicLinear:null,sculptTitle:null,sculptBrush:"ブラシ",sculptInflate:"膨張",sculptTwist:"回転",sculptSmooth:"スムーズ化 (-Shift)",sculptFlatten:"フラット化",sculptPinch:"つまむ",sculptCrease:"しわ",sculptDrag:"ドラッグ",sculptPaint:"ペイント",sculptMasking:null,sculptMove:null,sculptLocalScale:null,sculptTransform:null,sculptCommon:null,sculptTool:"ツール",sculptSymmetry:"対称加工",sculptContinuous:"連続加工",sculptRadius:"半径 (-X)",sculptIntensity:"明るさ (-C)",sculptHardness:null,sculptCulling:null,sculptAlphaTitle:null,sculptLockPositon:null,sculptAlphaTex:null,sculptImportAlpha:null,sculptNegative:"ネガティブ (N or -Alt)",sculptColor:null,sculptRoughness:null,sculptMetallic:null,sculptClay:"クレイ",sculptAccumulate:null,sculptColorGlobal:null,sculptPickColor:null,sculptTangentialSmoothing:null,sculptTopologicalCheck:null,sculptMoveAlongNormal:null,sculptMaskingClear:null,sculptMaskingInvert:null,sculptMaskingBlur:null,sculptMaskingSharpen:null,sculptPBRTitle:null,sculptPaintAll:null,sculptExtractTitle:null,sculptExtractThickness:null,sculptExtractAction:null,stateTitle:"履歴",stateUndo:"アンドゥ",stateRedo:"リドゥ",stateMaxStack:null,pressureTitle:"ワコムタブレット",pressureRadius:"圧力半径？",pressureIntensity:"圧力の強さ？",renderingTitle:null,renderingGrid:null,renderingSymmetryLine:null,renderingMatcap:null,renderingCurvature:null,renderingPBR:null,renderingTransparency:"透過",renderingNormal:"ノーマル",renderingUV:null,renderingShader:"シェーダー",renderingMaterial:null,renderingImportUV:null,renderingImportMatcap:null,renderingExtra:null,renderingFlat:"フラットシェーディング",renderingWireframe:"ワイヤーフレーム (W)",renderingExposure:null,renderingEnvironment:null,renderingIsolate:null,renderingFilmic:null,contour:null,contourShow:null,contourColor:null,darkenUnselected:null,resolution:null,matcapPearl:null,matcapClay:"クレイ",matcapSkin:"スキン",matcapGreen:null,matcapWhite:null,sketchfabTitle:"Sketchfabへ移動",sketchfabUpload:"アップロード",sketchfabUploadMessage:null,sketchfabUploadError:null,sketchfabUploadSuccess:null,sketchfabAbort:null,sketchfabUploadProcessing:null,about:null,alphaNone:null,alphaSquare:null,alphaSkin:null,envFootPrint:null,envGlazedPatio:null,envNicolausChurch:null,envTerrace:null,envBryantPark:null};t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={backgroundTitle:"배경",backgroundReset:"초기화",backgroundImport:"배경 (jpg, png...)",backgroundFill:"채우기",cameraTitle:"카메라",cameraReset:"뷰",cameraCenter:"초기화 (bar)",cameraFront:"앞쪽 (F)",cameraLeft:"왼쪽 (L)",cameraTop:"위쪽 (T)",cameraMode:"모드",cameraOrbit:"궤도 (Turntable)",cameraSpherical:"구 (Trackball)",cameraPlane:"평면 (Trackball)",cameraProjection:"투사",cameraPerspective:"원근법",cameraOrthographic:"정사영법",cameraFov:"시야각",cameraPivot:"피봇 고르기",fileTitle:"파일 (가져오기/내보내기)",fileImportTitle:"가져오기",fileAdd:"파일 (obj, sgl, ply, stl)",fileAutoMatrix:null,fileVertexSRGB:null,fileExportSceneTitle:"장면 내보내기",fileExportAll:"모두 내보내기",fileExportSGL:"sgl로 저장하기",fileExportOBJ:"obj로 저장하기",fileExportPLY:"ply로 저장하기",fileExportSTL:"stl로 저장하기",sceneTitle:"장면",sceneReset:"장면 초기화",sceneAddSphere:"구 추가하기 ",sceneAddCube:null,sceneAddCylinder:null,sceneAddTorus:null,sceneSelection:null,sceneMerge:null,meshTitle:"메쉬",meshNbVertices:"점들 : ",meshNbFaces:"면들 : ",topologyTitle:"토폴로지",multiresTitle:"다중 해상도",multiresSubdivide:"세분화",multiresReverse:"리버스",multiresResolution:"해상도",multiresNoLower:"더 낮은 해상도가 존재하지 않습니다.",multiresNoHigher:"더 높은 해상도가 존재하지 않습니다.",multiresDelHigher:"더 높은 것을 삭제",multiresDelLower:"더 낮은 것을 삭제",multiresSelectLowest:"리버싱 하기 전에 더 낮은 해상도를 고르세요.",multiresSelectHighest:"세분화 하기 전에 더 높은 해상도를 고르세요",multiresWarnBigMesh:function(e){return"다음 세분화 레벨은 "+e+' 면만큼 도달할 것입니다.\n만약 당신이 무엇을 하는지 안다면 "세분화"를 다시 클릭하세요.'},multiresNotReversible:"이 메쉬는 리버싱할 수 없습니다.\n이 메쉬는 여러가지 메쉬의 표면의 세분화를 product한 것이 아닙니다.(loop-catmull)",remeshTitle:null,remeshRemesh:null,remeshResolution:null,remeshBlock:null,dynamicTitle:null,dynamicActivated:null,dynamicSubdivision:null,dynamicDecimation:null,dynamicLinear:null,sculptTitle:null,sculptBrush:"브러쉬",sculptInflate:null,sculptTwist:null,sculptSmooth:null,sculptFlatten:null,sculptPinch:null,sculptCrease:null,sculptDrag:null,sculptPaint:null,sculptMasking:null,sculptMove:null,sculptLocalScale:null,sculptTransform:null,sculptCommon:null,sculptTool:null,sculptSymmetry:null,sculptContinuous:null,sculptRadius:null,sculptIntensity:null,sculptHardness:null,sculptCulling:null,sculptAlphaTitle:null,sculptLockPositon:null,sculptAlphaTex:null,sculptImportAlpha:null,sculptNegative:null,sculptColor:null,sculptRoughness:null,sculptMetallic:null,sculptClay:null,sculptAccumulate:null,sculptColorGlobal:null,sculptPickColor:null,sculptTangentialSmoothing:null,sculptTopologicalCheck:null,sculptMoveAlongNormal:null,sculptMaskingClear:null,sculptMaskingInvert:null,sculptMaskingBlur:null,sculptMaskingSharpen:null,sculptPBRTitle:null,sculptPaintAll:null,sculptExtractTitle:null,sculptExtractThickness:null,sculptExtractAction:null,stateTitle:"역사",stateUndo:"되돌리기",stateRedo:"다시하기",stateMaxStack:"최대 스택",pressureTitle:"와콤 테블릿",pressureRadius:"압력 반지름",pressureIntensity:"압력 강도",renderingTitle:"렌더링",renderingGrid:"그리드 보이기",renderingSymmetryLine:"대칭선 보이기",renderingMatcap:null,renderingCurvature:null,renderingPBR:null,renderingTransparency:"투명도",renderingNormal:"노말 쉐이더",renderingUV:"UV 쉐이더",renderingShader:"쉐이더",renderingMaterial:"질",renderingImportUV:"가져오기 (jpg, png...)",renderingImportMatcap:"가져오기 (jpg, png...)",renderingExtra:"추가",renderingFlat:"편평한 (느리게)",renderingWireframe:"와이어프레임 (느리게) (W)",renderingExposure:null,renderingEnvironment:null,renderingIsolate:null,renderingFilmic:null,contour:null,contourShow:null,contourColor:null,darkenUnselected:null,resolution:null,matcapPearl:null,matcapClay:null,matcapSkin:null,matcapGreen:null,matcapWhite:null,sketchfabTitle:"Sketchfab으로 가기 !",sketchfabUpload:"올리기",sketchfabUploadMessage:null,sketchfabUploadError:null,sketchfabUploadSuccess:null,sketchfabAbort:null,sketchfabUploadProcessing:null,about:null,alphaNone:null,alphaSquare:null,alphaSkin:null,envFootPrint:null,envGlazedPatio:null,envNicolausChurch:null,envTerrace:null,envBryantPark:null};t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={backgroundTitle:"Фон",backgroundReset:"Сброс",backgroundImport:"Импорт (jpg, png...)",backgroundFill:"Заполнить",cameraTitle:"Камера",cameraReset:"Вид",cameraCenter:"Сброс (bar)",cameraFront:"Спереди (F)",cameraLeft:"Слева (L)",cameraTop:"Сверху (T)",cameraMode:"Режим камеры",cameraOrbit:"Орбита (Вращение)",cameraSpherical:"Сферическая (трекбол)",cameraPlane:"Плоскость (трекбол)",cameraProjection:"Проекция",cameraPerspective:"Перспективная",cameraOrthographic:"Ортогональная",cameraFov:"Угол обзора",cameraPivot:"Выбор вращения",fileTitle:"Файл",fileImportTitle:"Импорт",fileAdd:"Добавить(obj,sgl,ply,stl)",fileAutoMatrix:"Масштаб-вид",fileVertexSRGB:"Цвета вершин sRGB",fileExportSceneTitle:"Экспорт сцены",fileExportAll:"Экспорт все",fileExportSGL:"Сохранить .sgl",fileExportOBJ:"Сохранить .obj",fileExportPLY:"Сохранить .ply",fileExportSTL:"Сохранить .stl",sceneTitle:"Сцена",sceneReset:"Очистить сцену",sceneAddSphere:"Добавить сферу",sceneAddCube:"Добавить куб",sceneAddCylinder:"Добавить цилиндр",sceneAddTorus:"Добавить тор",sceneSelection:"Выбрать",sceneMerge:"Объединить",meshTitle:"Сетка",meshNbVertices:"Вершины : ",meshNbFaces:"Грани : ",topologyTitle:"Топология",multiresTitle:"Детализация",multiresSubdivide:"Увеличить",multiresReverse:"Реверс",multiresResolution:"Разрешение",multiresNoLower:"Ниже уровня не существует.",multiresNoHigher:"Выше уровня не существует.",multiresDelHigher:"Удалить высокое",multiresDelLower:"Удалить низкое",multiresSelectLowest:"Выберете низкий перед реверсом.",multiresSelectHighest:"Выберете бысокий перед увеличением.",multiresWarnBigMesh:function(e){return"Следующий уровень "+e+' faces.\nЕсли вы уверены, снова нажмите на "разрешение".'},multiresNotReversible:"К сожалению это не возможно, чтобы изменить эту сетку.\nСетка не продуктивна.",remeshTitle:"Перестроить воксели",remeshRemesh:"Перестроить",remeshResolution:"Разрешение",remeshBlock:"Блоки-кубики",dynamicTitle:"Динамическая топология",dynamicActivated:"Активировать (без кубиков)",dynamicSubdivision:"Увеличить",dynamicDecimation:"Прореживание",dynamicLinear:"Линейное увеличение",sculptTitle:"Лепить и красить",sculptBrush:"3D Кисть",sculptInflate:"3D Надуть",sculptTwist:"3D Закручивание",sculptSmooth:"3D Сгладить (-Shift)",sculptFlatten:"3D Расплющить",sculptPinch:"3D Сдавить",sculptCrease:"3D Складка",sculptDrag:"3D Тянучка",sculptMove:"3D Перемещать",sculptLocalScale:"3D масштабирование",sculptPaint:"2D Кисть",sculptMasking:"2D Маска (-Ctrl)",sculptTransform:"Трансформация",sculptCommon:"Общее",sculptTool:"Инструмент",sculptSymmetry:"Симетрия",sculptContinuous:"Спрей",sculptRadius:"Размер (-X)",sculptIntensity:"Сила (-C)",sculptHardness:"Жесткость",sculptCulling:"Тонкая поверхность(передние вершины)",sculptAlphaTitle:"Альфа",sculptLockPositon:"Фиксация",sculptAlphaTex:"Текстура",sculptImportAlpha:"Импорт альфа текстуры (jpg, png...)",sculptNegative:"Негатив (N или -Alt)",sculptColor:"Палитра",sculptRoughness:"Шероховатость",sculptMetallic:"Металлический",sculptClay:"Без учета содержимого",sculptAccumulate:"Наращивать без ограничений",sculptColorGlobal:"Глобальный",sculptPickColor:"Пипетка материал (-S)",sculptTangentialSmoothing:"Сглаживание по касательной",sculptTopologicalCheck:"Проверка топологии",sculptMoveAlongNormal:"Перемещать вдоль нормали",sculptMaskingClear:"Очистить (-Ctrl + Drag)",sculptMaskingInvert:"Инверсия (-Ctrl + Click)",sculptMaskingBlur:"Сгладить",sculptMaskingSharpen:"Резко",sculptPBRTitle:"PBR материал",sculptPaintAll:"Краска",sculptExtractTitle:"Извлечь",sculptExtractThickness:"Толщина",sculptExtractAction:"Извлечь!",stateTitle:"История",stateUndo:"Назад",stateRedo:"Вперед",stateMaxStack:"Количество шагов",pressureTitle:"Планшет pressure",pressureRadius:"Нажим-размер",pressureIntensity:"Нажим-жесткость",renderingTitle:"Визуализация",renderingGrid:"Показать сетку",renderingSymmetryLine:"Линия симетрии",renderingMatcap:null,renderingCurvature:"Рельефность",renderingPBR:"PBR",renderingTransparency:"Прозрачность",renderingNormal:"Карта нормалей",renderingUV:"UV",renderingShader:"Шейдеры",renderingMaterial:"Материал",renderingImportUV:"Импорт (jpg, png...)",renderingImportMatcap:"Импорт (jpg, png...)",renderingExtra:"Дополнительно",renderingFlat:"Плоскости",renderingWireframe:"Каркас (W)",renderingExposure:"Экспозиция",renderingEnvironment:"Отражение",renderingIsolate:"Изолировать / Показать (I)",renderingFilmic:"Пленка",contour:"Контур",contourShow:"Показать контур",contourColor:"Цвет",darkenUnselected:"Затемнить невыбранное",resolution:"Разрешение",matcapPearl:"Жемчуг",matcapClay:"Глина",matcapSkin:"Кожа",matcapGreen:"Зеленый",matcapWhite:"Белый",sketchfabTitle:"В Sketchfab.com ",sketchfabUpload:"Загрузить",sketchfabUploadMessage:"Ведите API-ключ sketchfab.\nОставьте слово «guest», чтобы загрузить модель анонимно.\n(По окончании загрузки и обработки откроется новое окно)",sketchfabUploadError:function(e){return"Ошибка загрузки в Sketchfab :\n"+e},sketchfabUploadSuccess:"Загрузка выполнена !\nВаша ссылка:",sketchfabAbort:"Прервать загрузку?",sketchfabUploadProcessing:"Обработка...\nВаша модель будет доступна после:",about:"О программе",alphaNone:"Нет",alphaSquare:"Квадрат",alphaSkin:"Кожа",envFootPrint:"Китайский театр Граумана",envGlazedPatio:"Застекленный дворик",envNicolausChurch:"Церковь Святого Николая",envTerrace:"Терраса",envBryantPark:"Бра́йант-парк"};t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={backgroundTitle:"Arka plan",backgroundReset:"Temizle",backgroundImport:"İçe Aktar (jpg, png...)",backgroundFill:"Doldur",cameraTitle:"Kamera",cameraReset:"Görünüm",cameraCenter:"Temizle (boşluk)",cameraFront:"Ön (F)",cameraLeft:"Sol (L)",cameraTop:"Üst (T)",cameraMode:"Mod",cameraOrbit:"Eksen (Döner Tabla)",cameraSpherical:"Küresel (Trackball)",cameraPlane:"Düzlem (Trackball)",cameraProjection:"İz Düşüm",cameraPerspective:"Perspektif",cameraOrthographic:"Orthografik",cameraFov:"Görüş Alanı",cameraPivot:"Eksen",fileTitle:"Dosyalar (içeri/dışarı)",fileImportTitle:"İçe Aktar",fileAdd:"Aktar (obj, sgl, ply, stl)",fileAutoMatrix:"Ölçekle ve ortala",fileVertexSRGB:"sRGB verteks renk",fileExportSceneTitle:"Sahneyi Dışa Aktar",fileExportAll:"tümünü ver",fileExportSGL:"Kaydet .sgl (SculptGL)",fileExportOBJ:"Kaydet .obj",fileExportPLY:"Kaydet .ply",fileExportSTL:"Kaydet .stl",sceneTitle:"Sahne",sceneReset:"Sahneyi temizle",sceneAddSphere:"Küre ekle",sceneAddCube:"Küp ekle",sceneAddCylinder:"Silindir ekle",sceneAddTorus:"Halka ekle",sceneSelection:"Seçim",sceneMerge:"Seçimi birleştir",meshTitle:"Nesne",meshNbVertices:"Verteks : ",meshNbFaces:"Cephe : ",topologyTitle:"Topoloji",multiresTitle:"Çoklu çözünürlük",multiresSubdivide:"Böl",multiresReverse:"Ters",multiresResolution:"Çözünürlük",multiresNoLower:"Daha düşük çözünürlük yok.",multiresNoHigher:"Daha yüksek çözünürlük yok.",multiresDelHigher:"Üst çözünürlüğü sil",multiresDelLower:"Alt çözünürlüğü sil",multiresSelectLowest:"Tersine çevirmeden önce en düşük çözünürlüğü seç.",multiresSelectHighest:"Tesine çevirmeden önce en yüksek çözünürlüğü seç.",multiresWarnBigMesh:function(e){return"Sonraki çözünürlük "+e+' cepheden oluşacak.\nEğer devam etmek istiyorsanız, tekrar "böl" butonuna basın.'},multiresNotReversible:"Malesef bu nesneyi tersine çevirmek mümkün değil.\nThe mesh is not a product of a (loop-catmull) subdivision surface on a manifold mesh.",remeshTitle:"Voksel Remeshing",remeshRemesh:"Remesh",remeshResolution:"Çözünürlük",remeshBlock:"Engelle",dynamicTitle:"Dinamik Topoloji",dynamicActivated:"Aktifleştirildi (no quads)",dynamicSubdivision:"Altbölüm",dynamicDecimation:"Üstbölüm",dynamicLinear:"Doğrusal altbölüm",sculptTitle:"Oyma & Boyama",sculptBrush:"Fırça",sculptInflate:"Şişir",sculptTwist:"Bükülme",sculptSmooth:"Yumuşat (-Shift)",sculptFlatten:"Düzleştir",sculptPinch:"Çimdik",sculptCrease:"Kıvrım",sculptDrag:"Sürükle",sculptPaint:"Boya",sculptMasking:"Maskeleme (-Ctrl)",sculptMove:"Taşı",sculptLocalScale:"Yerel ölçek",sculptTransform:"Transform (E)",sculptCommon:"Genel",sculptTool:"Araç",sculptSymmetry:"Simetri",sculptContinuous:"Sürekli",sculptRadius:"Yarıçağ (-X)",sculptIntensity:"Yoğunluk (-C)",sculptHardness:"Sertlik",sculptCulling:"İnce yüzey (front vertex only)",sculptAlphaTitle:"Alfa",sculptLockPositon:"Pozisyonu kilitle",sculptAlphaTex:"Kaplama",sculptImportAlpha:"Alfa kaplama yükle (jpg, png...)",sculptNegative:"Negatif (N or -Alt)",sculptColor:"Aklık",sculptRoughness:"Pürüzlülük",sculptMetallic:"Metalik",sculptClay:"Kil",sculptAccumulate:"Biriktir (limitsiz)",sculptColorGlobal:"Evrensel",sculptPickColor:"Materyal / Renk seçici (-S)",sculptTangentialSmoothing:"Rahatlat",sculptTopologicalCheck:"Topoloji kontrol",sculptMoveAlongNormal:"Normal boyunca taşı (N or -Alt)",sculptMaskingClear:"Temizle (-Ctrl + Drag)",sculptMaskingInvert:"Tersine çevir (-Ctrl + Click)",sculptMaskingBlur:"Bulanıklaştır",sculptMaskingSharpen:"Keskinleştir",sculptPBRTitle:"PBR materyali",sculptPaintAll:"Tümünü boya",sculptExtractTitle:"Çıkar",sculptExtractThickness:"Kalınlık",sculptExtractAction:"Çıkar !",stateTitle:"Geçmiş",stateUndo:"Geri Al",stateRedo:"İleri Al",stateMaxStack:"Maksimum Yığın",pressureTitle:"Tablet pressure",pressureRadius:"Basınç çapı",pressureIntensity:"Basınç hassasiyeti",renderingTitle:"Sahneleme",renderingGrid:"Izgarayı göster",renderingSymmetryLine:"aynalama çizgisini göster",renderingMatcap:"Matcap",renderingCurvature:"Eğrilik",renderingPBR:"PBR",renderingTransparency:"Transparanlık",renderingNormal:"Normal shader",renderingUV:"UV shader",renderingShader:"Shader",renderingMaterial:"Materyal",renderingImportUV:"İçe AKtar (jpg, png...)",renderingImportMatcap:"İçe AKtar (jpg, png...)",renderingExtra:"Ekstra",renderingFlat:"Düz gölgeleme",renderingWireframe:"Tel kafes (W)",renderingExposure:"Teşir",renderingEnvironment:"Ortam",renderingIsolate:"İzole/Göster (I)",renderingFilmic:"Film Ton Eşleşmesi",contour:"Kontür",contourShow:"Kontürü göster",contourColor:"Renk",darkenUnselected:"Seçilmeyenleri koyu yap",resolution:"Çözünürlük",matcapPearl:"İnci",matcapClay:"Kil",matcapSkin:"Deri",matcapGreen:"Yeşil",matcapWhite:"Beyaz",sketchfabTitle:"Sketchfab'a git !",sketchfabUpload:"Yükle",sketchfabUploadMessage:'Lütfen sketchfab entegrasyon anahtarını giriniz.\nAnonim olarak kullanmak için "guest" olarak bırakınız.\n(İşleme ve yükleme tamamlandığında yeni bir pencere açılacak)',sketchfabUploadError:function(e){return"Sketchfab yükleme hatası :\n"+e},sketchfabUploadSuccess:"Yükleme başarılı !\nAdresiniz burada :",sketchfabAbort:"Son yüklemeyi iptal et ?",sketchfabUploadProcessing:"Hesaplanıyor...\nModeliniz şu adreste olacak :",about:"Hakkında & Yardım",alphaNone:"Hiç Biri",alphaSquare:"Kare",alphaSkin:"Deri",envFootPrint:"Foot Print",envGlazedPatio:"Glazed Patio",envNicolausChurch:"St Nicolaus church",envTerrace:"Terrace",envBryantPark:"BryantPark"};t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={backgroundTitle:"Bakgrund",backgroundReset:"Återställ",backgroundImport:"Importera (jpg, png...)",backgroundFill:"Fyll",cameraTitle:"Kamera",cameraReset:"Vy",cameraCenter:"Återställ (bar)",cameraFront:"Fram (F)",cameraLeft:"Vänster (L)",cameraTop:"Över (T)",cameraMode:"Läge",cameraOrbit:"Omloppsbana (skivtallrik)",cameraSpherical:"Sfärisk (trackball)",cameraPlane:"Plan (trackball)",cameraProjection:"Projektion",cameraPerspective:"Perspektiv",cameraOrthographic:"Ortografisk",cameraFov:"Fov",cameraPivot:"Plocka pivot",fileTitle:"Filer (import/export)",fileImportTitle:"Importera",fileAdd:"Lägg till (obj, sgl, ply, stl)",fileAutoMatrix:"Skala och centrera",fileVertexSRGB:"sRGB vertexfärg",fileExportSceneTitle:"Exportera Scen",fileExportAll:"Exportera alla",fileExportSGL:"Spara .sgl (SculptGL)",fileExportOBJ:"Spara .obj",fileExportPLY:"Spara .ply",fileExportSTL:"Spara .stl",sceneTitle:"Scen",sceneReset:"Rensa scen",sceneAddSphere:"Lägg till sfär",sceneAddCube:"Lägg till kub",sceneAddCylinder:"Lägg till cylinder",sceneAddTorus:"Lägg till torus",sceneSelection:"Urval",sceneMerge:"Sammanfoga urval",meshTitle:"Mesh",meshNbVertices:"Vertex : ",meshNbFaces:"Faces : ",topologyTitle:"Topologi",multiresTitle:"Upplösningar",multiresSubdivide:"Dela upp yta",multiresReverse:"Omvänd",multiresResolution:"Upplösning",multiresNoLower:"Det finns ingen lägre upplösningsnivå.",multiresNoHigher:"Det finns ingen högre upplösningsnivå.",multiresDelHigher:"Ta bort högre",multiresDelLower:"Ta bort lägre",multiresSelectLowest:"Välj den lägsta upplösningen innan omvändning.",multiresSelectHighest:"Välj den högsta upplösningen innan uppdelning.",multiresWarnBigMesh:function(e){return"Nästa underavdelning nivå kommer att ha "+e+' faces.\nOm du vet vad du gör, klicka igen på "dela upp yta".'},multiresNotReversible:"Tyvärr, det går inte att omvända denna mesh.\nMeshen är inte en produkt av en (loop-calmull) mångfaldsytindelning.",remeshTitle:"Voxel Meshombyggnation",remeshRemesh:"Bygg om mesh",remeshResolution:"Upplösning",remeshBlock:"Kuber",dynamicTitle:"Dynamisk Topologi",dynamicActivated:"Aktiverad (inga quads)",dynamicSubdivision:"Ytindelning",dynamicDecimation:"Decimering",dynamicLinear:"Linjär ytindelning",sculptTitle:"Skulptering & Måleri",sculptBrush:"Pensel",sculptInflate:"Blås upp",sculptTwist:"Tvista",sculptSmooth:"Jämna ut (-Shift)",sculptFlatten:"Platta till",sculptPinch:"Nyp",sculptCrease:"Vecka",sculptDrag:"Dra",sculptPaint:"Måla",sculptMasking:"Maskera (-Ctrl)",sculptMove:"Flytta",sculptLocalScale:"Skala lokalt",sculptTransform:"Transformera (E)",sculptCommon:"Generellt",sculptTool:"Verktyg",sculptSymmetry:"Symmetri",sculptContinuous:"Kontinuerlig",sculptRadius:"Radie (-X)",sculptIntensity:"Intensitet (-C)",sculptHardness:"Hårdhet",sculptCulling:"Tunn yta (endast främre vertex)",sculptAlphaTitle:"Alfa",sculptLockPositon:"Lås position",sculptAlphaTex:"Textur",sculptImportAlpha:"Importera alfatextur (jpg, png...)",sculptNegative:"Negativ (N or -Alt)",sculptColor:"Albedo",sculptRoughness:"Ytjämnhet",sculptMetallic:"Metallisk",sculptClay:"Lera",sculptAccumulate:"Ackumulera (ingen gräns per strykning)",sculptColorGlobal:"Global",sculptPickColor:"Material / Färgvälgare (-S)",sculptTangentialSmoothing:"Tangentiell utjämning",sculptTopologicalCheck:"Topologisk check",sculptMoveAlongNormal:"Flytta längsmed normal (N or -Alt)",sculptMaskingClear:"Rensa (-Ctrl + Drag)",sculptMaskingInvert:"Invertera (-Ctrl + Click)",sculptMaskingBlur:"Gör suddig",sculptMaskingSharpen:"Gör skarp",sculptPBRTitle:"PBR-material",sculptPaintAll:"Måla allt",sculptExtractTitle:"Extrahera",sculptExtractThickness:"Tjocklek",sculptExtractAction:"Extrahera!",stateTitle:"Historia",stateUndo:"Ångra",stateRedo:"Gör om",stateMaxStack:"Ågra antal steg",pressureTitle:"pressureplatta",pressureRadius:"Tryckradie",pressureIntensity:"Tryckintensitet",renderingTitle:"Rendering",renderingGrid:"Visa rutnät",renderingSymmetryLine:"Visa speglingslinje",renderingMatcap:"MatCap",renderingCurvature:"Kurvatur",renderingPBR:"PBR",renderingTransparency:"Genomskinlighet",renderingNormal:"Normal shader",renderingUV:"UV-shader",renderingShader:"Shader",renderingMaterial:"Material",renderingImportUV:"Importera (jpg, png...)",renderingImportMatcap:"Importera (jpg, png...)",renderingExtra:"Extra",renderingFlat:"Platt shading",renderingWireframe:"Wireframe (W)",renderingExposure:"Exponering",renderingEnvironment:"Miljö",renderingIsolate:"Isolera/Visa (I)",renderingFilmic:"Filmiska färgtoner",contour:"Kontur",contourShow:"Visa kontur",contourColor:"Färg",darkenUnselected:"Skym ej valda",resolution:"Upplösning",matcapPearl:"Pärla",matcapClay:"Lera",matcapSkin:"Hud",matcapGreen:"Grön",matcapWhite:"Vit",sketchfabTitle:"Gå till Sketchfab!",sketchfabUpload:"Ladda upp",sketchfabUploadMessage:'Vänligen fyll i din sketchfab API-nyckel.\nDu kan även ange "guest" för att ladda upp anonymt.\n(ett nytt fönster kommer att öppnas när uppladdning och bearbetning är klar)',sketchfabUploadError:function(e){return"Sketchfab uppladdningsfel:\n"+e},sketchfabUploadSuccess:"Uppladdning lyckades!\nHär är din länk:",sketchfabAbort:"Avbryta senaste uppladdningen?",sketchfabUploadProcessing:"Bearbetar...\nDin modell kommer bli tillgänglig här:",about:"Om & Hjälp",alphaNone:"Ingen",alphaSquare:"Fyrkant",alphaSkin:"Hud",envFootPrint:"Fotavtryck",envGlazedPatio:"Inglasad uteplats",envNicolausChurch:"S:t Nikolauskyrkan",envTerrace:"Terrass",envBryantPark:"Bryant Park"};t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={backgroundTitle:"Fond d'écran",backgroundReset:"Réinitialiser",backgroundImport:"Importer (jpg, png...)",backgroundFill:"Remplir",cameraTitle:"Caméra",cameraReset:"Vue",cameraCenter:"Reinitialiser (bar)",cameraFront:"De face (F)",cameraLeft:"De gauche (L)",cameraTop:"De haut (T)",cameraMode:"Mode",cameraOrbit:"Orbite (Turntable)",cameraSpherical:"Spherique (Trackball)",cameraPlane:"Planaire (Trackball)",cameraProjection:"Projection",cameraPerspective:"Perspective",cameraOrthographic:"Orthographique",cameraFov:"Champs de vision",cameraPivot:"Point de pivot",fileTitle:"Fichiers (importer/exporter)",fileImportTitle:"Importer",fileAdd:"Ajouter (obj, sgl, ply, stl)",fileAutoMatrix:"Mise a l'échelle et centrage",fileVertexSRGB:"Couleur de vertex en sRGB",fileExportSceneTitle:"Exporter Scene",fileExportAll:"Tout exporter",fileExportSGL:"Sauver .sgl (SculptGL)",fileExportOBJ:"Sauver .obj",fileExportPLY:"Sauver .ply",fileExportSTL:"Sauver .stl",sceneTitle:"Scène",sceneReset:"Réinitialiser scène",sceneAddSphere:"Ajouter sphere",sceneAddCube:"Ajouter cube",sceneAddCylinder:"Ajouter cylindre",sceneAddTorus:"Ajouter tore",sceneSelection:"Sélection",sceneMerge:"Fusionner selection",meshTitle:"Mesh",meshNbVertices:"Vertex : ",meshNbFaces:"Faces : ",topologyTitle:"Topologie",multiresTitle:"Multirésolution",multiresSubdivide:"Subdiviser",multiresReverse:"Inverser",multiresResolution:"Résolution",multiresNoLower:"Il n'y a pas de niveau de résolution inférieur.",multiresNoHigher:"Il n'y a pas de niveau de résolution plus élevé.",multiresDelHigher:"Supprimer niveau supérieur",multiresDelLower:"Supprimer niveau inférieur",multiresSelectLowest:"Sélectionnez la résolution la plus basse avant d'inverser.",multiresSelectHighest:"Sélectionnez la résolution la plus élevée avant de subdiviser.",multiresWarnBigMesh:function(e){return"Le prochain niveau de subdivision atteindra "+e+' faces.\nSi vous savez ce que vous faites, cliquez de nouveau sur "subdiviser".'},multiresNotReversible:"Désolé, il n'est pas possible d'inverser ce maillage.\nLe mesh n'est pas un produit d'une surface de subdivision (loop-catmull) provenant manifold.",remeshTitle:"Remaillage volumétrique",remeshRemesh:"Remaillage",remeshResolution:"Résolution",remeshBlock:"Bloc",dynamicTitle:"Topologie dynamique",dynamicActivated:"Activaté (pas quads)",dynamicSubdivision:"Subdivision",dynamicDecimation:"Décimation",dynamicLinear:"Subdivision linéaire",sculptTitle:"Sculpture & Painture",sculptBrush:"Brosse",sculptInflate:"Gonfler",sculptTwist:"Tordre",sculptSmooth:"Lisser (-Shift)",sculptFlatten:"Aplatir",sculptPinch:"Pincer",sculptCrease:"Plier",sculptDrag:"Tirer",sculptPaint:"Peindre",sculptMasking:"Masquer (-Ctrl)",sculptMove:"Bouger",sculptLocalScale:"Mise à l'échelle locale",sculptTransform:"Transformer (E)",sculptCommon:"Commun",sculptTool:"Outil",sculptSymmetry:"Symétrie",sculptContinuous:"Continu",sculptRadius:"Rayon (-X)",sculptIntensity:"Intensité (-C)",sculptHardness:"Dureté",sculptCulling:"Surface fine (vertex de face uniquement)",sculptAlphaTitle:"Alpha",sculptLockPositon:"Bloquer position",sculptAlphaTex:"Texture",sculptImportAlpha:"Importer texture alpha (jpg, png...)",sculptNegative:"Négatif (N ou -Alt)",sculptColor:"Albedo",sculptRoughness:"Rugosité",sculptMetallic:"Métallique",sculptClay:"Argile",sculptAccumulate:"Accumuler (pas de limite par coup de pinceau)",sculptColorGlobal:"Global",sculptPickColor:"Matériau / selection de couleur (-S)",sculptTangentialSmoothing:"Relaxer uniquement",sculptTopologicalCheck:"Vérification topologique",sculptMoveAlongNormal:"Extruder suivant la normale (N ou -Alt)",sculptMaskingClear:"Réinitialiser (-Ctrl + Drag)",sculptMaskingInvert:"Inverser (-Ctrl + Click)",sculptMaskingBlur:"Brouiller",sculptMaskingSharpen:"Aiguiser",sculptPBRTitle:"Matériaux physiques (PBR)",sculptPaintAll:"Peindre tout",sculptExtractTitle:"Extraire",sculptExtractThickness:"Epaisseur",sculptExtractAction:"Extraire !",stateTitle:"Historique",stateUndo:"Annuler",stateRedo:"Refaire",stateMaxStack:"Nombre maximale d'action",pressureTitle:"Pression de la tablette",pressureRadius:"Pression sur le rayon",pressureIntensity:"Pression sur l'intensité",renderingTitle:"Rendu",renderingGrid:"Afficher grille",renderingSymmetryLine:"Afficher ligne de symétrie",renderingMatcap:"Matcap",renderingCurvature:"Courbure",renderingPBR:"PBR",renderingTransparency:"Transparence",renderingNormal:"Normal shader",renderingUV:"UV shader",renderingShader:"Shader",renderingMaterial:"Matériau",renderingImportUV:"Importer (jpg, png...)",renderingImportMatcap:"Importer (jpg, png...)",renderingExtra:"Extra",renderingFlat:"Ombrage plat",renderingWireframe:"Fil de fer (W)",renderingExposure:"Exposition",renderingEnvironment:"Environment",renderingIsolate:"Isoler/Afficher (I)",renderingFilmic:"Tonemapping filmique",contour:"Contour",contourShow:"Afficher les contours",contourColor:"Couleur",darkenUnselected:"Assombrir non séléctioné",resolution:"Résolution",matcapPearl:"Perle",matcapClay:"Argile",matcapSkin:"Peau",matcapGreen:"Vert",matcapWhite:"Blanc",sketchfabTitle:"Vers Sketchfab !",sketchfabUpload:"Uploader",sketchfabUploadMessage:"Entrez votre clé d'API sketchfab.\n",sketchfabUploadError:function(e){return"Sketchfab upload error :\n"+e},sketchfabUploadSuccess:"Téléchargement fini !\nVoici le lien :",sketchfabAbort:"Annuler le dernier téléchargement ?",sketchfabUploadProcessing:"En traitement...\nLe modèle sera disponible sur :",about:"A propos & aide",alphaNone:"Vide",alphaSquare:"Carré",alphaSkin:"Peau",envFootPrint:"Empreinte",envGlazedPatio:"Patio glacé",envNicolausChurch:"Eglise Saint-Nicolas",envTerrace:"Terrasse",envBryantPark:"Bryant Park"};t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(e){return e&&e.__esModule?e:{default:e}}(r(4)),i=n.default.getCopy();i.vertexName=i.fragmentName="ShowNormal",i.uniforms={},i.attributes={},i.activeAttributes={vertex:!0,normal:!0,material:!0},i.uniformNames=[],Array.prototype.push.apply(i.uniformNames,n.default.uniformNames.commonUniforms),i.vertex=["attribute vec3 aVertex;","attribute vec3 aNormal;","attribute vec3 aMaterial;",n.default.strings.vertUniforms,"varying vec3 vVertex;","varying vec3 vNormal;","varying float vMasking;","void main() {","  vMasking = aMaterial.z;","  vNormal = mix(aNormal, uEN * aNormal, vMasking);","  vNormal = normalize(uN * vNormal);","  vec4 vertex4 = vec4(aVertex, 1.0);","  vertex4 = mix(vertex4, uEM *vertex4, vMasking);","  vVertex = vec3(uMV * vertex4);","  gl_Position = uMVP * vertex4;","}"].join("\n"),i.fragment=["varying vec3 vVertex;","varying vec3 vNormal;","uniform float uAlpha;",n.default.strings.fragColorUniforms,n.default.strings.fragColorFunction,"void main() {","  gl_FragColor = encodeFragColor(sRGBToLinear(getNormal() * 0.5 + 0.5), uAlpha);","}"].join("\n");var a=i;t.default=a},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(4)),a=n(r(13)),s=i.default.getCopy();s.vertexName=s.fragmentName="ShowUV",s.texPath="resources/uv.jpg",s.uniforms={},s.attributes={},s.uniformNames=["uTexture0","uAlbedo"],Array.prototype.push.apply(s.uniformNames,i.default.uniformNames.commonUniforms),s.vertex=["attribute vec3 aVertex;","attribute vec3 aNormal;","attribute vec3 aColor;","attribute vec2 aTexCoord;","attribute vec3 aMaterial;",i.default.strings.vertUniforms,"varying vec3 vVertex;","varying vec3 vNormal;","varying vec3 vColor;","varying vec2 vTexCoord;","varying float vMasking;","uniform vec3 uAlbedo;","void main() {","  vColor = uAlbedo.x >= 0.0 ? uAlbedo : aColor;","  vTexCoord = aTexCoord;","  vMasking = aMaterial.z;","  vNormal = mix(aNormal, uEN * aNormal, vMasking);","  vNormal = normalize(uN * vNormal);","  vec4 vertex4 = vec4(aVertex, 1.0);","  vertex4 = mix(vertex4, uEM *vertex4, vMasking);","  vVertex = vec3(uMV * vertex4);","  gl_Position = uMVP * vertex4;","}"].join("\n"),s.fragment=["uniform sampler2D uTexture0;","varying vec3 vVertex;","varying vec3 vNormal;","varying vec3 vColor;","varying vec2 vTexCoord;","uniform float uAlpha;",i.default.strings.fragColorUniforms,i.default.strings.fragColorFunction,"void main() {","  vec3 color = sRGBToLinear(texture2D(uTexture0, vTexCoord).rgb) * sRGBToLinear(vColor);","  gl_FragColor = encodeFragColor(color, uAlpha);","}"].join("\n"),s.draw=i.default.draw,s.drawBuffer=i.default.drawBuffer,s.getOrCreate=i.default.getOrCreate,s.initUniforms=i.default.initUniforms,s.initAttributes=function(e){i.default.initAttributes.call(this,e),s.attributes.aTexCoord=new a.default(e,s.program,"aTexCoord",2,e.FLOAT)},s.bindAttributes=function(e){i.default.bindAttributes.call(this,e),s.attributes.aTexCoord.bindToBuffer(e.getTexCoordBuffer())},s.updateUniforms=function(e,t){var r=e.getGL(),n=this.uniforms;r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,this.getOrCreateTexture0(r,s.texPath,t)||this.getDummyTexture(r)),r.uniform1i(n.uTexture0,0),r.uniform3fv(n.uAlbedo,e.getAlbedo()),i.default.updateUniforms.call(this,e,t)};var o=s;t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(e){return e&&e.__esModule?e:{default:e}}(r(4)),i=n.default.getCopy();i.vertexName=i.fragmentName="Wireframe",i.uniforms={},i.attributes={},i.activeAttributes={vertex:!0,material:!0},i.uniformNames=["uMVP","uEM"],i.vertex=["attribute vec3 aVertex;","attribute vec3 aMaterial;","uniform mat4 uMVP;","uniform mat4 uEM;","void main() {","  vec4 vertex4 = vec4(aVertex, 1.0);","  vec4 pos = uMVP * mix(vertex4, uEM * vertex4, aMaterial.z);","  pos[3] += 0.0001;","  gl_Position = pos;","}"].join("\n"),i.fragment=["void main() {","  gl_FragColor = vec4(0.0, 0.0, 0.0, 0.4);","}"].join("\n"),i.getOrCreate=n.default.getOrCreate,i.draw=function(e){var t=e.getGL();t.useProgram(this.program),this.bindAttributes(e),this.updateUniforms(e),e.getWireframeBuffer().bind(),t.drawElements(t.LINES,2*e.getRenderNbEdges(),t.UNSIGNED_INT,0)},i.updateUniforms=function(e){var t=e.getGL();t.uniformMatrix4fv(this.uniforms.uMVP,!1,e.getMVP()),t.uniformMatrix4fv(this.uniforms.uEM,!1,e.getEditMatrix())};var a=i;t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(e){return e&&e.__esModule?e:{default:e}}(r(4)),i=n.default.getCopy();i.vertexName=i.fragmentName="FlatColor",i.uniforms={},i.attributes={},i.activeAttributes={vertex:!0,material:!0},i.uniformNames=["uColor"],Array.prototype.push.apply(i.uniformNames,n.default.uniformNames.commonUniforms),i.vertex=["attribute vec3 aVertex;","attribute vec3 aMaterial;",n.default.strings.vertUniforms,"varying vec3 vVertex;","void main() {","  vec4 vertex4 = vec4(aVertex, 1.0);","  gl_Position = uMVP * mix(vertex4, uEM * vertex4, aMaterial.z);","}"].join("\n"),i.fragment=["uniform vec3 uColor;","void main() {","  gl_FragColor = vec4(uColor, 1.0);","}"].join("\n"),i.updateUniforms=function(e,t){e.getGL().uniform3fv(this.uniforms.uColor,e.getFlatColor()),n.default.updateUniforms.call(this,e,t)};var a=i;t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(e){return e&&e.__esModule?e:{default:e}}(r(4)).default.getCopy();n.vertexName=n.fragmentName="ShowSelection",n.uniforms={},n.attributes={},n.activeAttributes={vertex:!0},n.uniformNames=["uMVP","uColor"],n.vertex=["attribute vec3 aVertex;","uniform mat4 uMVP;","void main() {","  gl_Position = uMVP * vec4(aVertex, 1.0);","}"].join("\n"),n.fragment=["uniform vec3 uColor;","void main() {","  gl_FragColor = vec4(uColor, 1.0);","}"].join("\n"),n.draw=function(e,t,r){var i=e.getGL();i.useProgram(this.program),i.uniform3fv(this.uniforms.uColor,e.getColor()),t&&(i.uniformMatrix4fv(this.uniforms.uMVP,!1,e.getCircleMVP()),n.attributes.aVertex.bindToBuffer(e.getCircleBuffer()),i.drawArrays(i.LINE_LOOP,0,e.getCircleBuffer()._size/3)),i.uniformMatrix4fv(this.uniforms.uMVP,!1,e.getDotMVP()),n.attributes.aVertex.bindToBuffer(e.getDotBuffer()),i.drawArrays(i.TRIANGLE_FAN,0,e.getDotBuffer()._size/3),r&&(i.uniformMatrix4fv(this.uniforms.uMVP,!1,e.getDotSymmetryMVP()),i.drawArrays(i.TRIANGLE_FAN,0,e.getDotBuffer()._size/3))};var i=n;t.default=i},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(4)),a=n(r(13)),s=i.default.getCopy();s.vertexName=s.fragmentName="Background",s.uniforms={},s.attributes={},s.uniformNames=["uTexture0"],s.vertex=["attribute vec2 aVertex;","attribute vec2 aTexCoord;","varying vec2 vTexCoord;","void main() {","  vTexCoord = aTexCoord;","  gl_Position = vec4(aVertex, 1.0, 1.0);","}"].join("\n"),s.fragment=["uniform sampler2D uTexture0;","varying vec2 vTexCoord;",i.default.strings.colorSpaceGLSL,"void main() {","  gl_FragColor = encodeRGBM(sRGBToLinear(texture2D(uTexture0, vTexCoord)).rgb);","}"].join("\n"),s.draw=function(e){var t=e.getGL();t.useProgram(this.program),this.bindAttributes(e),this.updateUniforms(e),t.drawArrays(t.TRIANGLE_STRIP,0,4)},s.initAttributes=function(e){var t=s.program,r=s.attributes;r.aVertex=new a.default(e,t,"aVertex",2,e.FLOAT),r.aTexCoord=new a.default(e,t,"aTexCoord",2,e.FLOAT)},s.bindAttributes=function(e){var t=s.attributes;t.aVertex.bindToBuffer(e.getVertexBuffer()),t.aTexCoord.bindToBuffer(e.getTexCoordBuffer())},s.updateUniforms=function(e){var t=e.getGL();t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,e.getTexture()),t.uniform1i(this.uniforms.uTexture0,0)};var o=s;t.default=o},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(4)),a=n(r(13)),s=n(r(5)),o=i.default.getCopy();o.vertexName=o.fragmentName="Merge",o.FILMIC=(0,s.default)().filmic,o.uniforms={},o.attributes={},o.uniformNames=["uTexture0","uTexture1","uFilmic"],o.vertex=["attribute vec2 aVertex;","varying vec2 vTexCoord;","void main() {","  vTexCoord = aVertex * 0.5 + 0.5;","  gl_Position = vec4(aVertex, 0.5, 1.0);","}"].join("\n"),o.fragment=["uniform sampler2D uTexture0;","uniform sampler2D uTexture1;","uniform int uFilmic;","varying vec2 vTexCoord;",i.default.strings.colorSpaceGLSL,"void main() {","  vec4 transparent = texture2D(uTexture1, vTexCoord);","  vec3 color = decodeRGBM(texture2D(uTexture0, vTexCoord))*(1.0-transparent.a) + transparent.rgb;","  if(uFilmic == 1){","    vec3 x = max(vec3(0.0), color - vec3(0.004));","    gl_FragColor = vec4((x*(6.2*x+0.5))/(x*(6.2*x+1.7)+0.06), 1.0);","  }else{","    gl_FragColor = vec4(linearTosRGB(color), 1.0);","  }","}"].join("\n"),o.draw=function(e,t){var r=e.getGL();r.useProgram(this.program),o.attributes.aVertex.bindToBuffer(e.getVertexBuffer()),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,t._rttOpaque.getTexture()),r.uniform1i(this.uniforms.uTexture0,0),r.activeTexture(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,t._rttTransparent.getTexture()),r.uniform1i(this.uniforms.uTexture1,1),r.uniform1i(this.uniforms.uFilmic,o.FILMIC),r.drawArrays(r.TRIANGLES,0,3)},o.initAttributes=function(e){o.attributes.aVertex=new a.default(e,o.program,"aVertex",2,e.FLOAT)};var u=o;t.default=u},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(4)),a=n(r(13)),s=n(r(5)),o=n(r(70)),u=i.default.getCopy();u.vertexName=u.fragmentName="Fxaa",u.FILMIC=(0,s.default)().filmic,u.uniforms={},u.attributes={},u.uniformNames=["uTexture0","uInvSize"],u.vertex=["attribute vec2 aVertex;","uniform vec2 uInvSize;","varying vec2 vUVNW;","varying vec2 vUVNE;","varying vec2 vUVSW;","varying vec2 vUVSE;","varying vec2 vUVM;","void main() {","  vUVM = aVertex * 0.5 + 0.5;","  vUVNW = vUVM + vec2(-1.0, -1.0) * uInvSize;","  vUVNE = vUVM + vec2(1.0, -1.0) * uInvSize;","  vUVSW = vUVM + vec2(-1.0, 1.0) * uInvSize;","  vUVSE = vUVM + vec2(1.0, 1.0) * uInvSize;","  gl_Position = vec4(aVertex, 0.5, 1.0);","}"].join("\n"),u.fragment=["uniform sampler2D uTexture0;","uniform vec2 uInvSize;","varying vec2 vUVNW;","varying vec2 vUVNE;","varying vec2 vUVSW;","varying vec2 vUVSE;","varying vec2 vUVM;",o.default,i.default.strings.colorSpaceGLSL,"void main() {","  gl_FragColor = vec4(fxaa(uTexture0, vUVNW, vUVNE, vUVSW, vUVSE, vUVM, uInvSize), 1.0);","}"].join("\n"),u.draw=function(e,t){var r=e.getGL();r.useProgram(this.program),u.attributes.aVertex.bindToBuffer(e.getVertexBuffer()),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,t._rttMerge.getTexture()),r.uniform1i(this.uniforms.uTexture0,0),r.uniform2fv(this.uniforms.uInvSize,e.getInverseSize()),r.drawArrays(r.TRIANGLES,0,3)},u.initAttributes=function(e){u.attributes.aVertex=new a.default(e,u.program,"aVertex",2,e.FLOAT)};var l=u;t.default=l},function(e,t){e.exports="// https://github.com/mattdesl/glsl-fxaa\r\n#define FXAA_REDUCE_MIN (1.0/ 128.0)\r\n#define FXAA_REDUCE_MUL (1.0 / 8.0)\r\n#define FXAA_SPAN_MAX 8.0\r\n\r\nvec3 fxaa(const in sampler2D tex, const in vec2 uvNW, const in vec2 uvNE, const in vec2 uvSW, const in vec2 uvSE, const in vec2 uvM, const in vec2 invRes) {\r\n    const vec3 luma = vec3(0.299, 0.587, 0.114);\r\n    float lumaNW = dot(texture2D(tex, uvNW).xyz, luma);\r\n    float lumaNE = dot(texture2D(tex, uvNE).xyz, luma);\r\n    float lumaSW = dot(texture2D(tex, uvSW).xyz, luma);\r\n    float lumaSE = dot(texture2D(tex, uvSE).xyz, luma);\r\n    float lumaM  = dot(texture2D(tex, uvM).xyz,  luma);\r\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\r\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\r\n\r\n    vec2 dir = vec2(-((lumaNW + lumaNE) - (lumaSW + lumaSE)), ((lumaNW + lumaSW) - (lumaNE + lumaSE)));\r\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\r\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\r\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX), max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), dir * rcpDirMin)) * invRes;\r\n    \r\n    vec3 rgbA = 0.5 * ( texture2D(tex, uvM + dir * (1.0 / 3.0 - 0.5)).xyz + texture2D(tex, uvM + dir * (2.0 / 3.0 - 0.5)).xyz);\r\n    vec3 rgbB = rgbA * 0.5 + 0.25 * ( texture2D(tex, uvM - dir * 0.5).xyz + texture2D(tex, uvM + dir * 0.5).xyz);\r\n    \r\n    float lumaB = dot(rgbB, luma);\r\n    if((lumaB < lumaMin) || (lumaB > lumaMax))\r\n      return rgbA;\r\n    return rgbB;\r\n}"},function(e,t){e.exports="\r\nfloat outlineDistance( const in vec2 uv, const in sampler2D tex, const in vec2 invSize ) {\r\n  float fac0 = 2.0;\r\n  float fac1 = 1.0;\r\n  float ox = invSize.x;\r\n  float oy = invSize.y;\r\n  vec4 texel0 = texture2D(tex, uv + vec2(ox, oy));\r\n  vec4 texel1 = texture2D(tex, uv + vec2(ox, 0.0));\r\n  vec4 texel2 = texture2D(tex, uv + vec2(ox, -oy));\r\n  vec4 texel3 = texture2D(tex, uv + vec2(0.0, -oy));\r\n  vec4 texel4 = texture2D(tex, uv + vec2(-ox, -oy));\r\n  vec4 texel5 = texture2D(tex, uv + vec2(-ox, 0.0));\r\n  vec4 texel6 = texture2D(tex, uv + vec2(-ox, oy));\r\n  vec4 texel7 = texture2D(tex, uv + vec2(0.0, oy));\r\n  vec4 rowx = -fac0 * texel5 + fac0 * texel1 + -fac1 * texel6 + fac1 * texel0 + -fac1 * texel4 + fac1 * texel2;\r\n  vec4 rowy = -fac0 * texel3 + fac0 * texel7 + -fac1 * texel4 + fac1 * texel6 + -fac1 * texel2 + fac1 * texel0;\r\n  return dot(rowy, rowy) + dot(rowx, rowx);\r\n}\r\n"},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=r(1),o=n(r(7)),u=n(r(6)),l=n(r(27)),c=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=function(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r._radius=50,r._intensity=.5,r._negative=!1,r._clay=!0,r._culling=!1,r._accumulate=!0,r._idAlpha=0,r._lockPosition=!1,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.default),function(e,t,r){t&&a(e.prototype,t),r&&a(e,r)}(t,[{key:"stroke",value:function(e){var t=e.getPickedVertices(),r=this._intensity*o.default.getPressureIntensity();this._accumulate||this._lockPosition||this.updateProxy(t),this._main.getStateManager().pushVertices(t),this._lockPosition||(t=this.dynamicTopology(e));var n=this.getFrontVertices(t,e.getEyeDirection());this._culling&&(t=n);var i=e.getLocalRadius2();if(e.updateAlpha(this._lockPosition),e.setIdAlpha(this._idAlpha),this._clay){var a=this.areaNormal(n);if(!a)return;var u=this._lockPosition?e.getIntersectionPoint():this.areaCenter(n),c=.1*Math.sqrt(i);s.vec3.scaleAndAdd(u,u,a,this._negative?-c:c),l.default.prototype.flatten.call(this,t,a,u,e.getIntersectionPoint(),i,r,e)}else this.brush(t,e.getPickedNormal(),e.getIntersectionPoint(),i,r,e);var h=this.getMesh();h.updateGeometry(h.getFacesFromVertices(t),t)}},{key:"brush",value:function(e,t,r,n,i,a){var s=this.getMesh(),o=s.getVertices(),u=s.getMaterials(),l=this._accumulate||this._lockPosition?o:s.getVerticesProxy(),c=Math.sqrt(n),h=i*c*.1;this._negative&&(h=-h);for(var f=r[0],d=r[1],p=r[2],v=t[0],g=t[1],m=t[2],_=0,y=e.length;_<y;++_){var b=3*e[_],M=l[b]-f,T=l[b+1]-d,A=l[b+2]-p,S=Math.sqrt(M*M+T*T+A*A)/c;if(!(S>=1)){var k=o[b],w=o[b+1],E=o[b+2],x=S*S;x=3*x*x-4*x*S+1,x*=u[b+2]*h*a.getAlpha(k,w,E),o[b]=k+v*x,o[b+1]=w+g*x,o[b+2]=E+m*x}}}}]),t}();t.default=c},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=n(r(7)),o=n(r(6)),u=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=function(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r._radius=50,r._intensity=.3,r._negative=!1,r._culling=!1,r._idAlpha=0,r._lockPosition=!1,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),function(e,t,r){t&&a(e.prototype,t),r&&a(e,r)}(t,[{key:"stroke",value:function(e){var t=e.getPickedVertices(),r=this._intensity*s.default.getPressureIntensity();this.updateProxy(t),this._main.getStateManager().pushVertices(t),t=this.dynamicTopology(e),this._culling&&(t=this.getFrontVertices(t,e.getEyeDirection())),e.updateAlpha(this._lockPosition),e.setIdAlpha(this._idAlpha),this.inflate(t,e.getIntersectionPoint(),e.getLocalRadius2(),r,e);var n=this.getMesh();n.updateGeometry(n.getFacesFromVertices(t),t)}},{key:"inflate",value:function(e,t,r,n,i){var a=this.getMesh(),s=a.getVertices(),o=a.getMaterials(),u=a.getVerticesProxy(),l=a.getNormals(),c=Math.sqrt(r),h=n*c*.1;this._negative&&(h=-h);for(var f=t[0],d=t[1],p=t[2],v=0,g=e.length;v<g;++v){var m=3*e[v],_=u[m]-f,y=u[m+1]-d,b=u[m+2]-p,M=Math.sqrt(_*_+y*y+b*b)/c;if(!(M>=1)){var T=M*M;T=3*T*T-4*T*M+1,T*=h;var A=s[m],S=s[m+1],k=s[m+2],w=l[m],E=l[m+1],x=l[m+2];T/=Math.sqrt(w*w+E*E+x*x),T*=o[m+2]*i.getAlpha(A,S,k),s[m]=A+w*T,s[m+1]=S+E*T,s[m+2]=k+x*T}}}}]),t}();t.default=u},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=r(1),o=n(r(10)),u=n(r(6)),l=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=function(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r._radius=75,r._culling=!1,r._twistData={normal:[0,0,0],center:[0,0]},r._twistDataSym={normal:[0,0,0],center:[0,0]},r._idAlpha=0,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.default),function(e,t,r){t&&a(e.prototype,t),r&&a(e,r)}(t,[{key:"startSculpt",value:function(){var e=this._main,t=e._mouseX,r=e._mouseY,n=e.getPicking();if(this.initTwistData(n,t,r,this._twistData),e.getSculptManager().getSymmetry()){var i=e.getPickingSymmetry();i.intersectionMouseMesh(),i.setLocalRadius2(n.getLocalRadius2()),i.getMesh()&&this.initTwistData(i,t,r,this._twistDataSym)}}},{key:"initTwistData",value:function(e,t,r,n){e.pickVerticesInSphere(e.getLocalRadius2()),s.vec3.negate(n.normal,e.getEyeDirection()),s.vec2.set(n.center,t,r)}},{key:"sculptStroke",value:function(){var e=this._main,t=e._mouseX,r=e._mouseY,n=e._lastMouseX,i=e._lastMouseY,a=e.getPicking(),s=a.getLocalRadius2();if(a.pickVerticesInSphere(s),this.stroke(a,t,r,n,i,this._twistData),e.getSculptManager().getSymmetry()){var o=e.getPickingSymmetry();o.getMesh()&&(o.pickVerticesInSphere(s),this.stroke(o,n,i,t,r,this._twistDataSym))}this.updateRender(),e.setCanvasCursor("default")}},{key:"stroke",value:function(e,t,r,n,i,a){var s=e.getPickedVertices();this._main.getStateManager().pushVertices(s),s=this.dynamicTopology(e),this._culling&&(s=this.getFrontVertices(s,e.getEyeDirection())),e.updateAlpha(!1),e.setIdAlpha(this._idAlpha),this.twist(s,e.getIntersectionPoint(),e.getLocalRadius2(),t,r,n,i,a,e);var o=this.getMesh();o.updateGeometry(o.getFacesFromVertices(s),s)}},{key:"twist",value:function(e,t,r,n,i,a,u,l,c){var h=this.getMesh(),f=l.center,d=[n-f[0],i-f[1]];if(!(s.vec2.len(d)<30)){s.vec2.normalize(d,d);var p=l.normal,v=[0,0,0,0],g=[a-f[0],u-f[1]];s.vec2.normalize(g,g);for(var m=o.default.signedAngle2d(d,g),_=h.getVertices(),y=h.getMaterials(),b=1/Math.sqrt(r),M=t[0],T=t[1],A=t[2],S=[0,0,0],k=0,w=e.length;k<w;++k){var E=3*e[k],x=_[E],R=_[E+1],C=_[E+2],P=x-M,F=R-T,D=C-A,I=Math.sqrt(P*P+F*F+D*D)*b,N=I*I;N=3*N*N-4*N*I+1,N*=m*y[E+2]*c.getAlpha(x,R,C),s.quat.setAxisAngle(v,p,N),s.vec3.set(S,x,R,C),s.vec3.sub(S,S,t),s.vec3.transformQuat(S,S,v),s.vec3.add(S,S,t),_[E]=S[0],_[E+1]=S[1],_[E+2]=S[2]}}}}]),t}();t.default=l},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=n(r(7)),o=n(r(6)),u=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=function(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r._radius=50,r._intensity=.75,r._negative=!1,r._culling=!1,r._idAlpha=0,r._lockPosition=!1,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),function(e,t,r){t&&a(e.prototype,t),r&&a(e,r)}(t,[{key:"stroke",value:function(e){var t=e.getPickedVertices(),r=this._intensity*s.default.getPressureIntensity();this._main.getStateManager().pushVertices(t),t=this.dynamicTopology(e),this._culling&&(t=this.getFrontVertices(t,e.getEyeDirection())),e.updateAlpha(this._lockPosition),e.setIdAlpha(this._idAlpha),this.pinch(t,e.getIntersectionPoint(),e.getLocalRadius2(),r,e);var n=this.getMesh();n.updateGeometry(n.getFacesFromVertices(t),t)}},{key:"pinch",value:function(e,t,r,n,i){var a=this.getMesh(),s=a.getVertices(),o=a.getMaterials(),u=Math.sqrt(r),l=t[0],c=t[1],h=t[2],f=.05*n;this._negative&&(f=-f);for(var d=0,p=e.length;d<p;++d){var v=3*e[d],g=s[v],m=s[v+1],_=s[v+2],y=l-g,b=c-m,M=h-_,T=Math.sqrt(y*y+b*b+M*M)/u,A=T*T;A=3*A*A-4*A*T+1,A*=f*o[v+2]*i.getAlpha(g,m,_),s[v]=g+y*A,s[v+1]=m+b*A,s[v+2]=_+M*A}}}]),t}();t.default=u},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=n(r(7)),o=n(r(6)),u=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=function(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r._radius=25,r._intensity=.75,r._negative=!0,r._culling=!1,r._idAlpha=0,r._lockPosition=!1,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),function(e,t,r){t&&a(e.prototype,t),r&&a(e,r)}(t,[{key:"stroke",value:function(e){var t=e.getPickedVertices(),r=this._intensity*s.default.getPressureIntensity();this.updateProxy(t),this._main.getStateManager().pushVertices(t),t=this.dynamicTopology(e),this._culling&&(t=this.getFrontVertices(t,e.getEyeDirection())),e.updateAlpha(this._lockPosition),e.setIdAlpha(this._idAlpha),this.crease(t,e.getPickedNormal(),e.getIntersectionPoint(),e.getLocalRadius2(),r,e);var n=this.getMesh();n.updateGeometry(n.getFacesFromVertices(t),t)}},{key:"crease",value:function(e,t,r,n,i,a){var s=this.getMesh(),o=s.getVertices(),u=s.getMaterials(),l=s.getVerticesProxy(),c=Math.sqrt(n),h=r[0],f=r[1],d=r[2],p=t[0],v=t[1],g=t[2],m=.07*i,_=m*c;this._negative&&(_=-_);for(var y=0,b=e.length;y<b;++y){var M=3*e[y],T=h-l[M],A=f-l[M+1],S=d-l[M+2],k=Math.sqrt(T*T+A*A+S*S)/c;if(!(k>=1)){var w=o[M],E=o[M+1],x=o[M+2],R=k*k;R=3*R*R-4*R*k+1,R*=u[M+2]*a.getAlpha(w,E,x);var C=Math.pow(R,5)*_;R*=m,o[M]=w+T*R+p*C,o[M+1]=E+A*R+v*C,o[M+2]=x+S*R+g*C}}}}]),t}();t.default=u},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=r(1),o=n(r(10)),u=n(r(6)),l=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=function(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r._radius=150,r._dragDir=[0,0,0],r._dragDirSym=[0,0,0],r._idAlpha=0,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.default),function(e,t,r){t&&a(e.prototype,t),r&&a(e,r)}(t,[{key:"sculptStroke",value:function(){var e=this._main,t=this.getMesh(),r=e.getPicking(),n=e.getSculptManager().getSymmetry()?e.getPickingSymmetry():null,i=e._mouseX-this._lastMouseX,a=e._mouseY-this._lastMouseY,u=Math.sqrt(i*i+a*a),l=.15*this._radius,c=1/Math.floor(u/l);i*=c,a*=c;var h=this._lastMouseX,f=this._lastMouseY;if(r.getMesh()){r._mesh=t,n&&(n._mesh=t,s.vec3.copy(n.getIntersectionPoint(),r.getIntersectionPoint()),o.default.mirrorPoint(n.getIntersectionPoint(),t.getSymmetryOrigin(),t.getSymmetryNormal()));for(var d=0;d<1&&this.makeStroke(h,f,r,n);d+=c)h+=i,f+=a;this.updateRender(),this._lastMouseX=e._mouseX,this._lastMouseY=e._mouseY}}},{key:"makeStroke",value:function(e,t,r,n){var i=this.getMesh();return this.updateDragDir(r,e,t),r.pickVerticesInSphere(r.getLocalRadius2()),r.computePickedNormal(),i.isDynamic&&this.stroke(r,!1),n&&(this.updateDragDir(n,e,t,!0),n.setLocalRadius2(r.getLocalRadius2()),n.pickVerticesInSphere(n.getLocalRadius2())),i.isDynamic||this.stroke(r,!1),n&&this.stroke(n,!0),!0}},{key:"stroke",value:function(e,t){var r=e.getPickedVertices();this._main.getStateManager().pushVertices(r),r=this.dynamicTopology(e),e.updateAlpha(this._lockPosition),e.setIdAlpha(this._idAlpha),this.drag(r,e.getIntersectionPoint(),e.getLocalRadius2(),t,e);var n=this.getMesh();n.updateGeometry(n.getFacesFromVertices(r),r)}},{key:"drag",value:function(e,t,r,n,i){for(var a=this.getMesh(),s=a.getVertices(),o=a.getMaterials(),u=Math.sqrt(r),l=t[0],c=t[1],h=t[2],f=n?this._dragDirSym:this._dragDir,d=f[0],p=f[1],v=f[2],g=0,m=e.length;g<m;++g){var _=3*e[g],y=s[_],b=s[_+1],M=s[_+2],T=y-l,A=b-c,S=M-h,k=Math.sqrt(T*T+A*A+S*S)/u,w=k*k;w=3*w*w-4*w*k+1,w*=o[_+2]*i.getAlpha(y,b,M),s[_]=y+d*w,s[_+1]=b+p*w,s[_+2]=M+v*w}}},{key:"updateDragDir",value:function(e,t,r,n){var i=this.getMesh(),a=e.unproject(t,r,0),u=e.unproject(t,r,.1),l=s.mat4.create();s.mat4.invert(l,i.getMatrix()),s.vec3.transformMat4(a,a,l),s.vec3.transformMat4(u,u,l);var c=this._dragDir;if(n){c=this._dragDirSym;var h=i.getSymmetryOrigin(),f=i.getSymmetryNormal();o.default.mirrorPoint(a,h,f),o.default.mirrorPoint(u,h,f)}var d=e.getIntersectionPoint();e.setIntersectionPoint(o.default.vertexOnLine(d,a,u)),s.vec3.sub(c,e.getIntersectionPoint(),d),e._mesh=i,e.updateLocalAndWorldRadius2();var p=e.getEyeDirection();s.vec3.sub(p,u,a),s.vec3.normalize(p,p)}}]),t}();t.default=l},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=r(1),o=n(r(10)),u=n(r(6)),l=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=function(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r._radius=150,r._intensity=1,r._topoCheck=!0,r._negative=!1,r._moveData={center:[0,0,0],dir:[0,0],vProxy:null},r._moveDataSym={center:[0,0,0],dir:[0,0],vProxy:null},r._idAlpha=0,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.default),function(e,t,r){t&&a(e.prototype,t),r&&a(e,r)}(t,[{key:"startSculpt",value:function(){var e=this._main,t=e.getPicking();if(this.initMoveData(t,this._moveData),e.getSculptManager().getSymmetry()){var r=e.getPickingSymmetry();r.intersectionMouseMesh(),r.setLocalRadius2(t.getLocalRadius2()),r.getMesh()&&this.initMoveData(r,this._moveDataSym)}}},{key:"initMoveData",value:function(e,t){this._topoCheck?e.pickVerticesInSphereTopological(e.getLocalRadius2()):e.pickVerticesInSphere(e.getLocalRadius2()),s.vec3.copy(t.center,e.getIntersectionPoint());var r=e.getPickedVertices();this._main.getStateManager().pushVertices(r);for(var n=e.getMesh().getVertices(),i=r.length,a=t.vProxy=new Float32Array(3*i),o=0;o<i;++o){var u=3*r[o],l=3*o;a[l]=n[u],a[l+1]=n[u+1],a[l+2]=n[u+2]}}},{key:"copyVerticesProxy",value:function(e,t){for(var r=e.getPickedVertices(),n=this.getMesh().getVertices(),i=t.vProxy,a=0,s=r.length;a<s;++a){var o=3*r[a],u=3*a;n[o]=i[u],n[o+1]=i[u+1],n[o+2]=i[u+2]}}},{key:"sculptStroke",value:function(){var e=this._main,t=e.getPicking(),r=e.getPickingSymmetry(),n=e.getSculptManager().getSymmetry()&&r.getMesh();t.updateAlpha(this._lockPosition),t.setIdAlpha(this._idAlpha),n&&(r.updateAlpha(!1),r.setIdAlpha(this._idAlpha)),this.copyVerticesProxy(t,this._moveData),n&&this.copyVerticesProxy(r,this._moveDataSym);var i=e._mouseX,a=e._mouseY;this.updateMoveDir(t,i,a),this.move(t.getPickedVertices(),t.getIntersectionPoint(),t.getLocalRadius2(),this._moveData,t),n&&(this.updateMoveDir(r,i,a,!0),this.move(r.getPickedVertices(),r.getIntersectionPoint(),r.getLocalRadius2(),this._moveDataSym,r));var s=this.getMesh();s.updateGeometry(s.getFacesFromVertices(t.getPickedVertices()),t.getPickedVertices()),n&&s.updateGeometry(s.getFacesFromVertices(r.getPickedVertices()),r.getPickedVertices()),this.updateRender(),e.setCanvasCursor("default")}},{key:"move",value:function(e,t,r,n,i){for(var a=this.getMesh(),s=a.getVertices(),o=a.getMaterials(),u=Math.sqrt(r),l=n.vProxy,c=t[0],h=t[1],f=t[2],d=n.dir,p=d[0],v=d[1],g=d[2],m=0,_=e.length;m<_;++m){var y=3*e[m],b=3*m,M=l[b],T=l[b+1],A=l[b+2],S=M-c,k=T-h,w=A-f,E=Math.sqrt(S*S+k*k+w*w)/u,x=E*E;x=3*x*x-4*x*E+1,x*=o[y+2]*i.getAlpha(M,T,A),s[y]+=p*x,s[y+1]+=v*x,s[y+2]+=g*x}}},{key:"updateMoveDir",value:function(e,t,r,n){var i=this.getMesh(),a=e.unproject(t,r,0),u=e.unproject(t,r,.1),l=s.mat4.create();s.mat4.invert(l,i.getMatrix()),s.vec3.transformMat4(a,a,l),s.vec3.transformMat4(u,u,l);var c=n?this._moveDataSym:this._moveData;if(n){var h=i.getSymmetryOrigin(),f=i.getSymmetryNormal();o.default.mirrorPoint(a,h,f),o.default.mirrorPoint(u,h,f)}if(this._negative){var d=s.vec3.dist(o.default.vertexOnLine(c.center,a,u),c.center);s.vec3.normalize(c.dir,e.computePickedNormal()),s.vec3.scale(c.dir,c.dir,t<this._lastMouseX?-d:d)}else s.vec3.sub(c.dir,o.default.vertexOnLine(c.center,a,u),c.center);s.vec3.scale(c.dir,c.dir,this._intensity);var p=e.getEyeDirection();s.vec3.sub(p,u,a),s.vec3.normalize(p,p)}}]),t}();t.default=l},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=r(1),o=n(r(0)),u=n(r(6)),l=n(r(28)),c=n(r(18)),h=n(r(9)),f=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=function(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r._radius=50,r._hardness=.25,r._intensity=1,r._negative=!0,r._culling=!1,r._idAlpha=0,r._lockPosition=!1,r._thickness=1,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.default),function(e,t,r){t&&a(e.prototype,t),r&&a(e,r)}(t,[{key:"pushState",value:function(){this._main.getStateManager().pushStateColorAndMaterial(this.getMesh())}},{key:"updateMeshBuffers",value:function(){var e=this.getMesh();e.isDynamic?e.updateBuffers():e.updateMaterialBuffer()}},{key:"stroke",value:function(e){l.default.prototype.stroke.call(this,e)}},{key:"dynamicTopology",value:function(e){return e.getPickedVertices()}},{key:"paint",value:function(e,t,r,n,i,a){for(var s=this.getMesh(),o=s.getVertices(),u=s.getMaterials(),l=Math.sqrt(r),c=t[0],h=t[1],f=t[2],d=2*(1-i),p=this._negative?-n:n,v=0,g=e.length;v<g;++v){var m=3*e[v],_=o[m],y=o[m+1],b=o[m+2],M=_-c,T=y-h,A=b-f,S=Math.sqrt(M*M+T*T+A*A)/l;S>1&&(S=1);var k=Math.pow(1-S,d);k*=p*a.getAlpha(_,y,b),u[m+2]=Math.min(Math.max(u[m+2]+k,0),1)}}},{key:"updateAndRenderMask",value:function(){var e=this.getMesh();e.updateDuplicateColorsAndMaterials(),e.updateDrawArrays(),this.updateRender()}},{key:"blur",value:function(){var e=this.getMesh(),t=this.getMaskedVertices();if(0!==t.length){t=e.expandsVertices(t,1),this.pushState(),this._main.getStateManager().pushVertices(t);var r=e.getMaterials(),n=t.length,i=new Float32Array(3*n);this.laplacianSmooth(t,i,r);for(var a=0;a<n;++a)r[3*t[a]+2]=i[3*a+2];this.updateAndRenderMask()}}},{key:"sharpen",value:function(){var e=this.getMesh(),t=this.getMaskedVertices();if(0!==t.length){this.pushState(),this._main.getStateManager().pushVertices(t);for(var r=e.getMaterials(),n=t.length,i=0;i<n;++i){var a=3*t[i]+2,s=r[a];r[a]=s>.5?Math.min(s+.1,1):Math.max(s-1,0)}this.updateAndRenderMask()}}},{key:"clear",value:function(){var e=this.getMesh(),t=this.getMaskedVertices();if(0!==t.length){this.pushState(),this._main.getStateManager().pushVertices(t);for(var r=e.getMaterials(),n=0,i=t.length;n<i;++n)r[3*t[n]+2]=1;this.updateAndRenderMask()}}},{key:"invert",value:function(e,t){var r=t;r||(r=this.getMesh()),e||this._main.getStateManager().pushStateCustom(this.invert.bind(this,!0,r));for(var n=r.getMaterials(),i=0,a=r.getNbVertices();i<a;++i)n[3*i+2]=1-n[3*i+2];this.updateAndRenderMask()}},{key:"remapAndMirrorIndices",value:function(e,t,r){var n=this.getMesh().getNbVertices(),i=new Uint32Array(o.default.getMemory(4*n),0,n),a=0,s=0,u=r.length;for(a=0;a<u;++a)i[r[a]]=a;var l=2*t;for(a=0;a<l;++a){s=4*a;var c=a<t?0:u;e[s]=i[e[s]]+c,e[s+1]=i[e[s+1]]+c,e[s+2]=i[e[s+2]]+c;var h=e[s+3];h!==o.default.TRI_INDEX&&(e[s+3]=i[h]+c)}var f=e.length/4;for(a=l;a<f;++a)e[s=4*a]=i[e[s]],e[s+1]=i[e[s+1]],e[s+2]=i[e[s+2]]+u,e[s+3]=i[e[s+3]]+u}},{key:"invertFaces",value:function(e){for(var t=0,r=e.length/4;t<r;++t){var n=4*t,i=e[n];e[n]=e[n+2],e[n+2]=i}}},{key:"extractFaces",value:function(e,t,r){for(var n=this.getMesh(),i=n.getFaces(),a=n.getMaterials(),s=n.getVerticesOnEdge(),u=0===this._thickness,l=e.length,c=new Uint32Array(o.default.getMemory(4*l*4*3),0,4*l*3),h=u?l:2*l,f=0;f<l;++f){var d=4*f,p=4*e[f],v=c[d]=i[p],g=c[d+1]=i[p+1],m=c[d+2]=i[p+2],_=c[d+3]=i[p+3];if(!u){var y=_!==o.default.TRI_INDEX,b=a[3*v+2]>=r||s[v]>=1,M=a[3*g+2]>=r||s[g]>=1,T=a[3*m+2]>=r||s[m]>=1,A=!!y&&(a[3*_+2]>=r||s[_]>=1);c[d+=4*l]=m,c[d+1]=g,c[d+2]=v,c[d+3]=_,M&&(b&&(c[d=4*h++]=c[d+3]=g,c[d+1]=c[d+2]=v),T&&(c[d=4*h++]=c[d+3]=m,c[d+1]=c[d+2]=g)),y?A&&(b&&(c[d=4*h++]=c[d+3]=v,c[d+1]=c[d+2]=_),T&&(c[d=4*h++]=c[d+3]=_,c[d+1]=c[d+2]=m)):b&&T&&(c[d=4*h++]=c[d+3]=v,c[d+1]=c[d+2]=m)}}var S=new Uint32Array(c.subarray(0,4*h));return this.remapAndMirrorIndices(S,l,t),this._thickness>0&&this.invertFaces(S),S}},{key:"extractVertices",value:function(e){var t=this.getMesh(),r=t.getVertices(),n=t.getNormals(),i=t.getMatrix(),a=s.mat3.normalFromMat4(s.mat3.create(),i),o=e.length,u=new Float32Array(2*o*3),l=[0,0,0],c=[0,0,0],h=3*o,f=this._thickness,d=.01;f<0&&(d=-d);for(var p=0;p<o;++p){var v=3*p,g=3*e[p];l[0]=r[g],l[1]=r[g+1],l[2]=r[g+2],c[0]=n[g],c[1]=n[g+1],c[2]=n[g+2],s.vec3.transformMat3(c,c,a),s.vec3.normalize(c,c),s.vec3.transformMat4(l,l,i),s.vec3.scaleAndAdd(l,l,c,d),u[v]=l[0],u[v+1]=l[1],u[v+2]=l[2],s.vec3.scaleAndAdd(l,l,c,f),u[v+=h]=l[0],u[v+1]=l[1],u[v+2]=l[2]}return u}},{key:"smoothBorder",value:function(e,t){for(var r=2*t.length,n=new Uint32Array(e.getNbFaces()-r),i=0,a=n.length;i<a;++i)n[i]=r+i;var s=e.expandsVertices(e.getVerticesFromFaces(n),1),o=new c.default;o.setToolMesh(e),o.smooth(s,1),o.smooth(s,1),o.smooth(s,1)}},{key:"extract",value:function(){var e=this.getMesh(),t=this.filterMaskedVertices(-1/0,.5);if(0!==t.length){var r=e.getFacesFromVertices(t);t=e.getVerticesFromFaces(r);var n=this.extractFaces(r,t,.5),i=this.extractVertices(t),a=new h.default(e.getGL());a.setVertices(i),a.setFaces(n),a.initColorsAndMaterials(),a.allocateArrays(),a.initTopology(),0!==this._thickness&&this.smoothBorder(a,r),a.updateGeometry(),a.updateDuplicateColorsAndMaterials(),a.copyRenderConfig(e),a.initRender();var s=this._main;s.addNewMesh(a),s.setMesh(e)}}}]),t}();t.default=f},function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._parent=t||null,this._depth=t?t._depth+1:0,this._children=[],this._aabbLoose=[1/0,1/0,1/0,-1/0,-1/0,-1/0],this._aabbSplit=[1/0,1/0,1/0,-1/0,-1/0,-1/0],this._iFaces=[],this._flag=0}return function(e,t,r){t&&n(e.prototype,t),r&&n(e,r)}(e,[{key:"resetNbFaces",value:function(e){var t=this._iFaces;t.length=e;for(var r=0;r<e;++r)t[r]=r}},{key:"build",value:function(t){var r=0,n=e.STACK;n[0]=this;for(var i=1,a=[];i>0;){var s=n[--i],o=s._iFaces.length;if(o>e.MAX_FACES&&s._depth<e.MAX_DEPTH){s.constructChildren(t);var u=s._children;for(r=0;r<8;++r)n[i+r]=u[r];i+=8}else o>0&&a.push(s)}var l=a.length;for(r=0;r<l;++r)a[r].constructLeaf(t)}},{key:"constructLeaf",value:function(e){for(var t=this._iFaces,r=t.length,n=1/0,i=1/0,a=1/0,s=-1/0,o=-1/0,u=-1/0,l=e.getFaceBoxes(),c=e.getFacePosInLeaf(),h=e.getFaceLeaf(),f=0;f<r;++f){var d=t[f];h[d]=this,c[d]=f;var p=l[d*=6],v=l[d+1],g=l[d+2],m=l[d+3],_=l[d+4],y=l[d+5];p<n&&(n=p),m>s&&(s=m),v<i&&(i=v),_>o&&(o=_),g<a&&(a=g),y>u&&(u=y)}this.expandsAabbLoose(n,i,a,s,o,u)}},{key:"constructChildren",value:function(t){for(var r=this._aabbSplit,n=r[0],i=r[1],a=r[2],s=r[3],o=r[4],u=r[5],l=.5*(s-n),c=.5*(o-i),h=.5*(u-a),f=.5*(s+n),d=.5*(o+i),p=.5*(u+a),v=new e(this),g=new e(this),m=new e(this),_=new e(this),y=new e(this),b=new e(this),M=new e(this),T=new e(this),A=v._iFaces,S=g._iFaces,k=m._iFaces,w=_._iFaces,E=y._iFaces,x=b._iFaces,R=M._iFaces,C=T._iFaces,P=t.getFaceCenters(),F=this._iFaces,D=F.length,I=0;I<D;++I){var N=F[I],V=3*N,L=P[V],O=P[V+1],U=P[V+2];L>f?O>d?U>p?R.push(N):x.push(N):U>p?k.push(N):S.push(N):O>d?U>p?C.push(N):E.push(N):U>p?w.push(N):A.push(N)}v.setAabbSplit(n,i,a,f,d,p),g.setAabbSplit(n+l,i,a,f+l,d,p),m.setAabbSplit(f,d-c,p,s,o-c,u),_.setAabbSplit(n,i,a+h,f,d,p+h),y.setAabbSplit(n,i+c,a,f,d+c,p),b.setAabbSplit(f,d,p-h,s,o,u-h),M.setAabbSplit(f,d,p,s,o,u),T.setAabbSplit(f-l,d,p,s-l,o,u),this._children.length=0,this._children.push(v,g,m,_,y,b,M,T),F.length=0}},{key:"setAabbSplit",value:function(e,t,r,n,i,a){var s=this._aabbSplit;s[0]=e,s[1]=t,s[2]=r,s[3]=n,s[4]=i,s[5]=a}},{key:"setAabbLoose",value:function(e,t,r,n,i,a){var s=this._aabbLoose;s[0]=e,s[1]=t,s[2]=r,s[3]=n,s[4]=i,s[5]=a}},{key:"collectIntersectRay",value:function(t,r,n,i){var a=t[0],s=t[1],o=t[2],u=1/r[0],l=1/r[1],c=1/r[2],h=0,f=e.STACK;f[0]=this;for(var d=1;d>0;){var p=f[--d],v=p._aabbLoose,g=(v[0]-a)*u,m=(v[3]-a)*u,_=(v[1]-s)*l,y=(v[4]-s)*l,b=(v[2]-o)*c,M=(v[5]-o)*c,T=Math.max(Math.min(g,m),Math.min(_,y),Math.min(b,M)),A=Math.min(Math.max(g,m),Math.max(_,y),Math.max(b,M));if(!(A<0||T>A)){var S=p._children;if(8===S.length){for(var k=0;k<8;++k)f[d+k]=S[k];d+=8}else{i&&i.push(p);var w=p._iFaces;n.set(w,h),h+=w.length}}}return new Uint32Array(n.subarray(0,h))}},{key:"collectIntersectSphere",value:function(t,r,n,i){var a=t[0],s=t[1],o=t[2],u=0,l=e.STACK;l[0]=this;for(var c=1;c>0;){var h=l[--c],f=h._aabbLoose,d=0,p=0,v=0;if(d=f[0]>a?f[0]-a:f[3]<a?f[3]-a:0,p=f[1]>s?f[1]-s:f[4]<s?f[4]-s:0,v=f[2]>o?f[2]-o:f[5]<o?f[5]-o:0,!(d*d+p*p+v*v>r)){var g=h._children;if(8===g.length){for(var m=0;m<8;++m)l[c+m]=g[m];c+=8}else{i&&i.push(h);var _=h._iFaces;n.set(_,u),u+=_.length}}}return new Uint32Array(n.subarray(0,u))}},{key:"addFace",value:function(t,r,n,i,a,s,o,u,l,c){var h=e.STACK;h[0]=this;for(var f=1;f>0;){var d=h[--f],p=d._aabbSplit;if(!(u<=p[0])&&!(l<=p[1]||c<=p[2]||u>p[3]||l>p[4]||c>p[5])){var v=d._aabbLoose;r<v[0]&&(v[0]=r),n<v[1]&&(v[1]=n),i<v[2]&&(v[2]=i),a>v[3]&&(v[3]=a),s>v[4]&&(v[4]=s),o>v[5]&&(v[5]=o);var g=d._children;if(8!==g.length)return d._iFaces.push(t),d;for(var m=0;m<8;++m)h[f+m]=g[m];f+=8}}}},{key:"pruneIfPossible",value:function(){for(var e=this;e._parent;){var t=e._parent,r=t._children;if(0===r.length)return;for(var n=0;n<8;++n){var i=r[n];if(i._iFaces.length>0||8===i._children.length)return}r.length=0,e=t}}},{key:"expandsAabbLoose",value:function(e,t,r,n,i,a){for(var s=this;s;){var o=s._aabbLoose,u=!1;e<o[0]&&(o[0]=e,u=!0),t<o[1]&&(o[1]=t,u=!0),r<o[2]&&(o[2]=r,u=!0),n>o[3]&&(o[3]=n,u=!0),i>o[4]&&(o[4]=i,u=!0),a>o[5]&&(o[5]=a,u=!0),s=u?s._parent:null}}}]),e}();i.FLAG=0,i.MAX_DEPTH=8,i.MAX_FACES=100,function(){for(var e=1+7*i.MAX_DEPTH,t=i.STACK=new Array(e),r=0;r<e;++r)t[r]=null}();var a=i;t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(1),i=function(){return{_center:n.vec3.create(),_matrix:n.mat4.create(),_editMatrix:n.mat4.create(),_symmetryNormal:[1,0,0],_lastComputedMV:n.mat4.create(),_lastComputedMVP:n.mat4.create(),_lastComputedN:n.mat3.create(),_lastComputedEN:n.mat3.create(),_lastComputedDepth:0,_lastWorldBound:[1/0,1/0,1/0,-1/0,-1/0,-1/0]}};t.default=i},function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(r(6)),s=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=function(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r._radius=50,r._culling=!1,r._idAlpha=0,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),function(e,t,r){t&&i(e.prototype,t),r&&i(e,r)}(t,[{key:"startSculpt",value:function(){var e=this._main;if(e.getSculptManager().getSymmetry()){var t=e.getPickingSymmetry();t.intersectionMouseMesh(),t.setLocalRadius2(e.getPicking().getLocalRadius2())}}},{key:"sculptStroke",value:function(){var e=this._main,t=e._mouseX-e._lastMouseX,r=e.getPicking(),n=r.getLocalRadius2();if(r.pickVerticesInSphere(n),this.stroke(r,t),e.getSculptManager().getSymmetry()){var i=e.getPickingSymmetry();i.getMesh()&&(i.pickVerticesInSphere(n),this.stroke(i,t))}this.updateRender()}},{key:"stroke",value:function(e,t){var r=e.getPickedVertices();this._main.getStateManager().pushVertices(r),r=this.dynamicTopology(e),this._culling&&(r=this.getFrontVertices(r,e.getEyeDirection())),e.updateAlpha(!1),e.setIdAlpha(this._idAlpha),this.scale(r,e.getIntersectionPoint(),e.getLocalRadius2(),t,e);var n=this.getMesh();n.updateGeometry(n.getFacesFromVertices(r),r)}},{key:"scale",value:function(e,t,r,n,i){for(var a=this.getMesh(),s=a.getVertices(),o=a.getMaterials(),u=.01*n,l=Math.sqrt(r),c=t[0],h=t[1],f=t[2],d=0,p=e.length;d<p;++d){var v=3*e[d],g=s[v],m=s[v+1],_=s[v+2],y=g-c,b=m-h,M=_-f,T=Math.sqrt(y*y+b*b+M*M)/l,A=T*T;A=3*A*A-4*A*T+1,A*=u*o[v+2]*i.getAlpha(g,m,_),s[v]=g+y*A,s[v+1]=m+b*A,s[v+2]=_+M*A}}}]),t}();t.default=s},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=r(1),o=n(r(84)),u=n(r(6)),l=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=function(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r._gizmo=new o.default(e),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.default),function(e,t,r){t&&a(e.prototype,t),r&&a(e,r)}(t,[{key:"isIdentity",value:function(e){return 1===e[0]&&1===e[5]&&1===e[10]&&1===e[15]&&(0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&(0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&(0===e[11]&&0===e[12]&&0===e[13]&&0===e[14])))}},{key:"preUpdate",value:function(){var e=this._main.getPicking(),t=e.getMesh();this._gizmo.onMouseOver(),e._mesh=t,this._main.setCanvasCursor("default")}},{key:"start",value:function(e){var t=this._main,r=this.getMesh(),n=t.getPicking();return r&&this._gizmo.onMouseDown()?(this.pushState(),n._mesh=r,!0):!!n.intersectionMouseMeshes(t.getMeshes(),t._mouseX,t._mouseY)&&(!!t.setOrUnsetMesh(n.getMesh(),e)&&(this._lastMouseX=t._mouseX,this._lastMouseY=t._mouseY,!1))}},{key:"end",value:function(){this._gizmo.onMouseUp();var e=this.getMesh();if(e&&!this.isIdentity(e.getEditMatrix())){var t=this.getUnmaskedVertices();this._main.getStateManager().pushVertices(t),this.applyEditMatrix(t),0!==t.length&&this.updateMeshBuffers()}}},{key:"applyEditMatrix",value:function(e){for(var t=this.getMesh(),r=t.getEditMatrix(),n=t.getMaterials(),i=t.getVertices(),a=[0,0,0],o=0,u=e.length;o<u;++o){var l=3*e[o],c=n[l+2],h=a[0]=i[l],f=a[1]=i[l+1],d=a[2]=i[l+2];s.vec3.transformMat4(a,a,r);var p=1-c;i[l]=h*p+a[0]*c,i[l+1]=f*p+a[1]*c,i[l+2]=d*p+a[2]*c}s.vec3.transformMat4(t.getCenter(),t.getCenter(),r),s.mat4.identity(r),e.length===t.getNbVertices()?t.updateGeometry():t.updateGeometry(t.getFacesFromVertices(e),e)}},{key:"update",value:function(){}},{key:"postRender",value:function(){this.getMesh()&&this._gizmo.render()}},{key:"addSculptToScene",value:function(e){this.getMesh()&&this._gizmo.addGizmoToScene(e)}}]),t}();t.default=l},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=r(1),o=n(r(29)),u=n(r(2)),l=s.vec3.fromValues(.7,.2,.2),c=s.vec3.fromValues(.2,.7,.2),h=s.vec3.fromValues(.2,.2,.7),f=s.vec3.fromValues(.4,.4,.4),d=s.vec3.fromValues(.8,.4,.2),p=s.quat.create(),v=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return{_finalMatrix:s.mat4.create(),_baseMatrix:s.mat4.create(),_color:s.vec3.create(),_colorSelect:s.vec3.fromValues(1,1,0),_drawGeo:null,_pickGeo:null,_isSelected:!1,_type:e,_nbAxis:t,_lastInter:[0,0,0],updateMatrix:function(){s.mat4.copy(this._drawGeo.getMatrix(),this._finalMatrix),s.mat4.copy(this._pickGeo.getMatrix(),this._finalMatrix)},updateFinalMatrix:function(e){s.mat4.mul(this._finalMatrix,e,this._baseMatrix)}}},g=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=t,this._gl=t._gl,this._activatedType=e.TRANS_XYZ|e.ROT_XYZ|e.PLANE_XYZ|e.SCALE_XYZW|e.ROT_W,this._transX=v(e.TRANS_X,0),this._transY=v(e.TRANS_Y,1),this._transZ=v(e.TRANS_Z,2),this._planeX=v(e.PLANE_X,0),this._planeY=v(e.PLANE_Y,1),this._planeZ=v(e.PLANE_Z,2),this._scaleX=v(e.SCALE_X,0),this._scaleY=v(e.SCALE_Y,1),this._scaleZ=v(e.SCALE_Z,2),this._scaleW=v(e.SCALE_W),this._rotX=v(e.ROT_X,0),this._rotY=v(e.ROT_Y,1),this._rotZ=v(e.ROT_Z,2),this._rotW=v(e.ROT_W),this._lineHelper=o.default.createLine2D(this._gl),this._lineHelper.setShaderType(u.default.Shader.FLAT),this._lastDistToEye=0,this._isEditing=!1,this._selected=null,this._pickables=[],this._editLineOrigin=[0,0,0],this._editLineDirection=[0,0,0],this._editOffset=[0,0,0],this._editLocal=s.mat4.create(),this._editTrans=s.mat4.create(),this._editScaleRot=s.mat4.create(),this._editLocalInv=s.mat4.create(),this._editTransInv=s.mat4.create(),this._editScaleRotInv=s.mat4.create(),this._initTranslate(),this._initRotate(),this._initScale(),this._initPickables()}return a(e,null,[{key:"TRANS_X",get:function(){return 1}},{key:"TRANS_Y",get:function(){return 2}},{key:"TRANS_Z",get:function(){return 4}},{key:"ROT_X",get:function(){return 8}},{key:"ROT_Y",get:function(){return 16}},{key:"ROT_Z",get:function(){return 32}},{key:"ROT_W",get:function(){return 64}},{key:"PLANE_X",get:function(){return 128}},{key:"PLANE_Y",get:function(){return 256}},{key:"PLANE_Z",get:function(){return 512}},{key:"SCALE_X",get:function(){return 1024}},{key:"SCALE_Y",get:function(){return 2048}},{key:"SCALE_Z",get:function(){return 4096}},{key:"SCALE_W",get:function(){return 8192}},{key:"TRANS_XYZ",get:function(){return 7}},{key:"ROT_XYZ",get:function(){return 56}},{key:"PLANE_XYZ",get:function(){return 896}},{key:"SCALE_XYZW",get:function(){return 15360}}]),a(e,[{key:"setActivatedType",value:function(e){this._activatedType=e,this._initPickables()}},{key:"_initPickables",value:function(){var e=this._pickables;e.length=0;var t=this._activatedType;1&t&&e.push(this._transX._pickGeo),2&t&&e.push(this._transY._pickGeo),4&t&&e.push(this._transZ._pickGeo),128&t&&e.push(this._planeX._pickGeo),256&t&&e.push(this._planeY._pickGeo),512&t&&e.push(this._planeZ._pickGeo),8&t&&e.push(this._rotX._pickGeo),16&t&&e.push(this._rotY._pickGeo),32&t&&e.push(this._rotZ._pickGeo),1024&t&&e.push(this._scaleX._pickGeo),2048&t&&e.push(this._scaleY._pickGeo),4096&t&&e.push(this._scaleZ._pickGeo),8192&t&&e.push(this._scaleW._pickGeo)}},{key:"_createArrow",value:function(e,t,r){var n=e._baseMatrix;s.mat4.rotate(n,n,.5*Math.PI,t),s.mat4.translate(n,n,[0,1.25,0]),s.vec3.copy(e._color,r),e._pickGeo=o.default.createArrow(this._gl,.1,2.5,6*.4),e._pickGeo._gizmo=e,e._drawGeo=o.default.createArrow(this._gl,.02,2.5,6,.25),e._drawGeo.setShaderType(u.default.Shader.FLAT)}},{key:"_createPlane",value:function(e,t,r,n,i,a,l,c){s.vec3.copy(e._color,t),e._pickGeo=o.default.createPlane(this._gl,0,0,0,r,n,i,a,l,c),e._pickGeo._gizmo=e,e._drawGeo=o.default.createPlane(this._gl,0,0,0,r,n,i,a,l,c),e._drawGeo.setShaderType(u.default.Shader.FLAT)}},{key:"_initTranslate",value:function(){var e=[0,0,0];this._createArrow(this._transX,s.vec3.set(e,0,0,-1),l),this._createArrow(this._transY,s.vec3.set(e,0,1,0),c),this._createArrow(this._transZ,s.vec3.set(e,1,0,0),h);this._createPlane(this._planeX,l,0,.5,0,0,0,.5),this._createPlane(this._planeY,c,.5,0,0,0,0,.5),this._createPlane(this._planeZ,h,.5,0,0,0,.5,0)}},{key:"_createCircle",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;s.vec3.copy(e._color,r),e._pickGeo=o.default.createTorus(this._gl,n,.1*i,t,6,64),e._pickGeo._gizmo=e,e._drawGeo=o.default.createTorus(this._gl,n,.02*i,t,6,64),e._drawGeo.setShaderType(u.default.Shader.FLAT)}},{key:"_initRotate",value:function(){this._createCircle(this._rotX,Math.PI,l),this._createCircle(this._rotY,Math.PI,c),this._createCircle(this._rotZ,Math.PI,h),this._createCircle(this._rotW,2*Math.PI,f)}},{key:"_createCube",value:function(e,t,r){var n=e._baseMatrix;s.mat4.rotate(n,n,.5*Math.PI,t),s.mat4.translate(n,n,[0,1.5,0]),s.vec3.copy(e._color,r),e._pickGeo=o.default.createCube(this._gl,.42),e._pickGeo._gizmo=e,e._drawGeo=o.default.createCube(this._gl,.35),e._drawGeo.setShaderType(u.default.Shader.FLAT)}},{key:"_initScale",value:function(){var e=[0,0,0];this._createCube(this._scaleX,s.vec3.set(e,0,0,-1),l),this._createCube(this._scaleY,s.vec3.set(e,0,1,0),c),this._createCube(this._scaleZ,s.vec3.set(e,1,0,0),h),this._createCircle(this._scaleW,2*Math.PI,d,1.5*1.3,2)}},{key:"_updateArcRotation",value:function(e){p[0]=e[2],p[1]=0,p[2]=-e[0],p[3]=1+e[1],s.quat.normalize(p,p),s.mat4.fromQuat(this._rotW._baseMatrix,p),s.mat4.fromQuat(this._scaleW._baseMatrix,p),s.quat.rotateZ(p,s.quat.identity(p),.5*Math.PI),s.quat.rotateY(p,p,Math.atan2(-e[1],-e[2])),s.mat4.fromQuat(this._rotX._baseMatrix,p),s.quat.rotateY(p,s.quat.identity(p),Math.atan2(-e[0],-e[2])),s.mat4.fromQuat(this._rotY._baseMatrix,p),s.quat.rotateX(p,s.quat.identity(p),.5*Math.PI),s.quat.rotateY(p,p,Math.atan2(-e[0],e[1])),s.mat4.fromQuat(this._rotZ._baseMatrix,p)}},{key:"_computeCenterGizmo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0],t=this._main.getMesh();return t&&(s.vec3.copy(e,t.getCenter()),s.vec3.transformMat4(e,e,t.getEditMatrix()),s.vec3.transformMat4(e,e,t.getMatrix())),e}},{key:"_updateMatrices",value:function(){var e=this._main.getCamera(),t=this._computeCenterGizmo(),r=e.computePosition();this._lastDistToEye=this._isEditing?this._lastDistToEye:s.vec3.dist(r,t);var n=80*this._lastDistToEye/e.getConstantScreen(),i=s.mat4.create();s.mat4.translate(i,i,t),s.mat4.scale(i,i,[n,n,n]),this._updateArcRotation(s.vec3.normalize(r,s.vec3.sub(r,t,r))),this._transX.updateFinalMatrix(i),this._transY.updateFinalMatrix(i),this._transZ.updateFinalMatrix(i),this._planeX.updateFinalMatrix(i),this._planeY.updateFinalMatrix(i),this._planeZ.updateFinalMatrix(i),this._rotX.updateFinalMatrix(i),this._rotY.updateFinalMatrix(i),this._rotZ.updateFinalMatrix(i),this._rotW.updateFinalMatrix(i),this._scaleX.updateFinalMatrix(i),this._scaleY.updateFinalMatrix(i),this._scaleZ.updateFinalMatrix(i),this._scaleW.updateFinalMatrix(i)}},{key:"_drawGizmo",value:function(e){e.updateMatrix();var t=e._drawGeo;t.setFlatColor(e._isSelected?e._colorSelect:e._color),t.updateMatrices(this._main.getCamera()),t.render(this._main)}},{key:"_updateLineHelper",value:function(e,t,r,n){var i=this._lineHelper.getVertices(),a=this._main,s=a.getCanvasWidth(),o=a.getCanvasHeight();i[0]=e/s*2-1,i[1]=(o-t)/o*2-1,i[3]=r/s*2-1,i[4]=(o-n)/o*2-1,this._lineHelper.updateVertexBuffer()}},{key:"_saveEditMatrices",value:function(){s.mat4.copy(this._editLocal,this._main.getMesh().getMatrix());var e=this._computeCenterGizmo();s.mat4.translate(this._editTrans,s.mat4.identity(this._editTrans),e),s.mat4.copy(this._editScaleRot,this._editLocal),this._editScaleRot[12]=this._editScaleRot[13]=this._editScaleRot[14]=0,s.mat4.invert(this._editLocalInv,this._editLocal),s.mat4.invert(this._editTransInv,this._editTrans),s.mat4.invert(this._editScaleRotInv,this._editScaleRot)}},{key:"_startRotateEdit",value:function(){var e=this._main,t=e.getCamera(),r=[0,0,0];this._computeCenterGizmo(r),s.vec3.copy(r,t.project(r));var n=this._editLineDirection,i=0===this._selected._nbAxis?-1:1,a=this._selected._lastInter;s.vec3.set(n,-i*a[2],-i*a[1],i*a[0]),s.vec3.transformMat4(n,n,this._selected._finalMatrix),s.vec3.copy(n,t.project(n)),s.vec2.normalize(n,s.vec2.sub(n,n,r)),s.vec2.set(this._editLineOrigin,e._mouseX,e._mouseY)}},{key:"_startTranslateEdit",value:function(){var e=this._main,t=e.getCamera(),r=this._editLineOrigin,n=this._editLineDirection;this._computeCenterGizmo(r);var i=this._selected._nbAxis;-1!==i&&(s.vec3.set(n,0,0,0)[i]=1),s.vec3.add(n,r,n),s.vec3.copy(r,t.project(r)),s.vec3.copy(n,t.project(n)),s.vec2.normalize(n,s.vec2.sub(n,n,r));var a=this._editOffset;a[0]=e._mouseX-r[0],a[1]=e._mouseY-r[1]}},{key:"_startPlaneEdit",value:function(){var e=this._main,t=e.getCamera(),r=this._editLineOrigin;this._computeCenterGizmo(r),s.vec3.copy(r,t.project(r));var n=this._editOffset;n[0]=e._mouseX-r[0],n[1]=e._mouseY-r[1],s.vec2.set(this._editLineOrigin,e._mouseX,e._mouseY)}},{key:"_startScaleEdit",value:function(){this._startTranslateEdit()}},{key:"_updateRotateEdit",value:function(){var e=this._main,t=e.getMesh(),r=this._editLineOrigin,n=this._editLineDirection,i=[e._mouseX,e._mouseY,0];s.vec2.sub(i,i,r);var a=s.vec2.dot(i,n);this._updateLineHelper(r[0],r[1],r[0]+n[0]*a,r[1]+n[1]*a);var o=7*a/Math.min(e.getCanvasWidth(),e.getCanvasHeight());o%=2*Math.PI;var u=this._selected._nbAxis,l=t.getEditMatrix();s.mat4.identity(l),0===u?s.mat4.rotateX(l,l,-o):1===u?s.mat4.rotateY(l,l,-o):2===u&&s.mat4.rotateZ(l,l,-o),this._scaleRotateEditMatrix(l),e.render()}},{key:"_updateTranslateEdit",value:function(){var e=this._main,t=e.getCamera(),r=e.getMesh(),n=this._editLineOrigin,i=this._editLineDirection,a=[e._mouseX,e._mouseY,0];s.vec2.sub(a,a,n),s.vec2.sub(a,a,this._editOffset),s.vec2.scaleAndAdd(a,n,i,s.vec2.dot(a,i)),this._updateLineHelper(n[0],n[1],a[0],a[1]);var o=t.unproject(a[0],a[1],0),u=t.unproject(a[0],a[1],.1);s.vec3.transformMat4(o,o,this._editTransInv),s.vec3.transformMat4(u,u,this._editTransInv),s.vec3.normalize(a,s.vec3.sub(a,u,o));var l=[0,0,0];l[this._selected._nbAxis]=1;var c=-s.vec3.dot(a,l),h=s.vec3.dot(o,a),f=Math.abs(1-c*c),d=-s.vec3.dot(o,l);l[this._selected._nbAxis]=(c*h-d)/f,s.vec3.transformMat4(l,l,this._editScaleRotInv);var p=r.getEditMatrix();s.mat4.identity(p),s.mat4.translate(p,p,l),e.render()}},{key:"_updatePlaneEdit",value:function(){var e=this._main,t=e.getCamera(),r=e.getMesh(),n=[e._mouseX,e._mouseY,0];s.vec2.sub(n,n,this._editOffset),this._updateLineHelper(this._editLineOrigin[0],this._editLineOrigin[1],e._mouseX,e._mouseY);var i=t.unproject(n[0],n[1],0),a=t.unproject(n[0],n[1],.1);s.vec3.transformMat4(i,i,this._editTransInv),s.vec3.transformMat4(a,a,this._editTransInv);var o=[0,0,0];o[this._selected._nbAxis]=1;var u=s.vec3.dot(i,o),l=s.vec3.dot(a,o);if(u===l)return!1;var c=-u/(l-u);o[0]=i[0]+(a[0]-i[0])*c,o[1]=i[1]+(a[1]-i[1])*c,o[2]=i[2]+(a[2]-i[2])*c,s.vec3.transformMat4(o,o,this._editScaleRotInv);var h=r.getEditMatrix();s.mat4.identity(h),s.mat4.translate(h,h,o),e.render()}},{key:"_updateScaleEdit",value:function(){var e=this._main,t=e.getMesh(),r=this._editLineOrigin,n=this._editLineDirection,i=this._selected._nbAxis,a=[e._mouseX,e._mouseY,0];-1!==i&&(s.vec2.sub(a,a,r),s.vec2.scaleAndAdd(a,r,n,s.vec2.dot(a,n))),this._updateLineHelper(r[0],r[1],a[0],a[1]);var o=s.vec3.len(this._editOffset),u=[1,1,1],l=Math.max(-.99,(s.vec2.dist(r,a)-o)/o);-1===i?(u[0]+=l,u[1]+=l,u[2]+=l):u[i]+=l;var c=t.getEditMatrix();s.mat4.identity(c),s.mat4.scale(c,c,u),this._scaleRotateEditMatrix(c),e.render()}},{key:"_scaleRotateEditMatrix",value:function(e){s.mat4.mul(e,this._editTrans,e),s.mat4.mul(e,e,this._editTransInv),s.mat4.mul(e,this._editLocalInv,e),s.mat4.mul(e,e,this._editLocal)}},{key:"addGizmoToScene",value:function(e){return e.push(this._transX._drawGeo),e.push(this._transY._drawGeo),e.push(this._transZ._drawGeo),e.push(this._planeX._drawGeo),e.push(this._planeY._drawGeo),e.push(this._planeZ._drawGeo),e.push(this._rotX._drawGeo),e.push(this._rotY._drawGeo),e.push(this._rotZ._drawGeo),e.push(this._rotW._drawGeo),e.push(this._scaleX._drawGeo),e.push(this._scaleY._drawGeo),e.push(this._scaleZ._drawGeo),e.push(this._scaleW._drawGeo),e}},{key:"render",value:function(){this._updateMatrices();var e=this._isEditing&&this._selected?this._selected._type:this._activatedType;64&e&&this._drawGizmo(this._rotW),1&e&&this._drawGizmo(this._transX),2&e&&this._drawGizmo(this._transY),4&e&&this._drawGizmo(this._transZ),128&e&&this._drawGizmo(this._planeX),256&e&&this._drawGizmo(this._planeY),512&e&&this._drawGizmo(this._planeZ),8&e&&this._drawGizmo(this._rotX),16&e&&this._drawGizmo(this._rotY),32&e&&this._drawGizmo(this._rotZ),1024&e&&this._drawGizmo(this._scaleX),2048&e&&this._drawGizmo(this._scaleY),4096&e&&this._drawGizmo(this._scaleZ),8192&e&&this._drawGizmo(this._scaleW),this._isEditing&&this._lineHelper.render(this._main)}},{key:"onMouseOver",value:function(){if(this._isEditing){var e=this._selected._type;return 56&e?this._updateRotateEdit():7&e?this._updateTranslateEdit():896&e?this._updatePlaneEdit():15360&e&&this._updateScaleEdit(),!0}var t=this._main,r=t.getPicking(),n=t._mouseX,i=t._mouseY,a=this._pickables;r.intersectionMouseMeshes(a,n,i),this._selected&&(this._selected._isSelected=!1);var o=r.getMesh();return o?(this._selected=o._gizmo,this._selected._isSelected=!0,s.vec3.copy(this._selected._lastInter,r.getIntersectionPoint()),!0):(this._selected=null,!1)}},{key:"onMouseDown",value:function(){var e=this._selected;if(!e)return!1;this._isEditing=!0;var t=e._type;return this._saveEditMatrices(),56&t?this._startRotateEdit():7&t?this._startTranslateEdit():896&t?this._startPlaneEdit():15360&t&&this._startScaleEdit(),!0}},{key:"onMouseUp",value:function(){this._isEditing=!1}}]),e}();t.default=g},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(0)),a=n(r(9)),s=n(r(11)),o=function(e,t){this.previous=null,this.next=null,this.v1=e,this.v2=t},u=function(e){if(!(e.length<=2)){var t=e.length,r=e[0].v1,n=e[0].v2,i=e[0],a=i;e[0]=e[--t];for(var s=0;s<t;){var o=e[s];if(o.v1===n){if(o.previous=a,a.next=o,a=o,n=e[s].v2,e[s]=e[--t],n===r)break;s=0}else s++}if(e.length=t,n===r)return i.previous=a,a.next=i,i}},l=function(e,t,r,n,a,s){var o=e.getVertices(),u=e.getColors(),l=e.getMaterials(),c=e.getNbVertices()+n.length/3,h=t,f=0,d=0,p=0,v=0,g=0,m=0,_=0,y=0,b=0,M=0;do{var T=h.next,A=h.v1,S=h.v2,k=T.v2;r.push(A,S,c,i.default.TRI_INDEX),S*=3,k*=3,M++,f+=o[A*=3],d+=o[A+1],p+=o[A+2],v+=u[A],g+=u[A+1],m+=u[A+2],_+=l[A],y+=l[A+1],b+=l[A+2];var w=o[S],E=o[S+1],x=o[S+2],R=o[A]-w,C=o[A+1]-E,P=o[A+2]-x,F=o[k]-w,D=o[k+1]-E,I=o[k+2]-x,N=R*R+C*C+P*P,V=F*F+D*D+I*I;h.angle=Math.acos((R*F+C*D+P*I)/Math.sqrt(N*V)),h=T}while(h!==t);n.push(f/M,d/M,p/M),a.push(v/M,g/M,m/M),s.push(_/M,y/M,b/M)},c=function(e,t,r,n,i){var o=new a.default;return o.setID(e.getID()),o.setVertices(t),n&&o.setColors(n),i&&o.setMaterials(i),o.setFaces(r),o.setTransformData(e.getTransformData()),o.setRenderData(e.getRenderData()),s.default.OPTIMIZE=!1,o.init(),s.default.OPTIMIZE=!0,o},h=function(e){var t=function(e){for(var t=e.getEdges(),r=e.getFaces(),n=e.getFaceEdges(),a=[],s=0,l=e.getNbFaces();s<l;++s){var c=4*s,h=n[c+3],f=h!==i.default.TRI_INDEX;1===t[n[c]]&&a.push(new o(r[c],r[c+1])),1===t[n[c+1]]&&a.push(new o(r[c+1],r[c+2])),1===t[n[c+2]]&&a.push(new o(r[c+2],r[f?c+3:c])),f&&1===t[h]&&a.push(new o(r[c+3],r[c]))}for(var d=[];;){var p=u(a);if(!p)break;d.push(p)}return d}(e);if(0===t.length)return e;for(var r=[],n=[],a=[],s=[],h=0,f=t.length;h<f;++h)l(e,t[h],r,n,a,s);var d=3*e.getNbVertices(),p=d+n.length,v=new Float32Array(p);v.set(e.getVertices().subarray(0,d));var g=new Float32Array(p);g.set(e.getColors().subarray(0,d));var m=new Float32Array(p);m.set(e.getMaterials().subarray(0,d)),p>d&&(v.set(n,d),g.set(a,d),m.set(s,d));var _=new Uint32Array(4*e.getNbFaces()+r.length);return _.set(e.getFaces()),r.length>0&&_.set(r,4*e.getNbFaces()),c(e,v,_,g,m)},f={};f.createClosedMesh=function(e){var t=h(e);if(t===e){var r=3*e.getNbVertices(),n=4*e.getNbFaces(),i=new Uint32Array(e.getFaces().subarray(0,n)),a=new Float32Array(e.getVertices().subarray(0,r)),s=new Float32Array(e.getColors().subarray(0,r)),o=new Float32Array(e.getMaterials().subarray(0,r));t=c(e,a,i,s,o)}return t};var d=f;t.default=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={};n.BLOCK=!1;var i=function(){for(var e=new Uint32Array(24),t=0,r=0;r<8;++r)for(var n=1;n<=4;n<<=1){var i=r^n;r<=i&&(e[t++]=r,e[t++]=i)}return e}(),a=function(e){for(var t=new Uint32Array(256),r=0;r<256;++r){for(var n=0,i=0;i<24;i+=2)n|=!!(r&1<<e[i])!=!!(r&1<<e[i+1])?1<<(i>>1):0;t[r]=n}return t}(i),s=function(e,t,r,n,i,a){for(var s=e.colorField,o=e.materialField,u=e.distanceField,l=0,c=0,h=0,f=0,d=0,p=0,v=0,g=0,m=0,_=r[0],y=r[0]*r[1],b=0;b<2;++b)for(var M=0;M<2;++M)for(var T=0;T<2;++T){var A=n+T+M*_+b*y,S=3*A,k=u[A];t[m]=k,g|=k<0?1<<m:0,m++,k!==1/0&&(v+=k=Math.min(1/Math.abs(k),1e15),l+=s[S]*k,c+=s[S+1]*k,h+=s[S+2]*k,f+=o[S]*k,d+=o[S+1]*k,p+=o[S+2]*k)}return 0!==g&&255!==g&&(v>0&&(v=1/v),i.push(l*v,c*v,h*v),a.push(f*v,d*v,p*v)),g},o=[0,0,0],u=function(e,t,r,i,a){o[0]=o[1]=o[2]=0;for(var s=0,u=0;u<12;++u)if(e&1<<u&&(++s,!n.BLOCK)){var l=t[u<<1],c=t[1+(u<<1)],h=r[l],f=h-r[c];if(!(Math.abs(f)<1e-7)){f=h/f;for(var d=0,p=1;d<3;++d,p<<=1){var v=l&p;o[d]+=v!==(c&p)?v?1-f:f:v?1:0}}}for(var g=1/s,m=0;m<3;++m)o[m]=i[m]+g*o[m];a.push(o[0],o[1],o[2])},l=function(e,t,r,n,i,a,s){for(var o=0;o<3;++o)if(e&1<<o){var u=(o+1)%3,l=(o+2)%3;if(0!==a[u]&&0!==a[l]){var c=n[u],h=n[l];1&t?s.push(r[i],r[i-c],r[i-c-h],r[i-h]):s.push(r[i],r[i-h],r[i-c-h],r[i-c])}}};n.computeSurface=function(e){var t=e.dims,r=[],n=[],o=[],c=[],h=0,f=new Int32Array(3),d=new Int32Array([1,t[0]+1,(t[0]+1)*(t[1]+1)]),p=new Float32Array(8),v=1,g=new Int32Array(2*d[2]);for(f[2]=0;f[2]<t[2]-1;++f[2],h+=t[0],v^=1,d[2]=-d[2]){var m=1+(t[0]+1)*(1+v*(t[1]+1));for(f[1]=0;f[1]<t[1]-1;++f[1],++h,m+=2)for(f[0]=0;f[0]<t[0]-1;++f[0],++h,++m){var _=s(e,p,t,h,n,o);if(0!==_&&255!==_){var y=a[_];g[m]=r.length/3,u(y,i,p,f,r),l(y,_,g,d,m,f,c)}}}return{colors:new Float32Array(n),materials:new Float32Array(o),vertices:new Float32Array(r),faces:new Uint32Array(c)}};var c=n;t.default=c},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(88)),a=n(r(89)),s=n(r(90)),o=n(r(91)),u={importOBJ:i.default.importOBJ,importSGL:a.default.importSGL,importPLY:s.default.importPLY,importSTL:o.default.importSTL};t.default=u},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(0)),a=n(r(9)),s={};s.importOBJ=function(e,t){for(var r=[],n=[],o=[],u=[],l=[],c=[],h=[],f=[],d=[],p=0,v=0,g=0,m=0,_=e.split("\n"),y=[],b=_.length,M=0;M<b;++M){var T=_[M].trim();if(0!==T.length){var A,S=T[0];if("v"===S)" "===(A=T[1])?(y=T.split(/\s+/),n.push(parseFloat(y[1]),parseFloat(y[2]),parseFloat(y[3])),y[4]&&o.push(parseFloat(y[4]),parseFloat(y[5]),parseFloat(y[6])),++g):"t"===A&&(y=T.split(/\s+/),h.push(parseFloat(y[1]),parseFloat(y[2])),++m);else if("f"===S){var k=(y=T.split(/\s+/)).length-1;if(k<3)continue;for(var w=Math.ceil(k/2)-1,E=0;E<w;++E){var x=E+1,R=E+2,C=k-x,P=k-E;C===R&&(C=P,P=i.default.TRI_INDEX);var F,D=y[x].split("/"),I=y[R].split("/"),N=y[C].split("/"),V=P!==i.default.TRI_INDEX;V&&(F=y[P].split("/"));var L=parseInt(D[0],10),O=parseInt(I[0],10),U=parseInt(N[0],10),B=V?parseInt(F[0],10):void 0;if((!V||B!==L&&B!==O&&B!==U)&&(L!==O&&L!==U&&O!==U))if(L=(L<0?L+g:L-1)-p,O=(O<0?O+g:O-1)-p,U=(U<0?U+g:U-1)-p,V&&(B=(B<0?B+g:B-1)-p),f.push(L,O,U,V?B:i.default.TRI_INDEX),D[1]){var j=parseInt(D[1],10),G=parseInt(I[1],10),X=parseInt(N[1],10),z=V?parseInt(F[1],10):void 0;j=(j<0?j+m:j-1)-v,G=(G<0?G+m:G-1)-v,X=(X<0?X+m:X-1)-v,V&&(z=(z<0?z+m:z-1)-v),d.push(j,G,X,V?z:i.default.TRI_INDEX)}else d.length>0&&d.push(L,O,U,V?B:i.default.TRI_INDEX)}}else if("#"===S){if("M"!==T[1])continue;if(T.startsWith("#MRGB "))for(var W=(y=T.split(/\s+/))[1],Y=2,H=W.length;Y<H;Y+=8){var q=parseInt(W.substr(Y,6),16);u.push(1/255*(q>>16),1/255*(q>>8&255),1/255*(255&q))}else if(T.startsWith("#MAT "))for(var K=(y=T.split(/\s+/))[1],Z=0,Q=K.length;Z<Q;Z+=6){var J=parseInt(K.substr(Z,6),16);c.push(1/255*(J>>16),1/255*(J>>8&255),1/255*(255&J))}}else T.startsWith("o ")&&(r.length>0&&(s.initMeshOBJ(r[r.length-1],n,f,o,l,h,d,u,c),p=g,v=m),r.push(new a.default(t)))}}return 0===r.length&&(r[0]=new a.default(t)),s.initMeshOBJ(r[r.length-1],n,f,o,l,h,d,u,c),r},s.initMeshOBJ=function(e,t,r,n,i,a,s,o,u){e.setVertices(new Float32Array(t)),e.setFaces(new Uint32Array(r)),o.length===t.length?e.setColors(new Float32Array(o)):n.length===t.length&&e.setColors(new Float32Array(n)),u.length===t.length?e.setMaterials(new Float32Array(u)):i.length===t.length&&e.setMaterials(new Float32Array(i)),a.length>0&&s.length===r.length&&e.initTexCoordsDataFromOBJData(a,s),t.length=r.length=0,o.length=n.length=0,u.length=i.length=0,a.length=s.length=0};var o=s;t.default=o},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(0)),a=n(r(9)),s=n(r(30)),o=n(r(4)),u={},l=function(e){for(var t=new Uint32Array(e),r=t.length/4,n=0;n<r;++n){var a=4*n+3;e[a]<0&&(t[a]=i.default.TRI_INDEX)}return t};u.importSGL=function(e,t,r){var n=new Float32Array(e),i=new Uint32Array(e),u=new Int32Array(e),c=0,h=i[c++];if(h>s.default.VERSION)return[];if(h>=2){r._showGrid=i[c++],o.default.showSymmetryLine=i[c++],r._showContour=i[c++];var f=r.getCamera();f.setProjectionType(i[c++]),f.setMode(i[c++]),f.setFov(n[c++]),f.setUsePivot(i[c++])}for(var d=i[c++],p=new Array(d),v=0;v<d;++v){var g=p[v]=new a.default(t);if(h>=2){var m=g.getRenderData();m._shaderType=i[c++],m._matcap=i[c++],m._showWireframe=i[c++],m._flatShading=i[c++],m._alpha=n[c++]}g.getCenter().set(n.subarray(c,c+3)),c+=3,g.getMatrix().set(n.subarray(c,c+16)),c+=16,c++;var _=i[c++];g.setVertices(n.subarray(c,c+3*_)),c+=3*_,(_=i[c++])>0&&g.setColors(n.subarray(c,c+3*_)),c+=3*_,(_=i[c++])>0&&g.setMaterials(n.subarray(c,c+3*_)),c+=3*_,_=i[c++],h<=2?g.setFaces(l(u.subarray(c,c+4*_))):g.setFaces(i.subarray(c,c+4*_)),c+=4*_;var y=null;(_=i[c++])&&(y=n.subarray(c,c+2*_)),c+=2*_;var b=null;(_=i[c++])&&(b=h<=2?l(u.subarray(c,c+4*_)):i.subarray(c,c+4*_)),c+=4*_,y&&b&&g.initTexCoordsDataFromOBJData(y,b)}return p};var c=u;t.default=c},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(0)),a=n(r(9)),s={},o=function(e){switch(e){case"uchar":case"char":case"int8":case"uint8":return 1;case"ushort":case"short":case"int16":case"uint16":return 2;case"uint":case"int":case"float":case"int32":case"uint32":case"float32":return 4;case"double":case"float64":return 8;default:return 0}},u=function(e,t){var r=t?1/255:1;switch(e){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return function(e){return parseInt(e,10)*r};case"float":case"double":case"float32":case"float64":return parseFloat;default:return function(e){return e}}},l=function(e,t,r){var n=r?1/255:1,i=t.offsetOctet;switch(t.type){case"int8":case"char":return function(t){return e.getInt8(t+i)*n};case"uint8":case"uchar":return function(t){return e.getUint8(t+i)*n};case"int16":case"short":return function(t){return e.getInt16(t+i,!0)*n};case"uint16":case"ushort":return function(t){return e.getUint16(t+i,!0)*n};case"int32":case"int":return function(t){return e.getInt32(t+i,!0)*n};case"uint32":case"uint":return function(t){return e.getUint32(t+i,!0)*n};case"float32":case"float":return function(t){return e.getFloat32(t+i,!0)};case"float64":case"double":return function(t){return e.getFloat64(t+i,!0)}}},c=function(e,t){var r=e.properties,n=e.objProperties={};e.offsetOctet=0;for(var i=0,a=r.length;i<a;++i){var s=r[i],u=n[s.name]={};u.type=s.type,u.type2=s.type2,t.isBinary?(u.offsetOctet=e.offsetOctet,e.offsetOctet+=o(s.type)):u.id=i}},h=function(e,t){c(e,t);var r,n=t.vertices=new Float32Array(3*e.count),i=e.objProperties;(i.red||i.green||i.blue)&&(r=t.colors=new Float32Array(3*e.count)),t.isBinary?function(e,t,r,n){var i,a,s,o=e.count,u=e.objProperties,c=e.offsetOctet,h=c*o,f=new DataView(t.buffer,t.offsetOctet,h),d=l(f,u.x,!0),p=l(f,u.y,!0),v=l(f,u.z,!0);u.red&&(i=l(f,u.red,!0)),u.green&&(a=l(f,u.green,!0)),u.blue&&(s=l(f,u.blue,!0));for(var g=0;g<o;++g){var m=3*g,_=g*c;r[m]=d(_),r[m+1]=p(_),r[m+2]=v(_),i&&(n[m]=i(_)),a&&(n[m+1]=a(_)),s&&(n[m+2]=s(_))}t.offsetOctet+=h}(e,t,n,r):function(e,t,r,n){var i,a,s,o=e.count,l=t.lines,c=e.objProperties,h=t.offsetLine,f=u(c.x.type,!0),d=u(c.y.type,!0),p=u(c.z.type,!0),v=c.x.id,g=c.y.id,m=c.z.id;c.red&&(i=u(c.red.type,!0)),c.green&&(a=u(c.green.type,!0)),c.blue&&(s=u(c.blue.type,!0));var _,y,b;c.red&&(_=c.red.id),c.green&&(y=c.green.id),c.blue&&(b=c.blue.id);for(var M=0;M<o;++M){var T=3*M,A=l[h+M].trim().split(/\s+/);r[T]=f(A[v]),r[T+1]=d(A[g]),r[T+2]=p(A[m]),i&&(n[T]=i(A[_])),a&&(n[T+1]=a(A[y])),s&&(n[T+2]=s(A[b]))}t.offsetLine+=o}(e,t,n,r)},f=function(e,t,r,n){for(var a=e.count,s=e.objProperties,u=s.vertex_index||s.vertex_indices||e.properties[0],c=new DataView(t.buffer,t.offsetOctet),h=l(c,u),f=l(c,{type:u.type2,offsetOctet:u.offsetOctet+o(u.type)}),d=o(u.type2),p=e.offsetOctet,v=0,g=0,m=0;m<a;++m){var _=h(v);3!==_&&4!==_||(r[g++]=f(v),r[g++]=f(v+d),r[g++]=f(v+2*d),r[g++]=3===_?i.default.TRI_INDEX:f(v+3*d)),v+=_*d+p}n||(t.faces=r.subarray(0,g)),t.offsetOctet+=v},d=function(e,t){c(e,t);var r=t.faces=new Uint32Array(4*e.count);t.isBinary?f(e,t,r):function(e,t,r){for(var n=e.count,a=t.lines,s=e.objProperties,o=t.offsetLine,l=s.vertex_index||s.vertex_indices,c=u(l.type),h=u(l.type2),f=l.id,d=0,p=0;p<n;++p){var v=a[o+p].trim().split(/\s+/),g=c(v[0]);3!==g&&4!==g||(r[d]=h(v[f+1]),r[d+1]=h(v[f+2]),r[d+2]=h(v[f+3]),r[d+3]=4===g?h(v[f+4]):i.default.TRI_INDEX,d+=4)}t.offsetLine+=n}(e,t,r)},p=function(e,t){var r=e.count;t.isBinary?f(e,t,[],!0):t.offsetLine+=r};s.importPLY=function(e,t){for(var r=function(e){for(var t,r=i.default.ab2str(e).split("\n"),n={isBinary:!1,start:0,elements:[],lines:r,buffer:e,vertices:null,faces:null,colors:null,offsetLine:0,offsetOctet:0},a=0;;){var s=r[a++];if(n.offsetOctet+=s.length+1,n.offsetLine=a,(s=s.trim()).startsWith("format binary"))n.isBinary=!0;else if(s.startsWith("element"))t=s.split(/\s+/),n.elements.push({name:t[1],count:parseInt(t[2],10),properties:[]});else if(s.startsWith("property")){var o="list"===(t=s.split(/\s+/))[1];n.elements[n.elements.length-1].properties.push({type:t[o?2:1],type2:o?t[3]:void 0,name:t[o?4:2]})}else if(s.startsWith("end_header"))break}return n}(e),n=r.elements,s=0,o=n.length;s<o;++s){var u=n[s];"vertex"===u.name?h(u,r):"face"===u.name?d(u,r):p(u,r)}var l=new a.default(t);return l.setVertices(r.vertices),l.setFaces(r.faces),l.setColors(r.colors),[l]};var v=s;t.default=v},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(0)),a=n(r(9)),s={};s.importSTL=function(e,t){var r,n=new Uint32Array(e,80,1)[0]||0,o=84+50*n===e.byteLength,u=o?s.importBinarySTL(e,n):s.importAsciiSTL(i.default.ab2str(e));o&&(r=u[1],u=u[0]),n=u.length/9;for(var l=new Map,c=[0],h=new Uint32Array(4*n),f=0;f<n;++f){var d=4*f,p=9*f;h[d]=s.detectNewVertex(l,u,r,p,c),h[d+1]=s.detectNewVertex(l,u,r,p+3,c),h[d+2]=s.detectNewVertex(l,u,r,p+6,c),h[d+3]=i.default.TRI_INDEX}var v=new a.default(t);return v.setVertices(u.subarray(0,3*c[0])),r&&v.setColors(r.subarray(0,3*c[0])),v.setFaces(h),[v]},s.detectNewVertex=function(e,t,r,n,i){var a=t[n],s=t[n+1],o=t[n+2],u=a+"+"+s+"+"+o,l=e.get(u);if(void 0===l){l=i[0],e.set(u,l);var c=3*l;t[c]=a,t[c+1]=s,t[c+2]=o,r&&(r[c]=r[n],r[c+1]=r[n+1],r[c+2]=r[n+2]),i[0]++}return l},s.importAsciiSTL=function(e){for(var t=e.split("\n"),r=t.length,n=new Float32Array(Math.ceil(9*r/7)),i=0,a=0;a<r;++a){if(t[a].trim().startsWith("facet")){var s=t[a+2].trim().split(/\s+/);n[i++]=parseFloat(s[1]),n[i++]=parseFloat(s[2]),n[i++]=parseFloat(s[3]),s=t[a+3].trim().split(/\s+/),n[i++]=parseFloat(s[1]),n[i++]=parseFloat(s[2]),n[i++]=parseFloat(s[3]),s=t[a+4].trim().split(/\s+/),n[i++]=parseFloat(s[1]),n[i++]=parseFloat(s[2]),n[i++]=parseFloat(s[3])}}return n.subarray(0,i)},s.importBinarySTL=function(e,t){var r=new Uint8Array(e),n=0,i=new Uint8Array(36*t),a=new Uint8Array(2*t),s=96,o=0,u=0;for(n=0;n<t;n++){for(var l=0;l<36;++l)i[o++]=r[s++];a[u++]=r[s++],a[u++]=r[s++],s+=12}var c=new Uint16Array(a.buffer);a=new Float32Array(9*t);for(n=0;n<t;++n){o=9*n;var h=c[n],f=32768&h;a[o]=a[o+3]=a[o+6]=f?1/31*(h>>10&31):1,a[o+1]=a[o+4]=a[o+7]=f?1/31*(h>>5&31):1,a[o+2]=a[o+5]=a[o+8]=f?1/31*(31&h):1}return[new Float32Array(i.buffer),a]};var o=s;t.default=o},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(93)),s=(n(r(3)),n(r(94))),o=n(r(95)),u=n(r(96)),l=n(r(97)),c=n(r(107)),h=n(r(108)),f=n(r(114)),d=n(r(115)),p=n(r(116)),v=n(r(118)),g=n(r(124)),m=(n(r(26)),function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=t,this._guiMain=null,this._sidebar=null,this._topbar=null,this._ctrlTablet=null,this._ctrlFiles=null,this._ctrlScene=null,this._ctrlStates=null,this._ctrlCamera=null,this._ctrlBackground=null,this._ctrlSculpting=null,this._ctrlTopology=null,this._ctrlRendering=null,this._ctrlNotification=null,this._ctrls=[]}return function(e,t,r){t&&i(e.prototype,t),r&&i(e,r)}(e,[{key:"initGui",value:function(){this.deleteGui(),this._guiMain=new a.default.GuiMain(this._main.getViewport(),this._main.onCanvasResize.bind(this._main));var e=this._ctrls;e.length=0;var t=0;this._topbar=this._guiMain.addTopbar(),e[t++]=this._ctrlFiles=new l.default(this._topbar,this),e[t++]=this._ctrlScene=new d.default(this._topbar,this),e[t++]=this._ctrlStates=new v.default(this._topbar,this),e[t++]=this._ctrlBackground=new s.default(this._topbar,this),e[t++]=this._ctrlCamera=new o.default(this._topbar,this),e[t++]=this._ctrlTablet=new g.default(this._topbar,this),e[t++]=this._ctrlConfig=new u.default(this._topbar,this),e[t++]=this._ctrlMesh=new c.default(this._topbar,this),this._sidebar=this._guiMain.addRightSidebar(),e[t++]=this._ctrlRendering=new f.default(this._sidebar,this),e[t++]=this._ctrlTopology=new h.default(this._sidebar,this),e[t++]=this._ctrlSculpting=new p.default(this._sidebar,this),this.updateMesh(),this.setVisibility(!0)}},{key:"getWidgetNotification",value:function(){return this._ctrlNotification||(this._ctrlNotification=this._topbar.addMenu(),this._ctrlNotification.setVisibility(!1)),this._ctrlNotification}},{key:"updateMesh",value:function(){this._ctrlRendering.updateMesh(),this._ctrlTopology.updateMesh(),this._ctrlSculpting.updateMesh(),this._ctrlScene.updateMesh(),this.updateMeshInfo()}},{key:"updateMeshInfo",value:function(){this._ctrlMesh.updateMeshInfo()}},{key:"getFlatShading",value:function(){return this._ctrlRendering.getFlatShading()}},{key:"getWireframe",value:function(){return this._ctrlRendering.getWireframe()}},{key:"getShaderType",value:function(){return this._ctrlRendering.getShaderType()}},{key:"addAlphaOptions",value:function(e){this._ctrlSculpting.addAlphaOptions(e)}},{key:"deleteGui",value:function(){this._guiMain&&this._guiMain.domMain.parentNode&&(this.callFunc("removeEvents"),this.setVisibility(!1),this._guiMain.domMain.parentNode.removeChild(this._guiMain.domMain))}},{key:"setVisibility",value:function(e){this._guiMain.setVisibility(e)}},{key:"callFunc",value:function(e,t){for(var r=0,n=this._ctrls,i=n.length;r<i;++r){var a=n[r];a&&a[e]&&a[e](t)}}}]),e}());t.default=m},function(e,t,r){!function(t,r){e.exports=r()}("undefined"!=typeof self&&self,function(){return function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=3)}([function(e,t,r){"use strict";t.a=class{constructor(){}_getInitialValue(e,t){return"string"!=typeof t?e:e[t]}_getCheckCallback(e,t){return"string"!=typeof t?t:function(r){e[t]=r}}_setDomContainer(e){this.domContainer=e}setCallback(e){this.callback=e}setVisibility(e){this.domContainer&&(this.domContainer.hidden=!e)}}},function(e,t,r){"use strict";var n=r(7),i=r(8),a=r(9),s=r(10),o=r(11),u=r(12);t.a=class{constructor(){}_addLine(e){var t=document.createElement("li");return t.innerHTML=e||"",this.domUl.appendChild(t),t}_createLabel(e){var t=document.createElement("label");return t.className="gui-label-side",t.innerHTML=e||"",t}_setDomContainer(e){this.domContainer=e}addTitle(e){var t=new u.a(e);return this.domUl.appendChild(t.domText),t}addCheckbox(e,t,r){var n=new i.a(t,r),a=this._addLine();a.className+=" gui-pointerOnHover gui-glowOnHover";var s=this._createLabel(e);return s.style.overflow="visible",s.className+=" gui-pointerOnHover",a.appendChild(s),a.appendChild(n.domCheckbox),a.appendChild(n.domLabelCheckbox),a.addEventListener("mousedown",n._onMouseDown.bind(n)),n._setDomContainer(a),n}addCombobox(e,t,r,n){var i=new s.a(t,r,n),a=this._addLine();return e?a.appendChild(this._createLabel(e)):i.domSelect.style.width="100%",a.appendChild(i.domSelect),i._setDomContainer(a),i}addSlider(e,t,r,n,i,a){var s=new o.a(t,r,n,i,a),u=this._addLine();return e&&u.appendChild(this._createLabel(e)),u.appendChild(s.domInputText),u.appendChild(s.domSlider),s._setDomContainer(u),s}addColor(e,t,r){var n=new a.a(t,r),i=this._addLine();return e?i.appendChild(this._createLabel(e)):n.domColor.style.width="100%",i.appendChild(n.domColor),n._setDomContainer(i),n}addButton(e,t,r){var i=new n.a(e,t,r),a=this._addLine();return a.appendChild(i.domButton),i._setDomContainer(a),i}addDualButton(e,t,r,i,a,s){var o=new n.a(e,r,a),u=new n.a(t,i,s),l=this._addLine();l.appendChild(u.domButton),l.appendChild(o.domButton);var c=o.domButton.style,h=u.domButton.style;return c.width=h.width="49%",c.marginRight=h.marginLeft="1%",o._setDomContainer(l),u._setDomContainer(l),[o,u]}setVisibility(e){this.domContainer&&(this.domContainer.hidden=!e)}}},function(e,t,r){"use strict";var n={};n.rgbToHsv=function(e){var t=e[0],r=e[1],n=e[2],i=Math.max(t,r,n),a=Math.min(t,r,n);if(a===i)return[0,0,a];return[((t===a?3:n===a?1:5)-(t===a?r-n:n===a?t-r:n-t)/(i-a))/6,(i-a)/i,i]},n.hsvToRgb=function(e){var t=6*e[0],r=e[1],n=e[2],i=Math.floor(t),a=t-i,s=n*(1-r),o=n*(1-a*r),u=n*(1-(1-a)*r),l=i%6;return 0===l?[n,u,s]:1===l?[o,n,s]:2===l?[s,n,u]:3===l?[s,o,n]:4===l?[u,s,n]:[n,s,o]},n.getValidColor=function(e){for(var t=0,r=e.length;t<r;++t)e[t]=Math.max(0,Math.min(1,e[t]));return e},n.getStrColor=function(e){return 3===e.length?n.rgbToHex(e):"rgba("+Math.round(255*e[0])+","+Math.round(255*e[1])+","+Math.round(255*e[2])+","+e[3]+")"},n.getColorMult=function(e,t){var r=[e[0]*t,e[1]*t,e[2]*t];return 4===e.length&&r.push(e[3]),n.getValidColor(r)},n.getColorAdd=function(e,t){var r=[e[0]+t,e[1]+t,e[2]+t];return 4===e.length&&r.push(e[3]),n.getValidColor(r)},n.rgbToHex=function(e){for(var t="#",r=0;r<3;++r){var n=Math.round(255*e[r]).toString(16);t+=1===n.length?"0"+n:n}return t},n.hexToRgb=function(e){var t=0;"#"===e[0]&&(e=e.slice(1));var r=e;if(e.length>6)r=e.slice(0,6);else if(e.length<6)for(r="",t=0;t<3;++t)r+=e[t]?e[t]+e[t]:"00";var n=[0,0,0];for(t=0;t<3;++t){var i=parseInt(r[2*t]+r[2*t+1],16);n[t]=(i!=i?0:i)/255}return n},t.a=n},function(e,t,r){var n={GuiMain:r(4).default};e.exports=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(5),i=r(13);t.default=class{constructor(e,t){this.domMain=document.createElement("div"),this.viewport=e,this.callbackResize=t,this.viewport&&(this.viewport.style.width=document.documentElement.clientWidth+"px",this.viewport.style.height=document.documentElement.clientHeight+"px"),this.cbResize_=this._onWindowResize.bind(this),document.body.appendChild(this.domMain),this.leftSidebar=void 0,this.rightSidebar=void 0,this.topbar=void 0,window.addEventListener("resize",this._onWindowResize.bind(this),!1)}_onWindowResize(){this.viewport&&(this.viewport.style.width=document.documentElement.clientWidth+"px",this.viewport.style.height=document.documentElement.clientHeight+"px",this.viewport.style.left="0px",this.viewport.style.top="0px",this.leftSidebar&&this.leftSidebar._updateViewportPosition(this.viewport),this.rightSidebar&&this.rightSidebar._updateViewportPosition(this.viewport),this.topbar&&this.topbar._updateViewportPosition(this.viewport)),this._updateSidebarsPosition(),this.callbackResize&&this.callbackResize()}_updateSidebarsPosition(){if(this.topbar){var e=this.topbar.domTopbar.offsetHeight;this.leftSidebar&&this.leftSidebar._setTop(e),this.rightSidebar&&this.rightSidebar._setTop(e)}}addLeftSidebar(){this.leftSidebar=new n.a(this.cbResize_);var e=this.leftSidebar.domSidebar;return this.domMain.appendChild(e),this.domMain.appendChild(this.leftSidebar.domResize),this._updateSidebarsPosition(),this.leftSidebar._updateViewportPosition(this.viewport),this.leftSidebar}addRightSidebar(){this.rightSidebar=new n.a(this.cbResize_);var e=this.rightSidebar.domSidebar;return this.domMain.appendChild(e),this.domMain.appendChild(this.rightSidebar.domResize),this.rightSidebar._onTheRight(),this._updateSidebarsPosition(),this.rightSidebar._updateViewportPosition(this.viewport),this.rightSidebar}addTopbar(){return this.topbar=new i.a(this.cbResize_),this.domMain.appendChild(this.topbar.domTopbar),this._updateSidebarsPosition(),this.topbar._updateViewportPosition(this.viewport),this.topbar}setVisibility(e){this.domMain.hidden=!e,this._onWindowResize()}}},function(e,t,r){"use strict";var n=r(6);t.a=class{constructor(e){this.domSidebar=document.createElement("div"),this.domSidebar.className="gui-sidebar",this.domResize=document.createElement("div"),this.domResize.className="gui-resize",this.isDragging=!1,this.mouseX=0,this.domResize.addEventListener("mousedown",this._onMouseDown.bind(this)),window.addEventListener("mousemove",this._onMouseMove.bind(this)),window.addEventListener("mouseup",this._onMouseUp.bind(this)),this.callbackResize=e,this.isOnTheRight=!1}_setTop(e){this.domSidebar.style.top=this.domResize.style.top=e+"px"}_onTheRight(){this.isOnTheRight=!0,this.domSidebar.style.right=0,this.domSidebar.style.borderRight=0,this.domSidebar.style.borderLeft="double",this.domSidebar.style.borderColor="rgba(255,255,255,0.3)",this.domResize.style.left="auto",this.domResize.style.right=this.domSidebar.offsetWidth+"px",this.domResize.style.marginRight="-3px"}_onMouseDown(e){this.isDragging=!0,this.mouseX=e.clientX}_updateViewportPosition(e){var t=this.domSidebar.hidden?0:this.domSidebar.offsetWidth;this.isOnTheRight?e.style.width=e.clientWidth-t+"px":(e.style.left=this.domSidebar.offsetLeft+t+"px",e.style.width=e.clientWidth-t+"px")}_onMouseMove(e){if(!1!==this.isDragging){var t=e.clientX,r=t-this.mouseX;this.isOnTheRight&&(r=-r);var n=Math.max(50,this.domSidebar.offsetWidth+r)+"px";this.domSidebar.style.width=n,this.isOnTheRight?this.domResize.style.right=this.domSidebar.offsetWidth+"px":this.domResize.style.left=n,this.mouseX=t,this.callbackResize()}}_onMouseUp(){this.isDragging=!1}addMenu(e){var t=new n.a(e);return this.domSidebar.appendChild(t.domUl),t}setVisibility(e){this.domSidebar.hidden=!e,this.domResize.hidden=!e,this.callbackResize()}}},function(e,t,r){"use strict";var n=r(1);t.a=class extends n.a{constructor(e){super(),this.domUl=document.createElement("ul"),this.domUl.setAttribute("opened",!0);var t=document.createElement("label");t.innerHTML=e||"",t.addEventListener("mousedown",this._onMouseDown.bind(this)),this.domUl.appendChild(t),this.isOpen=!0}_onMouseDown(){this.isOpen=!this.isOpen,this.domUl.setAttribute("opened",this.isOpen)}open(){this.isOpen=!0,this.domUl.setAttribute("opened",!0)}close(){this.isOpen=!1,this.domUl.setAttribute("opened",!1)}setVisibility(e){e?this.isOpen&&this.domUl.setAttribute("opened",!0):this.domUl.setAttribute("opened",!1),this.domUl.style.height=e?"auto":"0px"}}},function(e,t,r){"use strict";var n=r(0);t.a=class extends n.a{constructor(e,t,r){super();var n=r?t[r].bind(t):t;this.domButton=document.createElement("button"),this.domButton.className="gui-button",this.domButton.innerHTML=e||"",this.domButton.addEventListener("click",this._onClick.bind(this)),this.setCallback(n)}setEnable(e){this.domButton.disabled=void 0!==e&&!e}_onClick(){this.callback&&this.callback()}}},function(e,t,r){"use strict";var n=r(0);t.a=class extends n.a{constructor(e,t){super();var r=this._getInitialValue(e,t),n=this._getCheckCallback(e,t);this.domCheckbox=document.createElement("input"),this.domCheckbox.className="gui-input-checkbox",this.domCheckbox.type="checkbox",this.domLabelCheckbox=document.createElement("label"),this.setValue(void 0===r||r),this.setCallback(n)}_onMouseDown(){this.setValue(!this.domCheckbox.checked)}setValue(e,t){this.domCheckbox.checked=e,!t&&this.callback&&this.callback(e)}getValue(){return this.domCheckbox.checked}}},function(e,t,r){"use strict";var n=r(2),i=r(0),a=["-moz-","-o-","-webkit-","-ms-",""],s='url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAIAAABLbSncAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAChJREFUeNpiPHPmDAMMGBsbw9lMDDgA6RKM%2F%2F%2F%2Fh3POnj1LCzsAAgwAQtYIcFfEyzkAAAAASUVORK5CYII%3D")';t.a=class extends i.a{constructor(e,t){super();var r=this._getInitialValue(e,t),i=this._getCheckCallback(e,t);this.color=r?n.a.getValidColor(r.slice()):[1,0,0],this.domColor=document.createElement("div"),this.domColor.className="gui-widget-color",this.domInputColor=document.createElement("input"),this.domPopup=document.createElement("div"),this.domHue=document.createElement("div"),this.domHue.className="gui-color-hue",this.domHueKnob=document.createElement("div"),this.domHueKnob.className="gui-knob-hue",this.domSaturation=document.createElement("div"),this.domSaturation.className="gui-color-saturation";var a=document.createElement("div");this.domSaturation.appendChild(a),this.domSaturationKnob=document.createElement("div"),this.domSaturationKnob.className="gui-knob-saturation",this.domHue.appendChild(this.domHueKnob),this.domPopup.appendChild(this.domSaturationKnob),this.domPopup.appendChild(this.domSaturation),this.domPopup.appendChild(this.domHue),this.domColor.appendChild(this.domInputColor),this.domColor.appendChild(this.domPopup),this._hueGradient(this.domHue),this._linearGradient(a,"top","rgba(0,0,0,0)","#000"),this.domColor.addEventListener("keydown",this._onInputDown.bind(this)),this.domSaturation.addEventListener("mousedown",this._onSaturationDown.bind(this)),this.domHue.addEventListener("mousedown",this._onHueDown.bind(this)),window.addEventListener("mouseup",this._onMouseUp.bind(this)),window.addEventListener("mouseout",this._onMouseUp.bind(this)),window.addEventListener("mousemove",this._onMouseMove.bind(this)),this.hasAlpha=4===this.color.length,this.alpha=1,this.hasAlpha&&(this.domPopup.style.width="142px",this.domAlpha=document.createElement("div"),this.domAlpha.className="gui-color-alpha",this.domAlphaKnob=document.createElement("div"),this.domAlphaKnob.className="gui-knob-alpha",this._alphaGradient(this.domAlpha,"top","rgba(0,0,0,1.0)","rgba(0,0,0,0.0)"),this.domAlpha.addEventListener("mousedown",this._onAlphaDown.bind(this)),this.domAlpha.appendChild(this.domAlphaKnob),this.domPopup.appendChild(this.domAlpha)),this.editHue=this.editSaturation=this.editAlpha=!1,this.widgetHeight=this.widgetWidth=100,this.setValue(this.color),this.setCallback(i)}_onInputDown(e){e.stopPropagation(),13===e.keyCode&&this.setValue(n.a.hexToRgb(e.target.value))}_onUpdateSaturation(e){var t=this.domSaturation.getBoundingClientRect(),r=n.a.rgbToHsv(this.getValue());r[1]=Math.min(1,Math.max(0,(e.clientX-t.left)/t.width)),r[2]=Math.min(1,Math.max(0,1-(e.clientY-t.top)/t.width)),this.setValue(n.a.hsvToRgb(r),!1,!0),this._updateGui()}_onUpdateHue(e){var t=this.domHue.getBoundingClientRect(),r=n.a.rgbToHsv(this.getValue());r[0]=Math.min(1,Math.max(0,1-(e.clientY-t.top)/t.height)),this.setValue(n.a.hsvToRgb(r),!1,!0),this._updateGui()}_onUpdateAlpha(e){var t=this.domAlpha.getBoundingClientRect(),r=this.getValue();r[3]=this.alpha=Math.min(1,Math.max(0,1-(e.clientY-t.top)/t.height)),this.setValue(r,!1,!0),this._updateGui()}_updateGui(){var e=this.getValue(),t=n.a.rgbToHsv(e);this.domSaturationKnob.style.marginLeft=this.widgetWidth*t[1]-7+"px",this.domSaturationKnob.style.marginTop=this.widgetHeight*(1-t[2])-7+"px",t[1]=t[2]=1,this._linearGradient(this.domSaturation,"left","#fff",n.a.getStrColor(n.a.hsvToRgb(t))),this.domHueKnob.style.marginTop=(1-t[0])*this.widgetHeight+"px",this.hasAlpha&&void 0!==e[3]&&(this.domAlphaKnob.style.marginTop=(1-this.alpha)*this.widgetHeight+"px")}_onMouseMove(e){if(this.editSaturation||this.editHue||this.editAlpha)return this.editSaturation?this._onUpdateSaturation(e):this.editHue?this._onUpdateHue(e):this.editAlpha?this._onUpdateAlpha(e):void 0}_onSaturationDown(e){this.editSaturation=!0,this._onMouseMove(e)}_onHueDown(e){this.editHue=!0,this._onMouseMove(e)}_onAlphaDown(e){this.editAlpha=!0,this._onMouseMove(e)}_onMouseUp(){this.editHue=this.editSaturation=this.editAlpha=!1}_hueGradient(e){e.style.background="";for(var t=0,r=a.length;t<r;++t)e.style.cssText+="background: "+a[t]+"linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);"}_alphaGradient(e,t,r,n){e.style.background="";for(var i=0,o=a.length;i<o;++i)e.style.cssText+="background: "+a[i]+"linear-gradient("+t+", "+r+","+n+"),"+s+";"}_linearGradient(e,t,r,n){e.style.background="";for(var i=0,s=a.length;i<s;++i)e.style.cssText+="background: "+a[i]+"linear-gradient("+t+", "+r+" 0%, "+n+" 100%);"}setValue(e,t,r){for(var i=this.color,a=0,s=e.length;a<s;++a)i[a]=e[a];var o=n.a.rgbToHex(e);if(this.domInputColor.value=o,this.hasAlpha){e.length>=4?this.alpha=e[3]:e.push(this.alpha);var u="rgba("+parseInt(255*e[0],10)+","+parseInt(255*e[1],10)+","+parseInt(255*e[2],10)+","+this.alpha+")";this._alphaGradient(this.domInputColor,"0deg",u,u)}else this.domInputColor.style.background=o;var l=n.a.rgbToHsv(e);this.domSaturationKnob.style.borderColor=l[2]<.5||l[1]>.5?"#fff":"#000",this.domInputColor.style.color=this.alpha>.2&&(l[2]<.5||l[1]>.5)?"#fff":"#000",r||this._updateGui(),!t&&this.callback&&this.callback(e)}getValue(){return this.color}}},function(e,t,r){"use strict";var n=r(0);t.a=class extends n.a{constructor(e,t,r){super();var n=this._getInitialValue(e,t),i=this._getCheckCallback(e,t);r=r||{},n=void 0!==n?n:r[0],this.isArray=void 0!==r.length,this.domSelect=document.createElement("select"),this.domSelect.className="gui-select",this.addOptions(r),this.domSelect.addEventListener("change",this._onChange.bind(this)),this.setValue(n),this.setCallback(i)}_parseValue(e){return this.isArray?parseInt(e,10):e}_onChange(e){this.setValue(e.target.value)}addOptions(e){for(var t=Object.keys(e),r=0;r<t.length;++r){var n=document.createElement("option");n.innerHTML=e[t[r]],n.value=t[r],this.domSelect.appendChild(n)}}setValue(e,t){this.domSelect.value=e,!t&&this.callback&&this.callback(this._parseValue(e))}getValue(){return this._parseValue(this.domSelect.value)}}},function(e,t,r){"use strict";var n=r(0);t.a=class extends n.a{constructor(e,t,r,n,i){super();var a=this._getInitialValue(e,t),s=this._getCheckCallback(e,t);a=void 0!==a?a:100,r=void 0!==r?r:0,n=void 0!==n?n:200,i=void 0!==i?i:1,this.domSlider=document.createElement("div"),this.domSlider.className="gui-slider",this.domSliderFill=document.createElement("div"),this.domSlider.appendChild(this.domSliderFill),this.domInputText=document.createElement("input"),this.domInputText.className="gui-input-number",this.domInputText.type="number",this.min=this.domInputText.min=r,this.max=this.domInputText.max=n,this.step=this.domInputText.step=i,this.domInputText.addEventListener("keydown",this._onKeyDown.bind(this)),this.domInputText.addEventListener("change",this._onInputText.bind(this)),this.domInputText.addEventListener("blur",this._onInputText.bind(this)),this.domSlider.addEventListener("mousedown",this._onMouseDown.bind(this)),window.addEventListener("mouseup",this._onMouseUp.bind(this),!0),window.addEventListener("mousemove",this._onMouseMove.bind(this)),this.lastValue=a,this.isDown=!1,this.setValue(a),this.setCallback(s)}_onInputText(e){var t=parseFloat(e.target.value);t==t&&t!==this.lastValue&&this.setValue(t)}_onKeyDown(e){e.stopPropagation(),13===e.which&&this.domInputText.blur()}_onMouseMove(e){if(e.preventDefault(),this.isDown){var t=this.domSlider.getBoundingClientRect(),r=this.min+(this.max-this.min)*((e.clientX-t.left)/t.width);this.setValue(r)}}_onMouseDown(e){this.isDown=!0,this._onMouseMove(e)}_onMouseUp(){this.isDown=!1}_setDomContainer(e){this.domContainer=e}getValue(){return parseFloat(this.domInputText.value)}setValue(e,t){this.lastValue=e,e=Math.max(Math.min(e,this.max),this.min),e=Math.round(e/this.step)*this.step,this.domInputText.value=e;var r=this.min;this.max!==this.min&&(r=(e-this.min)/(this.max-this.min)),this.domSliderFill.style.width=100*r+"%",!t&&this.callback&&this.callback(e)}setMax(e){return this.domInputText.max=this.max=e,this}setMin(e){return this.min=e,this}}},function(e,t,r){"use strict";var n=r(0);t.a=class extends n.a{constructor(e){super(),this.domText=document.createElement("div"),this.domText.innerHTML=e||"",this.domText.className="group-title"}setText(e){this.domText.innerHTML=e}setVisibility(e){this.domText.hidden=!e}}},function(e,t,r){"use strict";var n=r(14),i=r(16);t.a=class{constructor(e){this.domTopbar=document.createElement("div"),this.domTopbar.className="gui-topbar",this.domUl=document.createElement("ul"),this.domTopbar.appendChild(this.domUl),this.callbackResize=e,this.uiExtra={}}_updateViewportPosition(e){var t=this.domTopbar.hidden?0:this.domTopbar.offsetHeight;e.style.top=t+"px",e.style.height=e.clientHeight-t+"px"}_onChangeColor(e,t){e(t),this.uiExtra.overallColor.setValue(i.a._curWidgetColor,!0),this.uiExtra.widgetColor.setValue(i.a._curWidgetColor,!0),this.uiExtra.backColor.setValue(i.a._curBackgroundColor,!0),this.uiExtra.textColor.setValue(i.a._curTextColor,!0)}addMenu(e){var t=new n.a,r=document.createElement("li");return r.setAttribute("onclick","void(0)"),r.innerHTML=e||"",this.domUl.appendChild(r),r.appendChild(t.domUl),t._setDomContainer(r),t}addExtra(){var e=this._onChangeColor,t=this.addMenu("Extra UI"),r=this.uiExtra;return t.addTitle("Overall"),r.overallColor=t.addColor("",i.a._curWidgetColor,e.bind(this,i.a.changeOverallColor)),t.addTitle("Advanced"),r.widgetColor=t.addColor("Widget",i.a._curWidgetColor,e.bind(this,i.a.changeWidgetsColor)),r.backColor=t.addColor("Back",i.a._curBackgroundColor,e.bind(this,i.a.changeBackgroundColor)),r.textColor=t.addColor("Text",i.a._curTextColor,e.bind(this,i.a.changeTextColor)),r.showBorder=t.addCheckbox("Border",i.a._curShowBorder,i.a.changeDisplayBoorder),t}setVisibility(e){this.domTopbar.hidden=!e,this.callbackResize()}}},function(e,t,r){"use strict";var n=r(1),i=r(15);t.a=class extends n.a{constructor(){super(),this.domUl=document.createElement("ul")}addButton(e,t,r,n){var a=new i.a(t,r,n),s=this._addLine(e);return s.appendChild(a.domSpan),a._setDomContainer(s),a}addSlider(e,t,r,n,i,a){var s=super.addSlider(e,t,r,n,i,a);return s.domInputText.style.width="18%",s.domSlider.style.width=e?"44%":"80%",s}}},function(e,t,r){"use strict";var n=r(0);t.a=class extends n.a{constructor(e,t,r){super();var n=e;n&&"function"!=typeof n?n=e[t].bind(e):r=t,this.domSpan=document.createElement("span"),this.domSpan.className="shortcut",this.domSpan.innerHTML=r||"",this.setCallback(n)}_setDomContainer(e){this.domContainer=e,e.addEventListener("click",this._onClick.bind(this))}_onClick(){this.callback&&this.callback()}}},function(e,t,r){"use strict";var n=r(2),i={};i.refRules={};var a,s=function(e,t,r){var n=function(){if(a)return a;for(var e=document.styleSheets,t=0,r=e.length;t<r;++t){var n=e[t].href;if(n&&-1!==n.indexOf("yagui.css"))return a=e[t]}}();if(n){var s=n.cssRules||n.rules,o=i.refRules[e];if(!o){var u=0,l=s.length;for(u=0;u<l&&s[u].selectorText!==e;++u);if(u===l)return!1;o=i.refRules[e]=s[u]}o&&(o.style[t]=r)}};i.changeWidgetsColor=function(e){var t=n.a.getStrColor(e);s(".gui-button","background",t),s(".gui-select","background",t),s(".gui-slider > div","background",t),i._curWidgetColor=e},i.changeDisplayBoorder=function(e){var t=e?"1px solid #000":"0";s(".gui-button","border",t),s(".gui-select","border",t),s(".gui-slider","border",t),s(".gui-input-number","border",t),s(".gui-sidebar > ul > label","borderTop",t),s(".gui-sidebar > ul > label","borderBottom",t),s(".gui-sidebar","borderLeft",t),s(".gui-sidebar","borderRight",t),s(".gui-topbar","borderBottom",t),i._curShowBorder=e},i.changeBackgroundColor=function(e){s(".gui-sidebar","background",n.a.getStrColor(e));var t=n.a.getStrColor(n.a.getColorMult(e,.5));s(".gui-topbar","background",t),s(".gui-topbar ul > li > ul","background",t),i._curBackgroundColor=e},i.changeTextColor=function(e){var t=n.a.getStrColor(e);s("*","color",t),s(".gui-sidebar > ul > label","color",t),i._curTextColor=e},i.changeOverallColor=function(e){i.changeWidgetsColor(e);var t=n.a.getColorMult(e,.5);t.length=3,i.changeBackgroundColor(t);for(var r=n.a.getColorAdd(e,.5),a=0;a<3;++a)r[a]=Math.min(.8,r[a]);i.changeTextColor(r),i._curWidgetColor=e,i._curBackgroundColor=t,i._curTextColor=r},i._curTextColor=[.73,.73,.73,1],i._curWidgetColor=[.32,.37,.39,1],i._curBackgroundColor=[.24,.24,.24],i._curShowBorder=!1,i.changeOverallColor([.3,.34,.4,1]),t.a=i}])})},function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=function(e){return e&&e.__esModule?e:{default:e}}(r(3)),a=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=r._main,this._menu=null,this.init(t)}return function(e,t,r){t&&n(e.prototype,t),r&&n(e,r)}(e,[{key:"init",value:function(e){var t=this._menu=e.addMenu((0,i.default)("backgroundTitle"));t.addButton((0,i.default)("backgroundReset"),this,"resetBackground"),t.addButton((0,i.default)("backgroundImport"),this,"importBackground"),t.addCheckbox((0,i.default)("backgroundFill"),this._main.getBackground()._fill,this.updateFill.bind(this))}},{key:"updateFill",value:function(e){this._main.getBackground()._fill=e,this._main.onCanvasResize()}},{key:"resetBackground",value:function(){this._main.getBackground().deleteTexture(),this._main.render()}},{key:"importBackground",value:function(){document.getElementById("backgroundopen").click()}}]),e}();t.default=a},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(3)),s=n(r(5)),o=n(r(2)),u=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=r._main,this._menu=null,this._camera=this._main.getCamera(),this._cameraTimer=-1,this._cbTranslation=this.cbOnTranslation.bind(this),this.init(t)}return function(e,t,r){t&&i(e.prototype,t),r&&i(e,r)}(e,[{key:"init",value:function(e){var t=this._camera,r=this._menu=e.addMenu((0,a.default)("cameraTitle"));r.addTitle((0,a.default)("cameraReset")),r.addDualButton((0,a.default)("cameraCenter"),(0,a.default)("cameraFront"),this.resetCamera.bind(this),this.resetFront.bind(this)),r.addDualButton((0,a.default)("cameraLeft"),(0,a.default)("cameraTop"),this.resetLeft.bind(this),this.resetTop.bind(this)),this._ctrlProjectionTitle=r.addTitle((0,a.default)("cameraProjection"));var n=[];n[o.default.Projection.PERSPECTIVE]=(0,a.default)("cameraPerspective"),n[o.default.Projection.ORTHOGRAPHIC]=(0,a.default)("cameraOrthographic"),this._ctrlProjection=r.addCombobox("",t.getProjectionType(),this.onCameraTypeChange.bind(this),n),this._ctrlFov=r.addSlider((0,a.default)("cameraFov"),t.getFov(),this.onFovChange.bind(this),10,90,1),this._ctrlFov.setVisibility(t.getProjectionType()===o.default.Projection.PERSPECTIVE),r.addTitle((0,a.default)("cameraMode"));var i=[];i[o.default.CameraMode.ORBIT]=(0,a.default)("cameraOrbit"),i[o.default.CameraMode.SPHERICAL]=(0,a.default)("cameraSpherical"),i[o.default.CameraMode.PLANE]=(0,a.default)("cameraPlane"),r.addCombobox("",t.getMode(),this.onCameraModeChange.bind(this),i),this._ctrlPivot=r.addCheckbox((0,a.default)("cameraPivot"),t.getUsePivot(),this.onPivotChange.bind(this))}},{key:"onCameraModeChange",value:function(e){this._camera.setMode(e),this._main.render()}},{key:"onCameraTypeChange",value:function(e){this._camera.setProjectionType(e),this._ctrlFov.setVisibility(e===o.default.Projection.PERSPECTIVE),this._main.render()}},{key:"onFovChange",value:function(e){this._camera.setFov(e),this._main.render()}},{key:"onKeyDown",value:function(e){if(!0!==e.handled&&(e.stopPropagation(),!this._main._focusGui)){e.preventDefault();var t=this._main,r=t.getCamera();switch(e.handled=!0,e.shiftKey&&t._action===o.default.Action.CAMERA_ROTATE&&(r.snapClosestRotation(),t.render()),s.default.getShortKey(e.which)){case o.default.KeyAction.STRIFE_LEFT:r._moveX=-1;break;case o.default.KeyAction.STRIFE_RIGHT:r._moveX=1;break;case o.default.KeyAction.STRIFE_UP:r._moveZ=-1;break;case o.default.KeyAction.STRIFE_DOWN:r._moveZ=1;break;default:e.handled=!1}!0===e.handled&&-1===this._cameraTimer&&(this._cameraTimer=window.setInterval(this._cbTranslation,16.6))}}},{key:"cbOnTranslation",value:function(){var e=this._main;e.getCamera().updateTranslation(),e.render()}},{key:"onKeyUp",value:function(e){if(!0!==e.handled&&(e.stopPropagation(),!this._main._focusGui)){e.preventDefault(),e.handled=!0;var t=this._camera;switch(s.default.getShortKey(e.which)){case o.default.KeyAction.STRIFE_LEFT:case o.default.KeyAction.STRIFE_RIGHT:t._moveX=0;break;case o.default.KeyAction.STRIFE_UP:case o.default.KeyAction.STRIFE_DOWN:t._moveZ=0;break;case o.default.KeyAction.CAMERA_RESET:this.resetCamera();break;case o.default.KeyAction.CAMERA_FRONT:this.resetFront();break;case o.default.KeyAction.CAMERA_TOP:this.resetTop();break;case o.default.KeyAction.CAMERA_LEFT:this.resetLeft();break;default:e.handled=!1}-1!==this._cameraTimer&&0===t._moveX&&0===t._moveZ&&(clearInterval(this._cameraTimer),this._cameraTimer=-1)}}},{key:"resetCamera",value:function(){this._camera.resetView(),this._main.render()}},{key:"resetFront",value:function(){this._camera.toggleViewFront(),this._main.render()}},{key:"resetLeft",value:function(){this._camera.toggleViewLeft(),this._main.render()}},{key:"resetTop",value:function(){this._camera.toggleViewTop(),this._main.render()}},{key:"onPivotChange",value:function(){this._camera.toggleUsePivot(),this._main.render()}}]),e}();t.default=u},function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=function(e){return e&&e.__esModule?e:{default:e}}(r(3)),a=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._ctrlGui=r,this._menu=null,this.init(t)}return function(e,t,r){t&&n(e.prototype,t),r&&n(e,r)}(e,[{key:"init",value:function(e){this._langs=Object.keys(i.default.languages),this._menu=e.addMenu((0,i.default)("language")),this._menu.addCombobox("",this._langs.indexOf(i.default.select),this.onLangChange.bind(this),this._langs)}},{key:"onLangChange",value:function(e){i.default.select=this._langs[parseInt(e,10)],this._ctrlGui.initGui()}}]),e}();t.default=a},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(3)),s=r(98),o=r(31),u=n(r(101)),l=r(105).SketchfabOAuth2,c=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=r._main,this._ctrlGui=r,this._menu=null,this._parent=t,this._exportAll=!0,this.init(t)}return function(e,t,r){t&&i(e.prototype,t),r&&i(e,r)}(e,[{key:"init",value:function(e){var t=this._menu=e.addMenu((0,a.default)("fileTitle"));t.addTitle((0,a.default)("fileImportTitle")),t.addButton((0,a.default)("fileAdd"),this,"addFile"),t.addCheckbox((0,a.default)("fileAutoMatrix"),this._main,"_autoMatrix"),t.addCheckbox((0,a.default)("fileVertexSRGB"),this._main,"_vertexSRGB"),t.addTitle((0,a.default)("fileExportSceneTitle")),t.addCheckbox((0,a.default)("fileExportAll"),this,"_exportAll"),t.addButton((0,a.default)("fileExportSGL"),this,"saveFileAsSGL"),t.addButton((0,a.default)("fileExportOBJ"),this,"saveFileAsOBJ"),t.addButton((0,a.default)("fileExportPLY"),this,"saveFileAsPLY"),t.addButton((0,a.default)("fileExportSTL"),this,"saveFileAsSTL")}},{key:"addFile",value:function(){document.getElementById("fileopen").click()}},{key:"_getExportMeshes",value:function(){if(this._exportAll)return this._main.getMeshes();var e=this._main.getSelectedMeshes();return e.length?e:void 0}},{key:"saveFileAsSGL",value:function(){var e=this._getExportMeshes();e&&this._save(u.default.exportSGL(e,this._main),"yourMesh.sgl")}},{key:"saveFileAsOBJ",value:function(){var e=this._getExportMeshes();e&&this._save(u.default.exportOBJ(e),"yourMesh.obj")}},{key:"saveFileAsPLY",value:function(){var e=this._getExportMeshes();e&&this._save(u.default.exportBinaryPLY(e),"yourMesh.ply")}},{key:"saveFileAsSTL",value:function(){var e=this._getExportMeshes();e&&this._save(u.default.exportBinarySTL(e),"yourMesh.stl")}},{key:"_save",value:function(e,t,r){if(!r)return(0,s.saveAs)(e,t);o.zip.useWebWorkers=!0,o.zip.workerScriptsPath="worker/",o.zip.createWriter(new o.zip.BlobWriter("application/zip"),function(r){r.add(t,new o.zip.BlobReader(e),function(){r.close(function(e){(0,s.saveAs)(e,"yourMesh.zip")})})},onerror)}},{key:"exportSketchfab",value:function(){if(this._main.getMesh()&&window.sketchfabOAuth2Config){var e=this._ctrlGui.getWidgetNotification();if(this._sketchfabXhr&&!0===e.sketchfab){if(!window.confirm((0,a.default)("sketchfabAbort")))return;e.sketchfab=!1,this._sketchfabXhr.abort()}new l(window.sketchfabOAuth2Config).connect().then(function(t){this._sketchfabXhr=u.default.exportSketchfab(this._main,t,e)}.bind(this)).catch(function(e){console.error(e)})}}},{key:"onKeyDown",value:function(e){if(!0!==e.handled){e.stopPropagation(),this._main._focusGui||e.preventDefault();var t=e.which;e.ctrlKey&&e.altKey&&78===t?(this._main.clearScene(),e.handled=!0):!e.ctrlKey||79!==t&&73!==t?e.ctrlKey&&69===t&&(this.saveFileAsOBJ(),e.handled=!0):(this.addFile(),e.handled=!0)}}}]),e}();t.default=c},function(e,t,r){var n,i=i||function(e){"use strict";if(!(void 0===e||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var t=function(){return e.URL||e.webkitURL||e},r=e.document.createElementNS("http://www.w3.org/1999/xhtml","a"),n="download"in r,i=/constructor/i.test(e.HTMLElement)||e.safari,a=/CriOS\/[\d]+/.test(navigator.userAgent),s=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},o=function(e){setTimeout(function(){"string"==typeof e?t().revokeObjectURL(e):e.remove()},4e4)},u=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e},l=function(l,c,h){h||(l=u(l));var f,d=this,p="application/octet-stream"===l.type,v=function(){!function(e,t,r){for(var n=(t=[].concat(t)).length;n--;){var i=e["on"+t[n]];if("function"==typeof i)try{i.call(e,r||e)}catch(e){s(e)}}}(d,"writestart progress write writeend".split(" "))};if(d.readyState=d.INIT,n)return f=t().createObjectURL(l),void setTimeout(function(){r.href=f,r.download=c,function(e){var t=new MouseEvent("click");e.dispatchEvent(t)}(r),v(),o(f),d.readyState=d.DONE});!function(){if((a||p&&i)&&e.FileReader){var r=new FileReader;return r.onloadend=function(){var t=a?r.result:r.result.replace(/^data:[^;]*;/,"data:attachment/file;");e.open(t,"_blank")||(e.location.href=t),t=void 0,d.readyState=d.DONE,v()},r.readAsDataURL(l),void(d.readyState=d.INIT)}f||(f=t().createObjectURL(l)),p?e.location.href=f:e.open(f,"_blank")||(e.location.href=f);d.readyState=d.DONE,v(),o(f)}()},c=l.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,r){return t=t||e.name||"download",r||(e=u(e)),navigator.msSaveOrOpenBlob(e,t)}:(c.abort=function(){},c.readyState=c.INIT=0,c.WRITING=1,c.DONE=2,c.error=c.onwritestart=c.onprogress=c.onwrite=c.onabort=c.onerror=c.onwriteend=null,function(e,t,r){return new l(e,t||e.name||"download",r)})}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);void 0!==e&&e.exports?e.exports.saveAs=i:null!==r(99)&&null!==r(100)&&(void 0===(n=function(){return i}.call(t,r,t,e))||(e.exports=n))},function(e,t){e.exports=function(){throw new Error("define cannot be used indirect")}},function(e,t){(function(t){e.exports=t}).call(t,{})},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(102)),a=n(r(30)),s=n(r(32)),o=n(r(103)),u=n(r(104)),l={};l.exportOBJ=i.default.exportOBJ,l.exportSGL=a.default.exportSGL,l.exportAsciiPLY=s.default.exportAsciiPLY,l.exportBinaryPLY=s.default.exportBinaryPLY,l.exportAsciiSTL=o.default.exportAsciiSTL,l.exportBinarySTL=o.default.exportBinarySTL,l.exportSketchfab=u.default.exportSketchfab;var c=l;t.default=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(1),i=function(e){return e&&e.__esModule?e:{default:e}}(r(0)),a={};a.exportOBJ=function(e){for(var t="s 0\n",r=[1,1],n=0,i=e.length;n<i;++n)t+="o mesh_"+n+"\n",t=a.addMesh(e[n],t,r);return new Blob([t])};var s=function(e,t,r){for(var n=0,i=t.length;n<i;n++)e[r++]=t.charCodeAt(n);return r};a.addMesh=function(e,t,r){var a=e.getVertices(),o=e.getColors(),u=e.getMaterials(),l=e.getFaces(),c=e.getNbVertices(),h=e.getNbFaces(),f=e.getNbTexCoords(),d=e.getMatrix(),p=0,v=0,g="",m=0;m=79*c,m+=45*f+66*h;var _=new Uint8Array(Math.max(1e3,m)),y=0,b=[0,0,0];for(p=0;p<c;++p)v=3*p,b[0]=a[v],b[1]=a[v+1],b[2]=a[v+2],n.vec3.transformMat4(b,b,d),g="v "+b[0]+" "+b[1]+" "+b[2],y=s(_,g+="\n",y);var M=Math.ceil(c/64);for(p=0;p<M;++p){g="#MRGB ",v=64*p;for(var T=p===M-1?c:v+64;v<T;++v){g+="ff";var A=3*v,S=Math.round(255*o[A]).toString(16),k=Math.round(255*o[A+1]).toString(16),w=Math.round(255*o[A+2]).toString(16);g+=1===S.length?"0"+S:S,g+=1===k.length?"0"+k:k,g+=1===w.length?"0"+w:w}y=s(_,g+="\n",y)}for(M=Math.ceil(c/46),p=0;p<M;++p){g="#MAT ",v=46*p;for(var E=p===M-1?c:v+46;v<E;++v){var x=3*v,R=Math.round(255*u[x]).toString(16),C=Math.round(255*u[x+1]).toString(16),P=Math.round(255*u[x+2]).toString(16);g+=1===R.length?"0"+R:R,g+=1===C.length?"0"+C:C,g+=1===P.length?"0"+P:P}y=s(_,g+="\n",y)}var F=e.getFacesTexCoord(),D=e.getTexCoords(),I=e.hasUV();if(I)for(p=0;p<f;++p)g="vt "+D[v=2*p]+" "+D[v+1]+"\n",y=s(_,g,y);var N=r[0],V=r[1];for(r[0]+=c,r[1]+=f,p=0;p<h;++p){var L=l[(v=4*p)+3];I?(g="f "+(N+l[v])+"/"+(V+F[v]),g+=" "+(N+l[v+1])+"/"+(V+F[v+1]),g+=" "+(N+l[v+2])+"/"+(V+F[v+2]),g+=L!==i.default.TRI_INDEX?" "+(N+L)+"/"+(V+F[v+3])+"\n":"\n"):(g="f "+(N+l[v]),g+=" "+(N+l[v+1]),g+=" "+(N+l[v+2]),g+=L!==i.default.TRI_INDEX?" "+(N+L)+"\n":"\n"),y=s(_,g,y)}if(_=_.subarray(0,y),window.TextDecoder){return t+(new TextDecoder).decode(_)}for(p=0;p<y;++p)t+=String.fromCharCode(_[p]);return t};var o=a;t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(1),i=function(e){return e&&e.__esModule?e:{default:e}}(r(15)),a={},s=function(e){for(var t=i.default.mergeArrays(e,{vertices:null,colors:null,triangles:null}),r=t.vertices,a=t.triangles,s=n.vec3.create(),o=n.vec3.create(),u=n.vec3.create(),l=t.faceNormals=new Float32Array(3*t.nbTriangles),c=0;c<t.nbTriangles;++c){var h=3*c,f=3*a[h],d=3*a[h+1],p=3*a[h+2];n.vec3.set(s,r[f],r[f+1],r[f+2]),n.vec3.set(o,r[d],r[d+1],r[d+2]),n.vec3.set(u,r[p],r[p+1],r[p+2]),n.vec3.sub(o,o,s),n.vec3.sub(u,u,o),n.vec3.cross(s,o,u),n.vec3.normalize(s,s),l[h]=s[0],l[h+1]=s[1],l[h+2]=s[2]}return t};a.exportAsciiSTL=function(e){for(var t=s(e),r=t.nbTriangles,n=t.vertices,i=t.triangles,a=t.faceNormals,o="solid mesh\n",u=0;u<r;++u){var l=3*u;o+=" facet normal "+a[l]+" "+a[l+1]+" "+a[l+2]+"\n",o+="  outer loop\n";var c=3*i[l],h=3*i[l+1],f=3*i[l+2];o+="   vertex "+n[c]+" "+n[c+1]+" "+n[c+2]+"\n",o+="   vertex "+n[h]+" "+n[h+1]+" "+n[h+2]+"\n",o+="   vertex "+n[f]+" "+n[f+1]+" "+n[f+2]+"\n",o+="  endloop\n",o+=" endfacet\n"}return o+="endsolid mesh\n",new Blob([o])},a.exportBinarySTL=function(e){var t=s(e),r=t.nbTriangles,n=t.vertices,i=t.colors,a=t.triangles,o=t.faceNormals,u=new Uint8Array(84+50*r),l=new Uint8Array(new Uint32Array([r]).buffer);u.set(l,80);for(var c=new Uint8Array(n.buffer),h=new Uint8Array(o.buffer),f=84,d=0,p=0;p<r;++p){var v=12*p;for(d=0;d<12;++d)u[f++]=h[v++];var g=3*a[v=3*p],m=3*a[v+1],_=3*a[v+2],y=4*g;for(d=0;d<12;++d)u[f++]=c[y++];var b=4*m;for(d=0;d<12;++d)u[f++]=c[b++];var M=4*_;for(d=0;d<12;++d)u[f++]=c[M++];var T=(Math.round((i[g]+i[m]+i[_])*(31/3))<<10)+(Math.round((i[g+1]+i[m+1]+i[_+1])*(31/3))<<5)+Math.round((i[g+2]+i[m+2]+i[_+2])*(31/3))+32768;u[f++]=255&T,u[f++]=T>>8}return new Blob([u])};var o=a;t.default=o},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(3)),s=r(31),o=n(r(32)),u={};u.exportSketchfab=function(e,t,r){var n=new XMLHttpRequest,l=r.domContainer;r.setVisibility(!0),r.sketchfab=!0,l.innerHTML="Uploading...",n.open("POST","https://api.sketchfab.com/v2/models",!0),n.onprogress=function(e){var t="~";e.lengthComputable&&e.total&&(t=Math.round(100*e.loaded/e.total)),l.innerHTML="Uploading : "+t+"%"};var c=function(){r.setVisibility(!1),r.sketchfab=!1};return n.onerror=c,n.onabort=c,n.onload=function(){c();var e=JSON.parse(n.responseText),r=e.uid;if(r){window.prompt((0,a.default)("sketchfabUploadProcessing"),"https://sketchfab.com/models/"+r);!function e(){var n=new XMLHttpRequest,s="https://api.sketchfab.com/v2/models/"+r+"/status";"object"===i(t)&&t.hasOwnProperty("token_type")&&"Bearer"===t.token_type?(n.open("GET",s,!0),n.setRequestHeader("Authorization","Bearer "+t.access_token)):n.open("GET",s+"?token="+t,!0),n.onload=function(){var t=JSON.parse(n.responseText);"FAILED"===t.processing?window.alert((0,a.default)("sketchfabUploadError",t.warning.generic.join("\n"))):"SUCCEEDED"===t.processing?window.prompt((0,a.default)("sketchfabUploadSuccess"),"https://sketchfab.com/models/"+r):window.setTimeout(e,5e3)},n.send()}()}else window.alert((0,a.default)("sketchfabUploadError",e.detail))},s.zip.useWebWorkers=!0,s.zip.workerScriptsPath="worker/",s.zip.createWriter(new s.zip.BlobWriter("application/zip"),function(r){var i=o.default.exportBinaryPLY(e.getMeshes(),!0);r.add("yourMesh.ply",new s.zip.BlobReader(i),function(){r.close(u.exportFileSketchfab.bind(this,e,t,n))})},onerror),n},u.exportFileSketchfab=function(e,t,r,n){var a=new FormData;a.append("modelFile",n,"sculptglModel.zip"),a.append("name","My model"),a.append("tags","sculptgl"),"object"===i(t)&&t.hasOwnProperty("token_type")&&"Bearer"===t.token_type?r.setRequestHeader("Authorization","Bearer "+t.access_token):a.append("token",t),r.send(a)};var l=u;t.default=l},function(e,t,r){"use strict";(function(e){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var n,i,a;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,function(s,o){"object"===r(t)&&"object"===r(e)?e.exports=o():(i=[],void 0===(a="function"==typeof(n=o)?n.apply(t,i):n)||(e.exports=a))}(0,function(){return function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){function n(e){if(!e)throw new Error("SketchfabOAuth2 config is missing.");if(e.hasOwnProperty("hostname")||(e.hostname="sketchfab.com"),!e.hasOwnProperty("client_id"))throw new Error("client_id is missing. Please check the config of SketchfabOAuth2.");if(!e.hasOwnProperty("redirect_uri"))throw new Error("redirect_uri is missing. Please check the config of SketchfabOAuth2.");this.config=e}var i=r(1);n.prototype.connect=function(){return i.promise(function(e,t){if(this.config.client_id)var r=+new Date,n=["https://"+this.config.hostname+"/oauth2/authorize/?","state="+r,"&response_type=token","&client_id="+this.config.client_id].join(""),i=window.open(n,"loginWindow","width=640,height=400"),a=setInterval(function(){try{var r=i.location.href;if(void 0===r)return clearInterval(a),void t(new Error("Access denied (User closed popup)"));if(-1!==r.indexOf("?error=access_denied"))return clearInterval(a),void t(new Error("Access denied (User canceled)"));if(-1!==r.indexOf(this.config.redirect_uri)){clearInterval(a);var n,s=i.location.hash,o=RegExp("access_token=([^&]+)");return s.match(o)?(n=function(e){var t={};return e.split("&").forEach(function(e){var r=e.split("=");t[r[0]]=decodeURIComponent(r[1])}),t}(s.substring(1)),void e(n)):void t(new Error("Access denied (missing token)"))}}catch(e){}}.bind(this),1e3);else t(new Error("client_id is missing."))}.bind(this))},e.exports=n},function(e,t,r){var n;r(6),void 0===(n=function(e){function t(e,t,r,n){var i=v.resolve(e);return arguments.length<2?i:i.then(t,r,n)}function n(e){return function(){for(var t=0,r=arguments.length,n=new Array(r);t<r;++t)n[t]=arguments[t];return g(e,this,n)}}function i(e){for(var t=0,r=arguments.length-1,n=new Array(r);t<r;++t)n[t]=arguments[t+1];return g(e,this,n)}var a=r(2),s=r(8),o=r(11),u=r(12),l=r(13),c=r(14),h=r(15),f=r(16),d=r(17),p=r(7),v=[s,o,u,c,h,l,f,a,d].reduce(function(e,t){return t(e)},r(19)),g=r(10)(v);return t.promise=function(e){return new v(e)},t.resolve=v.resolve,t.reject=v.reject,t.lift=n,t.try=i,t.attempt=i,t.iterate=v.iterate,t.unfold=v.unfold,t.join=function(){return v.all(arguments)},t.all=function(e){return t(e,v.all)},t.settle=function(e){return t(e,v.settle)},t.any=n(v.any),t.some=n(v.some),t.race=n(v.race),t.map=function(e,r){return t(e,function(e){return v.map(e,r)})},t.filter=function(e,r){return t(e,function(e){return v.filter(e,r)})},t.reduce=n(v.reduce),t.reduceRight=n(v.reduceRight),t.isPromiseLike=function(e){return e&&"function"==typeof e.then},t.Promise=v,t.defer=function(){return new function(){function e(e){n._handler.resolve(e)}function t(e){n._handler.reject(e)}function r(e){n._handler.notify(e)}var n=v._defer();this.promise=n,this.resolve=e,this.reject=t,this.notify=r,this.resolver={resolve:e,reject:t,notify:r}}},t.TimeoutError=p,t}.call(t,r,t,e))||(e.exports=n)},function(e,t,r){var n;r(6),void 0===(n=function(e){function t(e,t,r,i){return n.setTimer(function(){e(r,i,t)},t)}var n=r(3),i=r(7);return function(e){function r(e,r,n){t(a,e,r,n)}function a(e,t){t.resolve(e)}function s(e,t,r){var n=void 0===e?new i("timed out after "+r+"ms"):e;t.reject(n)}return e.prototype.delay=function(e){var t=this._beget();return this._handler.fold(r,e,void 0,t._handler),t},e.prototype.timeout=function(e,r){var i=this._beget(),a=i._handler,o=t(s,e,r,i._handler);return this._handler.visit(a,function(e){n.clearTimer(o),this.resolve(e)},function(e){n.clearTimer(o),this.reject(e)},a.notify),i},e}}.call(t,r,t,e))||(e.exports=n)},function(e,t,r){var n;(function(i){r(6),void 0===(n=function(e){var t,n="undefined"!=typeof setTimeout&&setTimeout,a=function(e,t){return setTimeout(e,t)},s=function(e){return clearTimeout(e)},o=function(e){return n(e,0)};if(void 0!==i&&"[object process]"===Object.prototype.toString.call(i))o=function(e){return i.nextTick(e)};else if(t="function"==typeof MutationObserver&&MutationObserver||"function"==typeof WebKitMutationObserver&&WebKitMutationObserver)o=function(e){var t,r=document.createTextNode("");new e(function(){var e=t;t=void 0,e()}).observe(r,{characterData:!0});var n=0;return function(e){t=e,r.data=n^=1}}(t);else if(!n){var u=r(5);a=function(e,t){return u.setTimer(t,e)},s=u.cancelTimer,o=u.runOnLoop||u.runOnContext}return{setTimer:a,clearTimer:s,asap:o}}.call(t,r,t,e))||(e.exports=n)}).call(t,r(4))},function(e,t){function r(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}function i(e){if(l===setTimeout)return setTimeout(e,0);if((l===r||!l)&&setTimeout)return l=setTimeout,setTimeout(e,0);try{return l(e,0)}catch(t){try{return l.call(null,e,0)}catch(t){return l.call(this,e,0)}}}function a(){p&&f&&(p=!1,f.length?d=f.concat(d):v=-1,d.length&&s())}function s(){if(!p){var e=i(a);p=!0;for(var t=d.length;t;){for(f=d,d=[];++v<t;)f&&f[v].run();v=-1,t=d.length}f=null,p=!1,function(e){if(c===clearTimeout)return clearTimeout(e);if((c===n||!c)&&clearTimeout)return c=clearTimeout,clearTimeout(e);try{c(e)}catch(t){try{return c.call(null,e)}catch(t){return c.call(this,e)}}}(e)}}function o(e,t){this.fun=e,this.array=t}function u(){}var l,c,h=e.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:r}catch(e){l=r}try{c="function"==typeof clearTimeout?clearTimeout:n}catch(e){c=n}}();var f,d=[],p=!1,v=-1;h.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];d.push(new o(e,t)),1!==d.length||p||i(s)},o.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=u,h.addListener=u,h.once=u,h.off=u,h.removeListener=u,h.removeAllListeners=u,h.emit=u,h.binding=function(e){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(e){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},function(e,t){},function(e,t){e.exports=function(){throw new Error("define cannot be used indirect")}},function(e,t,r){var n;r(6),void 0===(n=function(){function e(t){Error.call(this),this.message=t,this.name=e.name,"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,e)}return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}.call(t,r,t,e))||(e.exports=n)},function(e,t,r){var n;r(6),void 0===(n=function(e){var t=r(9),n=r(10);return function(e){function r(r){var n=e._handler(r);return 0===n.state()?s(r).then(t.fulfilled,t.rejected):(n._unreport(),t.inspect(n))}function i(e){return function(t,r,n){return a(e,void 0,[t,r,n])}}var a=n(e),s=e.resolve,o=e.all,u=Array.prototype.reduce,l=Array.prototype.reduceRight,c=Array.prototype.slice;return e.any=function(t){function r(e){c=null,this.resolve(e)}function n(e){this.resolved||(c.push(e),0==--l&&this.reject(c))}for(var i,a,s=e._defer(),o=s._handler,u=t.length>>>0,l=u,c=[],h=0;h<u;++h)if(void 0!==(a=t[h])||h in t){if((i=e._handler(a)).state()>0){o.become(i),e._visitRemaining(t,h,i);break}i.visit(o,r,n)}else--l;return 0===l&&o.reject(new RangeError("any(): array must not be empty")),s},e.some=function(t,r){function n(e){this.resolved||(c.push(e),0==--d&&(h=null,this.resolve(c)))}function i(e){this.resolved||(h.push(e),0==--a&&(c=null,this.reject(h)))}var a,s,o,u=e._defer(),l=u._handler,c=[],h=[],f=t.length>>>0,d=0;for(o=0;o<f;++o)(void 0!==(s=t[o])||o in t)&&++d;for(r=Math.max(r,0),a=d-r+1,r>(d=Math.min(r,d))?l.reject(new RangeError("some(): array must contain at least "+r+" item(s), but had "+d)):0===d&&l.resolve(c),o=0;o<f;++o)(void 0!==(s=t[o])||o in t)&&e._handler(s).visit(l,n,i,l.notify);return u},e.settle=function(e){return o(e.map(r))},e.map=function(t,r){return e._traverse(r,t)},e.filter=function(t,r){var n=c.call(t);return e._traverse(r,n).then(function(t){return function(t,r){for(var n=r.length,i=new Array(n),a=0,s=0;a<n;++a)r[a]&&(i[s++]=e._handler(t[a]).value);return i.length=s,i}(n,t)})},e.reduce=function(e,t){return arguments.length>2?u.call(e,i(t),arguments[2]):u.call(e,i(t))},e.reduceRight=function(e,t){return arguments.length>2?l.call(e,i(t),arguments[2]):l.call(e,i(t))},e.prototype.spread=function(e){return this.then(o).then(function(t){return e.apply(this,t)})},e}}.call(t,r,t,e))||(e.exports=n)},function(e,t,r){var n;r(6),void 0===(n=function(){function e(){return{state:"pending"}}function t(e){return{state:"rejected",reason:e}}function r(e){return{state:"fulfilled",value:e}}return{pending:e,fulfilled:r,rejected:t,inspect:function(e){var n=e.state();return 0===n?{state:"pending"}:n>0?r(e.value):t(e.value)}}}.call(t,r,t,e))||(e.exports=n)},function(e,t,r){var n;r(6),void 0===(n=function(){function e(e,r){function n(t,n){if(t.i<0)return r(t.f,t.thisArg,t.params,n);e._handler(t.args[t.i]).fold(i,t,void 0,n)}function i(e,t,r){e.params[e.i]=t,e.i-=1,n(e,r)}return arguments.length<2&&(r=t),function(t,i,a){var s=e._defer(),o=a.length;return n({f:t,thisArg:i,args:a,params:new Array(o),i:o-1,call:r},s._handler),s}}function t(e,t,r,n){try{n.resolve(e.apply(t,r))}catch(e){n.reject(e)}}return e.tryCatchResolve=t,e}.call(t,r,t,e))||(e.exports=n)},function(e,t,n){var i;n(6),void 0===(i=function(){function e(){throw new TypeError("catch predicate must be a function")}function t(e,t){return function(e){return e===Error||null!=e&&e.prototype instanceof Error}(t)?e instanceof t:t(e)}function n(e){return e}return function(i){function a(e,t,n,i){var a=e.call(t);return function(e){return("object"===r(e)||"function"==typeof e)&&null!==e}(a)?function(e,t,r){return s(e).then(function(){return t(r)})}(a,n,i):n(i)}var s=i.resolve,o=i.reject,u=i.prototype.catch;return i.prototype.done=function(e,t){this._handler.visit(this._handler.receiver,e,t)},i.prototype.catch=i.prototype.otherwise=function(r){return arguments.length<2?u.call(this,r):"function"!=typeof r?this.ensure(e):u.call(this,function(e,r){return function(n){return t(n,r)?e.call(this,n):o(n)}}(arguments[1],r))},i.prototype.finally=i.prototype.ensure=function(e){return"function"!=typeof e?this:this.then(function(t){return a(e,this,n,t)},function(t){return a(e,this,o,t)})},i.prototype.else=i.prototype.orElse=function(e){return this.then(void 0,function(){return e})},i.prototype.yield=function(e){return this.then(function(){return e})},i.prototype.tap=function(e){return this.then(e).yield(this)},i}}.call(t,n,t,e))||(e.exports=i)},function(e,t,r){var n;r(6),void 0===(n=function(){return function(e){return e.prototype.fold=function(t,r){var n=this._beget();return this._handler.fold(function(r,n,i){e._handler(r).fold(function(e,r,n){n.resolve(t.call(this,r,e))},n,this,i)},r,n._handler.receiver,n._handler),n},e}}.call(t,r,t,e))||(e.exports=n)},function(e,t,r){var n;r(6),void 0===(n=function(e){var t=r(9).inspect;return function(e){return e.prototype.inspect=function(){return t(e._handler(this))},e}}.call(t,r,t,e))||(e.exports=n)},function(e,t,r){var n;r(6),void 0===(n=function(){return function(e){function t(e,n,i,a){function s(a,s){return r(i(a)).then(function(){return t(e,n,i,s)})}return r(a).then(function(t){return r(n(t)).then(function(n){return n?t:r(e(t)).spread(s)})})}var r=e.resolve;return e.iterate=function(e,r,n,i){return t(function(t){return[t,e(t)]},r,n,i)},e.unfold=t,e}}.call(t,r,t,e))||(e.exports=n)},function(e,t,r){var n;r(6),void 0===(n=function(){return function(e){return e.prototype.progress=function(e){return this.then(void 0,void 0,e)},e}}.call(t,r,t,e))||(e.exports=n)},function(e,t,r){var n;r(6),void 0===(n=function(){return function(e){return e.prototype.with=e.prototype.withThis=function(e){var t=this._beget(),r=t._handler;return r.receiver=e,this._handler.chain(r,e),t},e}}.call(t,r,t,e))||(e.exports=n)},function(e,t,r){var n;r(6),void 0===(n=function(e){function t(e){throw e}function n(){}var i=r(3).setTimer,a=r(18);return function(e){function r(e){e.handled||(d.push(e),c("Potentially unhandled rejection ["+e.id+"] "+a.formatError(e.value)))}function s(e){var t=d.indexOf(e);t>=0&&(d.splice(t,1),h("Handled previous rejection ["+e.id+"] "+a.formatObject(e.value)))}function o(e,t){f.push(e,t),null===p&&(p=i(u,0))}function u(){for(p=null;f.length>0;)f.shift()(f.shift())}var l,c=n,h=n;"undefined"!=typeof console&&(l=console,c=void 0!==l.error?function(e){l.error(e)}:function(e){l.log(e)},h=void 0!==l.info?function(e){l.info(e)}:function(e){l.log(e)}),e.onPotentiallyUnhandledRejection=function(e){o(r,e)},e.onPotentiallyUnhandledRejectionHandled=function(e){o(s,e)},e.onFatalRejection=function(e){o(t,e.value)};var f=[],d=[],p=null;return e}}.call(t,r,t,e))||(e.exports=n)},function(e,t,n){var i;n(6),void 0===(i=function(){function e(e){var r=String(e);return"[object Object]"===r&&"undefined"!=typeof JSON&&(r=t(e,r)),r}function t(e,t){try{return JSON.stringify(e)}catch(e){return t}}return{formatError:function(t){var n="object"===r(t)&&null!==t&&(t.stack||t.message)?t.stack||t.message:e(t);return t instanceof Error?n:n+" (WARNING: non-Error used)"},formatObject:e,tryStringify:t}}.call(t,n,t,e))||(e.exports=i)},function(e,t,r){var n;r(6),void 0===(n=function(e){return r(20)({scheduler:new(r(21))(r(3).asap)})}.call(t,r,t,e))||(e.exports=n)},function(e,t,n){var i;(function(a){n(6),void 0===(i=function(){return function(e){function t(e,t){this._handler=e===f?t:function(e){function t(e){i.resolve(e)}function r(e){i.reject(e)}function n(e){i.notify(e)}var i=new p;try{e(t,r,n)}catch(e){r(e)}return i}(e)}function n(e){return k(e)?e:new t(f,new v(c(e)))}function i(e){return new t(f,new v(new _(e)))}function s(){return O}function o(e,r,n){function i(e,t,r){c[e]=t,0==--l&&r.become(new m(c))}for(var a,s="function"==typeof r?function(t,a,s){s.resolved||u(n,i,t,e(r,a,t),s)}:i,o=new p,l=n.length>>>0,c=new Array(l),h=0;h<n.length&&!o.resolved;++h)void 0!==(a=n[h])||h in n?u(n,s,h,a,o):--l;return 0===l&&o.become(new m(c)),new t(f,o)}function u(e,t,r,n,i){if(w(n)){var a=function(e){return k(e)?e._handler.join():h(e)}(n),s=a.state();0===s?a.fold(t,r,void 0,i):s>0?t(r,a.value,i):(i.become(a),l(e,r+1,a))}else t(r,n,i)}function l(e,t,r){for(var n=t;n<e.length;++n)!function(e,t){if(e===t)return;var r=e.state();0===r?e.visit(e,void 0,e._unreport):r<0&&e._unreport()}(c(e[n]),r)}function c(e){return k(e)?e._handler.join():w(e)?h(e):new m(e)}function h(e){try{var t=e.then;return"function"==typeof t?new g(t,e):new m(e)}catch(e){return new _(e)}}function f(){}function d(){}function p(e,r){t.createContext(this,r),this.consumers=void 0,this.receiver=e,this.handler=void 0,this.resolved=!1}function v(e){this.handler=e}function g(e,t){p.call(this),D.enqueue(new A(e,t,this))}function m(e){t.createContext(this),this.value=e}function _(e){t.createContext(this),this.id=++L,this.value=e,this.handled=!1,this.reported=!1,this._report()}function y(e,t){this.rejection=e,this.context=t}function b(e){this.rejection=e}function M(e,t){this.continuation=e,this.handler=t}function T(e,t){this.handler=t,this.value=e}function A(e,t,r){this._then=e,this.thenable=t,this.resolver=r}function S(e,t,r,n){this.f=e,this.z=t,this.c=r,this.to=n,this.resolver=V,this.receiver=this}function k(e){return e instanceof t}function w(e){return("object"===r(e)||"function"==typeof e)&&null!==e}function E(e,r,n,i){if("function"!=typeof e)return i.become(r);t.enterContext(r),function(e,t,r,n){try{n.become(c(e.call(r,t)))}catch(e){n.become(new _(e))}}(e,r.value,n,i),t.exitContext()}function x(e,r,n,i,a){if("function"!=typeof e)return a.become(n);t.enterContext(n),function(e,t,r,n,i){try{e.call(n,t,r,i)}catch(e){i.become(new _(e))}}(e,r,n.value,i,a),t.exitContext()}function R(e,t,r){try{return e(t,r)}catch(e){return i(e)}}function C(e,t){t.prototype=N(e.prototype),t.prototype.constructor=t}function P(e,t){return t}function F(){}var D=e.scheduler,I=void 0!==a&&null!==a&&"function"==typeof a.emit?function(e,t){return"unhandledRejection"===e?a.emit(e,t.value,t):a.emit(e,t)}:"undefined"!=typeof self&&"function"==typeof CustomEvent?function(e,t,r){var n=!1;try{n=new r("unhandledRejection")instanceof r}catch(e){}return n?function(e,n){var i=new r(e,{detail:{reason:n.value,key:n},bubbles:!1,cancelable:!0});return!t.dispatchEvent(i)}:e}(F,self,CustomEvent):F,N=Object.create||function(e){function t(){}return t.prototype=e,new t};t.resolve=n,t.reject=i,t.never=s,t._defer=function(){return new t(f,new p)},t._handler=c,t.prototype.then=function(e,t,r){var n=this._handler,i=n.join().state();if("function"!=typeof e&&i>0||"function"!=typeof t&&i<0)return new this.constructor(f,n);var a=this._beget(),s=a._handler;return n.chain(s,n.receiver,e,t,r),a},t.prototype.catch=function(e){return this.then(void 0,e)},t.prototype._beget=function(){return function(e,t){return new t(f,new p(e.receiver,e.join().context))}(this._handler,this.constructor)},t.all=function(e){return o(P,null,e)},t.race=function(e){return"object"!==r(e)||null===e?i(new TypeError("non-iterable passed to race()")):0===e.length?s():1===e.length?n(e[0]):function(e){var r,n,i,a=new p;for(r=0;r<e.length;++r)if(void 0!==(n=e[r])||r in e){if(0!==(i=c(n)).state()){a.become(i),l(e,r+1,i);break}i.visit(a,a.resolve,a.reject)}return new t(f,a)}(e)},t._traverse=function(e,t){return o(R,e,t)},t._visitRemaining=l,f.prototype.when=f.prototype.become=f.prototype.notify=f.prototype.fail=f.prototype._unreport=f.prototype._report=F,f.prototype._state=0,f.prototype.state=function(){return this._state},f.prototype.join=function(){for(var e=this;void 0!==e.handler;)e=e.handler;return e},f.prototype.chain=function(e,t,r,n,i){this.when({resolver:e,receiver:t,fulfilled:r,rejected:n,progress:i})},f.prototype.visit=function(e,t,r,n){this.chain(V,e,t,r,n)},f.prototype.fold=function(e,t,r,n){this.when(new S(e,t,r,n))},C(f,d),d.prototype.become=function(e){e.fail()};var V=new d;C(f,p),p.prototype._state=0,p.prototype.resolve=function(e){this.become(c(e))},p.prototype.reject=function(e){this.resolved||this.become(new _(e))},p.prototype.join=function(){if(!this.resolved)return this;for(var e=this;void 0!==e.handler;)if((e=e.handler)===this)return this.handler=new _(new TypeError("Promise cycle"));return e},p.prototype.run=function(){var e=this.consumers,t=this.handler;this.handler=this.handler.join(),this.consumers=void 0;for(var r=0;r<e.length;++r)t.when(e[r])},p.prototype.become=function(e){this.resolved||(this.resolved=!0,this.handler=e,void 0!==this.consumers&&D.enqueue(this),void 0!==this.context&&e._report(this.context))},p.prototype.when=function(e){this.resolved?D.enqueue(new M(e,this.handler)):void 0===this.consumers?this.consumers=[e]:this.consumers.push(e)},p.prototype.notify=function(e){this.resolved||D.enqueue(new T(e,this))},p.prototype.fail=function(e){var t=void 0===e?this.context:e;this.resolved&&this.handler.join().fail(t)},p.prototype._report=function(e){this.resolved&&this.handler.join()._report(e)},p.prototype._unreport=function(){this.resolved&&this.handler.join()._unreport()},C(f,v),v.prototype.when=function(e){D.enqueue(new M(e,this))},v.prototype._report=function(e){this.join()._report(e)},v.prototype._unreport=function(){this.join()._unreport()},C(p,g),C(f,m),m.prototype._state=1,m.prototype.fold=function(e,t,r,n){x(e,t,this,r,n)},m.prototype.when=function(e){E(e.fulfilled,this,e.receiver,e.resolver)};var L=0;C(f,_),_.prototype._state=-1,_.prototype.fold=function(e,t,r,n){n.become(this)},_.prototype.when=function(e){"function"==typeof e.rejected&&this._unreport(),E(e.rejected,this,e.receiver,e.resolver)},_.prototype._report=function(e){D.afterQueue(new y(this,e))},_.prototype._unreport=function(){this.handled||(this.handled=!0,D.afterQueue(new b(this)))},_.prototype.fail=function(e){this.reported=!0,I("unhandledRejection",this),t.onFatalRejection(this,void 0===e?this.context:e)},y.prototype.run=function(){this.rejection.handled||this.rejection.reported||(this.rejection.reported=!0,I("unhandledRejection",this.rejection)||t.onPotentiallyUnhandledRejection(this.rejection,this.context))},b.prototype.run=function(){this.rejection.reported&&(I("rejectionHandled",this.rejection)||t.onPotentiallyUnhandledRejectionHandled(this.rejection))},t.createContext=t.enterContext=t.exitContext=t.onPotentiallyUnhandledRejection=t.onPotentiallyUnhandledRejectionHandled=t.onFatalRejection=F;var O=new t(f,new f);return M.prototype.run=function(){this.handler.join().when(this.continuation)},T.prototype.run=function(){var e=this.handler.consumers;if(void 0!==e)for(var r,n=0;n<e.length;++n)!function(e,r,n,i,a){if("function"!=typeof e)return a.notify(r);t.enterContext(n),function(e,t,r,n){try{n.notify(e.call(r,t))}catch(e){n.notify(e)}}(e,r,i,a),t.exitContext()}((r=e[n]).progress,this.value,this.handler,r.receiver,r.resolver)},A.prototype.run=function(){var e=this.resolver;!function(e,t,r,n,i){try{e.call(t,r,n,i)}catch(e){n(e)}}(this._then,this.thenable,function(t){e.resolve(t)},function(t){e.reject(t)},function(t){e.notify(t)})},S.prototype.fulfilled=function(e){this.f.call(this.c,this.z,e,this.to)},S.prototype.rejected=function(e){this.to.reject(e)},S.prototype.progress=function(e){this.to.notify(e)},t}}.call(t,n,t,e))||(e.exports=i)}).call(t,n(4))},function(e,t,r){var n;r(6),void 0===(n=function(){function e(e){this._async=e,this._running=!1,this._queue=this,this._queueLen=0,this._afterQueue={},this._afterQueueLen=0;var t=this;this.drain=function(){t._drain()}}return e.prototype.enqueue=function(e){this._queue[this._queueLen++]=e,this.run()},e.prototype.afterQueue=function(e){this._afterQueue[this._afterQueueLen++]=e,this.run()},e.prototype.run=function(){this._running||(this._running=!0,this._async(this.drain))},e.prototype._drain=function(){for(var e=0;e<this._queueLen;++e)this._queue[e].run(),this._queue[e]=void 0;for(this._queueLen=0,this._running=!1,e=0;e<this._afterQueueLen;++e)this._afterQueue[e].run(),this._afterQueue[e]=void 0;this._afterQueueLen=0},e}.call(t,r,t,e))||(e.exports=n)}])});var s=window.SketchfabOAuth2;t.default=s}).call(t,r(106)(e))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=function(e){return e&&e.__esModule?e:{default:e}}(r(3)),a=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=r._main,this.domVerts=null,this.domFaces=null,this.domUl=null,this.init(t)}return function(e,t,r){t&&n(e.prototype,t),r&&n(e,r)}(e,[{key:"init",value:function(e){this.domVerts=document.createElement("ul"),this.domVerts.innerHTML=(0,i.default)("meshNbVertices"),this.domFaces=document.createElement("ul"),this.domFaces.innerHTML=(0,i.default)("meshNbFaces"),this.domUl=document.createElement("span"),this.domUl.appendChild(this.domVerts),this.domUl.appendChild(this.domFaces);var t=this.domUl.style;t.cursor="default",void 0===t.float?t.cssFloat="right":t.float="right",e.domTopbar.appendChild(this.domUl)}},{key:"updateMeshInfo",value:function(){var e=this._main.getMesh();this.domVerts.innerHTML=(0,i.default)("meshNbVertices")+(e?e.getNbVertices():0),this.domFaces.innerHTML=(0,i.default)("meshNbFaces")+(e?e.getNbFaces():0)}}]),e}();t.default=a},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(3)),s=n(r(15)),o=n(r(11)),u=n(r(9)),l=n(r(21)),c=n(r(111)),h=n(r(33)),f=n(r(5)),d=n(r(2)),p=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._ctrlGui=r,this._main=r._main,this._menu=null,this._ctrlResolution=null,this._ctrlDynamic=null,this.init(t)}return function(e,t,r){t&&i(e.prototype,t),r&&i(e,r)}(e,[{key:"init",value:function(e){var t=this._menu=e.addMenu((0,a.default)("topologyTitle"));t.close(),t.addTitle((0,a.default)("multiresTitle")),this._ctrlResolution=t.addSlider((0,a.default)("multiresResolution"),1,this.onResolutionChanged.bind(this),1,1,1);var r=t.addDualButton((0,a.default)("multiresReverse"),(0,a.default)("multiresSubdivide"),this,this,"reverse","subdivide");this._ctrlReverse=r[0],this._ctrlSubdivide=r[1],r=this._dualButtonDel=t.addDualButton((0,a.default)("multiresDelLower"),(0,a.default)("multiresDelHigher"),this,this,"deleteLower","deleteHigher"),this._ctrlDelLower=r[0],this._ctrlDelHigher=r[1],this._ctrlDelLower.domButton.style.background=this._ctrlDelHigher.domButton.style.background="rgba(230,53,59,0.35)",t.addTitle((0,a.default)("remeshTitle")),t.addSlider((0,a.default)("remeshResolution"),s.default,"RESOLUTION",8,400,1),t.addCheckbox((0,a.default)("remeshBlock"),s.default,"BLOCK"),t.addButton((0,a.default)("remeshRemesh"),this,"remesh"),t.addTitle((0,a.default)("dynamicTitle")),this._ctrlDynamic=t.addCheckbox((0,a.default)("dynamicActivated"),!1,this.dynamicToggleActivate.bind(this)),this._ctrlDynSubd=t.addSlider((0,a.default)("dynamicSubdivision"),c.default,"SUBDIVISION_FACTOR",0,100,1),this._ctrlDynDec=t.addSlider((0,a.default)("dynamicDecimation"),c.default,"DECIMATION_FACTOR",0,100,1),this._ctrlDynLin=t.addCheckbox((0,a.default)("dynamicLinear"),c.default,"LINEAR"),this.updateDynamicVisibility(!1)}},{key:"onKeyUp",value:function(e){if(!0!==e.handled){var t=f.default.getShortKey(e.which);e.stopPropagation(),t===d.default.KeyAction.REMESH&&this.remesh()}}},{key:"updateDynamicVisibility",value:function(e){this._ctrlDynSubd.setVisibility(e),this._ctrlDynDec.setVisibility(e),this._ctrlDynLin.setVisibility(e)}},{key:"dynamicToggleActivate",value:function(){var e=this._main,t=e.getMesh();if(t){var r=t.isDynamic?this.convertToStaticMesh(t):new c.default(t);this.updateDynamicVisibility(!t.isDynamic),e.getStateManager().pushStateAddRemove(r,t),e.replaceMesh(t,r)}}},{key:"remesh",value:function(){var e=this._main,t=e.getMesh();if(t){for(var r=t.isDynamic,n=e.getMeshes(),i=e.getSelectedMeshes().slice(),a=0,o=i.length;a<o;++a){var u=i[a];n.splice(e.getIndexMesh(u),1),i[a]=this.convertToStaticMesh(u),u===t&&(t=i[a])}var l=s.default.remesh(i,t);r&&(l=new c.default(l)),e.getStateManager().pushStateAddRemove(l,e.getSelectedMeshes().slice()),e.getMeshes().push(l),e.setMesh(l)}}},{key:"isMultimesh",value:function(e){return!(!e||!e._meshes)}},{key:"convertToStaticMesh",value:function(e){if(!e.isDynamic)return e;var t=new u.default(e.getGL());return t.setID(e.getID()),t.setTransformData(e.getTransformData()),t.setVertices(e.getVertices().subarray(0,3*e.getNbVertices())),t.setColors(e.getColors().subarray(0,3*e.getNbVertices())),t.setMaterials(e.getMaterials().subarray(0,3*e.getNbVertices())),t.setFaces(e.getFaces().subarray(0,4*e.getNbFaces())),o.default.OPTIMIZE=!1,t.init(),o.default.OPTIMIZE=!0,t.setRenderData(e.getRenderData()),t.initRender(),t}},{key:"convertToMultimesh",value:function(e){if(this.isMultimesh(e))return e;return new l.default(this.convertToStaticMesh(e))}},{key:"subdivide",value:function(){var e=this._main,t=e.getMesh();if(t){var r=this.convertToMultimesh(t);r._sel===r._meshes.length-1?r.getNbTriangles()>4e5&&!window.confirm((0,a.default)("multiresWarnBigMesh",4*r.getNbFaces()))||(t!==r&&(e.replaceMesh(t,r),e.getStateManager().pushStateAddRemove(r,t,!0)),e.getStateManager().pushState(new h.default(e,r,h.default.SUBDIVISION)),r.addLevel(),e.setMesh(r),e.render()):window.alert((0,a.default)("multiresSelectHighest"))}}},{key:"reverse",value:function(){var e=this._main,t=e.getMesh();if(t){var r=this.convertToMultimesh(t);if(0===r._sel){var n=new h.default(e,r,h.default.REVERSION);r.computeReverse()?(t!==r&&(e.replaceMesh(t,r),e.getStateManager().pushStateAddRemove(r,t,!0)),e.getStateManager().pushState(n),e.setMesh(r),e.render()):window.alert((0,a.default)("multiresNotReversible"))}else window.alert((0,a.default)("multiresSelectLowest"))}}},{key:"deleteLower",value:function(){var e=this._main,t=e._mesh;this.isMultimesh(t)&&0!==t._sel?(e.getStateManager().pushState(new h.default(e,t,h.default.DELETE_LOWER)),t.deleteLower(),this.updateMeshResolution()):window.alert((0,a.default)("multiresNoLower"))}},{key:"deleteHigher",value:function(){var e=this._main,t=e.getMesh();this.isMultimesh(t)&&t._sel!==t._meshes.length-1?(e.getStateManager().pushState(new h.default(e,t,h.default.DELETE_HIGHER)),t.deleteHigher(),this.updateMeshResolution()):window.alert((0,a.default)("multiresNoHigher"))}},{key:"onResolutionChanged",value:function(e){var t=e-1,r=this._main,n=r.getMesh();if(n){var i=this.isMultimesh(n),a=i&&n._meshes.length-1===t;this._ctrlReverse.setEnable(!i||0===t),this._ctrlSubdivide.setEnable(!i||a),this._ctrlDelLower.setEnable(i&&0!==t),this._ctrlDelHigher.setEnable(i&&!a),i&&n._sel!==t&&(r.getStateManager().pushState(new h.default(r,n,h.default.SELECTION)),n.selectResolution(t),this._ctrlGui.updateMeshInfo(),r.render())}}},{key:"updateMeshResolution",value:function(){var e=this._main.getMesh();if(!e||!this.isMultimesh(e))return this._ctrlResolution.setMax(1),void this._ctrlResolution.setValue(0);this._ctrlResolution.setMax(e._meshes.length),this._ctrlResolution.setValue(e._sel+1)}},{key:"updateMesh",value:function(){if(this._main.getMesh()){this._menu.setVisibility(!0),this.updateMeshResolution();var e=this._main.getMesh().isDynamic;this.updateDynamicVisibility(e),this._ctrlDynamic.setValue(e,!0)}else this._menu.setVisibility(!1)}}]),e}();t.default=p},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=n(r(0)),o=n(r(20)),u=n(r(11)),l=n(r(19)),c=function(e){function t(e,r){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))).setID(e.getID()),n.setMeshData(r?e.getMeshData():(0,l.default)()),n.setRenderData(e.getRenderData()),n.setTransformData(e.getTransformData()),n._detailsXYZ=null,n._detailsRGB=null,n._detailsPBR=null,n._vertMapping=null,n._evenMapping=!1,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.default),function(e,t,r){t&&a(e.prototype,t),r&&a(e,r)}(t,[{key:"optimize",value:function(){}},{key:"getEvenMapping",value:function(){return this._evenMapping}},{key:"getVerticesMapping",value:function(){return this._vertMapping}},{key:"setVerticesMapping",value:function(e){this._vertMapping=e}},{key:"setEvenMapping",value:function(e){this._evenMapping=e}},{key:"higherSynthesis",value:function(e){e.computePartialSubdivision(this.getVertices(),this.getColors(),this.getMaterials(),this.getNbVertices()),this.applyDetails()}},{key:"lowerAnalysis",value:function(e){this.copyDataFromHigherRes(e);var t=e.getNbVertices(),r=new Float32Array(3*t),n=new Float32Array(3*t),i=new Float32Array(3*t);this.computePartialSubdivision(r,n,i,t),e.computeDetails(r,n,i,t)}},{key:"copyDataFromHigherRes",value:function(e){var t=this.getVertices(),r=this.getColors(),n=this.getMaterials(),i=this.getNbVertices(),a=e.getVertices(),s=e.getColors(),o=e.getMaterials();if(!1===this.getEvenMapping())t.set(a.subarray(0,3*i)),r.set(s.subarray(0,3*i)),n.set(o.subarray(0,3*i));else for(var u=this.getVerticesMapping(),l=0;l<i;++l){var c=3*l,h=3*u[l];t[c]=a[h],t[c+1]=a[h+1],t[c+2]=a[h+2],r[c]=s[h],r[c+1]=s[h+1],r[c+2]=s[h+2],n[c]=o[h],n[c+1]=o[h+1],n[c+2]=o[h+2]}}},{key:"computePartialSubdivision",value:function(e,t,r,n){var i=this.getVerticesMapping();if(i){var a=new Float32Array(3*n),s=new Float32Array(3*n),u=new Float32Array(3*n);o.default.partialSubdivision(this,a,s,u);var l=!0===this.getEvenMapping()?0:this.getNbVertices();l>0&&(e.set(a.subarray(0,3*l)),t.set(s.subarray(0,3*l)),r.set(u.subarray(0,3*l)));for(var c=l;c<n;++c){var h=3*c,f=3*i[c];e[f]=a[h],e[f+1]=a[h+1],e[f+2]=a[h+2],t[f]=s[h],t[f+1]=s[h+1],t[f+2]=s[h+2],r[f]=u[h],r[f+1]=u[h+1],r[f+2]=u[h+2]}}else o.default.partialSubdivision(this,e,t,r)}},{key:"applyDetails",value:function(){var e=this.getVerticesRingVertStartCount(),t=this.getVerticesRingVert(),r=this.getVertices(),n=this.getNormals(),i=this.getColors(),a=this.getMaterials(),o=this.getNbVertices(),u=new Float32Array(s.default.getMemory(3*o*4),0,3*o);u.set(r.subarray(0,3*o));for(var l=this._detailsXYZ,c=this._detailsRGB,h=this._detailsPBR,f=Math.min,d=Math.max,p=0;p<o;++p){var v=3*p;i[v]=f(1,d(0,i[v]+c[v])),i[v+1]=f(1,d(0,i[v+1]+c[v+1])),i[v+2]=f(1,d(0,i[v+2]+c[v+2])),a[v]=f(1,d(0,a[v]+h[v])),a[v+1]=f(1,d(0,a[v+1]+h[v+1])),a[v+2]=f(1,d(0,a[v+2]+h[v+2]));var g=u[v],m=u[v+1],_=u[v+2],y=n[v],b=n[v+1],M=n[v+2],T=y*y+b*b+M*M;if(0!==T){y*=T=1/Math.sqrt(T),b*=T,M*=T;var A=3*t[e[2*p]],S=u[A]-g,k=u[A+1]-m,w=u[A+2]-_;if(T=S*y+k*b+w*M,S-=y*T,k-=b*T,w-=M*T,0!==(T=S*S+k*k+w*w)){var E=b*(w*=T=1/Math.sqrt(T))-M*(k*=T),x=M*(S*=T)-y*w,R=y*k-b*S,C=l[v],P=l[v+1],F=l[v+2];r[v]=g+y*C+S*P+E*F,r[v+1]=m+b*C+k*P+x*F,r[v+2]=_+M*C+w*P+R*F}}}}},{key:"computeDetails",value:function(e,t,r,n){for(var i=this.getVerticesRingVertStartCount(),a=this.getVerticesRingVert(),s=this.getVertices(),o=this.getNormals(),u=this.getColors(),l=this.getMaterials(),c=this.getNbVertices(),h=this._detailsXYZ=new Float32Array(3*n),f=this._detailsRGB=new Float32Array(3*n),d=this._detailsPBR=new Float32Array(3*n),p=0;p<c;++p){var v=3*p;f[v]=u[v]-t[v],f[v+1]=u[v+1]-t[v+1],f[v+2]=u[v+2]-t[v+2],d[v]=l[v]-r[v],d[v+1]=l[v+1]-r[v+1],d[v+2]=l[v+2]-r[v+2];var g=o[v],m=o[v+1],_=o[v+2],y=g*g+m*m+_*_;if(0!==y){g*=y=1/Math.sqrt(y),m*=y,_*=y;var b=3*a[i[2*p]],M=e[b]-e[v],T=e[b+1]-e[v+1],A=e[b+2]-e[v+2];if(y=M*g+T*m+A*_,M-=g*y,T-=m*y,A-=_*y,0!==(y=M*M+T*T+A*A)){var S=m*(A*=y=1/Math.sqrt(y))-_*(T*=y),k=_*(M*=y)-g*A,w=g*T-m*M,E=s[v]-e[v],x=s[v+1]-e[v+1],R=s[v+2]-e[v+2];h[v]=g*E+m*x+_*R,h[v+1]=M*E+T*x+A*R,h[v+2]=S*E+k*x+w*R}}}}}]),t}();t.default=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(e){return e&&e.__esModule?e:{default:e}}(r(0)),i={},a=function(e,t,r){var i=++n.default.TAG_FLAG,a=e.getVerticesTagFlags(),s=e.getVerticesRingVertStartCount(),o=e.getVerticesRingVert(),u=e.getVerticesOnEdge(),l=function(e,t,r){var n=0,i=e.getNbVertices();for(n=0;n<i;++n)if(0===t[n]&&1===r[n])return n;var a=e.getVerticesOnEdge();for(n=0;n<i&&(0!==t[n]||1===a[n]);++n);if(n===i)return-1;for(n=0;n<i;++n)if(0===t[n])return n;return-1}(e,r,t);if(l<0)return!1;r[l]=1;var c=new Uint32Array(n.default.getMemory(4*e.getNbVertices()),0,e.getNbVertices());c[0]=l;for(var h=1;h>0;){var f=c[--h],d=s[2*f],p=d+s[2*f+1],v=0,g=++i;for(v=d;v<p;++v){var m=o[v];if(a[m]=g,1===r[m])return n.default.TAG_FLAG=i,!1;r[m]=-1,a[m]=g}for(g=++i,v=d;v<p;++v){var _=o[v];if(0!==t[_]&&!u[_])return n.default.TAG_FLAG=i,!1;for(var y=s[2*_],b=y+s[2*_+1],M=y;M<b;++M){var T=o[M];if(T!==f&&(!(a[T]>=g-1)&&(a[T]=g,0===r[T]))){for(var A=s[2*T],S=A+s[2*T+1],k=0,w=A;w<S;++w)a[o[w]]===g-1&&k++;2===k?r[T]=-1:(r[T]=1,c[h++]=T)}}}}return n.default.TAG_FLAG=i,!0},s=function(e,t){for(var r=e.getNbVertices(),i=function(e){for(var t=e.getNbVertices(),r=e.getFaces(),i=e.getVerticesOnEdge(),a=e.getVerticesRingVertStartCount(),s=e.getVerticesRingFace(),o=e.getVerticesRingFaceStartCount(),u=new Int8Array(t),l=0;l<t;++l){for(var c=2*l,h=a[c+1],f=o[c],d=o[c+1],p=i[l],v=0,g=f,m=f+d;g<m;++g)v+=r[4*s[g]+3]===n.default.TRI_INDEX?0:1;0===v?(!p&&6!==h||p&&4!==h)&&(u[l]=1):v===d?(!p&&4!==h||p&&3!==h)&&(u[l]=1):(p||5!==h)&&(u[l]=1)}return u}(e),s=!0;s;){if(!a(e,i,t))return!1;s=!1;for(var o=0;o<r;++o)if(0===t[o]){s=!0;break}}return!0},o=function(e,t,r){for(var i=e.getVerticesDuplicateStartCount(),a=t.getNbVertices(),s=new Uint32Array(2*a),o=t.getVerticesMapping(),u=e.getTexCoords(),l=new Float32Array(n.default.getMemory(4*e.getNbTexCoords()*2),0,2*e.getNbTexCoords()),c=new Uint32Array(a),h=a,f=0;f<a;++f){var d=o[f],p=i[2*d];if(l[2*f]=u[2*d],l[2*f+1]=u[2*d+1],0!==p){for(var v=c[f]=p-h,g=i[2*d+1],m=h,_=h+g;m<_;++m)l[2*m]=u[2*(v+m)],l[2*m+1]=u[2*(v+m)+1];s[2*f]=h,s[2*f+1]=g,h+=g}}t.setTexCoords(new Float32Array(l.subarray(0,2*h))),t.setVerticesDuplicateStartCount(s),function(e,t,r,i){for(var a=e.getFaces(),s=e.getFacesTexCoord(),o=e.getVerticesRingFaceStartCount(),u=e.getVerticesRingFace(),l=e.getVerticesDuplicateStartCount(),c=t.getFaces(),h=new Uint32Array(c),f=t.getVerticesMapping(),d=0,p=c.length;d<p;++d){var v=c[d];if(v!==n.default.TRI_INDEX){var g=f[v];if(0!==l[2*g]){var m=d%4,_=r[(d-m)/4],y=n.default.TRI_INDEX;if(_>=0){var b,M,T=4*_;0===m?(b=a[T+1],M=a[T]):1===m?(b=a[T+2],M=a[T+1]):(b=a[T],M=a[T+2]);for(var A=o[2*g],S=A+o[2*g+1],k=A;k<S;++k){var w=4*u[k],E=a[w],x=a[w+1],R=a[w+2];if(E===b?x===M&&(y=s[w+2]):x===b?R===M&&(y=s[w]):R===b&&E===M&&(y=s[w+1]),y!==n.default.TRI_INDEX)break}}else for(var C=o[2*(_=-_-1)],P=C+4,F=C;F<P;++F){var D=4*u[F];if(a[D]===g?y=s[D]:a[D+1]===g?y=s[D+1]:a[D+2]===g?y=s[D+2]:a[D+3]===g&&(y=s[D+3]),y!==n.default.TRI_INDEX)break}h[d]=y===g?y:y-i[v]}}}t.setFacesTexCoord(h)}(e,t,r,c)};i.computeReverse=function(e,t){var r=e.getNbFaces();if(r%4!=0)return!1;var i=new Int8Array(e.getNbVertices());if(!s(e,i))return!1;var a=new Int32Array(r/4);return!!function(e,t,r,i){var a=e.getFaceEdges(),s=e.getFaces(),o=new Int32Array(e.getNbEdges()),u=0,l=e.getNbFaces(),c=0,h=new Uint32Array(e.getNbVertices()),f=new Uint32Array(l);for(u=0;u<l;++u)f[u]=n.default.TRI_INDEX;for(u=0;u<l;++u){var d=4*u,p=s[d],v=s[d+1],g=s[d+2],m=s[d+3],_=r[p],y=r[v],b=r[g];if(m!==n.default.TRI_INDEX){var M=0,T=0,A=0;1===_?(M=p,T=g,A=o[a[d+1]]-1,o[a[d+2]]=p+1):1===y?(M=v,T=m,A=o[a[d+2]]-1,o[a[d+3]]=v+1):1===b?(M=g,T=p,A=o[a[d+3]]-1,o[a[d]]=g+1):(M=m,T=v,A=o[a[d]]-1,o[a[d+1]]=m+1);var S=h[T]-1;if(S<0)i[c]=-T-1,f[4*c+3]=M,h[T]=++c;else{var k=4*S;A<0?f[k+2]>=n.default.TRI_INDEX-1?(f[k+2]=M,f[k]=n.default.TRI_INDEX-1):f[k]===n.default.TRI_INDEX?f[k+1]=M:(f[k+1]=f[k+2],f[k+2]=M):f[k+1]===A?f[k]=M:(f[k]=f[k+1],f[k+2]===A?f[k+1]=M:(f[k+1]=f[k+2],f[k+2]=M))}}else{if(_+y+b===-3){i[c++]=u;continue}1===_?o[a[d+1]]=p+1:1===y?o[a[d+2]]=v+1:1===b&&(o[a[d]]=g+1)}}for(l/=4,u=0;u<l;++u){var w=i[u],E=4*u;if(w<0){var x=n.default.TRI_INDEX-1;if(f[E]>=x||f[E+1]>=n.default.TRI_INDEX||f[E+2]>=n.default.TRI_INDEX)return!1}else{var R=4*w;f[E]=o[a[R]]-1,f[E+1]=o[a[R+1]]-1,f[E+2]=o[a[R+2]]-1}}return t.setFaces(f),!0}(e,t,i,a)&&(function(e,t,r){var i=0,a=new Uint32Array(e.getNbVertices());t.setVerticesMapping(a);var s=t.getFaces(),o=new Int32Array(e.getNbVertices()),u=0,l=4*t.getNbFaces();for(u=0;u<l;++u){var c=s[u];if(c!==n.default.TRI_INDEX){var h=o[c]-1;-1===h&&(h=i++,o[c]=h+1,a[h]=c),s[u]=h}}t.setVertices(new Float32Array(3*i));var f=e.getFaces(),d=e.getVerticesRingFace(),p=e.getVerticesRingFaceStartCount(),v=new Uint8Array(e.getNbVertices());for(l/=4,u=0;u<l;++u){var g,m,_,y,b,M,T,A,S,k,w=r[u];if(w>=0){var E=4*w;g=f[E+1],m=f[E+2],_=f[E],y=n.default.TRI_INDEX,b=n.default.TRI_INDEX}else{b=-w-1;for(var x=4*u,R=a[s[x]],C=a[s[x+1]],P=a[s[x+2]],F=a[s[x+3]],D=p[2*b],I=D+4,N=D;N<I;++N){var V=4*d[N],L=f[V],O=f[V+1],U=f[V+2],B=f[V+3];L===R?g=O:O===R?g=U:U===R?g=B:B===R&&(g=L),L===C?m=O:O===C?m=U:U===C?m=B:B===C&&(m=L),L===P?_=O:O===P?_=U:U===P?_=B:B===P&&(_=L),L===F?y=O:O===F?y=U:U===F?y=B:B===F&&(y=L)}}M=v[g],T=v[m],A=v[_],S=y!==n.default.TRI_INDEX?v[y]:-1,k=b!==n.default.TRI_INDEX?v[b]:-1,0===M&&(v[g]=1,a[i++]=g),0===T&&(v[m]=1,a[i++]=m),0===A&&(v[_]=1,a[i++]=_),0===S&&(v[y]=1,a[i++]=y),0===k&&(v[b]=1,a[i++]=b)}}(e,t,a),function(e,t){var r=e.getVertices(),i=e.getColors(),a=e.getMaterials(),s=t.getVertices(),o=new Float32Array(s.length),u=new Float32Array(s.length);t.setColors(o),t.setMaterials(u);var l=t.getVerticesMapping(),c=0,h=t.getNbVertices();for(c=0;c<h&&!(l[c]>=h);++c);if(c===h){var f=t.getFaces(),d=f.length;for(c=0;c<d;++c){var p=f[c];p!==n.default.TRI_INDEX&&(f[c]=l[p])}for(c=0;c<h;++c)l[c]=c;s.set(r.subarray(0,3*h)),o.set(i.subarray(0,3*h)),u.set(a.subarray(0,3*h))}else for(t.setEvenMapping(!0),c=0;c<h;++c){var v=3*c,g=3*l[c];s[v]=r[g],s[v+1]=r[g+1],s[v+2]=r[g+2],o[v]=i[g],o[v+1]=i[g+1],o[v+2]=i[g+2],u[v]=a[g],u[v+1]=a[g+1],u[v+2]=a[g+2]}}(e,t),e.hasUV()&&o(e,t,a),t.allocateArrays(),!0)};var u=i;t.default=u},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t,r){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,t);if(void 0===n){var i=Object.getPrototypeOf(e);return null===i?void 0:s(i,t,r)}if("value"in n)return n.value;var a=n.get;if(void 0!==a)return a.call(r)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=n(r(2)),u=n(r(0)),l=n(r(112)),c=n(r(113)),h=n(r(11)),f=n(r(19)),d=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))).setID(e.getID()),r._meshData=(0,f.default)(),r.setRenderData(e.getRenderData()),r.setTransformData(e.getTransformData()),r._facesStateFlags=null,r._wireframe=null,r.initFromMesh(e),r.initRender(),r.isDynamic=!0,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,h.default),function(e,t,r){t&&a(e.prototype,t),r&&a(e,r)}(t,[{key:"subdivide",value:function(e,r,n,i,a){return l.default.subdivision(this,e,r,n,i,a,t.LINEAR)}},{key:"decimate",value:function(e,t,r,n,i){return c.default.decimation(this,e,t,r,n,i)}},{key:"getSubdivisionFactor",value:function(){return.01*t.SUBDIVISION_FACTOR}},{key:"getDecimationFactor",value:function(){return.01*t.DECIMATION_FACTOR}},{key:"getVerticesProxy",value:function(){return this.getVertices()}},{key:"addNbVertice",value:function(e){this._meshData._nbVertices+=e}},{key:"getNbTriangles",value:function(){return this.getNbFaces()}},{key:"addNbFace",value:function(e){this._meshData._nbFaces+=e}},{key:"getNbEdges",value:function(){return 3*this.getNbTriangles()}},{key:"getFacesStateFlags",value:function(){return this._facesStateFlags}},{key:"allocateArrays",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"allocateArrays",this).call(this),this._meshData._vertRingVert=[],this._meshData._vertRingFace=[],this._facesStateFlags=new Int32Array(this.getNbFaces())}},{key:"initFromMesh",value:function(e){var t=e.getNbVertices();this.setVertices(new Float32Array(e.getVertices().subarray(0,3*t))),this.setColors(new Float32Array(e.getColors().subarray(0,3*t))),this.setMaterials(new Float32Array(e.getMaterials().subarray(0,3*t))),this.setNbVertices(t),this.setFacesFromMesh(e),this.init(),e.isUsingTexCoords()&&this.setShaderType(o.default.Shader.MATCAP)}},{key:"setFacesFromMesh",value:function(e){this.setFaces(new Uint32Array(4*e.getNbTriangles())),this.setNbFaces(e.getNbTriangles());var t=e.getTriangles(),r=this.getNbTriangles(),n=this.getFaces();this._meshData._trianglesABC=new Uint32Array(t.subarray(0,3*r));for(var i=0;i<r;++i){var a=3*i,s=4*i;n[s]=t[a],n[s+1]=t[a+1],n[s+2]=t[a+2],n[s+3]=u.default.TRI_INDEX}}},{key:"updateTopology",value:function(e,t){this.updateRenderTriangles(e),this.updateVerticesOnEdge(t),this.getShowWireframe()&&this.updateWireframe(e),this.isUsingDrawArrays()&&this.updateDrawArrays(e)}},{key:"getWireframe",value:function(){return this._wireframe||(this._wireframe=new Uint32Array(2*this.getTriangles().length),this.updateWireframe()),this._wireframe}},{key:"setShowWireframe",value:function(e){this._wireframe=null,s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setShowWireframe",this).call(this,e)}},{key:"updateWireframe",value:function(e){for(var t=this._wireframe,r=this.getTriangles(),n=void 0===e,i=this.isUsingDrawArrays(),a=n?this.getNbTriangles():e.length,s=0;s<a;++s){var o=n?s:e[s],u=6*o,l=3*o;i?(t[u]=t[u+5]=l,t[u+1]=t[u+2]=l+2,t[u+3]=t[u+4]=l+1):(t[u]=t[u+5]=r[l],t[u+1]=t[u+2]=r[l+1],t[u+3]=t[u+4]=r[l+2])}}},{key:"updateRenderTriangles",value:function(e){for(var t=this.getTriangles(),r=this.getFaces(),n=void 0===e,i=n?this.getNbFaces():e.length,a=0;a<i;++a){var s=n?a:e[a],o=3*s,u=4*s;t[o]=r[u],t[o+1]=r[u+1],t[o+2]=r[u+2]}}},{key:"updateVerticesOnEdge",value:function(e){for(var t=this.getVerticesOnEdge(),r=this.getVerticesRingVert(),n=this.getVerticesRingFace(),i=void 0===e,a=i?this.getNbVertices():e.length,s=0;s<a;++s){var o=i?s:e[s];t[o]=r[o].length!==n[o].length?1:0}}},{key:"resizeArray",value:function(e,t){if(!e)return null;if(e.length>=t)return e.subarray(0,2*t);var r=new e.constructor(2*t);return r.set(e),r}},{key:"reAllocateArrays",value:function(e){var t=this._meshData,r=this._facesStateFlags.length,n=this.getNbTriangles(),i=n+e;(r<i||r>4*i)&&(this._facesStateFlags=this.resizeArray(this._facesStateFlags,i),this.getShowWireframe()&&(this._wireframe=this.resizeArray(this._wireframe,6*i)),t._facesABCD=this.resizeArray(t._facesABCD,4*i),t._trianglesABC=this.resizeArray(t._trianglesABC,3*i),t._faceBoxes=this.resizeArray(t._faceBoxes,6*i),t._faceNormalsXYZ=this.resizeArray(t._faceNormalsXYZ,3*i),t._faceCentersXYZ=this.resizeArray(t._faceCentersXYZ,3*i),t._facesTagFlags=this.resizeArray(t._facesTagFlags,i),t._facePosInLeaf=this.resizeArray(t._facePosInLeaf,i)),r=t._verticesXYZ.length/3;if(i=this.getNbVertices()+e,(r<i||r>4*i)&&(t._verticesXYZ=this.resizeArray(t._verticesXYZ,3*i),t._normalsXYZ=this.resizeArray(t._normalsXYZ,3*i),t._colorsRGB=this.resizeArray(t._colorsRGB,3*i),t._materialsPBR=this.resizeArray(t._materialsPBR,3*i),t._vertOnEdge=this.resizeArray(t._vertOnEdge,i),t._vertTagFlags=this.resizeArray(t._vertTagFlags,i),t._vertSculptFlags=this.resizeArray(t._vertSculptFlags,i),t._vertStateFlags=this.resizeArray(t._vertStateFlags,i)),this.isUsingDrawArrays()){((r=t._verticesXYZ.length/9)<(i=n+10*e)||r>4*i)&&(t._verticesXYZ=this.resizeArray(t._verticesXYZ,9*i),t._normalsXYZ=this.resizeArray(t._normalsXYZ,9*i),t._colorsRGB=this.resizeArray(t._colorsRGB,9*i),t._materialsPBR=this.resizeArray(t._materialsPBR,9*i))}}},{key:"initTopology",value:function(){var e=this.getVerticesRingVert(),t=this.getVerticesRingFace(),r=0,n=this.getNbVertices();for(e.length=t.length=n,r=0;r<n;++r)e[r]=[],t[r]=[];var i=this.getNbTriangles(),a=this.getTriangles();for(r=0;r<i;++r){var s=3*r;t[a[s]].push(r),t[a[s+1]].push(r),t[a[s+2]].push(r)}var o=this.getVerticesOnEdge();for(r=0;r<n;++r)this.computeRingVertices(r),o[r]=t[r].length!==e[r].length?1:0}},{key:"computeRingVertices",value:function(e){var t=++u.default.TAG_FLAG,r=this.getFaces(),n=this.getVerticesTagFlags(),i=this._meshData._vertRingVert[e],a=this._meshData._vertRingFace[e];i.length=0;for(var s=a.length,o=0;o<s;++o){var l=4*a[o],c=r[l],h=r[l+1];c===e?c=r[l+2]:h===e&&(h=r[l+2]),n[c]!==t&&(n[c]=t,i.push(c)),n[h]!==t&&(n[h]=t,i.push(h))}}}]),t}();d.SUBDIVISION_FACTOR=75,d.DECIMATION_FACTOR=0,d.LINEAR=!1;var p=d;t.default=p},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(1),a=n(r(0)),s=n(r(10)),o=n(r(18)),u={_mesh:null,_linear:!1,_verticesMap:new Map,_states:null,_center:[0,0,0],_radius2:0,_edgeMax2:0},l=function(e,t,r,n,i){var s=u._mesh,o=s.getVerticesRingVert(),l=s.getVerticesRingFace(),c=s.getFacePosInLeaf(),h=s.getFaceLeaf(),f=s.getFacesStateFlags(),d=s.getFaces(),p=4*e;d[p]=t,d[p+1]=i,d[p+2]=n,d[p+3]=a.default.TRI_INDEX;var v=h[e],g=v._iFaces;o[i].push(n),o[n].push(i);var m=s.getNbTriangles();l[i].push(e,m),d[p=4*m]=i,d[p+1]=r,d[p+2]=n,d[p+3]=a.default.TRI_INDEX,f[m]=a.default.STATE_FLAG,h[m]=v,c[m]=g.length,l[n].push(m),a.default.replaceElement(l[r],e,m),g.push(m),s.addNbFace(1)},c=function(e){for(var t=u._mesh,r=t.getVerticesRingVert(),n=t.getFaces(),i=e.length,s=new Uint32Array(a.default.getMemory(8*i),0,2*i),o=0,c=u._verticesMap,h=0;h<i;++h){var f=e[h],d=4*f,p=n[d],v=n[d+1],g=n[d+2],m=c.get(Math.min(p,v)+"+"+Math.max(p,v)),_=c.get(Math.min(v,g)+"+"+Math.max(v,g)),y=c.get(Math.min(p,g)+"+"+Math.max(p,g)),b=r[p].length,M=r[v].length,T=r[g].length,A=0;if(m?A=_?y?b<M&&b<T?2:M<T?3:1:b<T?2:1:y&&M<T?3:1:_?A=y&&M<b?3:2:y&&(A=3),1===A)l(f,p,v,g,m);else if(2===A)l(f,v,g,p,_);else{if(3!==A)continue;l(f,g,p,v,y)}s[o++]=f,s[o++]=t.getNbTriangles()-1}return new Uint32Array(s.subarray(0,o))},h=function(e,t,r,n){var i=u._mesh,s=i.getVertices(),o=i.getNormals(),l=i.getColors(),c=i.getMaterials(),h=i.getFaces(),f=i.getFacePosInLeaf(),d=i.getFaceLeaf(),p=i.getVerticesRingVert(),v=i.getVerticesRingFace(),g=i.getFacesStateFlags(),m=i.getVerticesStateFlags(),_=u._verticesMap,y=Math.min(t,r)+"+"+Math.max(t,r),b=!1,M=_.get(y);void 0===M&&(M=i.getNbVertices(),b=!0,_.set(y,M)),p[n].push(M);var T=4*e;h[T]=t,h[T+1]=M,h[T+2]=n,h[T+3]=a.default.TRI_INDEX;var A=i.getNbTriangles();h[T=4*A]=M,h[T+1]=r,h[T+2]=n,h[T+3]=a.default.TRI_INDEX,g[A]=a.default.STATE_FLAG,v[n].push(A),a.default.replaceElement(v[r],e,A);var S=d[e],k=S._iFaces;if(d[A]=S,f[A]=k.length,k.push(A),!b)return p[M].push(n),v[M].push(e,A),void i.addNbFace(1);var w=3*t,E=s[w],x=s[w+1],R=s[w+2],C=o[w],P=o[w+1],F=o[w+2],D=3*r,I=s[D],N=s[D+1],V=s[D+2],L=o[D],O=o[D+1],U=o[D+2],B=C+L,j=P+O,G=F+U;if(T=3*M,o[T]=.5*B,o[T+1]=.5*j,o[T+2]=.5*G,l[T]=.5*(l[w]+l[D]),l[T+1]=.5*(l[w+1]+l[D+1]),l[T+2]=.5*(l[w+2]+l[D+2]),c[T]=.5*(c[w]+c[D]),c[T+1]=.5*(c[w+1]+c[D+1]),c[T+2]=.5*(c[w+2]+c[D+2]),u._linear)s[T]=.5*(E+I),s[T+1]=.5*(x+N),s[T+2]=.5*(R+V);else{var X=C*C+P*P+F*F;0===X?C=1:(C*=X=1/Math.sqrt(X),P*=X,F*=X),0===(X=L*L+O*O+U*U)?L=1:(L*=X=1/Math.sqrt(X),O*=X,U*=X);var z=C*L+P*O+F*U,W=E-I,Y=x-N,H=R-V,q=.12*(z<=-1?Math.PI:z>=1?0:Math.acos(z));q*=Math.sqrt(W*W+Y*Y+H*H),(X=B*B+j*j+G*G)>0&&(q/=Math.sqrt(X)),W*(C-L)+Y*(P-O)+H*(F-U)<0&&(q=-q),s[T]=.5*(E+I)+B*q,s[T+1]=.5*(x+N)+j*q,s[T+2]=.5*(R+V)+G*q}m[M]=a.default.STATE_FLAG,p[M]=[t,r,n],v[M]=[e,A],a.default.replaceElement(p[t],r,M),a.default.replaceElement(p[r],t,M),i.addNbVertice(1),i.addNbFace(1)},f=function(){var e=[0,0,0],t=[0,0,0],r=[0,0,0],n=s.default.triangleInsideSphere,a=s.default.pointInsideTriangle;return function(s,o){var l=u._mesh,c=l.getVertices(),h=l.getFaces(),f=4*s,d=3*h[f],p=3*h[f+1],v=3*h[f+2];if(e[0]=c[d],e[1]=c[d+1],e[2]=c[d+2],t[0]=c[p],t[1]=c[p+1],t[2]=c[p+2],r[0]=c[v],r[1]=c[v+1],r[2]=c[v+2],o&&!n(u._center,u._radius2,e,t,r)&&!a(u._center,e,t,r))return 0;var g=l.getMaterials(),m=g[d+2],_=g[p+2],y=g[v+2],b=i.vec3.sqrDist(e,t),M=i.vec3.sqrDist(t,r),T=i.vec3.sqrDist(e,r);return b>M&&b>T?.5*(m+_)*b>u._edgeMax2?1:0:M>T?.5*(_+y)*M>u._edgeMax2?2:0:.5*(m+y)*T>u._edgeMax2?3:0}}(),d=function(e){var t=u._mesh,r=t.getNbVertices(),n=t.getNbTriangles();u._verticesMap=new Map;var i=function(e){for(var t=e.length,r=a.default.getMemory(5*t),n=new Uint32Array(r,0,t),i=new Uint8Array(r,4*t,t),s=0,o=0;o<t;++o){var u=e[o],l=f(u,!0);0!==l&&(i[s]=l,n[s++]=u)}return[new Uint32Array(n.subarray(0,s)),new Uint8Array(i.subarray(0,s))]}(e),s=i[0],l=i[1];s.length>5&&(s=t.expandsFaces(s,3),(l=new Uint8Array(s.length)).set(i[1])),u._states.pushVertices(t.getVerticesFromFaces(s)),u._states.pushFaces(s),t.reAllocateArrays(l.length),function(e,t){for(var r=u._mesh.getFaces(),n=e.length,i=0;i<n;++i){var a=e[i],s=t[i];0===s&&(s=f(a));var o=4*a;1===s?h(a,r[o],r[o+1],r[o+2]):2===s?h(a,r[o+1],r[o+2],r[o]):3===s&&h(a,r[o+2],r[o],r[o+1])}}(s,l);var d=0,p=t.getNbTriangles()-n,v=new Uint32Array(p);for(d=0;d<p;++d)v[d]=n+d;s=(v=t.expandsFaces(v,1)).subarray(p),u._states.pushVertices(t.getVerticesFromFaces(s)),u._states.pushFaces(s);var g=e,m=e.length;(e=new Uint32Array(m+v.length)).set(g),e.set(v,m);var _=t.getFacesTagFlags(),y=e.length,b=new Uint32Array(a.default.getMemory(4*y),0,y),M=0,T=++a.default.TAG_FLAG;for(d=0;d<y;++d){var A=e[d];_[A]!==T&&(_[A]=T,b[M++]=A)}b=new Uint32Array(b.subarray(0,M));for(var S=t.getNbTriangles();v.length>0;)t.reAllocateArrays(v.length),v=c(v);for(p=t.getNbTriangles()-S,g=b,(b=new Uint32Array(M+p)).set(g),d=0;d<p;++d)b[M+d]=S+d;var k=t.getNbVertices()-r,w=new Uint32Array(k);for(d=0;d<k;++d)w[d]=r+d;if(w=t.expandsVertices(w,1),!u._linear){var E=w.subarray(k),x=new o.default;x.setToolMesh(t),x.smoothTangent(E,1)}var R=t.getVertices(),C=t.getVerticesSculptFlags(),P=u._center,F=P[0],D=P[1],I=P[2],N=a.default.SCULPT_FLAG;for(k=w.length,d=0;d<k;++d){var V=w[d],L=3*V,O=R[L]-F,U=R[L+1]-D,B=R[L+2]-I;C[V]=O*O+U*U+B*B<u._radius2?N:N-1}return b},p={};p.subdivision=function(e,t,r,n,a,s,o){u._mesh=e,u._linear=o,i.vec3.copy(u._center,r),u._radius2=n,u._edgeMax2=a,u._states=s;for(var l=0;l!==e.getNbTriangles();)l=e.getNbTriangles(),t=d(t);return t};var v=p;t.default=v},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(e){return e&&e.__esModule?e:{default:e}}(r(0)),i={_mesh:null,_states:null,_iTrisToDelete:[],_iVertsToDelete:[],_iVertsDecimated:[]},a=function(e,t){return e-t},s=function(e){var t=i._mesh,r=t.getVerticesRingFace(),a=t.getFacesTagFlags(),s=t.getFaces(),o=t.getFacePosInLeaf(),u=t.getFaceLeaf(),l=t.getFacesStateFlags(),c=o[e],h=u[e]._iFaces,f=h[h.length-1];e!==f&&(h[c]=f,o[f]=c),h.pop();var d=t.getNbTriangles()-1;if(d!==e){var p=4*d,v=s[p],g=s[p+1],m=s[p+2];i._states.pushVertices([v,g,m]),i._states.pushFaces([d]),n.default.replaceElement(r[v],d,e),n.default.replaceElement(r[g],d,e),n.default.replaceElement(r[m],d,e);var _=u[d],y=o[d];_._iFaces[y]=e,u[e]=_,o[e]=y,a[e]=a[d],l[e]=l[d],s[e*=4]=v,s[e+1]=g,s[e+2]=m,s[e+3]=n.default.TRI_INDEX,i._iVertsDecimated.push(v,g,m),t.addNbFace(-1)}else t.addNbFace(-1)},o=function(e){var t=i._mesh,r=t.getVerticesRingVert(),a=t.getVerticesRingFace(),s=t.getVertices(),o=t.getNormals(),u=t.getColors(),l=t.getMaterials(),c=t.getFaces(),h=t.getVerticesTagFlags(),f=t.getVerticesStateFlags(),d=t.getVerticesSculptFlags(),p=t.getNbVertices()-1;if(e!==p){var v=0,g=i._states;g.pushVertices([p]);var m=a[p],_=r[p],y=m.length,b=_.length,M=0;for(M=0;M<y;++M)v=m[M],g.pushFaces([v]),c[v*=4]===p?c[v]=e:c[v+1]===p?c[v+1]=e:c[v+2]=e;for(M=0;M<b;++M)v=_[M],g.pushVertices([v]),n.default.replaceElement(r[v],p,e);r[e]=r[p].slice(),a[e]=a[p].slice(),h[e]=h[p],f[e]=f[p],d[e]=d[p];var T=3*p;s[v=3*e]=s[T],s[v+1]=s[T+1],s[v+2]=s[T+2],o[v]=o[T],o[v+1]=o[T+1],o[v+2]=o[T+2],u[v]=u[T],u[v+1]=u[T+1],u[v+2]=u[T+2],l[v]=l[T],l[v+1]=l[T+1],l[v+2]=l[T+2],t.addNbVertice(-1)}else t.addNbVertice(-1)},u=function(e,t,r,s,o,u,l){var c=i._mesh,h=c.getVertices(),f=c.getNormals(),d=c.getColors(),p=c.getMaterials(),v=c.getFaces(),g=c.getVerticesTagFlags(),m=c.getFacesTagFlags(),_=c.getVerticesRingVert(),y=c.getVerticesRingFace(),b=_[r],M=_[s],T=y[r],A=y[s];if(b.length===T.length&&M.length===A.length){var S=_[o],k=_[u],w=y[o],E=y[u];if(S.length===w.length&&k.length===E.length){i._iVertsDecimated.push(r,s),i._states.pushVertices(b),i._states.pushVertices(M),i._states.pushFaces(T),i._states.pushFaces(A),b.sort(a),M.sort(a);var x=0;if(n.default.intersectionArrays(b,M).length>=3)return n.default.removeElement(T,t),n.default.removeElement(A,e),w.push(t),E.push(e),x=4*e,v[x]===s?v[x]=u:v[x+1]===s?v[x+1]=u:v[x+2]=u,x=4*t,v[x]===r?v[x]=o:v[x+1]===r?v[x+1]=o:v[x+2]=o,c.computeRingVertices(r),c.computeRingVertices(s),c.computeRingVertices(o),void c.computeRingVertices(u);var R=3*s,C=f[x=3*r]+f[R],P=f[x+1]+f[R+1],F=f[x+2]+f[R+2],D=C*C+P*P+F*F;0===D?C=1:(C*=D=1/Math.sqrt(D),P*=D,F*=D),f[x]=C,f[x+1]=P,f[x+2]=F,d[x]=.5*(d[x]+d[R]),d[x+1]=.5*(d[x+1]+d[R+1]),d[x+2]=.5*(d[x+2]+d[R+2]),p[x]=.5*(p[x]+p[R]),p[x+1]=.5*(p[x+1]+p[R+1]),p[x+2]=.5*(p[x+2]+p[R+2]),n.default.removeElement(T,e),n.default.removeElement(T,t),n.default.removeElement(A,e),n.default.removeElement(A,t),n.default.removeElement(w,e),n.default.removeElement(E,t);var I=A.length,N=0;for(N=0;N<I;++N){var V=A[N];T.push(V);var L=4*V;v[L]===s?v[L]=r:v[L+1]===s?v[L+1]=r:v[L+2]=r}for(I=M.length,N=0;N<I;++N)b.push(M[N]);c.computeRingVertices(r);var O=0,U=0,B=0,j=b.length;for(N=0;N<j;++N){var G=b[N];c.computeRingVertices(G),O+=h[G*=3],U+=h[G+1],B+=h[G+2]}U/=j,B/=j;var X=C*((O/=j)-h[x])+P*(U-h[x+1])+F*(B-h[x+2]);for(h[x]=O-C*X,h[x+1]=U-P*X,h[x+2]=B-F*X,g[s]=m[e]=m[t]=-1,i._iVertsToDelete.push(s),i._iTrisToDelete.push(e,t),I=T.length,N=0;N<I;++N)l.push(T[N])}}},l=function(e,t,r){if(-1!==t){var n=i._mesh.getFaces(),a=4*e,s=n[a],o=n[a+1],l=n[a+2],c=n[a=4*t],h=n[a+1],f=n[a+2];s===c?o===f?u(e,t,s,o,l,h,r):u(e,t,s,l,o,f,r):s===h?o===c?u(e,t,s,o,l,f,r):u(e,t,s,l,o,c,r):s===f?o===h?u(e,t,s,o,l,c,r):u(e,t,s,l,o,h,r):o===c?u(e,t,l,o,s,h,r):o===h?u(e,t,l,o,s,f,r):u(e,t,l,o,s,c,r)}},c=function(e,t,r){var s=i._mesh.getVerticesRingFace(),o=s[t],u=s[r];o.sort(a),u.sort(a);var l=n.default.intersectionArrays(o,u);return 2!==l.length?-1:l[0]===e?l[1]:l[0]},h={};h.decimation=function(e,t,r,a,u,h){i._mesh=e,i._states=h,i._iVertsDecimated.length=0,i._iTrisToDelete.length=0,i._iVertsToDelete.length=0;var f=Math.sqrt(a),d=e.getFacesTagFlags(),p=e.getVertices(),v=e.getMaterials(),g=e.getFaces(),m=r[0],_=r[1],y=r[2],b=0,M=t.length,T=new Array(M);for(b=0;b<M;++b)T[b]=t[b];for(b=0;b<T.length;++b){var A=T[b];if(!(d[A]<0)){var S=4*A,k=g[S],w=g[S+1],E=g[S+2],x=3*k,R=3*w,C=3*E,P=p[x],F=p[x+1],D=p[x+2],I=p[R],N=p[R+1],V=p[R+2],L=p[C],O=p[C+1],U=p[C+2],B=(P+I+L)/3-m,j=(F+N+O)/3-_,G=(D+V+U)/3-y,X=B*B+j*j+G*G;if(X<a)X=1;else{if(!(X<2*a))continue;var z=(X=(Math.sqrt(X)-f)/(f*Math.SQRT2-f))*X;X=3*z*z-4*z*X+1}var W=(B=I-P)*B+(j=N-F)*j+(G=V-D)*G,Y=(B=I-L)*B+(j=N-O)*j+(G=V-U)*G,H=(B=P-L)*B+(j=F-O)*j+(G=D-U)*G,q=v[x+2],K=v[R+2],Z=v[C+2];W<Y&&W<H?W<u*X*(q+K)*.5&&l(A,c(A,k,w),T):Y<H?Y<u*X*(K+Z)*.5&&l(A,c(A,w,E),T):H<u*X*(q+Z)*.5&&l(A,c(A,k,E),T)}}return function(){var e=i._iTrisToDelete;n.default.tidy(e);var t=0;for(t=e.length-1;t>=0;--t)s(e[t]);var r=i._iVertsToDelete;n.default.tidy(r);for(t=r.length-1;t>=0;--t)o(r[t])}(),t=function(e,t){var r=i._mesh,a=r.getFacesTagFlags(),s=r.getNbTriangles(),o=r.getFacesFromVertices(e),u=t,l=t.length;(t=new Uint32Array(l+o.length)).set(u),t.set(o,l);var c=++n.default.TAG_FLAG;l=t.length;for(var h=new Uint32Array(n.default.getMemory(4*l),0,l),f=0,d=0;d<l;++d){var p=t[d];p>=s||a[p]!==c&&(a[p]=c,h[f++]=p)}return new Uint32Array(h.subarray(0,f))}(function(){for(var e=i._mesh,t=e.getVerticesTagFlags(),r=e.getNbVertices(),a=++n.default.TAG_FLAG,s=i._iVertsDecimated,o=s.length,u=new Uint32Array(n.default.getMemory(4*o),0,o),l=0,c=0;c<o;++c){var h=s[c];h>=r||t[h]!==a&&(t[h]=a,u[l++]=h)}return new Uint32Array(u.subarray(0,l))}(),T)};var f=h;t.default=f},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(3)),s=n(r(16)),o=n(r(12)),u=n(r(5)),l=n(r(2)),c=o.default[l.default.Shader.MERGE],h=o.default[l.default.Shader.UV],f=o.default[l.default.Shader.PBR],d=o.default[l.default.Shader.MATCAP],p=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=r._main,this._menu=null,this._ctrlFlatShadizfng=null,this._ctrlShowWireframe=null,this._ctrlShaders=null,this._ctrlMatcap=null,this._ctrlUV=null,this.init(t)}return function(e,t,r){t&&i(e.prototype,t),r&&i(e,r)}(e,[{key:"init",value:function(e){var t=this._menu=e.addMenu((0,a.default)("renderingTitle"));t.close();var r=[];r[l.default.Shader.MATCAP]=(0,a.default)("renderingMatcap"),r[l.default.Shader.PBR]=(0,a.default)("renderingPBR"),r[l.default.Shader.NORMAL]=(0,a.default)("renderingNormal"),r[l.default.Shader.UV]=(0,a.default)("renderingUV"),t.addTitle((0,a.default)("renderingShader")),this._ctrlShaders=t.addCombobox("",l.default.Shader.MATCAP,this.onShaderChanged.bind(this),r),this._ctrlCurvature=t.addSlider((0,a.default)("renderingCurvature"),20,this.onCurvatureChanged.bind(this),0,100,1),this._ctrlFilmic=t.addCheckbox((0,a.default)("renderingFilmic"),c.FILMIC,this.onFilmic.bind(this));for(var n={},i=0,o=f.environments,u=o.length;i<u;++i)n[i]=o[i].name;this._ctrlEnvTitle=t.addTitle((0,a.default)("renderingEnvironment")),this._ctrlEnv=t.addCombobox("",f.idEnv,this.onEnvironmentChanged.bind(this),n);for(var h={},p=0,v=d.matcaps,g=v.length;p<g;++p)h[p]=v[p].name;this._ctrlMatcapTitle=t.addTitle((0,a.default)("renderingMaterial")),this._ctrlMatcap=t.addCombobox((0,a.default)("renderingMatcap"),0,this.onMatcapChanged.bind(this),h),this._ctrlImportMatcap=t.addButton((0,a.default)("renderingImportMatcap"),this,"importMatcap"),this._ctrlUV=t.addButton((0,a.default)("renderingImportUV"),this,"importTexture"),this._ctrlExposure=t.addSlider((0,a.default)("renderingExposure"),20,this.onExposureChanged.bind(this),0,100,1),t.addTitle((0,a.default)("renderingExtra")),this._ctrlTransparency=t.addSlider((0,a.default)("renderingTransparency"),0,this.onTransparencyChanged.bind(this),0,100,1),this._ctrlFlatShading=t.addCheckbox((0,a.default)("renderingFlat"),!1,this.onFlatShading.bind(this)),this._ctrlShowWireframe=t.addCheckbox((0,a.default)("renderingWireframe"),!1,this.onShowWireframe.bind(this)),s.default.ONLY_DRAW_ARRAYS&&this._ctrlShowWireframe.setVisibility(!1),this.addEvents()}},{key:"onFilmic",value:function(e){c.FILMIC=e,this._main.render()}},{key:"onCurvatureChanged",value:function(e){this._main.getMesh()&&(this._main.getMesh().setCurvature(e/20),this._main.render())}},{key:"onEnvironmentChanged",value:function(e){f.idEnv=e,this._main.render()}},{key:"onExposureChanged",value:function(e){f.exposure=e/20,this._main.render()}},{key:"onTransparencyChanged",value:function(e){for(var t=this._main.getSelectedMeshes(),r=0,n=t.length;r<n;++r)t[r].setOpacity(1-e/100);this._main.render()}},{key:"onShaderChanged",value:function(e){for(var t=this._main,r=!1,n=this._main.getSelectedMeshes(),i=0,a=n.length;i<a;++i){var s=n[i];s&&(e!==l.default.Shader.UV||s.hasUV()?(s.setShaderType(e),t.render()):(r||window.alert("No UV on the mesh."),r=!0),r&&this.updateMesh())}this.updateVisibility()}},{key:"onMatcapChanged",value:function(e){for(var t=this._main.getSelectedMeshes(),r=0,n=t.length;r<n;++r){var i=t[r];i.getShaderType()!==l.default.Shader.MATCAP&&i.setShaderType(l.default.Shader.MATCAP),i.setMatcap(e)}this._main.render()}},{key:"onFlatShading",value:function(e){for(var t=this._main.getSelectedMeshes(),r=0,n=t.length;r<n;++r)t[r].setFlatShading(e);this._main.render()}},{key:"onShowWireframe",value:function(e){for(var t=this._main.getSelectedMeshes(),r=0,n=t.length;r<n;++r)t[r].setShowWireframe(e);this._main.render()}},{key:"addEvents",value:function(){var e=this.loadTextureUV.bind(this),t=this.loadMatcap.bind(this);document.getElementById("textureopen").addEventListener("change",e,!1),document.getElementById("matcapopen").addEventListener("change",t,!1),this.removeCallback=function(){document.getElementById("textureopen").removeEventListener("change",e,!1),document.getElementById("matcapopen").removeEventListener("change",t,!1)}}},{key:"removeEvents",value:function(){this.removeCallback&&this.removeCallback()}},{key:"updateMesh",value:function(){var e=this._main.getMesh();e?(this._menu.setVisibility(!0),this._ctrlShaders.setValue(e.getShaderType(),!0),this._ctrlFlatShading.setValue(e.getFlatShading(),!0),this._ctrlShowWireframe.setValue(e.getShowWireframe(),!0),this._ctrlMatcap.setValue(e.getMatcap(),!0),this._ctrlTransparency.setValue(100-100*e.getOpacity(),!0),this._ctrlCurvature.setValue(20*e.getCurvature(),!0),this.updateVisibility()):this._menu.setVisibility(!1)}},{key:"updateVisibility",value:function(){var e=this._main.getMesh();if(e){var t=e.getShaderType();this._ctrlMatcapTitle.setVisibility(t===l.default.Shader.MATCAP),this._ctrlMatcap.setVisibility(t===l.default.Shader.MATCAP),this._ctrlImportMatcap.setVisibility(t===l.default.Shader.MATCAP),this._ctrlExposure.setVisibility(t===l.default.Shader.PBR),this._ctrlEnvTitle.setVisibility(t===l.default.Shader.PBR),this._ctrlEnv.setVisibility(t===l.default.Shader.PBR),this._ctrlUV.setVisibility(t===l.default.Shader.UV)}}},{key:"getFlatShading",value:function(){return this._ctrlFlatShading.getValue()}},{key:"getWireframe",value:function(){return this._ctrlShowWireframe.getValue()}},{key:"getShaderName",value:function(){return this._ctrlShaders.getValue()}},{key:"importTexture",value:function(){document.getElementById("textureopen").click()}},{key:"loadTextureUV",value:function(e){if(0!==e.target.files.length){var t=e.target.files[0];if(t.type.match("image.*")){var r=new FileReader,n=this._main;r.onload=function(e){h.texture0=void 0,h.texPath=e.target.result,n.render()},document.getElementById("textureopen").value="",r.readAsDataURL(t)}}}},{key:"loadMatcap",value:function(e){if(0!==e.target.files.length){var t=e.target.files[0];if(t.type.match("image.*")){var r=new FileReader,n=this._main,i=this._ctrlMatcap;r.onload=function(e){var r=new Image;r.src=e.target.result,r.onload=function(){var e=d.matcaps.length;d.matcaps.push({name:t.name}),d.createTexture(n._gl,r,e);var a={};a[e]=t.name,i.addOptions(a),i.setValue(e),n.render()}},document.getElementById("matcapopen").value="",r.readAsDataURL(t)}}}},{key:"importMatcap",value:function(){document.getElementById("matcapopen").click()}},{key:"onKeyUp",value:function(e){u.default.getShortKey(e.which)!==l.default.KeyAction.WIREFRAME||e.ctrlKey||this._ctrlShowWireframe.setValue(!this._ctrlShowWireframe.getValue())}}]),e}();t.default=p},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(3)),s=n(r(15)),o=n(r(4)),u=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=r._main,this._menu=null,this._hideMeshes=[],this._cbToggleShowHide=this.toggleShowHide.bind(this,!0),this.init(t)}return function(e,t,r){t&&i(e.prototype,t),r&&i(e,r)}(e,[{key:"init",value:function(e){var t=this._menu=e.addMenu((0,a.default)("sceneTitle"));t.addButton((0,a.default)("sceneReset"),this._main,"clearScene"),t.addButton((0,a.default)("sceneAddSphere"),this._main,"addSphere"),t.addButton((0,a.default)("sceneAddCube"),this._main,"addCube"),t.addButton((0,a.default)("sceneAddCylinder"),this._main,"addCylinder"),t.addButton((0,a.default)("sceneAddTorus"),this._main,"addTorus"),t.addTitle((0,a.default)("sceneSelection")),this._ctrlIsolate=t.addCheckbox((0,a.default)("renderingIsolate"),!1,this.showHide.bind(this)),this._ctrlIsolate.setVisibility(!1),this._ctrlMerge=t.addButton((0,a.default)("sceneMerge"),this,"merge"),this._ctrlMerge.setVisibility(!1),t.addTitle((0,a.default)("renderingExtra")),t.addCheckbox((0,a.default)("darkenUnselected"),o.default.darkenUnselected,this.onDarkenUnselected.bind(this)),t.addCheckbox((0,a.default)("contourShow"),this._main._showContour,this.onShowContour.bind(this)),t.addCheckbox((0,a.default)("renderingGrid"),this._main._showGrid,this.onShowGrid.bind(this)),t.addCheckbox((0,a.default)("renderingSymmetryLine"),o.default.showSymmetryLine,this.onShowSymmetryLine.bind(this))}},{key:"validatePreview",value:function(){this._main._meshPreview||this._main.addTorus(!0),this._main._meshPreview.setShowWireframe(!1),this._main.addNewMesh(this._main._meshPreview),this._main._meshPreview=null,this.ctrlDiscard.setVisibility(!1),this.ctrlValidate.setVisibility(!1),this._main.render()}},{key:"discardPreview",value:function(){this._main._meshPreview=null,this.ctrlDiscard.setVisibility(!1),this.ctrlValidate.setVisibility(!1),this._main.render()}},{key:"updateTorusRadius",value:function(e){this._main._torusRadius=e,this.updateTorus()}},{key:"updateTorusRadial",value:function(e){this._main._torusRadial=e,this.updateTorus()}},{key:"updateTorusTubular",value:function(e){this._main._torusTubular=e,this.updateTorus()}},{key:"updateTorusWidth",value:function(e){this._main._torusWidth=e,this._main._torusLength<this._main._torusWidth?this.ctrlLE.setValue(e):this.updateTorus()}},{key:"updateTorusLength",value:function(e){this._main._torusLength=e,this._main._torusLength<this._main._torusWidth?this.ctrlWI.setValue(e):this.updateTorus()}},{key:"updateTorus",value:function(){this._main.addTorus(!0),this.ctrlDiscard.setVisibility(!0),this.ctrlValidate.setVisibility(!0),this._main.render()}},{key:"updateMesh",value:function(){var e=this._main.getMeshes().length,t=this._main.getSelectedMeshes().length;this._ctrlIsolate.setVisibility(this._hideMeshes.length>0||e!==t&&t>=1),this._ctrlMerge.setVisibility(t>1)}},{key:"merge",value:function(){var e=this._main,t=e.getSelectedMeshes();if(!(t.length<2)){var r=s.default.mergeMeshes(t,e.getMesh()||t[0]);e.removeMeshes(t),e.getStateManager().pushStateAddRemove(r,t.slice()),e.getMeshes().push(r),e.setMesh(r)}}},{key:"toggleShowHide",value:function(e){this._ctrlIsolate.setValue(!this._ctrlIsolate.getValue(),!!e)}},{key:"showHide",value:function(e){e?this.isolate():this.showAll(),this.updateMesh()}},{key:"isolate",value:function(){var e=this._main,t=e.getSelectedMeshes(),r=e.getMeshes();if(r.length===t.length||r.length<2)this._ctrlIsolate.setValue(!1,!0);else{var n=this._hideMeshes;n.length=0;for(var i=0;i<r.length;++i){e.getIndexSelectMesh(r[i])<0&&(n.push(r[i]),r.splice(i--,1))}e.getStateManager().pushStateRemove(n.slice()),e.getStateManager().pushStateCustom(this._cbToggleShowHide,this._cbToggleShowHide,!0),e.render()}}},{key:"showAll",value:function(){for(var e=this._main,t=e.getMeshes(),r=this._hideMeshes,n=0,i=r.length;n<i;++n)t.push(r[n]);e.getStateManager().pushStateAdd(r.slice()),e.getStateManager().pushStateCustom(this._cbToggleShowHide,this._cbToggleShowHide,!0),r.length=0,e.render()}},{key:"onDarkenUnselected",value:function(e){o.default.darkenUnselected=e,this._main.render()}},{key:"onShowSymmetryLine",value:function(e){o.default.showSymmetryLine=e,this._main.render()}},{key:"onShowGrid",value:function(e){var t=this._main;t._showGrid=e,t.render()}},{key:"onShowContour",value:function(e){var t=this._main;t._showContour=e,t.render()}},{key:"onKeyDown",value:function(e){!0!==e.handled&&(e.stopPropagation(),this._main._focusGui||e.preventDefault(),73===e.which&&(this.toggleShowHide(),e.handled=!0))}}]),e}();t.default=u},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(3)),s=n(r(2)),o=n(r(17)),u=n(r(5)),l=n(r(117)),c=l.default.tools,h=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=r._main,this._ctrlGui=r,this._sculptManager=r._main.getSculptManager(),this._toolOnRelease=-1,this._invertSign=!1,this._modalBrushRadius=!1,this._modalBrushIntensity=!1,this._lastPageX=0,this._lastPageY=0,this._refX=0,this._refY=0,this._menu=null,this._ctrlSculpt=null,this._ctrlSymmetry=null,this._ctrlContinuous=null,this._ctrlTitleCommon=null,this.init(t)}return function(e,t,r){t&&i(e.prototype,t),r&&i(e,r)}(e,[{key:"init",value:function(e){var t=this._menu=e.addMenu((0,a.default)("sculptTitle"));t.open(),t.addTitle((0,a.default)("sculptTool"));for(var r=[],n=0,i=o.default.length;n<i;++n)o.default[n]&&(r[n]=(0,a.default)(o.default[n].uiName));this._ctrlSculpt=t.addCombobox((0,a.default)("sculptTool"),this._sculptManager.getToolIndex(),this.onChangeTool.bind(this),r),l.default.initGuiTools(this._sculptManager,this._menu,this._main),this._ctrlTitleCommon=t.addTitle((0,a.default)("sculptCommon")),this._ctrlSymmetry=t.addCheckbox((0,a.default)("sculptSymmetry"),this._sculptManager._symmetry,this.onSymmetryChange.bind(this)),this._ctrlContinuous=t.addCheckbox((0,a.default)("sculptContinuous"),this._sculptManager,"_continuous"),l.default.show(this._sculptManager.getToolIndex()),this.addEvents(),this.onChangeTool(this._sculptManager.getToolIndex())}},{key:"onSymmetryChange",value:function(e){this._sculptManager._symmetry=e,this._main.render()}},{key:"addEvents",value:function(){var e=this.loadAlpha.bind(this);document.getElementById("alphaopen").addEventListener("change",e,!1),this.removeCallback=function(){document.getElementById("alphaopen").removeEventListener("change",e,!1)}}},{key:"removeEvents",value:function(){this.removeCallback&&this.removeCallback()}},{key:"getSelectedTool",value:function(){return this._ctrlSculpt.getValue()}},{key:"releaseInvertSign",value:function(){if(this._invertSign){this._invertSign=!1;var e=c[this.getSelectedTool()];e.toggleNegative&&e.toggleNegative()}}},{key:"onChangeTool",value:function(e){l.default.hide(this._sculptManager.getToolIndex()),this._sculptManager.setToolIndex(e),l.default.show(e);var t=!0===this._sculptManager.canBeContinuous();this._ctrlContinuous.setVisibility(t);var r=e!==s.default.Tools.TRANSFORM;this._ctrlSymmetry.setVisibility(r),this._ctrlTitleCommon.setVisibility(t||r),this._main.getPicking().updateLocalAndWorldRadius2()}},{key:"loadAlpha",value:function(e){if(0!==e.target.files.length){var t=e.target.files[0];if(t.type.match("image.*")){var r=new FileReader,n=this._main,i=c[this._sculptManager.getToolIndex()];r.onload=function(e){var r=new Image;r.src=e.target.result,r.onload=n.onLoadAlphaImage.bind(n,r,t.name||"new alpha",i)},document.getElementById("alphaopen").value="",r.readAsDataURL(t)}}}},{key:"addAlphaOptions",value:function(e){for(var t=0,r=c.length;t<r;++t){var n=c[t];n&&n._ctrlAlpha&&n._ctrlAlpha.addOptions(e)}}},{key:"updateMesh",value:function(){this._menu.setVisibility(!!this._main.getMesh())}},{key:"_startModalBrushRadius",value:function(e,t){this._refX=e,this._refY=t;var r=c[this.getSelectedTool()];if(r._ctrlRadius){var n=r._ctrlRadius.getValue();this._refX-=n,this._main.getSculptManager().getSelection().setOffsetX(-n*this._main.getPixelRatio()),this._main.renderSelectOverRtt()}}},{key:"_checkModifierKey",value:function(e){var t=this.getSelectedTool();if(this._main._action===s.default.Action.NOTHING&&(!e.shiftKey||e.altKey||e.ctrlKey||t!==s.default.Tools.SMOOTH&&(this._toolOnRelease=t,this._ctrlSculpt.setValue(s.default.Tools.SMOOTH)),!e.ctrlKey||e.shiftKey||e.altKey||t!==s.default.Tools.MASKING&&(this._toolOnRelease=t,this._ctrlSculpt.setValue(s.default.Tools.MASKING))),e.altKey){if(this._invertSign||e.shiftKey)return!0;this._invertSign=!0;var r=c[t];return r.toggleNegative&&r.toggleNegative(),!0}return!1}},{key:"onKeyDown",value:function(e){if(!0!==e.handled){var t=this._main,r=u.default.getShortKey(e.which);if(e.stopPropagation(),t._focusGui&&r!==s.default.KeyAction.RADIUS&&r!==s.default.KeyAction.INTENSITY||e.preventDefault(),e.handled=!0,!this._checkModifierKey(e)&&t._action===s.default.Action.NOTHING){if(void 0!==r&&o.default[r])return this._ctrlSculpt.setValue(r);var n=c[this.getSelectedTool()];switch(r){case s.default.KeyAction.DELETE:t.deleteCurrentSelection();break;case s.default.KeyAction.INTENSITY:this._modalBrushIntensity=t._focusGui=!0;break;case s.default.KeyAction.RADIUS:this._modalBrushRadius||this._startModalBrushRadius(this._lastPageX,this._lastPageY),this._modalBrushRadius=t._focusGui=!0;break;case s.default.KeyAction.NEGATIVE:n.toggleNegative&&n.toggleNegative();break;case s.default.KeyAction.PICKER:var i=n._ctrlPicker;i&&!i.getValue()&&i.setValue(!0);break;default:e.handled=!1}}}}},{key:"onKeyUp",value:function(e){var t=this._main._action===s.default.Action.NOTHING&&-1!==this._toolOnRelease&&!e.ctrlKey&&!e.shiftKey;e.altKey&&!t||this.releaseInvertSign(),t&&(this._ctrlSculpt.setValue(this._toolOnRelease),this._toolOnRelease=-1);var r=this._main;switch(u.default.getShortKey(e.which)){case s.default.KeyAction.RADIUS:this._modalBrushRadius=r._focusGui=!1;this._main.getSculptManager().getSelection().setOffsetX(0),e.pageX=this._lastPageX,e.pageY=this._lastPageY,r.setMousePosition(e),r.getPicking().intersectionMouseMeshes(),r.renderSelectOverRtt();break;case s.default.KeyAction.PICKER:var n=c[this.getSelectedTool()]._ctrlPicker;n&&n.getValue()&&n.setValue(!1);break;case s.default.KeyAction.INTENSITY:this._modalBrushIntensity=r._focusGui=!1}}},{key:"onMouseUp",value:function(e){-1===this._toolOnRelease||e.ctrlKey||e.shiftKey||(this.releaseInvertSign(),this._ctrlSculpt.setValue(this._toolOnRelease),this._toolOnRelease=-1)}},{key:"onMouseMove",value:function(e){var t=c[this.getSelectedTool()];if(this._modalBrushRadius&&t._ctrlRadius){var r=e.pageX-this._refX,n=e.pageY-this._refY;t._ctrlRadius.setValue(Math.sqrt(r*r+n*n)),this._main.renderSelectOverRtt()}this._modalBrushIntensity&&t._ctrlIntensity&&t._ctrlIntensity.setValue(t._ctrlIntensity.getValue()+e.pageX-this._lastPageX),this._lastPageX=e.pageX,this._lastPageY=e.pageY}},{key:"onMouseOver",value:function(e){this._modalBrushRadius&&this._startModalBrushRadius(e.pageX,e.pageY)}}]),e}();t.default=h},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(1),a=n(r(17)),s=n(r(3)),o=n(r(34)),u=n(r(2)),l=n(r(0)),c={};c.tools=[];var h=c.tools;c.initGuiTools=function(e,t,r){for(var n=0,i=a.default.length;n<i;++n)if(a.default[n]){var s=h[n];s||(console.error("No gui for tool index : "+n),c[n]={_ctrls:[],init:function(){}}),s.init(e.getTool(n),t,r),c.hide(n)}},c.hide=function(e){for(var t=0,r=h[e]._ctrls,n=r.length;t<n;++t)r[t].setVisibility(!1)},c.show=function(e){for(var t=0,r=h[e]._ctrls,n=r.length;t<n;++t)r[t].setVisibility(!0)};var f=function(e,t,r){this[e]=t?r/t:r},d=function(e,t,r,n){var i=t.addSlider((0,s.default)("sculptRadius"),e._radius,function(t){f.call(e,"_radius",1,t),n.getSculptManager().getSelection().setIsEditMode(!0),n.renderSelectOverRtt()},5,500,1);return r._ctrlRadius=i,i},p=function(e,t,r){var n=t.addSlider((0,s.default)("sculptIntensity"),100*e._intensity,f.bind(e,"_intensity",100),0,100,1);return r._ctrlIntensity=n,n},v=function(e,t){return t.addSlider((0,s.default)("sculptHardness"),100*e._hardness,f.bind(e,"_hardness",100),0,100,1)},g=function(e,t){return t.addCheckbox((0,s.default)("sculptCulling"),e,"_culling")},m=function(e,t,r,n){var i=t.addCheckbox(n||(0,s.default)("sculptNegative"),e,"_negative");return r.toggleNegative=function(){i.setValue(!i.getValue())},i},_=function(){document.getElementById("alphaopen").click()},y=function(e,t,r,n){e.push(t.addTitle((0,s.default)("sculptAlphaTitle"))),void 0!==r._lockPosition&&e.push(t.addCheckbox((0,s.default)("sculptLockPositon"),r,"_lockPosition")),n._ctrlAlpha=t.addCombobox((0,s.default)("sculptAlphaTex"),r,"_idAlpha",o.default.ALPHAS_NAMES),e.push(n._ctrlAlpha),e.push(t.addButton((0,s.default)("sculptImportAlpha"),_))};h[u.default.Tools.BRUSH]={_ctrls:[],init:function(e,t,r){this._ctrls.push(d(e,t,this,r)),this._ctrls.push(p(e,t,this)),this._ctrls.push(m(e,t,this)),this._ctrls.push(t.addCheckbox((0,s.default)("sculptClay"),e,"_clay")),this._ctrls.push(t.addCheckbox((0,s.default)("sculptAccumulate"),e,"_accumulate")),this._ctrls.push(g(e,t)),y(this._ctrls,t,e,this)}},h[u.default.Tools.CREASE]={_ctrls:[],init:function(e,t,r){this._ctrls.push(d(e,t,this,r)),this._ctrls.push(p(e,t,this)),this._ctrls.push(m(e,t,this)),this._ctrls.push(g(e,t)),y(this._ctrls,t,e,this)}},h[u.default.Tools.DRAG]={_ctrls:[],init:function(e,t,r){this._ctrls.push(d(e,t,this,r)),y(this._ctrls,t,e,this)}},h[u.default.Tools.FLATTEN]={_ctrls:[],init:function(e,t,r){this._ctrls.push(d(e,t,this,r)),this._ctrls.push(p(e,t,this)),this._ctrls.push(m(e,t,this)),this._ctrls.push(g(e,t)),y(this._ctrls,t,e,this)}},h[u.default.Tools.INFLATE]={_ctrls:[],init:function(e,t,r){this._ctrls.push(d(e,t,this,r)),this._ctrls.push(p(e,t,this)),this._ctrls.push(m(e,t,this)),this._ctrls.push(g(e,t)),y(this._ctrls,t,e,this)}},h[u.default.Tools.PAINT]={_ctrls:[],onMaterialChanged:function(e,t,r){i.vec3.copy(t._color,r[0].getValue()),t._material[0]=r[1].getValue()/100,t._material[1]=r[2].getValue()/100;var n=e.getMesh();n&&(n.setAlbedo(t._color),n.setRoughness(t._material[0]),n.setMetallic(t._material[1]),e.render())},resetMaterialOverride:function(e,t){this._ctrlPicker.getValue()!==t._pickColor&&this._ctrlPicker.setValue(t._pickColor);var r=e.getMesh();r&&r.getAlbedo&&(r.getAlbedo()[0]=-1,r.setRoughness(-1),r.setMetallic(-1),e.render())},onPickedMaterial:function(e,t,r,n,a,s){r.setCanvasCursor(l.default.cursors.dropper),e[0].setValue(n,!0),e[1].setValue(100*a,!0),e[2].setValue(100*s,!0),i.vec3.copy(t._color,n),t._material[0]=a,t._material[1]=s},onColorPick:function(e,t,r){e._pickColor=r,t.setCanvasCursor(r?l.default.cursors.dropper:"default"),t._action=r?u.default.Action.SCULPT_EDIT:u.default.Action.NOTHING,t.renderSelectOverRtt()},init:function(e,t,r){this._ctrls.push(d(e,t,this,r)),this._ctrls.push(p(e,t,this)),this._ctrls.push(v(e,t)),this._ctrls.push(g(e,t)),this._ctrls.push(t.addTitle((0,s.default)("sculptPBRTitle"))),this._ctrls.push(t.addButton((0,s.default)("sculptPaintAll"),e,"paintAll")),this._ctrlPicker=t.addCheckbox((0,s.default)("sculptPickColor"),e._pickColor,this.onColorPick.bind(this,e,r)),this._ctrls.push(this._ctrlPicker);var n=[],i=this.onMaterialChanged.bind(this,r,e,n),a=t.addColor((0,s.default)("sculptColor"),e._color,i),o=t.addSlider((0,s.default)("sculptRoughness"),100*e._material[0],i,0,100,1),u=t.addSlider((0,s.default)("sculptMetallic"),100*e._material[1],i,0,100,1);n.push(a,o,u),window.addEventListener("keyup",this.resetMaterialOverride.bind(this,r,e)),window.addEventListener("mouseup",this.resetMaterialOverride.bind(this,r,e)),e.setPickCallback(this.onPickedMaterial.bind(this,n,e,r)),this._ctrls.push(a,o,u),y(this._ctrls,t,e,this)}},h[u.default.Tools.PINCH]={_ctrls:[],init:function(e,t,r){this._ctrls.push(d(e,t,this,r)),this._ctrls.push(p(e,t,this)),this._ctrls.push(m(e,t,this)),this._ctrls.push(g(e,t)),y(this._ctrls,t,e,this)}},h[u.default.Tools.TWIST]={_ctrls:[],init:function(e,t,r){this._ctrls.push(d(e,t,this,r)),this._ctrls.push(g(e,t)),y(this._ctrls,t,e,this)}},h[u.default.Tools.LOCALSCALE]={_ctrls:[],init:function(e,t,r){this._ctrls.push(d(e,t,this,r)),this._ctrls.push(g(e,t)),y(this._ctrls,t,e,this)}},h[u.default.Tools.MOVE]={_ctrls:[],init:function(e,t,r){this._ctrls.push(d(e,t,this,r)),this._ctrls.push(p(e,t,this)),this._ctrls.push(t.addCheckbox((0,s.default)("sculptTopologicalCheck"),e,"_topoCheck")),this._ctrls.push(m(e,t,this,(0,s.default)("sculptMoveAlongNormal"))),y(this._ctrls,t,e,this)}},h[u.default.Tools.SMOOTH]={_ctrls:[],init:function(e,t,r){this._ctrls.push(d(e,t,this,r)),this._ctrls.push(p(e,t,this)),this._ctrls.push(t.addCheckbox((0,s.default)("sculptTangentialSmoothing"),e,"_tangent")),this._ctrls.push(g(e,t)),y(this._ctrls,t,e,this)}},h[u.default.Tools.MASKING]={_ctrls:[],init:function(e,t,r){this._ctrls.push(d(e,t,this,r)),this._ctrls.push(p(e,t,this)),this._ctrls.push(v(e,t)),this._ctrls.push(m(e,t,this)),this._ctrls.push(g(e,t)),this._main=r,this._tool=e;var n=t.addDualButton((0,s.default)("sculptMaskingClear"),(0,s.default)("sculptMaskingInvert"),e,e,"clear","invert"),i=t.addDualButton((0,s.default)("sculptMaskingBlur"),(0,s.default)("sculptMaskingSharpen"),e,e,"blur","sharpen");this._ctrls.push(n[0],n[1],i[0],i[1]),this._ctrls.push(t.addTitle((0,s.default)("sculptExtractTitle"))),this._ctrls.push(t.addSlider((0,s.default)("sculptExtractThickness"),e,"_thickness",-5,5,.001)),this._ctrls.push(t.addButton((0,s.default)("sculptExtractAction"),e,"extract")),y(this._ctrls,t,e,this)}},h[u.default.Tools.TRANSFORM]={_ctrls:[],init:function(){}};var b=c;t.default=b},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(3)),s=n(r(2)),o=n(r(35)),u=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._ctrlGui=r,this._main=r._main,this._menu=null,this.init(t)}return function(e,t,r){t&&i(e.prototype,t),r&&i(e,r)}(e,[{key:"init",value:function(e){var t=this._menu=e.addMenu((0,a.default)("stateTitle"));t.addButton((0,a.default)("stateUndo"),this,"onUndo","CTRL+Z"),t.addButton((0,a.default)("stateRedo"),this,"onRedo","CTRL+Y"),t.addTitle((0,a.default)("stateMaxStack"));var r=this._main.getStateManager();t.addSlider("",o.default.STACK_LENGTH,r.setNewMaxStack.bind(r),3,50,1)}},{key:"onUndo",value:function(){this._main._action=s.default.Action.NOTHING,this._main.getSculptManager().end(),this._main.getStateManager().undo(),this._main.render(),this._ctrlGui.updateMesh()}},{key:"onRedo",value:function(){this._main.getStateManager().redo(),this._main.render(),this._ctrlGui.updateMesh()}},{key:"onKeyDown",value:function(e){if(!0!==e.handled){e.stopPropagation(),this._main._focusGui||e.preventDefault();var t=e.which;e.ctrlKey&&90===t?(this.onUndo(),e.handled=!0):e.ctrlKey&&89===t&&(this.onRedo(),e.handled=!0)}}}]),e}();t.default=u},function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=t,this._addedMeshes=void 0!==r.length?r:[r],this._removedMeshes=void 0!==n.length?n:[n],this._selectMeshes=t.getSelectedMeshes().slice()}return function(e,t,r){t&&n(e.prototype,t),r&&n(e,r)}(e,[{key:"isNoop",value:function(){return 0===this._addedMeshes.length&&0===this._removedMeshes.length}},{key:"undo",value:function(){var e,t,r=this._main,n=r.getMeshes(),i=this._addedMeshes;for(e=0,t=i.length;e<t;++e)n.splice(r.getIndexMesh(i[e]),1);var a=this._removedMeshes;for(e=0,t=a.length;e<t;++e)n.push(a[e]);for(e=0,t=n.length;e<t;++e)n[e].initRender();var s=this._selectMeshes;r.setMesh(s[0]?s[0]:null);var o=r.getSelectedMeshes();for(o.length=0,e=0,t=s.length;e<t;++e)o.push(s[e])}},{key:"redo",value:function(){this.undo()}},{key:"createRedo",value:function(){return new e(this._main,this._removedMeshes,this._addedMeshes)}}]),e}();t.default=i},function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=function(e){return e&&e.__esModule?e:{default:e}}(r(0)),a=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=t,this._mesh=r,this._idVertState=[],this._cArState=[],this._mArState=[]}return function(e,t,r){t&&n(e.prototype,t),r&&n(e,r)}(e,[{key:"isNoop",value:function(){return 0===this._idVertState.length}},{key:"undo",value:function(){this.pullVertices();var e=this._mesh;e.updateDuplicateColorsAndMaterials(),e.updateDrawArrays(),e.updateColorBuffer(),e.updateMaterialBuffer(),this._main.setMesh(e)}},{key:"redo",value:function(){this.undo()}},{key:"createRedo",value:function(){var t=new e(this._main,this._mesh);return this.pushRedoVertices(t),t}},{key:"pushVertices",value:function(e){for(var t=this._idVertState,r=this._cArState,n=this._mArState,a=this._mesh,s=a.getColors(),o=a.getMaterials(),u=a.getVerticesStateFlags(),l=i.default.STATE_FLAG,c=e.length,h=0;h<c;++h){var f=e[h];u[f]!==l&&(u[f]=l,t.push(f),f*=3,r.push(s[f],s[f+1],s[f+2]),n.push(o[f],o[f+1],o[f+2]))}}},{key:"pushRedoVertices",value:function(e){for(var t=e._mesh,r=t.getColors(),n=t.getMaterials(),i=this._idVertState,a=i.length,s=e._cArState=new Float32Array(3*a),o=e._mArState=new Float32Array(3*a),u=e._idVertState=new Uint32Array(a),l=0;l<a;++l){var c=u[l]=i[l];c*=3;var h=3*l;s[h]=r[c],s[h+1]=r[c+1],s[h+2]=r[c+2],o[h]=n[c],o[h+1]=n[c+1],o[h+2]=n[c+2]}}},{key:"pullVertices",value:function(){for(var e=this._cArState,t=this._mArState,r=this._idVertState,n=r.length,i=this._mesh,a=i.getColors(),s=i.getMaterials(),o=0;o<n;++o){var u=3*r[o],l=3*o;a[u]=e[l],a[u+1]=e[l+1],a[u+2]=e[l+2],s[u]=t[l],s[u+1]=t[l+1],s[u+2]=t[l+2]}}}]),e}();t.default=a},function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(1),a=function(e){return e&&e.__esModule?e:{default:e}}(r(0)),s=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=t,this._mesh=r,this._center=i.vec3.copy([0,0,0],r.getCenter()),this._idVertState=[],this._vArState=[]}return function(e,t,r){t&&n(e.prototype,t),r&&n(e,r)}(e,[{key:"isNoop",value:function(){return 0===this._idVertState.length}},{key:"undo",value:function(){this.pullVertices();var e=this._mesh;e.updateGeometry(e.getFacesFromVertices(this._idVertState),this._idVertState),e.updateGeometryBuffers(),i.vec3.copy(e.getCenter(),this._center),this._main.setMesh(e)}},{key:"redo",value:function(){this.undo()}},{key:"createRedo",value:function(){var t=new e(this._main,this._mesh);return this.pushRedoVertices(t),t}},{key:"pushVertices",value:function(e){for(var t=this._idVertState,r=this._vArState,n=this._mesh,i=n.getVertices(),s=n.getVerticesStateFlags(),o=a.default.STATE_FLAG,u=e.length,l=0;l<u;++l){var c=e[l];s[c]!==o&&(s[c]=o,t.push(c),c*=3,r.push(i[c],i[c+1],i[c+2]))}}},{key:"pushRedoVertices",value:function(e){for(var t=e._mesh.getVertices(),r=this._idVertState,n=r.length,i=e._vArState=new Float32Array(3*n),a=e._idVertState=new Uint32Array(n),s=0;s<n;++s){var o=a[s]=r[s];o*=3;var u=3*s;i[u]=t[o],i[u+1]=t[o+1],i[u+2]=t[o+2]}}},{key:"pullVertices",value:function(){for(var e=this._vArState,t=this._idVertState,r=t.length,n=this._mesh.getVertices(),i=0;i<r;++i){var a=3*t[i],s=3*i;n[a]=e[s],n[a+1]=e[s+1],n[a+2]=e[s+2]}}}]),e}();t.default=s},function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(1),a=function(e){return e&&e.__esModule?e:{default:e}}(r(0)),s=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=t,this._mesh=r,this._center=i.vec3.copy([0,0,0],r.getCenter()),this._nbFacesState=r.getNbFaces(),this._nbVerticesState=r.getNbVertices(),this._idVertState=[],this._fRingState=[],this._vRingState=[],this._vArState=[],this._cArState=[],this._mArState=[],this._idFaceState=[],this._fArState=[]}return function(e,t,r){t&&n(e.prototype,t),r&&n(e,r)}(e,[{key:"isNoop",value:function(){return 0===this._idVertState.length&&0===this._idFaceState.length}},{key:"undo",value:function(){this.pullVertices(),this.pullFaces();var e=this._mesh;e.setNbVertices(this._nbVerticesState),e.setNbFaces(this._nbFacesState),e.updateTopology(),e.updateGeometry(),e.updateDuplicateColorsAndMaterials(),e.updateDrawArrays(),e.updateColorBuffer(),e.updateMaterialBuffer(),e.updateBuffers(),i.vec3.copy(e.getCenter(),this._center),this._main.setMesh(e)}},{key:"redo",value:function(){this.undo()}},{key:"createRedo",value:function(){var t=new e(this._main,this._mesh);return this.pushRedoVertices(t),this.pushRedoFaces(t),t}},{key:"pushVertices",value:function(e){for(var t=this._idVertState,r=this._fRingState,n=this._vRingState,i=this._vArState,s=this._cArState,o=this._mArState,u=this._mesh,l=u.getVerticesRingFace(),c=u.getVerticesRingVert(),h=u.getVertices(),f=u.getColors(),d=u.getMaterials(),p=u.getVerticesStateFlags(),v=a.default.STATE_FLAG,g=e.length,m=0;m<g;++m){var _=e[m];p[_]!==v&&(p[_]=v,r.push(l[_].slice()),n.push(c[_].slice()),t.push(_),_*=3,i.push(h[_],h[_+1],h[_+2]),s.push(f[_],f[_+1],f[_+2]),o.push(d[_],d[_+1],d[_+2]))}}},{key:"pushFaces",value:function(e){for(var t=this._idFaceState,r=this._fArState,n=this._mesh,i=n.getFaces(),s=n.getFacesStateFlags(),o=a.default.STATE_FLAG,u=e.length,l=0;l<u;++l){var c=e[l];s[c]!==o&&(s[c]=o,t.push(c),c*=4,r.push(i[c],i[c+1],i[c+2],i[c+3]))}}},{key:"pushRedoVertices",value:function(e){var t=e._mesh,r=t.getNbVertices(),n=t.getVerticesRingFace(),i=t.getVerticesRingVert(),s=t.getVertices(),o=t.getColors(),u=t.getMaterials(),l=0,c=0,h=0,f=this._idVertState,d=f.length,p=this._nbVerticesState,v=Math.min(p,r),g=new Uint32Array(a.default.getMemory(4*r),0,r);for(l=0;l<d;++l)(c=f[l])<v&&(g[h++]=c);for(l=p;l<r;++l)g[h++]=l;d=h,g=e._idVertState=new Uint32Array(g.subarray(0,d));var m=e._fRingState=new Array(d),_=e._vRingState=new Array(d),y=e._vArState=new Float32Array(3*d),b=e._cArState=new Float32Array(3*d),M=e._mArState=new Float32Array(3*d);for(l=0;l<d;++l){c=g[l],m[l]=n[c].slice(),_[l]=i[c].slice(),c*=3;var T=3*l;y[T]=s[c],y[T+1]=s[c+1],y[T+2]=s[c+2],b[T]=o[c],b[T+1]=o[c+1],b[T+2]=o[c+2],M[T]=u[c],M[T+1]=u[c+1],M[T+2]=u[c+2]}}},{key:"pushRedoFaces",value:function(e){var t=e._mesh,r=t.getNbFaces(),n=t.getFaces(),i=0,s=0,o=0,u=this._idFaceState,l=u.length,c=this._nbFacesState,h=Math.min(c,r),f=new Uint32Array(a.default.getMemory(4*r),0,r);for(i=0;i<l;++i)(s=u[i])<h&&(f[o++]=s);for(i=c;i<r;++i)f[o++]=i;l=o,f=e._idFaceState=new Uint32Array(f.subarray(0,l));var d=e._fArState=new Int32Array(4*l);for(i=0;i<l;++i){s=f[i],s*=4;var p=4*i;d[p]=n[s],d[p+1]=n[s+1],d[p+2]=n[s+2],d[p+3]=n[s+3]}}},{key:"pullVertices",value:function(){for(var e=this._nbVerticesState,t=this._fRingState,r=this._vRingState,n=this._vArState,i=this._cArState,a=this._mArState,s=this._idVertState,o=s.length,u=this._mesh,l=u.getVerticesRingFace(),c=u.getVerticesRingVert(),h=u.getVertices(),f=u.getColors(),d=u.getMaterials(),p=0;p<o;++p){var v=s[p];if(!(v>=e)){l[v]=t[p].slice(),c[v]=r[p].slice();var g=3*p;h[v*=3]=n[g],h[v+1]=n[g+1],h[v+2]=n[g+2],f[v]=i[g],f[v+1]=i[g+1],f[v+2]=i[g+2],d[v]=a[g],d[v+1]=a[g+1],d[v+2]=a[g+2]}}}},{key:"pullFaces",value:function(){for(var e=this._nbFacesState,t=this._fArState,r=this._idFaceState,n=r.length,i=this._mesh.getFaces(),a=0;a<n;++a){var s=r[a];if(!(s>=e)){var o=4*a;i[s*=4]=t[o],i[s+1]=t[o+1],i[s+2]=t[o+2],i[s+3]=t[o+3]}}}}]),e}();t.default=s},function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._undocb=t,this._redocb=r||t}return function(e,t,r){t&&n(e.prototype,t),r&&n(e,r)}(e,[{key:"isNoop",value:function(){return!this._undocb}},{key:"undo",value:function(){this._undocb()}},{key:"redo",value:function(){this._redocb()}},{key:"createRedo",value:function(){return new e(this._undocb,this._redocb)}}]),e}();t.default=i},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(3)),s=n(r(7)),o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._menu=null,this.init(t)}return function(e,t,r){t&&i(e.prototype,t),r&&i(e,r)}(e,[{key:"init",value:function(e){var t=this._menu=e.addMenu((0,a.default)("pressureTitle"));t.addTitle((0,a.default)("pressureRadius")),t.addSlider("",s.default,"radiusFactor",0,1,.01),t.addTitle((0,a.default)("pressureIntensity")),t.addSlider("",s.default,"intensityFactor",0,1,.01)}}]),e}();t.default=o},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(1),s=n(r(5)),o=n(r(2)),u=n(r(0)),l=n(r(10)),c=[0,0],h=[0,0,0],f=[0,0,0],d=[0,1,0],p=[0,0,0,1],v=a.mat4.create(),g=Math.SQRT1_2,m=[a.quat.fromValues(1,0,0,0),a.quat.fromValues(0,1,0,0),a.quat.fromValues(0,0,1,0),a.quat.fromValues(0,0,0,1),a.quat.fromValues(g,g,0,0),a.quat.fromValues(g,-g,0,0),a.quat.fromValues(g,0,g,0),a.quat.fromValues(g,0,-g,0),a.quat.fromValues(g,0,0,g),a.quat.fromValues(g,0,0,-g),a.quat.fromValues(0,g,g,0),a.quat.fromValues(0,g,-g,0),a.quat.fromValues(0,g,0,g),a.quat.fromValues(0,g,0,-g),a.quat.fromValues(0,0,g,g),a.quat.fromValues(0,0,g,-g),a.quat.fromValues(.5,.5,.5,.5),a.quat.fromValues(.5,.5,.5,-.5),a.quat.fromValues(.5,.5,-.5,.5),a.quat.fromValues(.5,.5,-.5,-.5),a.quat.fromValues(.5,-.5,.5,.5),a.quat.fromValues(.5,-.5,.5,-.5),a.quat.fromValues(.5,-.5,-.5,.5),a.quat.fromValues(-.5,.5,.5,.5)],_=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=t;var r=(0,s.default)();this._mode=r.cameramode||o.default.CameraMode.ORBIT,this._projectionType=r.projection||o.default.Projection.PERSPECTIVE,this._quatRot=[0,0,0,1],this._view=a.mat4.create(),this._proj=a.mat4.create(),this._viewport=a.mat4.create(),this._lastNormalizedMouseXY=[0,0],this._width=0,this._height=0,this._speed=0,this._fov=Math.min(r.fov,150),this._trans=[0,0,30],this._moveX=0,this._moveZ=0,this._usePivot=r.pivot,this._center=[0,0,0],this._offset=[0,0,0],this._rotX=0,this._rotY=0,this._near=.05,this._far=5e3,this._timers={},this.resetView()}return function(e,t,r){t&&i(e.prototype,t),r&&i(e,r)}(e,[{key:"setProjectionType",value:function(e){this._projectionType=e,this.updateProjection(),this.updateView()}},{key:"setMode",value:function(e){this._mode=e,e===o.default.CameraMode.ORBIT&&this.resetViewFront()}},{key:"setFov",value:function(e){this._fov=e,this.updateView(),this.optimizeNearFar()}},{key:"setUsePivot",value:function(e){this._usePivot=e}},{key:"toggleUsePivot",value:function(){this._usePivot=!this._usePivot}},{key:"getView",value:function(){return this._view}},{key:"getProjection",value:function(){return this._proj}},{key:"getProjectionType",value:function(){return this._projectionType}},{key:"isOrthographic",value:function(){return this._projectionType===o.default.Projection.ORTHOGRAPHIC}},{key:"getMode",value:function(){return this._mode}},{key:"getFov",value:function(){return this._fov}},{key:"getUsePivot",value:function(){return this._usePivot}},{key:"getConstantScreen",value:function(){var e=this._main.getCanvas().clientWidth;return this._projectionType===o.default.Projection.ORTHOGRAPHIC?e/this.getOrthoZoom():e*this._proj[0]}},{key:"start",value:function(e,t){if(this._lastNormalizedMouseXY=l.default.normalizedMouse(e,t,this._width,this._height),this._usePivot){var r=this._main,n=r.getPicking();n.intersectionMouseMeshes(r.getMeshes(),e,t),n.getMesh()&&(a.vec3.transformMat4(h,n.getIntersectionPoint(),n.getMesh().getMatrix()),this.setPivot(h))}}},{key:"setPivot",value:function(e){if(a.vec3.transformQuat(this._offset,this._offset,a.quat.invert(p,this._quatRot)),a.vec3.sub(this._offset,this._offset,this._center),a.vec3.copy(this._center,e),a.vec3.add(this._offset,this._offset,this._center),a.vec3.transformQuat(this._offset,this._offset,this._quatRot),this._projectionType===o.default.Projection.PERSPECTIVE){var t=this.getTransZ();this._trans[2]=a.vec3.dist(this.computePosition(),this._center)*this._fov/45,this._offset[2]+=this.getTransZ()-t}else this._offset[2]=0}},{key:"rotate",value:function(e,t){var r=h,n=c,i=l.default.normalizedMouse(e,t,this._width,this._height);if(this._mode===o.default.CameraMode.ORBIT)a.vec2.sub(n,i,this._lastNormalizedMouseXY),this.setOrbit(this._rotX-2*n[1],this._rotY+2*n[0]),this.rotateDelay([6*-n[1],6*n[0]],-1);else if(this._mode===o.default.CameraMode.PLANE){var s=a.vec2.dist(this._lastNormalizedMouseXY,i);a.vec2.sub(n,i,this._lastNormalizedMouseXY),a.vec3.normalize(r,a.vec3.set(r,-n[1],n[0],0)),a.quat.mul(this._quatRot,a.quat.setAxisAngle(p,r,2*s),this._quatRot),this.rotateDelay([r[0],r[1],r[2],6*s],-1)}else if(this._mode===o.default.CameraMode.SPHERICAL){var u=l.default.mouseOnUnitSphere(this._lastNormalizedMouseXY),f=l.default.mouseOnUnitSphere(i),d=Math.acos(Math.min(1,a.vec3.dot(u,f)));a.vec3.normalize(r,a.vec3.cross(r,u,f)),a.quat.mul(this._quatRot,a.quat.setAxisAngle(p,r,2*d),this._quatRot),this.rotateDelay([r[0],r[1],r[2],6*d],-1)}this._lastNormalizedMouseXY=i,this.updateView()}},{key:"setOrbit",value:function(e,t){var r=.49*Math.PI;this._rotX=Math.max(Math.min(e,r),-r),this._rotY=t;var n=this._quatRot;a.quat.identity(n),a.quat.rotateX(n,n,this._rotX),a.quat.rotateY(n,n,this._rotY)}},{key:"getTransZ",value:function(){return this._projectionType===o.default.Projection.PERSPECTIVE?45*this._trans[2]/this._fov:1e3}},{key:"updateView",value:function(){var e=h,t=this._view,r=this._trans[0],n=this._trans[1],i=this._offset;a.vec3.set(f,r-i[0],n-i[1],this.getTransZ()-i[2]),a.vec3.set(e,r-i[0],n-i[1],-i[2]),a.mat4.lookAt(t,f,e,d),a.mat4.mul(t,t,a.mat4.fromQuat(v,this._quatRot)),a.mat4.translate(t,t,a.vec3.negate(h,this._center))}},{key:"optimizeNearFar",value:function(e){if(e||(e=this._lastBBox),e){this._lastBBox=e;var t=this.computePosition(f),r=a.vec3.set(h,.5*(e[0]+e[3]),.5*(e[1]+e[4]),.5*(e[2]+e[5])),n=a.vec3.dist(t,r),i=.5*a.vec3.dist(e,a.vec3.set(h,e[3],e[4],e[5]));this._near=Math.max(.01,n-i),this._far=i+n,this.updateProjection()}}},{key:"updateProjection",value:function(){this._projectionType===o.default.Projection.PERSPECTIVE?(a.mat4.perspective(this._proj,this._fov*Math.PI/180,this._width/this._height,this._near,this._far),this._proj[10]=-1,this._proj[14]=-2*this._near):this.updateOrtho()}},{key:"updateTranslation",value:function(){var e=this._trans;e[0]+=this._moveX*this._speed*e[2]/50/400,e[2]=Math.max(1e-5,e[2]+this._moveZ*this._speed/400),this._projectionType===o.default.Projection.ORTHOGRAPHIC&&this.updateOrtho(),this.updateView()}},{key:"translate",value:function(e,t){var r=this._speed*this._trans[2]/54,n=[-e*r,t*r,0];this.setTrans(a.vec3.add(this._trans,this._trans,n)),a.vec3.scale(n,n,5),this.translateDelay(n,-1)}},{key:"zoom",value:function(e){var t=[0,0,0];a.vec3.sub(t,this._offset,this._trans),a.vec3.scale(t,t,e*this._speed/54),e<0&&(t[0]=t[1]=0),this.setTrans(a.vec3.add(this._trans,this._trans,t)),a.vec3.scale(t,t,5),this.translateDelay(t,-1)}},{key:"setAndFocusOnPivot",value:function(e,t){this.setPivot(e),this.moveToDelay(this._offset[0],this._offset[1],this._offset[2]+t)}},{key:"moveToDelay",value:function(e,t,r){var n=[e,t,r];this.translateDelay(a.vec3.sub(n,n,this._trans),200)}},{key:"setTrans",value:function(e){a.vec3.copy(this._trans,e),this._projectionType===o.default.Projection.ORTHOGRAPHIC&&this.updateOrtho(),this.updateView()}},{key:"getOrthoZoom",value:function(){return 55e-5*Math.abs(this._trans[2])}},{key:"updateOrtho",value:function(){var e=this.getOrthoZoom(),t=this._width*e,r=this._height*e;a.mat4.ortho(this._proj,-t,t,-r,r,-this._near,this._far)}},{key:"computePosition",value:function(e){e=e||[0,0,0];var t=this._view;return a.vec3.set(e,-t[12],-t[13],-t[14]),a.mat3.fromMat4(v,t),a.mat3.transpose(v,v),a.vec3.transformMat3(e,e,v)}},{key:"resetView",value:function(){this._speed=1.5*u.default.SCALE,this.centerDelay([0,0,0],200),this.offsetDelay([0,0,0],200);var e=[0,0,30+this._speed/3];a.vec3.sub(e,e,this._trans),this.translateDelay(e,200),this.quatDelay([0,0,0,1],200)}},{key:"resetViewFront",value:function(){this.quatDelay([0,0,0,1],200)}},{key:"resetViewBack",value:function(){this.quatDelay([0,1,0,0],200)}},{key:"resetViewTop",value:function(){this.quatDelay([Math.SQRT1_2,0,0,Math.SQRT1_2],200)}},{key:"resetViewBottom",value:function(){this.quatDelay([-Math.SQRT1_2,0,0,Math.SQRT1_2],200)}},{key:"resetViewLeft",value:function(){this.quatDelay([0,-Math.SQRT1_2,0,Math.SQRT1_2],200)}},{key:"resetViewRight",value:function(){this.quatDelay([0,Math.SQRT1_2,0,Math.SQRT1_2],200)}},{key:"toggleViewFront",value:function(){Math.abs(this._quatRot[3])>.99?this.resetViewBack():this.resetViewFront()}},{key:"toggleViewTop",value:function(){var e=this._quatRot[0]*Math.SQRT1_2+this._quatRot[3]*Math.SQRT1_2;e*e>.99?this.resetViewBottom():this.resetViewTop()}},{key:"toggleViewLeft",value:function(){var e=-this._quatRot[1]*Math.SQRT1_2+this._quatRot[3]*Math.SQRT1_2;e*e>.99?this.resetViewRight():this.resetViewLeft()}},{key:"computeWorldToScreenMatrix",value:function(e){return e=e||a.mat4.create(),a.mat4.mul(e,a.mat4.mul(e,this._viewport,this._proj),this._view)}},{key:"unproject",value:function(e,t,r){var n=[0,0,0];return a.mat4.invert(v,this.computeWorldToScreenMatrix(v)),a.vec3.transformMat4(n,a.vec3.set(n,e,this._height-t,r),v)}},{key:"project",value:function(e){var t=[0,0,0];return a.vec3.transformMat4(t,e,this.computeWorldToScreenMatrix(v)),t[1]=this._height-t[1],t}},{key:"onResize",value:function(e,t){this._width=e,this._height=t;var r=this._viewport;a.mat4.identity(r),a.mat4.scale(r,r,a.vec3.set(h,.5*e,.5*t,.5)),a.mat4.translate(r,r,a.vec3.set(h,1,1,1)),this.updateProjection()}},{key:"snapClosestRotation",value:function(){for(var e=this._quatRot,t=1/0,r=0,n=m.length,i=0;i<n;++i){var s=a.quat.dot(e,m[i]);t<(s=1-s*s)||(t=s,r=i)}this.quatDelay(m[r],200)}},{key:"clearTimerN",value:function(e){window.clearInterval(this._timers[e]),this._timers[e]=0}},{key:"delay",value:function(e,t,r){var n=r||"default";if(this._timers[n]&&this.clearTimerN(n),0===t)return e(1);if(!(t<0)){var i=0,a=(new Date).getTime();this._timers[n]=window.setInterval(function(){var r=((new Date).getTime()-a)/t;r=function(e){return-((e=Math.min(1,e)-1)*e*e*e-1)}(r),e(r-i,r),i=r,r>=1&&this.clearTimerN(n)}.bind(this),16.6)}}},{key:"_translateDelta",value:function(e,t){var r=this._trans;a.vec3.scaleAndAdd(r,r,e,t),this.setTrans(r),this._main.render()}},{key:"translateDelay",value:function(e,t){var r=this._translateDelta.bind(this,e);this.delay(r,t,"translate")}},{key:"_rotDelta",value:function(e,t){if(this._mode===o.default.CameraMode.ORBIT){var r=this._rotX+e[0]*t,n=this._rotY+e[1]*t;this.setOrbit(r,n)}else a.quat.mul(this._quatRot,a.quat.setAxisAngle(p,e,e[3]*t),this._quatRot);this.updateView(),this._main.render()}},{key:"rotateDelay",value:function(e,t){var r=this._rotDelta.bind(this,e);this.delay(r,t,"rotate")}},{key:"_quatDelta",value:function(e,t){a.quat.identity(p),a.quat.slerp(p,p,e,t);var r=this._quatRot;if(a.quat.mul(this._quatRot,this._quatRot,p),this._mode===o.default.CameraMode.ORBIT){var n=r[0],i=r[1],s=r[2],u=r[3];this._rotY=Math.atan2(2*(u*i+s*n),1-2*(i*i+s*s)),this._rotX=Math.atan2(2*(u*n+i*s),1-2*(s*s+n*n))}this.updateView(),this._main.render()}},{key:"quatDelay",value:function(e,t){var r=[0,0,0,0];a.quat.conjugate(r,this._quatRot),a.quat.mul(r,r,e),a.quat.normalize(r,r);var n=this._quatDelta.bind(this,r);this.delay(n,t,"quat")}},{key:"_centerDelta",value:function(e,t){a.vec3.scaleAndAdd(this._center,this._center,e,t),this.updateView(),this._main.render()}},{key:"centerDelay",value:function(e,t){var r=[0,0,0];a.vec3.sub(r,e,this._center);var n=this._centerDelta.bind(this,r);this.delay(n,t,"center")}},{key:"_offsetDelta",value:function(e,t){a.vec3.scaleAndAdd(this._offset,this._offset,e,t),this.updateView(),this._main.render()}},{key:"offsetDelay",value:function(e,t){var r=[0,0,0];a.vec3.sub(r,e,this._offset);var n=this._offsetDelta.bind(this,r);this.delay(n,t,"offset")}},{key:"computeFrustumFit",value:function(){var e,t=this._near;if(this._projectionType===o.default.Projection.ORTHOGRAPHIC)return e=Math.min(this._width,this._height)/t*.5,Math.sqrt(1+e*e)/e;var r=this._proj,n=t*(r[8]-1)/r[0],i=t*(1+r[8])/r[0],a=t*(1+r[9])/r[5],s=t*(r[9]-1)/r[5],u=Math.abs(i-n),l=Math.abs(a-s);return e=Math.min(l,u)/t*.5,this._fov/45*Math.sqrt(1+e*e)/e}}]),e}();t.default=_},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(14)),s=n(r(12)),o=n(r(2)),u=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=r,this._gl=t,this._vertexBuffer=new a.default(t,t.ARRAY_BUFFER,t.STATIC_DRAW),this._texCoordBuffer=new a.default(t,t.ARRAY_BUFFER,t.STATIC_DRAW),this._fill=!0,this._monoTex=null,this._texture=null,this._texWidth=1,this._texHeight=1,this.init()}return function(e,t,r){t&&i(e.prototype,t),r&&i(e,r)}(e,[{key:"init",value:function(){this.getTexCoordBuffer().update(new Float32Array([0,0,1,0,0,1,1,1])),this._monoTex=this.createOnePixelTexture(50,50,50,255),document.getElementById("backgroundopen").addEventListener("change",this.loadBackground.bind(this),!1)}},{key:"loadBackground",value:function(e){if(0!==e.target.files.length){var t=e.target.files[0];if(t.type.match("image.*")){var r=this,n=new FileReader;n.onload=function(e){var t=new Image;t.src=e.target.result,t.onload=function(){var e=r._main.getCanvas();r.loadBackgroundTexture(t),r.onResize(e.width,e.height),r._main.render()}},document.getElementById("backgroundopen").value="",n.readAsDataURL(t)}}}},{key:"getGL",value:function(){return this._gl}},{key:"getVertexBuffer",value:function(){return this._vertexBuffer}},{key:"getTexCoordBuffer",value:function(){return this._texCoordBuffer}},{key:"release",value:function(){this.deleteTexture(),this.getVertexBuffer().release(),this.getTexCoordBuffer().release()}},{key:"onResize",value:function(e,t){var r=e/t/(this._texWidth/this._texHeight),n=this._fill?1/r:r,i=n<1?1:1/r,a=n<1?r:1;this.getVertexBuffer().update(new Float32Array([-i,-a,i,-a,-i,a,i,a]))}},{key:"getTexture",value:function(){return this._texture?this._texture:this._monoTex}},{key:"createOnePixelTexture",value:function(e,t,r,n){var i=this._gl,a=i.createTexture();return i.bindTexture(i.TEXTURE_2D,a),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,1,1,0,i.RGBA,i.UNSIGNED_BYTE,new Uint8Array([e,t,r,n])),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.bindTexture(i.TEXTURE_2D,null),a}},{key:"loadBackgroundTexture",value:function(e){var t=this._gl;this.deleteTexture(),this._texWidth=e.width,this._texHeight=e.height,this._texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this._texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindTexture(t.TEXTURE_2D,null)}},{key:"deleteTexture",value:function(){this._texture&&(this._texWidth=this._texHeight=1,this._gl.deleteTexture(this._texture),this._texture=null)}},{key:"render",value:function(){s.default[o.default.Shader.BACKGROUND].getOrCreate(this._gl).draw(this)}}]),e}();t.default=u},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,s=n(r(14)),o=n(r(12)),u=n(r(36)),l=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.createRenderbuffer(),i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._gl=t,this._texture=t.createTexture(),this._depth=n,this._framebuffer=t.createFramebuffer(),this._shaderType=r,this._invSize=new Float32Array(2),this._vertexBuffer=null,i&&u.default.hasRTTHalfFloat()?this._type=u.default.HALF_FLOAT_OES:i&&u.default.hasRTTFloat()?this._type=t.FLOAT:this._type=t.UNSIGNED_BYTE,this.init()}return function(e,t,r){t&&i(e.prototype,t),r&&i(e,r)}(e,[{key:"getGL",value:function(){return this._gl}},{key:"getVertexBuffer",value:function(){return this._vertexBuffer}},{key:"getFramebuffer",value:function(){return this._framebuffer}},{key:"getTexture",value:function(){return this._texture}},{key:"getDepth",value:function(){return this._depth}},{key:"getInverseSize",value:function(){return this._invSize}},{key:"init",value:function(){var e=this._gl;a||(a=new s.default(e,e.ARRAY_BUFFER,e.STATIC_DRAW)).update(new Float32Array([-1,-1,4,-1,-1,4])),this._vertexBuffer=a}},{key:"onResize",value:function(e,t){var r=this._gl;this._invSize[0]=1/e,this._invSize[1]=1/t,r.bindTexture(r.TEXTURE_2D,this._texture),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,e,t,0,r.RGBA,this._type,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),this._depth&&(r.bindRenderbuffer(r.RENDERBUFFER,this._depth),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT16,e,t)),r.bindFramebuffer(r.FRAMEBUFFER,this._framebuffer),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,this._texture,0),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,this._depth),r.bindTexture(r.TEXTURE_2D,null)}},{key:"release",value:function(){this._texture&&this._gl.deleteTexture(this._texture),this.getVertexBuffer().release()}},{key:"render",value:function(e){o.default[this._shaderType].getOrCreate(this._gl).draw(this,e)}}]),e}();t.default=l}])});